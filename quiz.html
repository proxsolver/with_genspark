<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìŠµ í€´ì¦ˆ - EduPet Collection</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í•œê¸€ í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- MathJax for LaTeX support -->
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['\\(','\\)']],
                displayMath: [['\\[','\\]']],
                processEscapes: true
            },
            "HTML-CSS": {
                linebreaks: { automatic: true }
            },
            SVG: {
                linebreaks: { automatic: true }
            }
        });
    </script>

    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .font-game {
            font-family: 'Noto Sans KR', 'Comic Sans MS', cursive;
            font-weight: 600;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, 
                rgba(76, 175, 80, 0.1) 0%, 
                rgba(255, 152, 0, 0.1) 50%, 
                rgba(33, 150, 243, 0.1) 100%
            );
        }
        
        .option-btn {
            transition: all 0.2s ease;
        }
        
        .option-btn:hover {
            transform: scale(1.02);
        }
        
        .option-btn.correct {
            background-color: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .option-btn.incorrect {
            background-color: #ef4444;
            border-color: #ef4444;
            color: white;
        }
        
        .option-btn.neutral {
            background-color: #e5e7eb;
            border-color: #e5e7eb;
            color: #6b7280;
        }
        
        .confetti-animation {
            animation: confetti 1s ease-out;
        }
        
        @keyframes confetti {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .progress-fill {
            transition: width 0.5s ease-out;
        }
    </style>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            500: '#4CAF50',
                            600: '#16a34a',
                        },
                        secondary: {
                            500: '#FF9800',
                            600: '#ea580c',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="gradient-bg min-h-screen">
    <!-- í€´ì¦ˆ ì»¨í…Œì´ë„ˆ -->
    <div class="container mx-auto px-4 py-6 max-w-2xl">
        <!-- í—¤ë” -->
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-3">
                <button onclick="window.location.href='index.html'" class="p-2 rounded-lg hover:bg-white hover:shadow-md transition-all">
                    â† ëŒì•„ê°€ê¸°
                </button>
                <div class="flex items-center space-x-2">
                    <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                        ğŸ‡ºğŸ‡¸ ì˜ì–´
                    </span>
                    <span class="text-sm text-gray-600 font-medium" id="question-counter">1 / 10</span>
                </div>
            </div>
            
            <div class="flex items-center space-x-2">
                <span class="text-sm text-gray-600">ë‚¨ì€ ì‹œê°„:</span>
                <span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium" id="timer">
                    â° 9:30
                </span>
            </div>
        </div>

        <!-- ì§„í–‰ë¥  ë°” -->
        <div class="w-full bg-gray-200 rounded-full h-2 mb-6">
            <div class="bg-primary-500 h-2 rounded-full progress-fill" id="progress-bar" style="width: 10%;"></div>
        </div>

        <!-- í€´ì¦ˆ ì¹´ë“œ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 slide-in">
            <!-- ë¬¸ì œ -->
            <div class="mb-6">
                <div class="flex items-start justify-between">
                    <h2 class="text-xl font-bold text-gray-900 mb-4 flex-1" id="question-text">
                        ë‹¤ìŒ ì¤‘ 'apple'ì˜ ëœ»ì€?
                    </h2>
                    
                    <!-- TTS ë²„íŠ¼ -->
                    <button id="tts-btn" onclick="playTTS()" class="ml-4 px-3 py-1 border-2 border-primary-500 text-primary-500 rounded-lg text-sm hover:bg-primary-500 hover:text-white transition-all">
                        ğŸ”Š ë°œìŒ
                    </button>
                </div>
            </div>

            <!-- ë³´ê¸° -->
            <div class="space-y-3 mb-6" id="options-container">
                <button class="option-btn w-full p-4 text-left rounded-xl border-2 border-gray-300 hover:border-primary-500 hover:bg-primary-50 font-medium" onclick="selectOption(0)">
                    <span class="inline-block w-8 h-8 rounded-full bg-gray-100 text-center leading-8 mr-3 text-sm font-bold">A</span>
                    ì‚¬ê³¼
                </button>
                <button class="option-btn w-full p-4 text-left rounded-xl border-2 border-gray-300 hover:border-primary-500 hover:bg-primary-50 font-medium" onclick="selectOption(1)">
                    <span class="inline-block w-8 h-8 rounded-full bg-gray-100 text-center leading-8 mr-3 text-sm font-bold">B</span>
                    ë°”ë‚˜ë‚˜
                </button>
                <button class="option-btn w-full p-4 text-left rounded-xl border-2 border-gray-300 hover:border-primary-500 hover:bg-primary-50 font-medium" onclick="selectOption(2)">
                    <span class="inline-block w-8 h-8 rounded-full bg-gray-100 text-center leading-8 mr-3 text-sm font-bold">C</span>
                    ì˜¤ë Œì§€
                </button>
                <button class="option-btn w-full p-4 text-left rounded-xl border-2 border-gray-300 hover:border-primary-500 hover:bg-primary-50 font-medium" onclick="selectOption(3)">
                    <span class="inline-block w-8 h-8 rounded-full bg-gray-100 text-center leading-8 mr-3 text-sm font-bold">D</span>
                    í¬ë„
                </button>
            </div>

            <!-- í•´ì„¤ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
            <div id="explanation" class="hidden mb-6">
                <div class="p-4 rounded-xl border-2 bg-green-50 border-green-200">
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl" id="result-icon">ğŸ‰</span>
                        <div>
                            <h4 class="font-bold text-gray-900 mb-2" id="result-text">ì •ë‹µì…ë‹ˆë‹¤!</h4>
                            <p class="text-gray-700 leading-relaxed" id="explanation-text">
                                Appleì€ ì‚¬ê³¼ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì˜ì–´ì—ì„œ ê°€ì¥ ê¸°ë³¸ì ì¸ ê³¼ì¼ ë‹¨ì–´ ì¤‘ í•˜ë‚˜ì˜ˆìš”.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë‹¤ìŒ ë²„íŠ¼ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
            <div id="next-section" class="hidden text-center">
                <button onclick="nextQuestion()" class="px-8 py-3 bg-primary-500 text-white rounded-xl text-lg font-bold hover:bg-primary-600 transition-all">
                    ë‹¤ìŒ ë¬¸ì œ â¡ï¸
                </button>
            </div>
        </div>

        <!-- í•™ìŠµ í†µê³„ -->
        <div class="bg-white rounded-xl shadow-lg p-4">
            <div class="grid grid-cols-3 gap-4 text-center">
                <div>
                    <div class="text-2xl font-bold text-primary-600" id="correct-count">0</div>
                    <div class="text-sm text-gray-600">ì •ë‹µ</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-red-600" id="incorrect-count">0</div>
                    <div class="text-sm text-gray-600">ì˜¤ë‹µ</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-blue-600" id="accuracy">0%</div>
                    <div class="text-sm text-gray-600">ì •ë‹µë¥ </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ìƒ˜í”Œ ë¬¸ì œ ë°ì´í„°
        const questions = [
            {
                id: "eng_vocab_001",
                subject: "english",
                question: "ë‹¤ìŒ ì¤‘ 'apple'ì˜ ëœ»ì€?",
                options: ["ì‚¬ê³¼", "ë°”ë‚˜ë‚˜", "ì˜¤ë Œì§€", "í¬ë„"],
                correctIndex: 0,
                explanation: "Appleì€ ì‚¬ê³¼ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì˜ì–´ì—ì„œ ê°€ì¥ ê¸°ë³¸ì ì¸ ê³¼ì¼ ë‹¨ì–´ ì¤‘ í•˜ë‚˜ì˜ˆìš”.",
                audioText: "apple"
            },
            {
                id: "eng_vocab_002", 
                subject: "english",
                question: "'Good morning'ì„ í•œêµ­ì–´ë¡œ í•˜ë©´?",
                options: ["ì•ˆë…•í•˜ì„¸ìš”", "ì¢‹ì€ ì•„ì¹¨", "ì•ˆë…•íˆ ê°€ì„¸ìš”", "ê³ ë§™ìŠµë‹ˆë‹¤"],
                correctIndex: 1,
                explanation: "Good morningì€ 'ì¢‹ì€ ì•„ì¹¨'ì´ë¼ëŠ” ëœ»ìœ¼ë¡œ, ì•„ì¹¨ ì¸ì‚¬ë§ì…ë‹ˆë‹¤.",
                audioText: "Good morning"
            },
            {
                id: "eng_vocab_003",
                subject: "english", 
                question: "'Thank you'ì˜ ëœ»ì€?",
                options: ["ë¯¸ì•ˆí•´ìš”", "ê³ ë§ˆì›Œìš”", "ì•ˆë…•í•˜ì„¸ìš”", "ê´œì°®ì•„ìš”"],
                correctIndex: 1,
                explanation: "Thank youëŠ” 'ê³ ë§ˆì›Œìš”'ë¼ëŠ” ëœ»ì˜ ê¸°ë³¸ì ì¸ ê°ì‚¬ í‘œí˜„ì…ë‹ˆë‹¤.",
                audioText: "Thank you"
            }
        ];

        // ê²Œì„ ìƒíƒœ
        let currentQuestionIndex = 0;
        let correctCount = 0;
        let incorrectCount = 0;
        let isAnswered = false;
        let shuffledOptions = [];
        let timeRemaining = 600; // 10ë¶„ (600ì´ˆ)

        // íƒ€ì´ë¨¸
        function startTimer() {
            setInterval(() => {
                if (timeRemaining > 0) {
                    timeRemaining--;
                    const minutes = Math.floor(timeRemaining / 60);
                    const seconds = timeRemaining % 60;
                    document.getElementById('timer').textContent = `â° ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    // ì‹œê°„ì´ 1ë¶„ ë¯¸ë§Œì¼ ë•Œ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ê°•ì¡°
                    if (timeRemaining < 60) {
                        document.getElementById('timer').className = 'px-2 py-1 bg-red-500 text-white rounded-full text-sm font-medium animate-pulse';
                    }
                } else {
                    // ì‹œê°„ ì¢…ë£Œ
                    alert('ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    window.location.href = 'index.html';
                }
            }, 1000);
        }

        // ë³´ê¸° ì…”í”Œ í•¨ìˆ˜ (Fisher-Yates ì•Œê³ ë¦¬ì¦˜)
        function shuffleOptions(question) {
            const options = question.options.map((text, index) => ({
                text,
                originalIndex: index
            }));
            
            const shuffled = [...options];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            return shuffled;
        }

        // ë¬¸ì œ ë¡œë“œ
        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                // ëª¨ë“  ë¬¸ì œ ì™„ë£Œ
                completeQuiz();
                return;
            }

            const question = questions[currentQuestionIndex];
            shuffledOptions = shuffleOptions(question);
            isAnswered = false;

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('question-counter').textContent = `${currentQuestionIndex + 1} / ${questions.length}`;
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            const progress = ((currentQuestionIndex) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';

            // ë³´ê¸° ì—…ë°ì´íŠ¸
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            shuffledOptions.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn w-full p-4 text-left rounded-xl border-2 border-gray-300 hover:border-primary-500 hover:bg-primary-50 font-medium transition-all';
                button.onclick = () => selectOption(index);
                button.innerHTML = `
                    <span class="inline-block w-8 h-8 rounded-full bg-gray-100 text-center leading-8 mr-3 text-sm font-bold">
                        ${String.fromCharCode(65 + index)}
                    </span>
                    ${option.text}
                `;
                optionsContainer.appendChild(button);
            });

            // í•´ì„¤ê³¼ ë‹¤ìŒ ë²„íŠ¼ ìˆ¨ê¹€
            document.getElementById('explanation').classList.add('hidden');
            document.getElementById('next-section').classList.add('hidden');

            // TTS ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
            const ttsBtn = document.getElementById('tts-btn');
            if (question.audioText) {
                ttsBtn.style.display = 'block';
            } else {
                ttsBtn.style.display = 'none';
            }
        }

        // ì˜µì…˜ ì„ íƒ
        function selectOption(shuffledIndex) {
            if (isAnswered) return;

            const question = questions[currentQuestionIndex];
            const selectedOriginalIndex = shuffledOptions[shuffledIndex].originalIndex;
            const isCorrect = selectedOriginalIndex === question.correctIndex;
            
            isAnswered = true;

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            const options = document.querySelectorAll('.option-btn');
            options.forEach((btn, index) => {
                const originalIndex = shuffledOptions[index].originalIndex;
                
                if (originalIndex === question.correctIndex) {
                    // ì •ë‹µ ë²„íŠ¼
                    btn.classList.add('correct');
                    btn.innerHTML += ' <span class="ml-2 text-xl">âœ…</span>';
                } else if (index === shuffledIndex) {
                    // ì„ íƒí•œ ì˜¤ë‹µ ë²„íŠ¼
                    btn.classList.add('incorrect');
                    btn.innerHTML += ' <span class="ml-2 text-xl">âŒ</span>';
                } else {
                    // ë‚˜ë¨¸ì§€ ë²„íŠ¼ë“¤
                    btn.classList.add('neutral');
                }
                
                btn.onclick = null; // í´ë¦­ ë¹„í™œì„±í™”
            });

            // í†µê³„ ì—…ë°ì´íŠ¸
            if (isCorrect) {
                correctCount++;
                // ì •ë‹µ ì• ë‹ˆë©”ì´ì…˜
                options[shuffledIndex].classList.add('confetti-animation');
            } else {
                incorrectCount++;
            }

            updateStats();

            // í•´ì„¤ í‘œì‹œ
            setTimeout(() => {
                showExplanation(isCorrect, question.explanation);
            }, 1000);
        }

        // í•´ì„¤ í‘œì‹œ
        function showExplanation(isCorrect, explanation) {
            const explanationDiv = document.getElementById('explanation');
            const resultIcon = document.getElementById('result-icon');
            const resultText = document.getElementById('result-text');
            const explanationText = document.getElementById('explanation-text');
            const nextSection = document.getElementById('next-section');

            if (isCorrect) {
                resultIcon.textContent = 'ğŸ‰';
                resultText.textContent = 'ì •ë‹µì…ë‹ˆë‹¤!';
                explanationDiv.className = 'mb-6 p-4 rounded-xl border-2 bg-green-50 border-green-200';
            } else {
                resultIcon.textContent = 'ğŸ’¡';
                resultText.textContent = 'ì•„ì‰½ë„¤ìš”! ì •ë‹µì„ í™•ì¸í•´ë³´ì„¸ìš”.';
                explanationDiv.className = 'mb-6 p-4 rounded-xl border-2 bg-blue-50 border-blue-200';
            }

            explanationText.textContent = explanation;
            explanationDiv.classList.remove('hidden');
            
            setTimeout(() => {
                nextSection.classList.remove('hidden');
            }, 500);
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('incorrect-count').textContent = incorrectCount;
            
            const totalAnswered = correctCount + incorrectCount;
            const accuracy = totalAnswered > 0 ? Math.round((correctCount / totalAnswered) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        // TTS ì¬ìƒ
        function playTTS() {
            const question = questions[currentQuestionIndex];
            if (question.audioText && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(question.audioText);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // í€´ì¦ˆ ì™„ë£Œ
        function completeQuiz() {
            const accuracy = Math.round((correctCount / questions.length) * 100);
            
            alert(`í€´ì¦ˆ ì™„ë£Œ!\nì •ë‹µ: ${correctCount}ê°œ\nì •ë‹µë¥ : ${accuracy}%\n\nì‹ë¬¼ì´ ìëì–´ìš”! ğŸŒ±`);
            
            // ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
            window.location.href = 'index.html';
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            startTimer();
            loadQuestion();
            updateStats();
        });

        // ë’¤ë¡œê°€ê¸° í™•ì¸
        window.addEventListener('beforeunload', function(e) {
            if (currentQuestionIndex > 0 && currentQuestionIndex < questions.length) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>