<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„±ê³¼ ë° ì—…ì  - EduPet Collection</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        .achievement-card {
            transition: all 0.3s ease;
        }
        
        .achievement-card.completed {
            background: linear-gradient(135deg, #fef3c7 0%, #f59e0b 100%);
            border-color: #d97706;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }
        
        .achievement-card.locked {
            opacity: 0.6;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .achievement-progress {
            transition: width 0.5s ease;
        }
        
        .celebration {
            animation: celebrate 1s ease-out;
        }
        
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.15) rotate(5deg); }
            75% { transform: scale(1.05) rotate(-2deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-yellow-50 to-orange-50 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-6">
            <button onclick="goHome()" class="absolute left-4 top-6 text-2xl hover:scale-110 transition-transform">
                ğŸ 
            </button>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ† ì„±ê³¼ ë° ì—…ì </h1>
            <div class="text-sm text-gray-600">
                í•™ìŠµ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê³  ë³´ìƒì„ ë°›ìœ¼ì„¸ìš”!
            </div>
        </div>

        <!-- Summary Stats -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                ğŸ“Š ì „ì²´ í†µê³„
            </h2>
            <div class="grid grid-cols-3 gap-4 text-sm">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600" id="totalCorrect">0</div>
                    <div class="text-xs text-gray-500">ì´ ì •ë‹µ ìˆ˜</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600" id="totalSessions">0</div>
                    <div class="text-xs text-gray-500">í•™ìŠµ ì„¸ì…˜</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-yellow-600" id="completedAchievements">0</div>
                    <div class="text-xs text-gray-500">ë‹¬ì„± ì—…ì </div>
                </div>
            </div>
        </div>

        <!-- Achievements -->
        <div class="space-y-4">
            <h2 class="text-lg font-bold text-gray-800">ğŸ¯ ì—…ì  ëª©ë¡</h2>
            
            <div id="achievementsList">
                <!-- Achievements will be populated here -->
            </div>
        </div>

        <!-- Claim Rewards Button -->
        <div class="mt-6 text-center">
            <button id="claimRewardsBtn" onclick="claimAllRewards()" 
                    class="w-full px-6 py-3 bg-yellow-500 text-white rounded-xl font-bold hover:bg-yellow-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled>
                ğŸ ëª¨ë“  ë³´ìƒ ìˆ˜ë ¹ (0ê°œ)
            </button>
        </div>
    </div>

    <script>
        // Achievement definitions
        const achievements = [
            {
                id: 'first_quiz',
                name: 'ì²«ê±¸ìŒ',
                description: 'ì²« ë²ˆì§¸ í€´ì¦ˆ ì™„ë£Œí•˜ê¸°',
                icon: 'ğŸ¯',
                requirement: { type: 'sessions', value: 1 },
                reward: { water: 5, money: 100 },
                tier: 'bronze'
            },
            {
                id: 'correct_10',
                name: 'í•™ìŠµ ìƒˆì‹¹',
                description: 'ì •ë‹µ 10ê°œ ë‹¬ì„±',
                icon: 'ğŸŒ±',
                requirement: { type: 'totalCorrect', value: 10 },
                reward: { water: 10, money: 200 },
                tier: 'bronze'
            },
            {
                id: 'correct_25',
                name: 'ë½‘ê¸° ë§ˆìŠ¤í„°',
                description: 'ì •ë‹µ 25ê°œ ë‹¬ì„± (ì²« ë½‘ê¸°ê¶Œ!)',
                icon: 'ğŸ«',
                requirement: { type: 'totalCorrect', value: 25 },
                reward: { water: 15, money: 300, tickets: 1 },
                tier: 'silver'
            },
            {
                id: 'correct_50',
                name: 'ì§€ì‹ì˜ ë¹›',
                description: 'ì •ë‹µ 50ê°œ ë‹¬ì„±',
                icon: 'ğŸ’¡',
                requirement: { type: 'totalCorrect', value: 50 },
                reward: { water: 20, money: 500 },
                tier: 'silver'
            },
            {
                id: 'correct_100',
                name: 'í•™ìŠµ ë‹¬ì¸',
                description: 'ì •ë‹µ 100ê°œ ë‹¬ì„±',
                icon: 'ğŸ§ ',
                requirement: { type: 'totalCorrect', value: 100 },
                reward: { water: 30, money: 1000, tickets: 2 },
                tier: 'gold'
            },
            {
                id: 'sessions_5',
                name: 'ê¾¸ì¤€í•¨ì˜ í˜',
                description: 'í•™ìŠµ ì„¸ì…˜ 5íšŒ ì™„ë£Œ',
                icon: 'â­',
                requirement: { type: 'sessions', value: 5 },
                reward: { water: 25, money: 750 },
                tier: 'silver'
            },
            {
                id: 'sessions_10',
                name: 'ì„±ì‹¤í•œ í•™ìƒ',
                description: 'í•™ìŠµ ì„¸ì…˜ 10íšŒ ì™„ë£Œ',
                icon: 'ğŸ“š',
                requirement: { type: 'sessions', value: 10 },
                reward: { water: 40, money: 1500, tickets: 3 },
                tier: 'gold'
            },
            {
                id: 'perfect_quiz',
                name: 'ì™„ë²½ì£¼ì˜ì',
                description: '100% ì •ë‹µë¥  ë‹¬ì„±',
                icon: 'ğŸ’',
                requirement: { type: 'perfectAccuracy', value: 1 },
                reward: { water: 50, money: 2000, tickets: 5 },
                tier: 'diamond'
            },
            {
                id: 'animal_collector',
                name: 'ë™ë¬¼ ìˆ˜ì§‘ê°€',
                description: 'ë™ë¬¼ 10ë§ˆë¦¬ ìˆ˜ì§‘',
                icon: 'ğŸ¦',
                requirement: { type: 'animalsCollected', value: 10 },
                reward: { water: 35, money: 1200, tickets: 2 },
                tier: 'gold'
            },
            {
                id: 'plant_protector',
                name: 'ì‹ë¬¼ ìˆ˜í˜¸ì',
                description: 'ë™ë¬¼ë¡œ ì‹ë¬¼ ë³´í˜¸í•˜ê¸°',
                icon: 'ğŸ›¡ï¸',
                requirement: { type: 'plantsProtected', value: 1 },
                reward: { water: 60, money: 2500, tickets: 5 },
                tier: 'diamond'
            }
        ];

        let userProgress = {};
        let unclaimedRewards = [];

        function loadUserProgress() {
            // Load quiz progress
            const quizProgress = JSON.parse(localStorage.getItem('quizProgress') || '{}');
            const animalCollection = JSON.parse(localStorage.getItem('animalCollection') || '{}');
            const farmState = JSON.parse(localStorage.getItem('simpleFarmState') || '{}');
            
            userProgress = {
                totalCorrect: quizProgress.totalCorrect || 0,
                sessions: quizProgress.sessionCount || 0,
                perfectAccuracy: quizProgress.perfectSessions || 0,
                animalsCollected: Object.keys(animalCollection.collection || {}).length,
                plantsProtected: animalCollection.hallOfFame ? animalCollection.hallOfFame.length : 0
            };
            
            // Load achievement states
            const savedAchievements = JSON.parse(localStorage.getItem('achievements') || '{}');
            userProgress.achievements = savedAchievements;
        }

        function checkAchievements() {
            let newAchievements = [];
            
            achievements.forEach(achievement => {
                const isCompleted = userProgress.achievements[achievement.id]?.completed || false;
                const isClaimed = userProgress.achievements[achievement.id]?.claimed || false;
                
                if (!isCompleted) {
                    let requirementMet = false;
                    const req = achievement.requirement;
                    
                    switch (req.type) {
                        case 'totalCorrect':
                        case 'sessions':
                        case 'perfectAccuracy':
                        case 'animalsCollected':
                        case 'plantsProtected':
                            requirementMet = userProgress[req.type] >= req.value;
                            break;
                    }
                    
                    if (requirementMet) {
                        // Mark as completed
                        if (!userProgress.achievements[achievement.id]) {
                            userProgress.achievements[achievement.id] = {};
                        }
                        userProgress.achievements[achievement.id].completed = true;
                        userProgress.achievements[achievement.id].completedAt = Date.now();
                        newAchievements.push(achievement);
                    }
                }
                
                // Check for unclaimed rewards
                if (isCompleted && !isClaimed) {
                    unclaimedRewards.push(achievement);
                }
            });
            
            // Save updated achievements
            localStorage.setItem('achievements', JSON.stringify(userProgress.achievements));
            
            // Show celebration for new achievements
            if (newAchievements.length > 0) {
                showAchievementNotification(newAchievements);
            }
            
            return newAchievements.length > 0;
        }

        function displayAchievements() {
            const container = document.getElementById('achievementsList');
            
            container.innerHTML = achievements.map(achievement => {
                const isCompleted = userProgress.achievements[achievement.id]?.completed || false;
                const isClaimed = userProgress.achievements[achievement.id]?.claimed || false;
                const progress = getAchievementProgress(achievement);
                
                const cardClass = isCompleted ? 'completed' : 'locked';
                const rewardText = formatReward(achievement.reward);
                
                return `
                    <div class="achievement-card ${cardClass} rounded-lg border-2 p-4 ${isCompleted && !isClaimed ? 'celebration' : ''}">
                        <div class="flex items-start space-x-3">
                            <div class="text-3xl">${achievement.icon}</div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-1">
                                    <div class="font-bold text-gray-800">${achievement.name}</div>
                                    <div class="text-xs px-2 py-1 rounded-full ${getTierColor(achievement.tier)}">${getTierName(achievement.tier)}</div>
                                </div>
                                <div class="text-sm text-gray-600 mb-2">${achievement.description}</div>
                                
                                <!-- Progress Bar -->
                                <div class="bg-gray-200 rounded-full h-2 mb-2">
                                    <div class="achievement-progress bg-blue-500 h-2 rounded-full" 
                                         style="width: ${Math.min(progress.current / progress.total * 100, 100)}%"></div>
                                </div>
                                <div class="text-xs text-gray-500 mb-2">
                                    ${progress.current}/${progress.total} ${progress.unit}
                                </div>
                                
                                <!-- Reward -->
                                <div class="text-xs ${isCompleted ? 'text-yellow-700' : 'text-gray-500'}">
                                    ğŸ ë³´ìƒ: ${rewardText}
                                </div>
                                
                                <!-- Status -->
                                <div class="mt-2">
                                    ${isCompleted && isClaimed ? 
                                        '<span class="text-xs px-2 py-1 bg-green-100 text-green-600 rounded-full">âœ… ìˆ˜ë ¹ ì™„ë£Œ</span>' :
                                        isCompleted && !isClaimed ?
                                        '<span class="text-xs px-2 py-1 bg-yellow-100 text-yellow-600 rounded-full">ğŸ ìˆ˜ë ¹ ëŒ€ê¸°</span>' :
                                        '<span class="text-xs px-2 py-1 bg-gray-100 text-gray-500 rounded-full">â³ ì§„í–‰ ì¤‘</span>'
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getAchievementProgress(achievement) {
            const req = achievement.requirement;
            let current = 0;
            let unit = '';
            
            switch (req.type) {
                case 'totalCorrect':
                    current = userProgress.totalCorrect;
                    unit = 'ì •ë‹µ';
                    break;
                case 'sessions':
                    current = userProgress.sessions;
                    unit = 'ì„¸ì…˜';
                    break;
                case 'perfectAccuracy':
                    current = userProgress.perfectAccuracy;
                    unit = 'ì™„ë²½í•œ í€´ì¦ˆ';
                    break;
                case 'animalsCollected':
                    current = userProgress.animalsCollected;
                    unit = 'ë™ë¬¼';
                    break;
                case 'plantsProtected':
                    current = userProgress.plantsProtected;
                    unit = 'ë³´í˜¸';
                    break;
            }
            
            return { current, total: req.value, unit };
        }

        function getTierColor(tier) {
            const colors = {
                bronze: 'bg-orange-100 text-orange-600',
                silver: 'bg-gray-100 text-gray-600', 
                gold: 'bg-yellow-100 text-yellow-600',
                diamond: 'bg-blue-100 text-blue-600'
            };
            return colors[tier] || colors.bronze;
        }

        function getTierName(tier) {
            const names = {
                bronze: 'ë¸Œë¡ ì¦ˆ',
                silver: 'ì‹¤ë²„',
                gold: 'ê³¨ë“œ', 
                diamond: 'ë‹¤ì´ì•„'
            };
            return names[tier] || tier;
        }

        function formatReward(reward) {
            const parts = [];
            if (reward.water) parts.push(`ğŸ’§${reward.water}`);
            if (reward.money) parts.push(`ğŸ’°${reward.money}ì›`);
            if (reward.tickets) parts.push(`ğŸ«${reward.tickets}ì¥`);
            return parts.join(', ');
        }

        function updateStats() {
            document.getElementById('totalCorrect').textContent = userProgress.totalCorrect;
            document.getElementById('totalSessions').textContent = userProgress.sessions;
            
            const completedCount = achievements.filter(a => 
                userProgress.achievements[a.id]?.completed
            ).length;
            document.getElementById('completedAchievements').textContent = completedCount;
            
            // Update claim button
            const claimBtn = document.getElementById('claimRewardsBtn');
            if (unclaimedRewards.length > 0) {
                claimBtn.disabled = false;
                claimBtn.textContent = `ğŸ ëª¨ë“  ë³´ìƒ ìˆ˜ë ¹ (${unclaimedRewards.length}ê°œ)`;
            } else {
                claimBtn.disabled = true;
                claimBtn.textContent = 'ğŸ ìˆ˜ë ¹í•  ë³´ìƒ ì—†ìŒ';
            }
        }

        function claimAllRewards() {
            if (unclaimedRewards.length === 0) return;
            
            let totalRewards = { water: 0, money: 0, tickets: 0 };
            
            unclaimedRewards.forEach(achievement => {
                const reward = achievement.reward;
                if (reward.water) totalRewards.water += reward.water;
                if (reward.money) totalRewards.money += reward.money;
                if (reward.tickets) totalRewards.tickets += reward.tickets;
                
                // Mark as claimed
                userProgress.achievements[achievement.id].claimed = true;
            });
            
            // Apply rewards to game state
            const farmState = JSON.parse(localStorage.getItem('simpleFarmState') || '{}');
            farmState.water = (farmState.water || 0) + totalRewards.water;
            farmState.money = (farmState.money || 0) + totalRewards.money;
            localStorage.setItem('simpleFarmState', JSON.stringify(farmState));
            
            // Save achievement states
            localStorage.setItem('achievements', JSON.stringify(userProgress.achievements));
            
            // Show reward notification
            alert(`ğŸ‰ ë³´ìƒì„ ë°›ì•˜ìŠµë‹ˆë‹¤!\n\nğŸ’§ ë¬¼ë°©ìš¸: ${totalRewards.water}ê°œ\nğŸ’° ëˆ: ${totalRewards.money}ì›\nğŸ« ë½‘ê¸°ê¶Œ: ${totalRewards.tickets}ì¥\n\nê³„ì†í•´ì„œ ëª©í‘œë¥¼ ë‹¬ì„±í•´ë³´ì„¸ìš”!`);
            
            // Refresh display
            unclaimedRewards = [];
            updateStats();
            displayAchievements();
        }

        function showAchievementNotification(newAchievements) {
            const messages = newAchievements.map(a => `ğŸ† ${a.name} ë‹¬ì„±!`).join('\n');
            alert(`ì¶•í•˜í•©ë‹ˆë‹¤!\n\n${messages}\n\nì—…ì  í˜ì´ì§€ì—ì„œ ë³´ìƒì„ ë°›ìœ¼ì„¸ìš”!`);
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadUserProgress();
            checkAchievements();
            updateStats();
            displayAchievements();
        });
    </script>
</body>
</html>