<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ë¬¼ ìˆ˜ì§‘ - EduPet Collection</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- Plant System -->
    <script src="plant-system.js"></script>

    <!-- Firebase í†µí•© ìŠ¤í¬ë¦½íŠ¸ -->
    <script defer src="firebase-config.js"></script>
    <script defer src="firebase-auth.js"></script>
    <script defer src="firebase-integration.js"></script>

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        .animal-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #cbd5e1;
            transition: all 0.3s ease;
        }
        
        .animal-card.common {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-color: #94a3b8;
        }
        
        .animal-card.rare {
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
            border-color: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        .animal-card.epic {
            background: linear-gradient(135deg, #f3e8ff 0%, #c084fc 100%);
            border-color: #8b5cf6;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
            animation: epic-glow 2s ease-in-out infinite alternate;
        }
        
        .animal-card.legendary {
            background: linear-gradient(135deg, #fef3c7 0%, #f59e0b 100%);
            border-color: #d97706;
            box-shadow: 0 0 25px rgba(217, 119, 6, 0.5);
            animation: legendary-glow 1.5s ease-in-out infinite alternate;
        }
        
        @keyframes epic-glow {
            from { box-shadow: 0 0 20px rgba(139, 92, 246, 0.4); }
            to { box-shadow: 0 0 30px rgba(139, 92, 246, 0.6); }
        }
        
        @keyframes legendary-glow {
            from { box-shadow: 0 0 25px rgba(217, 119, 6, 0.5); }
            to { box-shadow: 0 0 35px rgba(217, 119, 6, 0.7); }
        }
        
        .gacha-button {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            transition: all 0.3s ease;
        }
        
        .gacha-button:hover {
            background: linear-gradient(45deg, #1d4ed8, #1e3a8a);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4);
        }
        
        .gacha-animation {
            animation: gacha-shake 0.6s ease-in-out;
        }
        
        @keyframes gacha-shake {
            0%, 100% { transform: rotate(0deg); }
            10%, 30%, 50%, 70%, 90% { transform: rotate(-2deg); }
            20%, 40%, 60%, 80% { transform: rotate(2deg); }
        }
        
        .animal-appear {
            animation: animal-appear 1s ease-out;
        }
        
        @keyframes animal-appear {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(50px);
            }
            50% {
                transform: scale(1.1) translateY(-10px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        /* íƒœë¸”ë¦¿ ì´ìƒ */
        @media (min-width: 768px) {
            .collection-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 16px;
            }
        }

        /* PC í™”ë©´ */
        @media (min-width: 1024px) {
            .collection-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 20px;
            }
        }

        /* í° PC í™”ë©´ */
        @media (min-width: 1440px) {
            .collection-grid {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 24px;
            }
        }
        
        .tier-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Loading Indicator -->
    <div id="loading-overlay" class="hidden fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="text-2xl animate-spin">ğŸ¾</div>
            <div class="mt-2 font-bold text-gray-700">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>
    <div class="container mx-auto px-4 py-6 max-w-md lg:max-w-6xl xl:max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-6">
            <button onclick="goHome()" class="absolute left-4 top-6 text-2xl hover:scale-110 transition-transform">
                ğŸ 
            </button>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ¦ ë™ë¬¼ ìˆ˜ì§‘</h1>
            <div class="text-sm text-gray-600 space-y-1">
                <div>
                    ì¼ë°˜ ë½‘ê¸°ê¶Œ: <span id="ticketCount" class="font-bold text-blue-600">0</span>ê°œ
                    <span class="mx-2">|</span>
                    ë³´ìœ  ì½”ì¸: <span id="coinCount" class="font-bold text-yellow-600">0</span>
                </div>
                <div>
                    <span class="text-purple-600">âœ¨ í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ: <span id="premiumTicketCount" class="font-bold">0</span>ê°œ</span>
                </div>
            </div>
        </div>

        <!-- Gacha Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="text-center mb-4">
                <div class="text-6xl mb-4" id="gachaBox">ğŸ“¦</div>
                <h2 class="text-lg font-bold text-gray-800 mb-2">ë™ë¬¼ ë½‘ê¸°</h2>

                <!-- Regular Gacha -->
                <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                    <h3 class="text-sm font-bold text-blue-800 mb-2">ì¼ë°˜ ë½‘ê¸°</h3>
                    <div class="text-xs text-gray-600 mb-3">
                        <div class="grid grid-cols-2 gap-2 text-left">
                            <div>ğŸ”˜ ì¼ë°˜: 60%</div>
                            <div>ğŸ”µ ë ˆì–´: 30%</div>
                            <div>ğŸŸ£ ì—í”½: 9%</div>
                            <div>ğŸŸ¡ ì „ì„¤: 1%</div>
                        </div>
                    </div>
                    <button
                        id="gachaButton"
                        onclick="drawAnimal()"
                        class="gacha-button text-white px-6 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed w-full"
                        disabled>
                        ë½‘ê¸°ê¶Œì´ ë¶€ì¡±í•©ë‹ˆë‹¤
                    </button>
                    <button
                        id="buyTicketButton"
                        onclick="buyTicket()"
                        class="mt-2 bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed w-full text-sm">
                        ì¼ë°˜ ë½‘ê¸°ê¶Œ êµ¬ë§¤ (100 ì½”ì¸)
                    </button>
                </div>

                <!-- Premium Gacha -->
                <div class="p-3 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg border-2 border-purple-300">
                    <h3 class="text-sm font-bold text-purple-800 mb-2">âœ¨ í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°</h3>
                    <div class="text-xs text-purple-700 mb-3">
                        <div class="grid grid-cols-2 gap-2 text-left">
                            <div>ğŸ”˜ ì¼ë°˜: 5%</div>
                            <div>ğŸ”µ ë ˆì–´: 62%</div>
                            <div>ğŸŸ£ ì—í”½: 30%</div>
                            <div>ğŸŸ¡ ì „ì„¤: 3%</div>
                        </div>
                    </div>
                    <button
                        id="premiumGachaButton"
                        onclick="drawPremiumAnimal()"
                        class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed w-full transition-all"
                        disabled>
                        í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œì´ ë¶€ì¡±í•©ë‹ˆë‹¤
                    </button>
                    <button
                        id="buyPremiumTicketButton"
                        onclick="buyPremiumTicket()"
                        class="mt-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-2 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed w-full text-sm">
                        í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ êµ¬ë§¤ (500 ì½”ì¸)
                    </button>
                </div>
            </div>
        </div>

        <!-- Latest Draw Result -->
        <div id="latestDraw" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
            <h3 class="font-bold text-gray-800 mb-3 text-center">ğŸ‰ ìƒˆë¡œìš´ ë™ë¬¼!</h3>
            <div id="newAnimalCard" class="animal-card rounded-lg p-4 text-center animal-appear">
                <!-- New animal will be displayed here -->
            </div>
        </div>

        <!-- Collection -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                ğŸ“š ë‚˜ì˜ ë„ê° 
                <span id="collectionCount" class="ml-2 text-sm bg-blue-100 text-blue-600 px-2 py-1 rounded-full">0/500</span>
            </h2>
            
            <div id="collectionGrid" class="collection-grid">
                <!-- Animal collection will be displayed here -->
            </div>
            
            <div class="mt-4 text-center space-y-2">
                <button onclick="window.location.href='hall-of-fame.html'" class="block w-full px-4 py-2 bg-purple-500 text-white rounded-lg text-sm hover:bg-purple-600 transition-colors">
                    ğŸ›ï¸ ëª…ì˜ˆì˜ ì „ë‹¹
                </button>
                <button onclick="clearCollection()" class="text-xs text-gray-500 hover:text-red-500 transition-colors">
                    ğŸ—‘ï¸ ì»¬ë ‰ì…˜ ì´ˆê¸°í™”
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
            <h2 class="text-lg font-bold text-gray-800 mb-4">ğŸ“Š ìˆ˜ì§‘ í†µê³„</h2>
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div class="text-center">
                    <div class="text-2xl font-bold text-gray-700" id="totalDraws">0</div>
                    <div class="text-xs text-gray-500">ì´ ë½‘ê¸° íšŸìˆ˜</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-yellow-600" id="legendaryCount">0</div>
                    <div class="text-xs text-gray-500">ì „ì„¤ ë™ë¬¼ ìˆ˜</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë™ë¬¼ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <div id="animalDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" onclick="closeAnimalDetail()">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all" onclick="event.stopPropagation()">
            <!-- ë‹«ê¸° ë²„íŠ¼ -->
            <button onclick="closeAnimalDetail()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl">Ã—</button>

            <!-- ë™ë¬¼ ì •ë³´ -->
            <div id="animalDetailContent" class="text-center">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ë™ë¬¼ ì´ëª¨ì§€ì™€ ì‹¤ì œ ì´ë¦„ ë§¤í•‘
        const animalDatabase = [
            { emoji: 'ğŸ•', names: ['ê³¨ë“ ë¦¬íŠ¸ë¦¬ë²„', 'ì§„ë—ê°œ', 'ë¹„ê¸€', 'í¬ë©”ë¼ë‹ˆì•ˆ', 'í—ˆìŠ¤í‚¤', 'ì¹˜ì™€ì™€', 'ì›°ì‹œì½”ê¸°', 'ë¶ˆë…', 'ì‹œë°”ê²¬', 'ë§í‹°ì¦ˆ'] },
            { emoji: 'ğŸ±', names: ['í˜ë¥´ì‹œì•ˆ', 'ëŸ¬ì‹œì•ˆë¸”ë£¨', 'ìƒ´ê³ ì–‘ì´', 'ìŠ¤í•‘í¬ìŠ¤', 'ë©”ì¸ì¿¤', 'ë±…ê°ˆ', 'ë™ëŒ', 'ì•„ë¹„ì‹œë‹ˆì•ˆ', 'ë¸Œë¦¬í‹°ì‹œìˆí—¤ì–´', 'ì½”ë¦¬ì•ˆìˆí—¤ì–´'] },
            { emoji: 'ğŸ°', names: ['ì•™ê³ ë¼í† ë¼', 'ë¡­ì´ì–´', 'ë„¤ëœë€ë“œë“œì›Œí”„', 'í”Œë ˆë¯¸ì‹œìì´ì–¸íŠ¸', 'ë¼ì´ì˜¨í—¤ë“œ', 'ë ‰ìŠ¤í† ë¼', 'ë¯¸ë‹ˆë¡­', 'í•˜ì–€í† ë¼', 'íšŒìƒ‰í† ë¼', 'ì–¼ë£©í† ë¼'] },
            { emoji: 'ğŸ¹', names: ['ê³¨ë“ í–„ìŠ¤í„°', 'ë“œì›Œí”„í–„ìŠ¤í„°', 'ì‹œë¦¬ì•ˆí–„ìŠ¤í„°', 'ë¡œë³´ë¡œë¸ŒìŠ¤í‚¤', 'ìº ë²¨í–„ìŠ¤í„°', 'ì°¨ì´ë‹ˆì¦ˆí–„ìŠ¤í„°', 'ìœˆí„°í™”ì´íŠ¸', 'í„í™”ì´íŠ¸', 'í‘¸ë”©í–„ìŠ¤í„°', 'ë¸”ë™í–„ìŠ¤í„°'] },
            { emoji: 'ğŸ¦', names: ['ì°¸ìƒˆ', 'ê¹Œì¹˜', 'ê¹Œë§ˆê·€', 'ë¹„ë‘˜ê¸°', 'ì§ë°•êµ¬ë¦¬', 'ë°•ìƒˆ', 'ë™ë°•ìƒˆ', 'ë©§ìƒˆ', 'ì´‰ìƒˆ', 'ë¶‰ì€ë¨¸ë¦¬ì˜¤ëª©ëˆˆì´'] },
            { emoji: 'ğŸ ', names: ['ì—´ëŒ€ì–´', 'êµ¬í”¼', 'ë„¤ì˜¨í…ŒíŠ¸ë¼', 'ì—”ì ¤í”¼ì‰¬', 'ë² íƒ€', 'ë””ìŠ¤ì»¤ìŠ¤', 'ë¼ë¯¸ë ˆì§€', 'í”Œë¼í‹°', 'ëª°ë¦¬', 'í…ŒíŠ¸ë¼'] },
            { emoji: 'ğŸ¢', names: ['ë¶‰ì€ê·€ê±°ë¶', 'ëŠ‘ëŒ€ê±°ë¶', 'ìœ¡ì§€ê±°ë¶', 'ìë¼', 'ë°”ë‹¤ê±°ë¶', 'ê°ˆë¼íŒŒê³ ìŠ¤ê±°ë¶', 'ë ˆì˜¤íŒŒë“œê±°ë¶', 'ìœ¡ì§€ê±°ë¶', 'ë¨¸ìŠ¤í¬í„°í‹€', 'ìŠ¤ë„¤ì´í¬ë„¥'] },
            { emoji: 'ğŸ¸', names: ['ì²­ê°œêµ¬ë¦¬', 'í™©ì†Œê°œêµ¬ë¦¬', 'ë¬´ë‹¹ê°œêµ¬ë¦¬', 'íŠ¸ë¦¬í”„ë¡', 'ì˜¥ìƒ‰ê°œêµ¬ë¦¬', 'ìˆ˜ë¦¬ë‚¨ê°œêµ¬ë¦¬', 'ì•„í”„ë¦¬ì¹´ë°œí†±ê°œêµ¬ë¦¬', 'ì–‘ì„œë¥˜', 'ë¶‰ì€ê°œêµ¬ë¦¬', 'ìš°ëŠ”ê°œêµ¬ë¦¬'] },
            { emoji: 'ğŸ”', names: ['ë¡œë“œì•„ì¼ëœë“œ', 'ë ˆê·¸í˜¼', 'ì½”ì¹œ', 'ì˜¤ê³¨ê³„', 'ì‹¤í‚¤', 'í”Œë¦¬ë¨¸ìŠ¤ë½', 'ì™€ì´ì–¸ë„íŠ¸', 'ë¸Œë¼ë§ˆ', 'ì˜¤ë¥´í•‘í„´', 'ì„œì„¹ìŠ¤'] },
            { emoji: 'ğŸ·', names: ['ëœë“œë ˆì´ìŠ¤', 'ìš”í¬ì…”', 'ë“€ë¡', 'ë²„í¬ì…”', 'í–„í”„ì…”', 'ì²´ìŠ¤í„°í™”ì´íŠ¸', 'í”¼ì—íŠ¸ë ˆì¸', 'ìŠ¤íŒŸ', 'íƒ¬ì›ŒìŠ¤', 'ë¼ì§€í™”ì´íŠ¸'] },
            { emoji: 'ğŸ„', names: ['í™€ìŠ¤íƒ€ì¸', 'ì €ì§€', 'í•œìš°', 'ì•µê±°ìŠ¤', 'í—¤ë¦¬í¼ë“œ', 'ë¸Œë¼ë§Œ', 'ìƒ¤ë¡¤ë ˆ', 'ë¦¼ë¬´ì§„', 'ì‹¬ë©˜íƒˆ', 'ë²¨ì§€ì•ˆë¸”ë£¨'] },
            { emoji: 'ğŸ‘', names: ['ë©”ë¦¬ë…¸', 'ì„œí½', 'ë„ì…‹', 'ë¨ë¶€ì˜ˆ', 'ë§ì»¨', 'ì½”ë¦¬ë°ì¼', 'ë¡¬ë‹ˆ', 'ì„œí”„ë‹¤ìš´', 'ì²´ë¹„ì—‡', 'ì»¬ëŸ¼ë¹„ì•„'] },
            { emoji: 'ğŸ­', names: ['ìƒì¥', 'ì‹œê¶ì¥', 'ë“¤ì¥', 'ì§‘ì¥', 'í°ì¥', 'í•˜ì–€ìƒì¥', 'ê²€ì€ì¥', 'ê°ˆìƒ‰ì¥', 'ì‘ì€ì¥', 'í°ì¥'] },
            { emoji: 'ğŸ»', names: ['ë°˜ë‹¬ê°€ìŠ´ê³°', 'ë¶ˆê³°', 'íšŒìƒ‰ê³°', 'í‘ê³°', 'ë§ë ˆì´ê³°', 'ì•ˆê²½ê³°', 'ë‚˜ë¬´ëŠ˜ë³´ê³°', 'í°ê³°', 'ì‘ì€ê³°', 'ì‚°ê³°'] },
            { emoji: 'ğŸ¨', names: ['ì½”ì•Œë¼', 'í€¸ì¦ëœë“œì½”ì•Œë¼', 'ë¹…í† ë¦¬ì•„ì½”ì•Œë¼', 'ë‰´ì‚¬ìš°ìŠ¤ì›¨ì¼ìŠ¤ì½”ì•Œë¼'] },
            { emoji: 'ğŸ¦Š', names: ['ë¶‰ì€ì—¬ìš°', 'ë¶ê·¹ì—¬ìš°', 'ì‚¬ë§‰ì—¬ìš°', 'íšŒìƒ‰ì—¬ìš°', 'í˜ë„¥ì—¬ìš°', 'ì€ì—¬ìš°', 'ëŒ€ë¦¬ì„ì—¬ìš°', 'ì‹­ìì—¬ìš°', 'ì¹´ë¼ì¹¼ì—¬ìš°', 'ì½”ë¥´ì‚­ì—¬ìš°'] },
            { emoji: 'ğŸº', names: ['íšŒìƒ‰ëŠ‘ëŒ€', 'ë¶ê·¹ëŠ‘ëŒ€', 'í‹°ë² íŠ¸ëŠ‘ëŒ€', 'ì‹œë² ë¦¬ì•„ëŠ‘ëŒ€', 'ê²€ì€ëŠ‘ëŒ€', 'í°ëŠ‘ëŒ€', 'ë¶‰ì€ëŠ‘ëŒ€', 'ë©•ì‹œì½”ëŠ‘ëŒ€', 'ì´ì§‘íŠ¸ëŠ‘ëŒ€', 'íˆë§ë¼ì•¼ëŠ‘ëŒ€'] },
            { emoji: 'ğŸ¦', names: ['ì•„í”„ë¦¬ì¹´ì‚¬ì', 'ì•„ì‹œì•„ì‚¬ì', 'ë°”ë°”ë¦¬ì‚¬ì', 'ì¼€ì´í”„ì‚¬ì', 'íŠ¸ë€ìŠ¤ë°œì‚¬ì', 'ì½©ê³ ì‚¬ì', 'ì„¸ë„¤ê°ˆì‚¬ì', 'ì¹´íƒ€ë¦¬ë‚˜ì‚¬ì', 'ë°±ì‚¬ì', 'ê²€ì€ê°ˆê¸°ì‚¬ì'] },
            { emoji: 'ğŸ¯', names: ['ë²µê³¨í˜¸ë‘ì´', 'ì‹œë² ë¦¬ì•„í˜¸ë‘ì´', 'ìˆ˜ë§ˆíŠ¸ë¼í˜¸ë‘ì´', 'ì¸ë„ì°¨ì´ë‚˜í˜¸ë‘ì´', 'ë°±í˜¸', 'ë§ë ˆì´í˜¸ë‘ì´', 'ì•„ë¬´ë¥´í˜¸ë‘ì´', 'ì¹´ìŠ¤í”¼í˜¸ë‘ì´', 'ìë°”í˜¸ë‘ì´', 'ë°œë¦¬í˜¸ë‘ì´'] },
            { emoji: 'ğŸ˜', names: ['ì•„í”„ë¦¬ì¹´ì½”ë¼ë¦¬', 'ì•„ì‹œì•„ì½”ë¼ë¦¬', 'ì‚¬ë°”ë‚˜ì½”ë¼ë¦¬', 'ìˆ²ì½”ë¼ë¦¬', 'ì¸ë„ì½”ë¼ë¦¬', 'ìŠ¤ë¦¬ë‘ì¹´ì½”ë¼ë¦¬', 'ìˆ˜ë§ˆíŠ¸ë¼ì½”ë¼ë¦¬', 'ë³´ë¥´ë„¤ì˜¤ì½”ë¼ë¦¬', 'ë§¤ë¨¸ë“œ', 'ë§ˆìŠ¤í† ëˆ'] },
            { emoji: 'ğŸ¦’', names: ['ë§ˆì‚¬ì´ê¸°ë¦°', 'ë ˆí‹°í˜ë ˆì´í‹°ë“œê¸°ë¦°', 'ë¡œìŠ¤ì°¨ì¼ë“œê¸°ë¦°', 'ì†Œë§ë¦¬ì•„ê¸°ë¦°', 'ë‚¨ì•„í”„ë¦¬ì¹´ê¸°ë¦°', 'ì•™ê³¨ë¼ê¸°ë¦°', 'ì½”ë¥´ë„íŒê¸°ë¦°', 'ëˆ„ë¹„ì•„ê¸°ë¦°', 'ìš°ê°„ë‹¤ê¸°ë¦°'] },
            { emoji: 'ğŸ¦“', names: ['í‰ì›ì–¼ë£©ë§', 'ì‚°ì•…ì–¼ë£©ë§', 'ê·¸ë ˆë¹„ì–¼ë£©ë§', 'ë²„ì²¼ì–¼ë£©ë§', 'ì±„í”„ë§Œì–¼ë£©ë§', 'í¬ì™€ê°€ì–¼ë£©ë§', 'í•˜íŠ¸ë§Œì‚°ì•…ì–¼ë£©ë§'] },
            { emoji: 'ğŸ¼', names: ['ìì´ì–¸íŠ¸íŒë‹¤', 'ë ˆì„œíŒë‹¤', 'ë¶‰ì€íŒë‹¤', 'í°íŒë‹¤', 'ì‘ì€íŒë‹¤', 'ì“°ì´¨íŒë‹¤', 'ì¹œë§íŒë‹¤'] },
            { emoji: 'ğŸµ', names: ['ì¼ë³¸ì›ìˆ­ì´', 'ë¶‰ì€í„¸ì›ìˆ­ì´', 'ê²Œì¡ì´ì›ìˆ­ì´', 'ë‹¤ëŒì¥ì›ìˆ­ì´', 'ë§ˆëª¨ì…‹', 'íƒ€ë§ˆë¦°', 'ì¹´í‘¸ì¹œì›ìˆ­ì´', 'ë§¨ë“œë¦´', 'ë¹„ë¹„', 'íˆíˆ'] },
            { emoji: 'ğŸ§', names: ['í™©ì œí­ê·„', 'ì  íˆ¬í­ê·„', 'ì•„ë¸ë¦¬í­ê·„', 'í‚¹í­ê·„', 'ë§ˆì¹´ë¡œë‹ˆí­ê·„', 'ë¡œì—´í­ê·„', 'ë¡í˜¸í¼í­ê·„', 'í­ê·„', 'ì‘ì€í­ê·„', 'ê°ˆë¼íŒŒê³ ìŠ¤í­ê·„'] },
            { emoji: 'ğŸ¦‰', names: ['ìˆ˜ë¦¬ë¶€ì—‰ì´', 'ì˜¬ë¹¼ë¯¸', 'ì†Œì©ìƒˆ', 'ì‡ ë¶€ì—‰ì´', 'í°ì˜¬ë¹¼ë¯¸', 'ë¶‰ì€ì˜¬ë¹¼ë¯¸', 'í°ì†Œì©ìƒˆ', 'ê¸´ê¼¬ë¦¬ì˜¬ë¹¼ë¯¸', 'ì¹¡ë¶€ì—‰ì´', 'ì†”ë¶€ì—‰ì´'] },
            { emoji: 'ğŸ¦…', names: ['ë…ìˆ˜ë¦¬', 'í°ë¨¸ë¦¬ìˆ˜ë¦¬', 'ê²€ë…ìˆ˜ë¦¬', 'í™©ê¸ˆë…ìˆ˜ë¦¬', 'ì°¸ìˆ˜ë¦¬', 'ì‡ ìˆ˜ë¦¬', 'í°ê¼¬ë¦¬ìˆ˜ë¦¬', 'ê²€ì€ë…ìˆ˜ë¦¬', 'ì™•ë…ìˆ˜ë¦¬', 'ë¹„ë‹¨ë±€ìˆ˜ë¦¬'] },
            { emoji: 'ğŸ¦†', names: ['ì²­ë‘¥ì˜¤ë¦¬', 'í°ëº¨ê²€ë‘¥ì˜¤ë¦¬', 'ì‡ ì˜¤ë¦¬', 'ê³ ë°©ì˜¤ë¦¬', 'í‘ì˜¤ë¦¬', 'ê°€ì°½ì˜¤ë¦¬', 'ì•Œë½ì˜¤ë¦¬', 'ë„“ì ë¶€ë¦¬', 'ë¹„ì˜¤ë¦¬', 'ì›ì•™'] },
            { emoji: 'ğŸ¦¢', names: ['í˜¹ê³ ë‹ˆ', 'í°ê³ ë‹ˆ', 'ê³ ë‹ˆ', 'í‘ê³ ë‹ˆ', 'ì½”ìŠ¤ì½”ë¡œë°”ê³ ë‹ˆ', 'íŠ¸ëŸ¼í«ê³ ë‹ˆ', 'íœ˜íŒŒëŒê³ ë‹ˆ'] },
            { emoji: 'ğŸ¦œ', names: ['ê¸ˆê°•ì•µë¬´', 'ìœ í™©ì•µë¬´', 'íšŒìƒ‰ì•µë¬´', 'ì½”ë‰´ì–´', 'ëª¨ë€ì•µë¬´', 'ì‚¬ë‘ì•µë¬´', 'ì•„ë§ˆì¡´ì•µë¬´', 'ë§ˆì½”ì•µë¬´', 'ì½”ì¹´íˆ¬', 'ë¡œë¦¬'] },
            { emoji: 'ğŸ¦©', names: ['í™í•™', 'ì¹ ë ˆí™í•™', 'ì¹´ë¦¬ë¸Œí™í•™', 'ì œì„ìŠ¤í™í•™', 'ì•ˆë°ìŠ¤í™í•™', 'ì‘ì€í™í•™', 'í°í™í•™'] },
            { emoji: 'ğŸ¦š', names: ['ì¸ë„ê³µì‘', 'ë…¹ê³µì‘', 'ë°±ê³µì‘', 'ì²­ê³µì‘', 'ê³µê³ ê³µì‘'] },
            { emoji: 'ğŸ¦ƒ', names: ['ì¹ ë©´ì¡°', 'ì•¼ìƒì¹ ë©´ì¡°', 'ê°€ì¶•ì¹ ë©´ì¡°', 'ë¸Œë¡ ì¦ˆì¹ ë©´ì¡°', 'í™”ì´íŠ¸ì¹ ë©´ì¡°'] },
            { emoji: 'ğŸ“', names: ['ìˆ˜íƒ‰', 'íˆ¬ê³„', 'ê¼¬ê¼¬ëŒ', 'ì¥ë¼', 'ìš°ëŠ”ë‹­'] },
            { emoji: 'ğŸ¤', names: ['ë³‘ì•„ë¦¬', 'ë…¸ë€ë³‘ì•„ë¦¬', 'í°ë³‘ì•„ë¦¬', 'ê°ˆìƒ‰ë³‘ì•„ë¦¬', 'ê²€ì€ë³‘ì•„ë¦¬'] },
            { emoji: 'ğŸ¦‡', names: ['í°ë°•ì¥', 'ì‘ì€ë°•ì¥', 'ê³¼ì¼ë°•ì¥', 'í¡í˜ˆë°•ì¥', 'ê´€ë°•ì¥', 'ë§êµ½ë°•ì¥', 'ì—¬ìš°ë°•ì¥', 'ê¸´ê°€ë½ë°•ì¥', 'ì§‘ë°•ì¥', 'ë™êµ´ë°•ì¥'] },
            { emoji: 'ğŸ', names: ['ê¿€ë²Œ', 'í˜¸ë°•ë²Œ', 'ë•…ë²Œ', 'ëª©ìˆ˜ë²Œ', 'ê°€ìœ„ë²Œ', 'ë¬´ì¹¨ë²Œ', 'ê³ ì¹˜ë²Œ', 'ë§ë²Œ', 'ì™•ë²Œ', 'ì¼ë²Œ'] },
            { emoji: 'ğŸ›', names: ['ì• ë²Œë ˆ', 'ëˆ„ì—', 'ì²­ì¶©', 'ë‚˜ë¹„ì• ë²Œë ˆ', 'ë‚˜ë°©ì• ë²Œë ˆ', 'ì²œë§‰ë²Œë ˆ', 'ì†”ë‚˜ë°©', 'ë§¤ë¯¸ë‚˜ë°©', 'ë°•ê°ì‹œ', 'ë°¤ë‚˜ë°©'] },
            { emoji: 'ğŸ¦‹', names: ['í˜¸ë‘ë‚˜ë¹„', 'ì œë¹„ë‚˜ë¹„', 'ì²­ë ì œë¹„ë‚˜ë¹„', 'ì‚°í˜¸ë‘ë‚˜ë¹„', 'ë‚¨ë°©ë…¸ë‘ë‚˜ë¹„', 'ë°°ì¶”í°ë‚˜ë¹„', 'í°ì¤„í°ë‚˜ë¹„', 'ë¨¹ê·¸ë¦¼ë‚˜ë¹„', 'ì™•ì˜¤ìƒ‰ë‚˜ë¹„', 'ì‘ì€ë©‹ìŸì´ë‚˜ë¹„'] },
            { emoji: 'ğŸŒ', names: ['ë‹¬íŒ½ì´', 'ì•„í”„ë¦¬ì¹´ì™•ë‹¬íŒ½ì´', 'í¬ë„ë‹¬íŒ½ì´', 'ì •ì›ë‹¬íŒ½ì´', 'ë¯¼ë‹¬íŒ½ì´', 'ë¶‰ì€ë‹¬íŒ½ì´', 'ê±°ë¶ë‹¬íŒ½ì´', 'ë‹¬íŒ½ì´ë¥˜'] },
            { emoji: 'ğŸ', names: ['ë¬´ë‹¹ë²Œë ˆ', 'ì¹ ì„±ë¬´ë‹¹ë²Œë ˆ', 'ì´ì‹­íŒ”ì ë°•ì´ë¬´ë‹¹ë²Œë ˆ', 'ì´ì‹­ì´ì ë°•ì´ë¬´ë‹¹ë²Œë ˆ', 'ì• ê¸°ë¬´ë‹¹ë²Œë ˆ', 'í°ì´ì‹­íŒ”ì ë°•ì´ë¬´ë‹¹ë²Œë ˆ', 'ì½©ë¬´ë‹¹ë²Œë ˆ', 'ë‚¨ìƒ‰ë¬´ë‹¹ë²Œë ˆ'] },
            { emoji: 'ğŸœ', names: ['ê°œë¯¸', 'ë¶ˆê°œë¯¸', 'ëª©ìˆ˜ê°œë¯¸', 'í–‰êµ°ê°œë¯¸', 'ìê¾¼ê°œë¯¸', 'ì¼ê°œë¯¸', 'ì—¬ì™•ê°œë¯¸', 'ìˆ˜ê°œë¯¸', 'í°ê°œë¯¸', 'ë¶ˆë…ê°œë¯¸'] },
            { emoji: 'ğŸ¦—', names: ['ê·€ëšœë¼ë¯¸', 'ë°©ìš¸ë²Œë ˆ', 'ì—¬ì¹˜', 'ë©”ëšœê¸°', 'ë² ì§±ì´', 'ì™•ê·€ëšœë¼ë¯¸', 'ë•…ê°•ì•„ì§€', 'ê¸´ê¼¬ë¦¬ê·€ëšœë¼ë¯¸', 'ê¿€ë²Œë ˆ', 'ìŒ•ìŒ”ê¸°'] },
            { emoji: 'ğŸ•·ï¸', names: ['ì™•ê±°ë¯¸', 'ë¬´ë‹¹ê±°ë¯¸', 'ê¹¡ì¶©ê±°ë¯¸', 'ëŠ‘ëŒ€ê±°ë¯¸', 'íƒ€ë€íˆ´ë¼', 'ë…ê±°ë¯¸', 'ì§‘ê±°ë¯¸', 'í™©ê¸ˆê±°ë¯¸', 'ì‹­ìê±°ë¯¸', 'ê²Œê±°ë¯¸'] },
            { emoji: 'ğŸ¦‚', names: ['ì „ê°ˆ', 'í™©ê¸ˆì „ê°ˆ', 'ê²€ì€ì „ê°ˆ', 'ë¶‰ì€ì „ê°ˆ', 'í™©ì œì „ê°ˆ', 'ë…ì „ê°ˆ', 'ì‚¬ë§‰ì „ê°ˆ', 'ìˆ²ì „ê°ˆ', 'ë‚˜ë¬´ì „ê°ˆ', 'ëŒì „ê°ˆ'] },
            { emoji: 'ğŸ™', names: ['ë¬¸ì–´', 'ëŒ€ì™•ë¬¸ì–´', 'ì‘ì€ë¬¸ì–´', 'í‘œë²”ë¬¸ì–´', 'ì²­ë¬¸ì–´', 'ëŒë¬¸ì–´', 'ì£¼ê¾¸ë¯¸', 'ë‚™ì§€', 'ì—°ì–´ë¬¸ì–´', 'ê°‘ì˜¤ì§•ì–´'] },
            { emoji: 'ğŸ¦‘', names: ['ì˜¤ì§•ì–´', 'ê°‘ì˜¤ì§•ì–´', 'ëŒ€ì™•ì˜¤ì§•ì–´', 'í™”ì‚´ì˜¤ì§•ì–´', 'ì‚´ì˜¤ì§•ì–´', 'ê¼´ëšœê¸°', 'í•œì¹˜', 'ë°˜ë”§ë¶ˆì˜¤ì§•ì–´', 'ê¹Šì€ë°”ë‹¤ì˜¤ì§•ì–´'] },
            { emoji: 'ğŸ¦', names: ['ìƒˆìš°', 'ëŒ€í•˜', 'ë³´ë¦¬ìƒˆìš°', 'ë‹­ìƒˆìš°', 'í°ë‹¤ë¦¬ìƒˆìš°', 'ì™•ìƒˆìš°', 'í’€ìƒˆìš°', 'ì “ìƒˆìš°', 'ë¯¼ë¬¼ìƒˆìš°', 'ê°€ì‹œìƒˆìš°'] },
            { emoji: 'ğŸ¦', names: ['ë°”ë‹·ê°€ì¬', 'ëìŠ¤í„°', 'ë‹­ìƒˆìš°', 'ê°€ì‹œë°”ë‹·ê°€ì¬', 'ì™•ë°”ë‹·ê°€ì¬', 'ìœ ëŸ½ë°”ë‹·ê°€ì¬', 'ë¯¸êµ­ë°”ë‹·ê°€ì¬', 'ë…¸ë¥´ì›¨ì´ë°”ë‹·ê°€ì¬'] },
            { emoji: 'ğŸ¦€', names: ['ê²Œ', 'ê½ƒê²Œ', 'ëŒ€ê²Œ', 'í„¸ê²Œ', 'ë¯¼ê½ƒê²Œ', 'ë¶‰ì€ëŒ€ê²Œ', 'ì°¸ê²Œ', 'ë°”ìœ„ê²Œ', 'ë‹¬ë‘ê²Œ', 'ë°©ê²Œ'] },
            { emoji: 'ğŸ¡', names: ['ë³µì–´', 'í™©ë³µ', 'ê²€ë³µ', 'ê¹Œì¹˜ë³µ', 'í°ì ë³µ', 'ë³„ë³µ', 'ë§¤ëˆë³µ', 'ì°¸ë³µ', 'ê±°ë¶ë³µ', 'í‘ë³µ'] },
            { emoji: 'ğŸŸ', names: ['ë¬¼ê³ ê¸°', 'ì‰ì–´', 'ë¶•ì–´', 'í–¥ì–´', 'ì´ˆì–´', 'í”¼ë¼ë¯¸', 'ì†¡ì‚¬ë¦¬', 'ë©”ê¸°', 'ë¯¸ê¾¸ë¼ì§€', 'ë¯¸ê¾¸ë¦¬'] },
            { emoji: 'ğŸ¬', names: ['ëŒê³ ë˜', 'í°ëŒê³ ë˜', 'ì°¸ëŒê³ ë˜', 'ë‚¨ë°©í°ëŒê³ ë˜', 'í°ëŒê³ ë˜', 'ê²€ì€ëŒê³ ë˜', 'ì‡ ëŒê³ ë˜', 'ë¬¼ëŒê³ ë˜', 'ìƒê´­ì´', 'í°ìƒê´­ì´'] },
            { emoji: 'ğŸ³', names: ['ê³ ë˜', 'í°ìˆ˜ì—¼ê³ ë˜', 'ê¸´ìˆ˜ì—¼ê³ ë˜', 'ê·€ì‹ ê³ ë˜', 'ì°¸ê³ ë˜', 'ë°í¬ê³ ë˜', 'ë³´ë¦¬ê³ ë˜', 'í‘ê³ ë˜', 'ëŒ€ì™•ê³ ë˜', 'í˜¹ë“±ê³ ë˜'] },
            { emoji: 'ğŸ‹', names: ['í–¥ìœ ê³ ë˜', 'ë²”ê³ ë˜', 'í°ê¸´ìˆ˜ì—¼ê³ ë˜', 'ì‡ ê³ ë˜', 'ë¶€ë¦¬ê³ ë˜', 'ì°¸ë¶€ë¦¬ê³ ë˜', 'ë‚¨ë°©ê¸´ìˆ˜ì—¼ê³ ë˜', 'ë¶ê·¹ê³ ë˜', 'ë‚¨ê·¹ë°í¬ê³ ë˜'] },
            { emoji: 'ğŸ¦ˆ', names: ['ìƒì–´', 'ë°±ìƒì•„ë¦¬', 'ì²­ìƒì•„ë¦¬', 'ê·€ìƒì–´', 'ë”ìƒì–´', 'í‘ê¸°í‰ìƒì–´', 'ë°±ê¸°í‰ìƒì–´', 'ê³ ë˜ìƒì–´', 'ë§ì¹˜ìƒì–´', 'í†±ìƒì–´'] },
            { emoji: 'ğŸŠ', names: ['ì•…ì–´', 'ë‚˜ì¼ì•…ì–´', 'ë°”ë‹¤ì•…ì–´', 'ë¯¸ì‹œì‹œí”¼ì•…ì–´', 'ì•„ë©”ë¦¬ì¹´ì•…ì–´', 'ì¹´ì´ë§Œ', 'ì•¨ë¦¬ê²Œì´í„°', 'ê°€ë¹„ì•Œ', 'í°ì•…ì–´', 'ì‘ì€ì•…ì–´'] },
            { emoji: 'ğŸ…', names: ['í˜¸ë‘ì´', 'ë°±í˜¸', 'í‘í˜¸', 'ê¸ˆí˜¸', 'ì²­í˜¸'] },
            { emoji: 'ğŸ†', names: ['í‘œë²”', 'ì•„í”„ë¦¬ì¹´í‘œë²”', 'ì•„ë¬´ë¥´í‘œë²”', 'í˜ë¥´ì‹œì•„í‘œë²”', 'ì¸ë„ì°¨ì´ë‚˜í‘œë²”', 'ìë°”í‘œë²”', 'ìŠ¤ë¦¬ë‘ì¹´í‘œë²”', 'ì•„ë¼ë¹„ì•„í‘œë²”', 'í‘í‘œë²”', 'ì„¤í‘œë²”'] },
            { emoji: 'ğŸ¦', names: ['ê³ ë¦´ë¼', 'ë§ˆìš´í‹´ê³ ë¦´ë¼', 'ë™ë¶€ì €ì§€ëŒ€ê³ ë¦´ë¼', 'ì„œë¶€ì €ì§€ëŒ€ê³ ë¦´ë¼', 'í¬ë¡œìŠ¤ë¦¬ë²„ê³ ë¦´ë¼', 'ì‹¤ë²„ë°±ê³ ë¦´ë¼'] },
            { emoji: 'ğŸ¦§', names: ['ì˜¤ë‘ìš°íƒ„', 'ë³´ë¥´ë„¤ì˜¤ì˜¤ë‘ìš°íƒ„', 'ìˆ˜ë§ˆíŠ¸ë¼ì˜¤ë‘ìš°íƒ„', 'íƒ€íŒŒëˆŒë¦¬ì˜¤ë‘ìš°íƒ„'] },
            { emoji: 'ğŸª', names: ['ë‹¨ë´‰ë‚™íƒ€', 'ì•„ë¼ë¹„ì•„ë‚™íƒ€', 'ë“œë¡œë©”ë‹¤ë¦¬'] },
            { emoji: 'ğŸ«', names: ['ìŒë´‰ë‚™íƒ€', 'ë°•íŠ¸ë¦¬ì•„ë‚™íƒ€', 'ëª½ê³¨ë‚™íƒ€', 'ì•¼ìƒë‚™íƒ€'] },
            { emoji: 'ğŸ¦™', names: ['ë¼ë§ˆ', 'ì•ŒíŒŒì¹´', 'ê³¼ë‚˜ì½”', 'ë¹„ì¿ ëƒ'] },
            { emoji: 'ğŸ¦˜', names: ['ìº¥ê±°ë£¨', 'ë¶‰ì€ìº¥ê±°ë£¨', 'ë™ë¶€íšŒìƒ‰ìº¥ê±°ë£¨', 'ì„œë¶€íšŒìƒ‰ìº¥ê±°ë£¨', 'ë‚˜ë¬´ìº¥ê±°ë£¨', 'ì™ˆë¼ë¹„', 'ì™ˆë¼ë£¨'] },
            { emoji: 'ğŸ¦¥', names: ['ë‚˜ë¬´ëŠ˜ë³´', 'ì„¸ë°œê°€ë½ë‚˜ë¬´ëŠ˜ë³´', 'ë‘ë°œê°€ë½ë‚˜ë¬´ëŠ˜ë³´', 'ê°ˆìƒ‰ëª©ë‚˜ë¬´ëŠ˜ë³´', 'ì°½ë°±ëª©ë‚˜ë¬´ëŠ˜ë³´', 'í”¼ê·¸ë¯¸ë‚˜ë¬´ëŠ˜ë³´'] },
            { emoji: 'ğŸ¦¦', names: ['ìˆ˜ë‹¬', 'ìœ ë¼ì‹œì•„ìˆ˜ë‹¬', 'í•´ë‹¬', 'ì‘ì€ë°œí†±ìˆ˜ë‹¬', 'ë¯¼ë¬¼ìˆ˜ë‹¬', 'í°ìˆ˜ë‹¬', 'ê±°ëŒ€ìˆ˜ë‹¬', 'ë§¤ë„ëŸ¬ìš´ìˆ˜ë‹¬'] },
            { emoji: 'ğŸ¦¨', names: ['ìŠ¤ì»¹í¬', 'ì¤„ë¬´ëŠ¬ìŠ¤ì»¹í¬', 'ì ë°•ì´ìŠ¤ì»¹í¬', 'ë¼ì§€ì½”ìŠ¤ì»¹í¬', 'í›„ë“œìŠ¤ì»¹í¬'] },
            { emoji: 'ğŸ¦¡', names: ['ì˜¤ì†Œë¦¬', 'ìœ ë¼ì‹œì•„ì˜¤ì†Œë¦¬', 'ì•„ë©”ë¦¬ì¹´ì˜¤ì†Œë¦¬', 'ê¿€ì˜¤ì†Œë¦¬', 'ì¡±ì œë¹„ì˜¤ì†Œë¦¬', 'ë¼ì§€ì˜¤ì†Œë¦¬'] },
            { emoji: 'ğŸ©', names: ['í‘¸ë“¤', 'í† ì´í‘¸ë“¤', 'ë¯¸ë‹ˆì–´ì²˜í‘¸ë“¤', 'ìŠ¤íƒ ë‹¤ë“œí‘¸ë“¤'] }
        ];

        // ë™ë¬¼ 500ê°œ ìë™ ìƒì„±
        function generateAnimals() {
            const animals = { common: [], rare: [], epic: [], legendary: [] };
            let idCounter = 1;

            // Common (300ê°œ) - power 1
            let commonIndex = 0;
            for (let i = 0; i < 300; i++) {
                const animalData = animalDatabase[commonIndex % animalDatabase.length];
                const nameIndex = Math.floor(i / animalDatabase.length) % animalData.names.length;
                animals.common.push({
                    id: `common_${idCounter++}`,
                    name: animalData.names[nameIndex],
                    emoji: animalData.emoji,
                    power: 1
                });
                commonIndex++;
            }

            // Rare (150ê°œ) - power 2-3
            let rareIndex = 0;
            for (let i = 0; i < 150; i++) {
                const animalData = animalDatabase[rareIndex % animalDatabase.length];
                const nameIndex = Math.floor(i / animalDatabase.length) % animalData.names.length;
                const baseName = animalData.names[nameIndex];
                const prefixes = ['ìš©ë§¹í•œ', 'ë¯¼ì²©í•œ', 'ì§€í˜œë¡œìš´', 'ê°•ì¸í•œ', 'ë‚ ë µí•œ', 'ì˜ë¦¬í•œ', 'ë‹¹ë‹¹í•œ', 'ìœ„í’ë‹¹ë‹¹í•œ', 'ë©‹ì§„', 'ë¹›ë‚˜ëŠ”'];
                animals.rare.push({
                    id: `rare_${idCounter++}`,
                    name: `${prefixes[i % prefixes.length]} ${baseName}`,
                    emoji: animalData.emoji,
                    power: 2 + (i % 2)
                });
                rareIndex++;
            }

            // Epic (45ê°œ) - power 5-7
            let epicIndex = 0;
            for (let i = 0; i < 45; i++) {
                const animalData = animalDatabase[epicIndex % animalDatabase.length];
                const nameIndex = Math.floor(i / animalDatabase.length) % animalData.names.length;
                const baseName = animalData.names[nameIndex];
                const prefixes = ['ì „ì„¤ì˜', 'ì‹ í™”ì˜', 'ê³ ëŒ€ì˜', 'í™˜ìƒì˜', 'ì‹ ë¹„í•œ', 'ë§ˆë²•ì˜', 'ì²œìƒì˜', 'ì˜ê´‘ì˜', 'ì°¬ë€í•œ'];
                animals.epic.push({
                    id: `epic_${idCounter++}`,
                    name: `${prefixes[i % prefixes.length]} ${baseName}`,
                    emoji: animalData.emoji + 'âœ¨',
                    power: 5 + (i % 3)
                });
                epicIndex++;
            }

            // Legendary (5ê°œ) - power 10-15
            const legendaryAnimals = [
                { emoji: 'ğŸ¦', name: 'ìš°ì£¼ì‚¬ì ë ˆì˜¤' },
                { emoji: 'ğŸ‰', name: 'ì‹œê³µë£¡ í¬ë¡œë…¸ìŠ¤' },
                { emoji: 'ğŸ¦…', name: 'ê´‘ëª…ë…ìˆ˜ë¦¬ ë£¨ë¯¸ë„ˆìŠ¤' },
                { emoji: 'ğŸº', name: 'ì•”í‘ëŠ‘ëŒ€ í˜ë„¤ìŠ¤' },
                { emoji: 'ğŸ¦‰', name: 'ì§€í˜œë¶€ì—‰ì´ ì†Œí”¼ì•„' }
            ];
            for (let i = 0; i < 5; i++) {
                animals.legendary.push({
                    id: `legendary_${i + 1}`,
                    name: legendaryAnimals[i].name,
                    emoji: legendaryAnimals[i].emoji + 'ğŸŒŸğŸ’«',
                    power: 10 + i
                });
            }

            return animals;
        }

        // Animal database (500ê°œ)
        const generatedAnimals = generateAnimals();

        // ì „ì—­ìœ¼ë¡œ ì‚¬ìš©í•  animals ê°ì²´ (í‹°ì–´ë³„ ë¶„ë¥˜)
        const animals = {
            common: generatedAnimals.common,
            rare: generatedAnimals.rare,
            epic: generatedAnimals.epic,
            legendary: generatedAnimals.legendary
        };

        const allAnimals = [
            ...generatedAnimals.common,
            ...generatedAnimals.rare,
            ...generatedAnimals.epic,
            ...generatedAnimals.legendary
        ];
        console.log(`âœ… ë™ë¬¼ ${allAnimals.length}ê°œ ìƒì„± ì™„ë£Œ!`);

        // Game state
        let gameState = {
            animals: allAnimals,  // 500ë§ˆë¦¬ ë™ë¬¼ ë°ì´í„°ë² ì´ìŠ¤
            collection: {},
            stats: {
                totalDraws: 0,
                legendaryCount: 0
            }
        };

        // Get tickets from plant-system
        function getTicketsFromPlantSystem() {
            try {
                const userData = JSON.parse(localStorage.getItem('plantSystemUser') || '{}');
                return {
                    normal: userData?.rewards?.normalGachaTickets || 0,
                    premium: userData?.rewards?.premiumGachaTickets || 0
                };
            } catch (e) {
                console.error('Error reading tickets from plant-system:', e);
                return { normal: 0, premium: 0 };
            }
        }

        // Use a ticket from plant-system
        function useTicketFromPlantSystem(isPremium = false) {
            try {
                const userData = JSON.parse(localStorage.getItem('plantSystemUser') || '{}');
                if (!userData.rewards) return false;

                if (isPremium) {
                    if (userData.rewards.premiumGachaTickets > 0) {
                        userData.rewards.premiumGachaTickets--;
                        localStorage.setItem('plantSystemUser', JSON.stringify(userData));
                        return true;
                    }
                } else {
                    if (userData.rewards.normalGachaTickets > 0) {
                        userData.rewards.normalGachaTickets--;
                        localStorage.setItem('plantSystemUser', JSON.stringify(userData));
                        return true;
                    }
                }
                return false;
            } catch (e) {
                console.error('Error using ticket:', e);
                return false;
            }
        }

        // Migrate old animal data to new level system
        function migrateAnimalData() {
            let needsSave = false;

            Object.keys(gameState.collection).forEach(animalId => {
                const animal = gameState.collection[animalId];

                // ë ˆë²¨ í•„ë“œê°€ ì—†ìœ¼ë©´ ì¶”ê°€
                if (!animal.level) {
                    animal.level = 1;
                    needsSave = true;
                }

                // ê²½í—˜ì¹˜ í•„ë“œê°€ ì—†ìœ¼ë©´ ì¶”ê°€
                if (animal.exp === undefined) {
                    animal.exp = 0;
                    needsSave = true;
                }

                // ì¤‘ë³µ ì¹´ë“œ ê°œìˆ˜ê°€ ì—†ìœ¼ë©´ ì¶”ê°€ (count - 1ë¡œ ê³„ì‚°)
                if (animal.duplicates === undefined) {
                    animal.duplicates = Math.max(0, (animal.count || 1) - 1);
                    needsSave = true;
                }

                // totalPowerê°€ ì—†ìœ¼ë©´ ê³„ì‚°
                if (!animal.totalPower) {
                    animal.totalPower = (animal.power || 1) * (animal.level || 1);
                    needsSave = true;
                }
            });

            if (needsSave) {
                saveGameState();
                console.log('âœ… ë™ë¬¼ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!');
            }
        }

        // Load game state
        async function loadGameState() {
            const saved = localStorage.getItem('animalCollection');
            if (saved) {
                const savedData = JSON.parse(saved);

                // animals ë°°ì—´ì´ ì—†ìœ¼ë©´ ì´ˆê¸° ìƒì„±ëœ 500ë§ˆë¦¬ ìœ ì§€
                gameState = {
                    animals: savedData.animals || allAnimals,  // ì €ì¥ëœ ë°ì´í„° ì—†ìœ¼ë©´ ì´ˆê¸° 500ë§ˆë¦¬ ì‚¬ìš©
                    collection: savedData.collection || {},
                    stats: savedData.stats || { totalDraws: 0, legendaryCount: 0 }
                };

                // ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
                migrateAnimalData();
            } else {
                console.log('âš ï¸ ì²« ë°©ë¬¸ì…ë‹ˆë‹¤. 500ë§ˆë¦¬ ë™ë¬¼ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.');
                // gameStateëŠ” ì´ë¯¸ allAnimalsë¡œ ì´ˆê¸°í™”ë˜ì–´ ìˆìŒ
            }

            // plantSystemì—ì„œ ëˆ ê°€ì ¸ì˜¤ê¸°
            const money = plantSystem.getMoney();
            updateDisplay(money);
        }

        // Save game state
        function saveGameState() {
            localStorage.setItem('animalCollection', JSON.stringify(gameState));
        }

        // ========== ë ˆë²¨ì—… ì‹œìŠ¤í…œ ==========

        // ë ˆë²¨ë³„ í•„ìš” ì¤‘ë³µ ì¹´ë“œ ìˆ˜
        const LEVEL_UP_REQUIREMENTS = {
            1: { duplicates: 1, nextLevel: 2 },  // Lv1â†’2: ì¤‘ë³µ 1ì¥
            2: { duplicates: 2, nextLevel: 3 },  // Lv2â†’3: ì¤‘ë³µ 2ì¥
            3: { duplicates: 3, nextLevel: 4 },  // Lv3â†’4: ì¤‘ë³µ 3ì¥
            4: { duplicates: 5, nextLevel: 5 },  // Lv4â†’5: ì¤‘ë³µ 5ì¥
            5: { duplicates: 0, nextLevel: 5 }   // MAX level
        };

        // ë ˆë²¨ë³„ ëŠ¥ë ¥ì¹˜ ê³„ì‚° (íŒŒì›Œë§Œ)
        function calculateAnimalAbilities(animal) {
            if (!animal) return { totalPower: 0 };

            const level = animal.level || 1;
            const basePower = animal.power || 1;

            return {
                // ì´ íŒŒì›Œ (ê¸°ë³¸ íŒŒì›Œ * ë ˆë²¨)
                totalPower: basePower * level
            };
        }

        // ë ˆë²¨ì—… ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        function canLevelUp(animalId) {
            const animal = gameState.collection[animalId];
            if (!animal) return false;

            const currentLevel = animal.level || 1;
            if (currentLevel >= 5) return false; // MAX ë ˆë²¨

            const requirement = LEVEL_UP_REQUIREMENTS[currentLevel];
            return animal.duplicates >= requirement.duplicates;
        }

        // ë™ë¬¼ ë ˆë²¨ì—… ì‹¤í–‰
        function levelUpAnimal(animalId) {
            const animal = gameState.collection[animalId];
            if (!animal) {
                console.error('ë™ë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', animalId);
                return false;
            }

            const currentLevel = animal.level || 1;
            if (currentLevel >= 5) {
                alert('ì´ë¯¸ ìµœëŒ€ ë ˆë²¨ì…ë‹ˆë‹¤!');
                return false;
            }

            const requirement = LEVEL_UP_REQUIREMENTS[currentLevel];
            if (animal.duplicates < requirement.duplicates) {
                alert(`ë ˆë²¨ì—…ì— ì¤‘ë³µ ì¹´ë“œê°€ ${requirement.duplicates}ì¥ í•„ìš”í•©ë‹ˆë‹¤.\ní˜„ì¬: ${animal.duplicates}ì¥`);
                return false;
            }

            // ë ˆë²¨ì—… ì‹¤í–‰
            animal.duplicates -= requirement.duplicates;
            animal.level = requirement.nextLevel;

            // íŒŒì›Œ ì¬ê³„ì‚°
            const abilities = calculateAnimalAbilities(animal);
            animal.totalPower = abilities.totalPower;

            saveGameState();

            console.log(`âœ¨ ${animal.name} ë ˆë²¨ì—…! Lv.${currentLevel} â†’ Lv.${animal.level}`);
            console.log('ìƒˆë¡œìš´ ëŠ¥ë ¥:', abilities);

            return {
                success: true,
                newLevel: animal.level,
                abilities: abilities,
                animal: animal
            };
        }

        // ê²½í—˜ì¹˜ ì¶”ê°€ (í•™ìŠµ ì‹œ ì‚¬ìš©)
        function addAnimalExp(animalId, exp) {
            const animal = gameState.collection[animalId];
            if (!animal) return;

            animal.exp = (animal.exp || 0) + exp;
            saveGameState();
        }

        // Buy a ticket with coins
        function buyTicket() {
            const ticketPrice = 100;

            // plantSystemì„ ì‚¬ìš©í•´ì„œ ëˆ ì°¨ê°
            const result = plantSystem.spendMoney(ticketPrice);

            if (result.success) {
                // Add ticket to plant-system
                try {
                    const plantSystemUser = plantSystem.getUserData();
                    if (!plantSystemUser.rewards) {
                        plantSystemUser.rewards = {
                            growthTickets: [],
                            normalGachaTickets: 0,
                            premiumGachaTickets: 0
                        };
                    }
                    plantSystemUser.rewards.normalGachaTickets = (plantSystemUser.rewards.normalGachaTickets || 0) + 1;
                    plantSystem.saveUserData(plantSystemUser);

                    console.log('âœ… Normal ticket purchased and added to plant-system');

                    alert('ì¼ë°˜ ë½‘ê¸°ê¶Œ 1ê°œë¥¼ 100ì½”ì¸ìœ¼ë¡œ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!');

                    // Update the entire display
                    updateDisplay(result.currentMoney);

                    // Firebase í†µê³„ ì—…ë°ì´íŠ¸
                    if (typeof updateFirebaseStats !== 'undefined') {
                        updateFirebaseStats.animal({
                            action: 'buy_ticket',
                            cost: ticketPrice
                        });
                    }
                } catch (e) {
                    console.error('Error adding ticket to plant-system:', e);
                    alert('ë½‘ê¸°ê¶Œ êµ¬ë§¤ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }

            } else {
                alert(`ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í˜„ì¬ ì½”ì¸: ${result.currentMoney})`);
            }
        }

        // Buy a premium ticket with coins
        function buyPremiumTicket() {
            const ticketPrice = 500;

            // plantSystemì„ ì‚¬ìš©í•´ì„œ ëˆ ì°¨ê°
            const result = plantSystem.spendMoney(ticketPrice);

            if (result.success) {
                // Add premium ticket to plant-system
                try {
                    const plantSystemUser = plantSystem.getUserData();
                    if (!plantSystemUser.rewards) {
                        plantSystemUser.rewards = {
                            growthTickets: [],
                            normalGachaTickets: 0,
                            premiumGachaTickets: 0
                        };
                    }
                    plantSystemUser.rewards.premiumGachaTickets = (plantSystemUser.rewards.premiumGachaTickets || 0) + 1;
                    plantSystem.saveUserData(plantSystemUser);

                    console.log('âœ… Premium ticket purchased and added to plant-system');

                    alert('í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ 1ê°œë¥¼ 500ì½”ì¸ìœ¼ë¡œ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!');

                    // Update the entire display
                    updateDisplay(result.currentMoney);

                    // Firebase í†µê³„ ì—…ë°ì´íŠ¸
                    if (typeof updateFirebaseStats !== 'undefined') {
                        updateFirebaseStats.animal({
                            action: 'buy_premium_ticket',
                            cost: ticketPrice
                        });
                    }
                } catch (e) {
                    console.error('Error adding premium ticket to plant-system:', e);
                    alert('í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ êµ¬ë§¤ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }

            } else {
                alert(`ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í˜„ì¬ ì½”ì¸: ${result.currentMoney})`);
            }
        }

        // Draw animal with gacha mechanics
        function drawAnimal() {
            const tickets = getTicketsFromPlantSystem();
            if (tickets.normal <= 0) {
                alert('ì¼ë°˜ ë½‘ê¸°ê¶Œì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
                return;
            }

            // Use ticket from plant-system
            if (!useTicketFromPlantSystem(false)) {
                alert('í‹°ì¼“ ì‚¬ìš©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            gameState.stats.totalDraws++;

            // Animate gacha box
            const gachaBox = document.getElementById('gachaBox');
            gachaBox.classList.add('gacha-animation');
            
            setTimeout(() => {
                gachaBox.classList.remove('gacha-animation');
                
                // Determine tier based on probability
                const rand = Math.random();
                let tier, animal;
                
                if (rand < 0.01) { // 1% legendary
                    tier = 'legendary';
                } else if (rand < 0.10) { // 9% epic
                    tier = 'epic';
                } else if (rand < 0.40) { // 30% rare
                    tier = 'rare';
                } else { // 60% common
                    tier = 'common';
                }
                
                // Select random animal from tier
                const tierAnimals = animals[tier];
                animal = tierAnimals[Math.floor(Math.random() * tierAnimals.length)];
                
                // Add to collection with level system
                if (!gameState.collection[animal.id]) {
                    gameState.collection[animal.id] = {
                        ...animal,
                        tier,
                        count: 0,
                        level: 1,              // ë ˆë²¨ (1-5)
                        exp: 0,                // ê²½í—˜ì¹˜
                        duplicates: 0,         // ì¤‘ë³µ ì¹´ë“œ ê°œìˆ˜ (í•©ì„±ì— ì‚¬ìš©)
                        totalPower: animal.power // ì‹¤ì œ íŒŒì›Œ (ë ˆë²¨ * ê¸°ë³¸ íŒŒì›Œ)
                    };
                }

                // ì¤‘ë³µ ì¹´ë“œ íšë“ ì‹œ
                if (gameState.collection[animal.id].count > 0) {
                    gameState.collection[animal.id].duplicates++;
                    console.log(`ğŸ”¥ ì¤‘ë³µ ì¹´ë“œ íšë“! ${animal.name} - ì¤‘ë³µ ${gameState.collection[animal.id].duplicates}ì¥`);
                }

                gameState.collection[animal.id].count++;
                
                // Update legendary count
                if (tier === 'legendary') {
                    gameState.stats.legendaryCount++;
                }
                
                // Show new animal
                showNewAnimal(animal, tier);
                
                // Play sound
                playDrawSound(tier);
                
                // Vibrate
                if (navigator.vibrate) {
                    const pattern = tier === 'legendary' ? [100, 50, 100, 50, 200] :
                                  tier === 'epic' ? [100, 50, 150] :
                                  tier === 'rare' ? [100, 100] : [100];
                    navigator.vibrate(pattern);
                }
                
                // Firebase í†µê³„ ì—…ë°ì´íŠ¸
                if (typeof updateFirebaseStats !== 'undefined') {
                    updateFirebaseStats.animal({
                        animalId: animal.id,
                        name: animal.name,
                        tier: tier,
                        cost: 1, // ë½‘ê¸°ê¶Œ 1ì¥ ì‚¬ìš©
                        isNewAnimal: gameState.collection[animal.id].count === 1
                    });
                }
                
                saveGameState();
                // We need to reload money status to update display correctly
                const money = plantSystem.getMoney();
                updateDisplay(money);
                
            }, 600);
        }

        // Draw premium animal (Common:5%, Rare:62%, Epic:30%, Legendary:3%)
        function drawPremiumAnimal() {
            const tickets = getTicketsFromPlantSystem();
            if (tickets.premium <= 0) {
                alert('í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
                return;
            }

            // Use premium ticket from plant-system
            if (!useTicketFromPlantSystem(true)) {
                alert('í‹°ì¼“ ì‚¬ìš©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            gameState.stats.totalDraws++;

            // Animate gacha box
            const gachaBox = document.getElementById('gachaBox');
            gachaBox.classList.add('gacha-animation');

            setTimeout(() => {
                gachaBox.classList.remove('gacha-animation');

                // Premium gacha: Common 5%, Rare 62%, Epic 30%, Legendary 3%
                const rand = Math.random();
                let tier, animal;

                if (rand < 0.03) { // 3% legendary
                    tier = 'legendary';
                } else if (rand < 0.33) { // 30% epic (0.03 + 0.30 = 0.33)
                    tier = 'epic';
                } else if (rand < 0.95) { // 62% rare (0.33 + 0.62 = 0.95)
                    tier = 'rare';
                } else { // 5% common (0.95 + 0.05 = 1.00)
                    tier = 'common';
                }

                // Select random animal from tier
                const tierAnimals = animals[tier];
                animal = tierAnimals[Math.floor(Math.random() * tierAnimals.length)];

                // Add to collection with level system
                if (!gameState.collection[animal.id]) {
                    gameState.collection[animal.id] = {
                        ...animal,
                        tier,
                        count: 0,
                        level: 1,              // ë ˆë²¨ (1-5)
                        exp: 0,                // ê²½í—˜ì¹˜
                        duplicates: 0,         // ì¤‘ë³µ ì¹´ë“œ ê°œìˆ˜ (í•©ì„±ì— ì‚¬ìš©)
                        totalPower: animal.power // ì‹¤ì œ íŒŒì›Œ (ë ˆë²¨ * ê¸°ë³¸ íŒŒì›Œ)
                    };
                }

                // ì¤‘ë³µ ì¹´ë“œ íšë“ ì‹œ
                if (gameState.collection[animal.id].count > 0) {
                    gameState.collection[animal.id].duplicates++;
                    console.log(`ğŸ”¥ ì¤‘ë³µ ì¹´ë“œ íšë“! ${animal.name} - ì¤‘ë³µ ${gameState.collection[animal.id].duplicates}ì¥`);
                }

                gameState.collection[animal.id].count++;

                // Update legendary count
                if (tier === 'legendary') {
                    gameState.stats.legendaryCount++;
                }

                // Show new animal with premium indicator
                showNewAnimal(animal, tier, true);

                // Play sound
                playDrawSound(tier);

                // Enhanced vibration for premium
                if (navigator.vibrate) {
                    const pattern = tier === 'legendary' ? [100, 50, 100, 50, 200, 50, 100] :
                                  [100, 50, 150, 50, 100];
                    navigator.vibrate(pattern);
                }

                // Firebase í†µê³„ ì—…ë°ì´íŠ¸
                if (typeof updateFirebaseStats !== 'undefined') {
                    updateFirebaseStats.animal({
                        animalId: animal.id,
                        name: animal.name,
                        tier: tier,
                        cost: 0, // í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ ì‚¬ìš© (ì½”ì¸ ì†Œëª¨ ì—†ìŒ)
                        isNewAnimal: gameState.collection[animal.id].count === 1,
                        isPremium: true
                    });
                }

                saveGameState();
                // We need to reload money status to update display correctly
                const money = plantSystem.getMoney();
                updateDisplay(money);

            }, 600);
        }

        // Show new animal
        function showNewAnimal(animal, tier, isPremium = false) {
            const latestDraw = document.getElementById('latestDraw');
            const newAnimalCard = document.getElementById('newAnimalCard');
            
            // Set tier class
            newAnimalCard.className = `animal-card ${tier} rounded-lg p-4 text-center animal-appear`;
            
            newAnimalCard.innerHTML = `
                ${isPremium ? '<div class="text-xs bg-gradient-to-r from-purple-500 to-pink-500 text-white px-2 py-1 rounded-full mb-2 inline-block">âœ¨ í”„ë¦¬ë¯¸ì—„</div>' : ''}
                <div class="tier-label ${getTierColor(tier)} mb-2">${getTierName(tier)}</div>
                <div class="text-4xl mb-2">${animal.emoji}</div>
                <div class="font-bold text-gray-800">${animal.name}</div>
                <div class="text-xs text-gray-600 mt-1">íŒŒì›Œ: ${animal.power}</div>
                <div class="text-xs text-gray-500 mt-1">
                    ë³´ìœ : ${gameState.collection[animal.id]?.count || 0}ë§ˆë¦¬
                </div>
            `;
            
            latestDraw.classList.remove('hidden');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                latestDraw.classList.add('hidden');
            }, 5000);
        }

        // Play draw sound
        function playDrawSound(tier) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const frequencies = {
                legendary: [523.25, 659.25, 783.99, 1046.50], // C5-E5-G5-C6
                epic: [523.25, 659.25, 783.99], // C5-E5-G5
                rare: [523.25, 659.25], // C5-E5
                common: [523.25] // C5
            };
            
            frequencies[tier].forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                    oscillator.type = 'triangle';
                    
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                }, index * 150);
            });
        }

        // Get tier display info
        function getTierName(tier) {
            const names = {
                common: 'ì¼ë°˜',
                rare: 'ë ˆì–´',
                epic: 'ì—í”½',
                legendary: 'ì „ì„¤'
            };
            return names[tier] || tier;
        }

        function getTierColor(tier) {
            const colors = {
                common: 'text-gray-600',
                rare: 'text-blue-600',
                epic: 'text-purple-600',
                legendary: 'text-yellow-600'
            };
            return colors[tier] || 'text-gray-600';
        }

        // Update display
        function updateDisplay(money) {
            const ticketPrice = 100;

            // Get tickets from plant-system
            const tickets = getTicketsFromPlantSystem();

            // Update regular ticket count
            document.getElementById('ticketCount').textContent = tickets.normal;

            // Update premium ticket count
            const premiumTicketCountEl = document.getElementById('premiumTicketCount');
            if (premiumTicketCountEl) {
                premiumTicketCountEl.textContent = tickets.premium;
            }

            // Update coin count
            const coinCountEl = document.getElementById('coinCount');
            if (coinCountEl) {
                coinCountEl.textContent = `${money || 0} ì½”ì¸`;
            }

            // Update regular gacha button
            const gachaButton = document.getElementById('gachaButton');
            if (tickets.normal > 0) {
                gachaButton.disabled = false;
                gachaButton.textContent = `ë™ë¬¼ ë½‘ê¸° (1ì¥ ì‚¬ìš©)`;
            } else {
                gachaButton.disabled = true;
                gachaButton.textContent = 'ë½‘ê¸°ê¶Œì´ ë¶€ì¡±í•©ë‹ˆë‹¤';
            }

            // Update premium gacha button
            const premiumGachaButton = document.getElementById('premiumGachaButton');
            if (premiumGachaButton) {
                if (tickets.premium > 0) {
                    premiumGachaButton.disabled = false;
                    premiumGachaButton.textContent = `âœ¨ í”„ë¦¬ë¯¸ì—„ ë½‘ê¸° (1ì¥ ì‚¬ìš©)`;
                } else {
                    premiumGachaButton.disabled = true;
                    premiumGachaButton.textContent = 'í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œì´ ë¶€ì¡±í•©ë‹ˆë‹¤';
                }
            }

            // Update buy ticket button
            const buyTicketButton = document.getElementById('buyTicketButton');
            if (buyTicketButton) {
                buyTicketButton.disabled = money < ticketPrice;
                if (money < ticketPrice) {
                    buyTicketButton.textContent = `ì½”ì¸ ë¶€ì¡± (100 ì½”ì¸ í•„ìš”)`;
                } else {
                    buyTicketButton.textContent = `ì¼ë°˜ ë½‘ê¸°ê¶Œ êµ¬ë§¤ (100 ì½”ì¸)`;
                }
            }

            // Update buy premium ticket button
            const buyPremiumTicketButton = document.getElementById('buyPremiumTicketButton');
            if (buyPremiumTicketButton) {
                const premiumTicketPrice = 500;
                buyPremiumTicketButton.disabled = money < premiumTicketPrice;
                if (money < premiumTicketPrice) {
                    buyPremiumTicketButton.textContent = `ì½”ì¸ ë¶€ì¡± (500 ì½”ì¸ í•„ìš”)`;
                } else {
                    buyPremiumTicketButton.textContent = `í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ êµ¬ë§¤ (500 ì½”ì¸)`;
                }
            }
            
            // Update collection
            updateCollectionDisplay();
            
            // Update stats
            document.getElementById('totalDraws').textContent = gameState.stats.totalDraws;
            document.getElementById('legendaryCount').textContent = gameState.stats.legendaryCount;
        }

        // Update collection display
        function updateCollectionDisplay() {
            const grid = document.getElementById('collectionGrid');
            const collectionCount = document.getElementById('collectionCount');
            
            const ownedAnimals = Object.values(gameState.collection);
            const totalPossible = Object.values(animals).flat().length;
            
            collectionCount.textContent = `${ownedAnimals.length}/${totalPossible}`;
            
            // Create all possible animals with owned status
            const allAnimals = [];
            Object.keys(animals).forEach(tier => {
                animals[tier].forEach(animal => {
                    const owned = gameState.collection[animal.id];
                    allAnimals.push({
                        ...animal,
                        tier,
                        owned: !!owned,
                        count: owned?.count || 0
                    });
                });
            });
            
            // Sort by tier and name
            const tierOrder = { legendary: 0, epic: 1, rare: 2, common: 3 };
            allAnimals.sort((a, b) => {
                if (tierOrder[a.tier] !== tierOrder[b.tier]) {
                    return tierOrder[a.tier] - tierOrder[b.tier];
                }
                return a.name.localeCompare(b.name);
            });
            
            grid.innerHTML = allAnimals.map(animal => {
                const level = animal.level || 1;
                const stars = 'â­'.repeat(level);
                const abilities = animal.owned ? calculateAnimalAbilities(animal) : null;

                return `
                <div class="animal-card ${animal.tier} ${!animal.owned ? 'opacity-30' : ''} rounded-lg p-3 text-center cursor-pointer hover:scale-105 transition-transform relative"
                     onclick="showAnimalDetails('${animal.id}')" >
                    <div class="tier-label ${getTierColor(animal.tier)} mb-1">${getTierName(animal.tier)}</div>

                    ${animal.owned && level > 1 ? `
                    <div class="absolute top-1 right-1 text-xs bg-yellow-400 text-yellow-900 px-2 py-0.5 rounded-full font-bold">
                        Lv.${level}
                    </div>
                    ` : ''}

                    <div class="text-2xl mb-1">${animal.owned ? animal.emoji : 'â“'}</div>
                    <div class="text-xs font-bold text-gray-800">${animal.owned ? animal.name : '???'}</div>

                    ${animal.owned ? `
                    <div class="text-xs text-yellow-500 mt-1">${stars}</div>
                    <div class="text-xs text-purple-600 font-bold">âš¡${abilities.totalPower}</div>
                    <div class="text-xs text-gray-500 mt-1">${animal.count}ë§ˆë¦¬</div>
                    ${animal.duplicates > 0 ? `<div class="text-xs text-orange-600 font-bold">ğŸ”¥ +${animal.duplicates}</div>` : ''}
                    ` : ''}
                </div>
                `;
            }).join('');
        }

        // Show animal details with level system
        function showAnimalDetails(animalId) {
            const animal = gameState.collection[animalId];
            if (!animal) return;

            const abilities = calculateAnimalAbilities(animal);
            const canLevel = canLevelUp(animalId);
            const requirement = LEVEL_UP_REQUIREMENTS[animal.level || 1];

            // ë ˆë²¨ë³„ ë³„ í‘œì‹œ
            const stars = 'â­'.repeat(animal.level || 1);

            // ë ˆë²¨ì—… ë²„íŠ¼ í‘œì‹œ ì¡°ê±´
            const levelUpButton = animal.level < 5 ? `
                <button
                    onclick="handleLevelUp('${animalId}')"
                    class="${canLevel ? 'bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600' : 'bg-gray-300 cursor-not-allowed'}
                           text-white px-6 py-3 rounded-xl font-bold text-lg transition-all transform ${canLevel ? 'hover:scale-105' : ''}"
                    ${!canLevel ? 'disabled' : ''}>
                    ${canLevel ? 'ğŸ”¥ ë ˆë²¨ì—… í•˜ê¸°!' : `ì¤‘ë³µ ì¹´ë“œ ${requirement.duplicates}ì¥ í•„ìš”`}
                </button>
                <div class="text-xs text-gray-500 mt-2">
                    ë³´ìœ  ì¤‘ë³µ: ${animal.duplicates}ì¥ / í•„ìš”: ${requirement.duplicates}ì¥
                </div>
            ` : `
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-xl font-bold text-lg">
                    ğŸ‘‘ MAX LEVEL
                </div>
            `;

            const modalContent = `
                <!-- í‹°ì–´ ë°°ì§€ -->
                <div class="mb-4">
                    <span class="px-4 py-2 rounded-full text-white font-bold text-sm ${getTierColor(animal.tier)}">
                        ${getTierName(animal.tier)}
                    </span>
                </div>

                <!-- ë™ë¬¼ ì´ëª¨ì§€ & ì´ë¦„ -->
                <div class="text-6xl mb-2">${animal.emoji}</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-1">${animal.name}</h2>
                <div class="text-yellow-500 text-2xl mb-4">${stars}</div>

                <!-- ë ˆë²¨ & íŒŒì›Œ -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4">
                        <div class="text-sm text-gray-600 mb-1">ë ˆë²¨</div>
                        <div class="text-3xl font-bold text-blue-600">Lv.${animal.level || 1}</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4">
                        <div class="text-sm text-gray-600 mb-1">íŒŒì›Œ</div>
                        <div class="text-3xl font-bold text-purple-600">âš¡${abilities.totalPower}</div>
                    </div>
                </div>

                <!-- íŒŒì›Œ ì •ë³´ -->
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 mb-4">
                    <h3 class="font-bold text-gray-800 mb-3 text-center">âš¡ íŒŒì›Œ</h3>
                    <div class="text-center">
                        <div class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
                            ${abilities.totalPower}
                        </div>
                        <div class="text-sm text-gray-600 mt-2">
                            ê¸°ë³¸ íŒŒì›Œ ${animal.power} Ã— ë ˆë²¨ ${animal.level || 1}
                        </div>
                    </div>
                </div>

                <!-- ë‹¤ìŒ ë ˆë²¨ ë¯¸ë¦¬ë³´ê¸° -->
                ${animal.level < 5 ? `
                <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-4 mb-4 border-2 border-yellow-200">
                    <h3 class="font-bold text-orange-700 mb-2 text-center">ğŸŒŸ ë‹¤ìŒ ë ˆë²¨ (Lv.${requirement.nextLevel})</h3>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-orange-600">
                            âš¡ ${abilities.totalPower} â†’ ${animal.power * requirement.nextLevel}
                        </div>
                        <div class="text-xs text-gray-600 mt-1">
                            íŒŒì›Œê°€ ì¦ê°€í•©ë‹ˆë‹¤!
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- ë ˆë²¨ì—… ë²„íŠ¼ -->
                <div class="mt-6">
                    ${levelUpButton}
                </div>

                <!-- ë³´ìœ  ì •ë³´ -->
                <div class="mt-4 text-sm text-gray-500">
                    ë³´ìœ : ${animal.count || 0}ë§ˆë¦¬ | ì¤‘ë³µ ì¹´ë“œ: ${animal.duplicates || 0}ì¥
                </div>
            `;

            document.getElementById('animalDetailContent').innerHTML = modalContent;
            document.getElementById('animalDetailModal').classList.remove('hidden');
            document.getElementById('animalDetailModal').classList.add('flex');
        }

        // Close animal detail modal
        function closeAnimalDetail() {
            document.getElementById('animalDetailModal').classList.add('hidden');
            document.getElementById('animalDetailModal').classList.remove('flex');
        }

        // Handle level up from modal
        function handleLevelUp(animalId) {
            const result = levelUpAnimal(animalId);
            if (result && result.success) {
                // ë ˆë²¨ì—… ì„±ê³µ ì• ë‹ˆë©”ì´ì…˜
                const stars = 'â­'.repeat(result.newLevel);
                alert(`âœ¨ ë ˆë²¨ì—… ì„±ê³µ!\n\n${result.animal.name}ê°€ Lv.${result.newLevel}ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!\n${stars}\n\nâš¡ íŒŒì›Œ: ${result.abilities.totalPower}`);

                // ëª¨ë‹¬ ì—…ë°ì´íŠ¸
                showAnimalDetails(animalId);

                // ì»¬ë ‰ì…˜ í™”ë©´ ì—…ë°ì´íŠ¸
                updateDisplay();
            }
        }

        // Clear collection (for testing)
        function clearCollection() {
            if (confirm('ì •ë§ë¡œ ì»¬ë ‰ì…˜ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                gameState.collection = {};
                gameState.stats = { totalDraws: 0, legendaryCount: 0 };
                gameState.tickets = 0; // Also reset tickets
                saveGameState();

                loadGameState(); // Reload to update display
            }
        }

        // ë™ë¬¼ ë„ê° ë°ì´í„° ë³µêµ¬ í—¬í¼ (ê°œë°œì ë„êµ¬ì—ì„œ ì‚¬ìš©)
        function restoreAnimalCollection(backupData) {
            if (!backupData) {
                console.error('âŒ ë°±ì—… ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                console.log('ì‚¬ìš©ë²•: restoreAnimalCollection(ë°±ì—…ë°ì´í„°)');
                return;
            }

            try {
                const restored = typeof backupData === 'string' ? JSON.parse(backupData) : backupData;

                // gameStateì— ë³µêµ¬
                if (restored.animals) {
                    gameState.animals = restored.animals;
                }
                if (restored.collection) {
                    gameState.collection = restored.collection;
                }
                if (restored.stats) {
                    gameState.stats = restored.stats;
                }

                saveGameState();
                loadGameState();

                console.log('âœ… ë™ë¬¼ ë„ê° ë°ì´í„°ê°€ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                console.log('ë³µêµ¬ëœ ë™ë¬¼ ìˆ˜:', gameState.animals?.length || 0);

                return true;
            } catch (e) {
                console.error('âŒ ë³µêµ¬ ì‹¤íŒ¨:', e);
                return false;
            }
        }

        // í˜„ì¬ ë™ë¬¼ ë„ê° ë°ì´í„° ë°±ì—… (ê°œë°œì ë„êµ¬ì—ì„œ ì‚¬ìš©)
        function backupAnimalCollection() {
            const backup = {
                animals: gameState.animals || [],
                collection: gameState.collection || {},
                stats: gameState.stats || { totalDraws: 0, legendaryCount: 0 },
                timestamp: new Date().toISOString()
            };

            console.log('ğŸ“¦ ë™ë¬¼ ë„ê° ë°±ì—… ë°ì´í„°:');
            console.log(JSON.stringify(backup, null, 2));
            console.log('\në³µêµ¬ ë°©ë²•: restoreAnimalCollection(' + JSON.stringify(backup) + ')');

            return backup;
        }

        // Go home
        function goHome() {
            window.location.href = 'index.html';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.classList.remove('hidden');

            try {
                // eduPetFirebaseIntegrationê°€ ì •ì˜ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
                await new Promise(resolve => {
                    const interval = setInterval(() => {
                        if (typeof eduPetFirebaseIntegration !== 'undefined') {
                            clearInterval(interval);
                            resolve();
                        }
                    }, 50);
                });

                // Firebase í†µí•© ê¸°ëŠ¥ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. (ì´ ê³¼ì •ì—ì„œ ìµëª… ë¡œê·¸ì¸ì´ íŠ¸ë¦¬ê±°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤)
                await eduPetFirebaseIntegration.initialize();
                console.log('Firebase Integration is ready.');

                // ì´ì œ ì»¬ë ‰ì…˜ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
                await loadGameState();

            } catch (error) {
                console.error('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                // ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ê³„ì† ì§„í–‰
                await loadGameState();
            } finally {
                // ë°ì´í„° ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ë¡œë”© ì˜¤ë²„ë ˆì´ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
                loadingOverlay.classList.add('hidden');
            }

            // Auto-refresh data every 10 seconds to sync coin changes from other tabs
            setInterval(loadGameState, 10000);
        });
    </script>
</body>
</html>