<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPet Collection ì‹œì‘í•˜ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- Plant System & Firebase Integration -->
    <script src="plant-system.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-integration.js"></script>
    <script src="firebase-auth.js"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        .tutorial-slide {
            transition: all 0.5s ease;
            min-height: 500px;
        }
        
        .slide-enter {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateX(50px); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .floating-icon {
            animation: float 2s ease-in-out infinite alternate;
        }
        
        @keyframes float {
            from { transform: translateY(0px); }
            to { transform: translateY(-10px); }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 25px rgba(59, 130, 246, 0.6); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-green-50 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Progress Bar -->
        <div class="mb-6">
            <div class="bg-gray-200 rounded-full h-2 mb-2">
                <div id="progressBar" class="progress-bar bg-blue-500 h-2 rounded-full" style="width: 16.67%"></div>
            </div>
            <div class="text-center text-sm text-gray-600">
                <span id="currentStep">1</span> / <span id="totalSteps"></span>
            </div>
        </div>

        <!-- Tutorial Slides -->
        <div id="tutorialContainer" class="bg-white rounded-xl shadow-lg p-6">
            <!-- Slide 1: Welcome -->
            <div id="slide1" class="tutorial-slide">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">ğŸŒ±</div>
                    <h1 class="text-2xl font-bold text-gray-800 mb-4">EduPet Collectionì—<br>ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h1>
                    <div class="text-gray-600 mb-6 space-y-2">
                        <p>í•™ìŠµí•˜ë©° ì‹ë¬¼ì„ í‚¤ìš°ê³ </p>
                        <p>ê·€ì—¬ìš´ ë™ë¬¼ë“¤ì„ ìˆ˜ì§‘í•˜ëŠ”</p>
                        <p>êµìœ¡ ê²Œì„ì…ë‹ˆë‹¤</p>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4 mb-6">
                        <div class="text-sm text-blue-700">
                            <div class="flex items-center justify-center space-x-2 mb-2">
                                <span>ğŸ“š</span>
                                <span>â†’</span>
                                <span>ğŸŒ±</span>
                                <span>â†’</span>
                                <span>ğŸ¦</span>
                                <span>â†’</span>
                                <span>ğŸ›¡ï¸</span>
                            </div>
                            <div class="font-medium">í•™ìŠµ â†’ ì„±ì¥ â†’ ìˆ˜ì§‘ â†’ ë³´í˜¸</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 2: Grade Selection -->
            <div id="slide2" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">ğŸ“</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">í•™ë…„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                    <div class="text-gray-600 mb-6">
                        <p class="mb-4">í•™ë…„ì— ë§ëŠ” ë‚œì´ë„ë¡œ ë¬¸ì œê°€ ì œê³µë©ë‹ˆë‹¤.</p>
                        <p class="text-sm text-blue-600">ğŸ’¡ ë‚˜ì¤‘ì— ì„¤ì •ì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”!</p>
                    </div>

                    <div class="grid grid-cols-3 gap-3 mb-6">
                        <button onclick="selectGrade(1)" id="grade-1-btn"
                                class="grade-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                            <div class="text-4xl mb-2">ğŸŒ°</div>
                            <div class="text-lg font-bold text-gray-800 mb-1">1í•™ë…„</div>
                            <div class="text-xs text-gray-600">ê¸°ì´ˆ</div>
                        </button>

                        <button onclick="selectGrade(2)" id="grade-2-btn"
                                class="grade-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                            <div class="text-4xl mb-2">ğŸŒ±</div>
                            <div class="text-lg font-bold text-gray-800 mb-1">2í•™ë…„</div>
                            <div class="text-xs text-gray-600">ì‰¬ì›€</div>
                        </button>

                        <button onclick="selectGrade(3)" id="grade-3-btn"
                                class="grade-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                            <div class="text-4xl mb-2">ğŸª´</div>
                            <div class="text-lg font-bold text-gray-800 mb-1">3í•™ë…„</div>
                            <div class="text-xs text-gray-600">ë³´í†µ</div>
                        </button>

                        <button onclick="selectGrade(4)" id="grade-4-btn"
                                class="grade-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                            <div class="text-4xl mb-2">ğŸŒ³</div>
                            <div class="text-lg font-bold text-gray-800 mb-1">4í•™ë…„</div>
                            <div class="text-xs text-gray-600">í‘œì¤€</div>
                        </button>

                        <button onclick="selectGrade(5)" id="grade-5-btn"
                                class="grade-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                            <div class="text-4xl mb-2">ğŸŒ²</div>
                            <div class="text-lg font-bold text-gray-800 mb-1">5í•™ë…„</div>
                            <div class="text-xs text-gray-600">ì–´ë ¤ì›€</div>
                        </button>

                        <button onclick="selectGrade(6)" id="grade-6-btn"
                                class="grade-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                            <div class="text-4xl mb-2">ğŸŒº</div>
                            <div class="text-lg font-bold text-gray-800 mb-1">6í•™ë…„</div>
                            <div class="text-xs text-gray-600">ê³ ê¸‰</div>
                        </button>
                    </div>

                    <div id="grade-selection-message" class="text-sm text-green-600 font-medium hidden">
                        âœ… ì„ íƒ ì™„ë£Œ! ë‹¤ìŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”
                    </div>
                </div>
            </div>

            <!-- Slide 3: Learning -->
            <div id="slide3" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">ğŸ“š</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">1ë‹¨ê³„: í•™ìŠµí•˜ê¸°</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-yellow-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">ğŸ¯</span>
                                <span class="font-medium">ê³¼ëª© ì™„ë£Œí•˜ê¸°</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                10ê°œ ê³¼ëª© ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´<br>
                                í€´ì¦ˆë¥¼ ì™„ë£Œí•˜ì„¸ìš”!
                            </div>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">ğŸ</span>
                                <span class="font-medium">ë³´ìƒ ë°›ê¸°</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                â€¢ 3ê³¼ëª© ì™„ë£Œ: ì„±ì¥ê¶Œ 1ì¥<br>
                                â€¢ 5ê³¼ëª© ì™„ë£Œ: ì¼ë°˜ ë½‘ê¸°ê¶Œ 1ì¥<br>
                                â€¢ 6ê³¼ëª© ì™„ë£Œ: ì„±ì¥ê¶Œ 1ì¥ ì¶”ê°€<br>
                                â€¢ 9ê³¼ëª© ì™„ë£Œ: í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ 1ì¥!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 4: Farming -->
            <div id="slide4" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">ğŸŒ±</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">2ë‹¨ê³„: ì‹ë¬¼ í‚¤ìš°ê¸°</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-green-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">ğŸŒ°</span>
                                <span class="font-medium">ì”¨ì•— ì‹¬ê³  ë¬¼ì£¼ê¸°</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                í™”ë¶„ì— ì”¨ì•—ì„ ì‹¬ê³ <br>
                                20ë²ˆì˜ ë¬¼ì„ ì£¼ì„¸ìš”!
                            </div>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">â°</span>
                                <span class="font-medium">24ì‹œê°„ ê¸°ë‹¤ë¦¬ê¸°</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                ë¬¼ 20ê°œ + 24ì‹œê°„ ê²½ê³¼í•˜ë©´<br>
                                ì‹ë¬¼ì´ ì„±ì¥ ì¤€ë¹„ ì™„ë£Œ!
                            </div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">ğŸ«</span>
                                <span class="font-medium">ì„±ì¥ê¶Œ ì‚¬ìš©</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                í•™ìŠµìœ¼ë¡œ ì–»ì€ ì„±ì¥ê¶Œìœ¼ë¡œ<br>
                                ì‹ë¬¼ì„ ì¦‰ì‹œ ì„±ì¥ì‹œí‚¤ì„¸ìš”!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 5: Collection -->
            <div id="slide5" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">ğŸ¦</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">3ë‹¨ê³„: ë™ë¬¼ ìˆ˜ì§‘</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-blue-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">ğŸ«</span>
                                <span class="font-medium">ì¼ë°˜ ë½‘ê¸°</span>
                            </div>
                            <div class="text-sm text-gray-700 mb-2">
                                5ê³¼ëª© ì™„ë£Œ ì‹œ íšë“!
                            </div>
                            <div class="grid grid-cols-2 gap-1 text-xs">
                                <div>ì¼ë°˜ 60%</div>
                                <div>ë ˆì–´ 30%</div>
                                <div>ì—í”½ 9%</div>
                                <div>ì „ì„¤ 1%</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4 text-left border-2 border-purple-200">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">âœ¨</span>
                                <span class="font-medium text-purple-800">í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°</span>
                            </div>
                            <div class="text-sm text-purple-700 mb-2">
                                9ê³¼ëª© ì™„ë£Œ ì‹œ íšë“!
                            </div>
                            <div class="grid grid-cols-2 gap-1 text-xs text-purple-700">
                                <div>ì—í”½ 90%</div>
                                <div>ì „ì„¤ 10%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 6: Daily System -->
            <div id="slide6" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">ğŸ“…</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">4ë‹¨ê³„: ë§¤ì¼ ìƒˆë¡œìš´ ì‹œì‘</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-green-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">ğŸ”„</span>
                                <span class="font-medium">ì¼ì¼ ì´ˆê¸°í™”</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                ë§¤ì¼ ìƒˆë²½ 4ì‹œì— ê³¼ëª© ì§„í–‰ë„ê°€<br>
                                ì´ˆê¸°í™”ë˜ì–´ ë‹¤ì‹œ ë„ì „í•  ìˆ˜ ìˆì–´ìš”!
                            </div>
                        </div>
                        <div class="bg-yellow-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">â°</span>
                                <span class="font-medium">ì„±ì¥ê¶Œ ìœ íš¨ê¸°ê°„</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                ì„±ì¥ê¶Œì€ 24ì‹œê°„ í›„ ë§Œë£Œë˜ë‹ˆ<br>
                                ë¹ ë¥´ê²Œ ì‚¬ìš©í•˜ì„¸ìš”!
                            </div>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">ğŸ¯</span>
                                <span class="font-medium">ê¾¸ì¤€í•œ í•™ìŠµ</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                ë§¤ì¼ ì¡°ê¸ˆì”© í•™ìŠµí•˜ë©´<br>
                                ì‹ë¬¼ë„ ìë¼ê³  ë™ë¬¼ë„ ëª¨ì„ ìˆ˜ ìˆì–´ìš”!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 7: Nickname Input -->
            <div id="slide7" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">ğŸ‘¤</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">ë‚˜ë§Œì˜ ë³„ëª…ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="text-sm text-gray-600 mb-4">
                            ë³„ëª…ì„ ì„¤ì •í•˜ë©´ ì¹œêµ¬ë“¤ê³¼ ìˆœìœ„í‘œì—ì„œ<br>
                            ë” ì¬ë¯¸ìˆê²Œ ì†Œí†µí•  ìˆ˜ ìˆì–´ìš”!
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4 mb-4">
                            <div class="flex items-center justify-center space-x-2 mb-3">
                                <span class="text-2xl">ğŸŒ</span>
                                <span class="font-medium text-blue-800">ì†Œì…œ ê¸°ëŠ¥ ë¯¸ë¦¬ë³´ê¸°</span>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-xs text-blue-700">
                                <div>ğŸ† ì‹¤ì‹œê°„ ìˆœìœ„í‘œ</div>
                                <div>ğŸ‘¥ ì¹œêµ¬ ì¶”ê°€</div>
                                <div>ğŸ¾ ë™ë¬¼ ìë‘í•˜ê¸°</div>
                                <div>ğŸ¯ í•™ìŠµ ê·¸ë£¹</div>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <input 
                                type="text" 
                                id="nicknameInput" 
                                placeholder="2-10ì ì‚¬ì´ë¡œ ì…ë ¥í•˜ì„¸ìš”" 
                                maxlength="10"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-center text-lg"
                            >
                            <div class="text-xs text-gray-500 space-y-1">
                                <div>ğŸ’¡ ë‚˜ì¤‘ì— ì†Œì…œ í—ˆë¸Œì—ì„œ ì–¸ì œë“  ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”!</div>
                                <div id="nicknameError" class="text-red-500 hidden"></div>
                                <div id="nicknameSuccess" class="text-green-600 hidden"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <button id="setNicknameBtn" onclick="setUserNickname()" class="w-full px-6 py-3 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition-colors">
                            âœ¨ ë³„ëª… ì„¤ì •í•˜ê¸°
                        </button>

                        <button onclick="skipNickname()" class="w-full px-6 py-2 text-gray-500 hover:text-gray-700 transition-colors text-sm">
                            ê±´ë„ˆë›°ê¸° (ë‚˜ì¤‘ì— ì„¤ì •)
                        </button>

                        <div class="text-xs text-gray-500 text-center mt-4">
                            ğŸ’¡ êµ¬ê¸€ ê³„ì • ì—°ë™ì€ ì†Œì…œ í—ˆë¸Œì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 8: Avatar Selection -->
            <div id="slide8" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">ğŸ¾</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">ë‚˜ë§Œì˜ ëŒ€í‘œ ë™ë¬¼ì„ ì„ íƒí•˜ì„¸ìš”!</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="text-sm text-gray-600 mb-4">
                            ì„ íƒí•œ ë™ë¬¼ì€ í”„ë¡œí•„ê³¼ ìˆœìœ„í‘œì— í‘œì‹œë©ë‹ˆë‹¤.<br>
                            ë‚˜ì¤‘ì— ì†Œì…œ í—ˆë¸Œì—ì„œ ì–¸ì œë“  ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”!
                        </div>
                        
                        <div id="avatar-selection" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; margin-bottom: 20px;">
                            <!-- ë™ë¬¼ ì•„ë°”íƒ€ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                        </div>
                        <div id="avatarError" class="text-red-500 hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Slide 9: Start -->
            <div id="slide9" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">ğŸ‰</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <span id="welcomeMessage">ì´ì œ ì‹œì‘í•´ë³´ì„¸ìš”!</span>
                    </h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-green-50 rounded-lg p-4">
                            <div class="text-sm text-green-700 space-y-1">
                                <div class="font-medium mb-2">ğŸ ì‹œì‘ ë³´ë„ˆìŠ¤</div>
                                <div>ğŸ’° ì´ˆê¸° ìê¸ˆ: 100ì›</div>
                                <div>ğŸ« í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ: 1ì¥</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">
                            ì–¸ì œë“ ì§€ ë„ì›€ì´ í•„ìš”í•˜ë©´<br>
                            ê° í˜ì´ì§€ì˜ ì•ˆë‚´ë¥¼ í™•ì¸í•˜ì„¸ìš”!
                        </div>
                    </div>
                    <button onclick="completeOnboarding()" class="w-full px-6 py-3 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 transition-colors pulse-glow">
                        ğŸš€ EduPet ì„¸ê³„ë¡œ ì¶œë°œ!
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-center space-x-4 mt-6">
            <button id="prevBtn" onclick="prevSlide()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                â† ì´ì „
            </button>
            <button id="skipBtn" onclick="completeOnboarding()" class="px-4 py-2 text-gray-500 hover:text-gray-700 transition-colors">
                ê±´ë„ˆë›°ê¸°
            </button>
            <button id="nextBtn" onclick="nextSlide()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                ë‹¤ìŒ â†’
            </button>
        </div>
    </div>

    <script>
        let currentSlide = 1;
        const totalSlides = 9;
        let tempSelectedAvatar = null; // ì„ì‹œ ì„ íƒëœ ì•„ë°”íƒ€
        let selectedGrade = null; // ì„ íƒëœ í•™ë…„

        // ì‚¬ìš© ê°€ëŠ¥í•œ ë™ë¬¼ ì•„ë°”íƒ€ ëª©ë¡ (social-hub.htmlì—ì„œ ê°€ì ¸ì˜´)
        const availableAvatars = [
            { id: 'bunny', emoji: 'ğŸ°', name: 'í† ë¼' },
            { id: 'cat', emoji: 'ğŸ±', name: 'ê³ ì–‘ì´' },
            { id: 'dog', emoji: 'ğŸ¶', name: 'ê°•ì•„ì§€' },
            { id: 'fox', emoji: 'ğŸ¦Š', name: 'ì—¬ìš°' },
            { id: 'lion', emoji: 'ğŸ¦', name: 'ì‚¬ì' },
            { id: 'tiger', emoji: 'ğŸ…', name: 'í˜¸ë‘ì´' },
            { id: 'bear', emoji: 'ğŸ»', name: 'ê³°' },
            { id: 'panda', emoji: 'ğŸ¼', name: 'íŒë‹¤' },
            { id: 'koala', emoji: 'ğŸ¨', name: 'ì½”ì•Œë¼' },
            { id: 'monkey', emoji: 'ğŸµ', name: 'ì›ìˆ­ì´' },
            { id: 'elephant', emoji: 'ğŸ˜', name: 'ì½”ë¼ë¦¬' },
            { id: 'giraffe', emoji: 'ğŸ¦’', name: 'ê¸°ë¦°' },
            { id: 'zebra', emoji: 'ğŸ¦“', name: 'ì–¼ë£©ë§' },
            { id: 'horse', emoji: 'ğŸ', name: 'ë§' },
            { id: 'cow', emoji: 'ğŸ„', name: 'ì†Œ' },
            { id: 'pig', emoji: 'ğŸ·', name: 'ë¼ì§€' },
            { id: 'sheep', emoji: 'ğŸ‘', name: 'ì–‘' },
            { id: 'chicken', emoji: 'ğŸ”', name: 'ë‹­' },
            { id: 'penguin', emoji: 'ğŸ§', name: 'í­ê·„' },
            { id: 'owl', emoji: 'ğŸ¦‰', name: 'ì˜¬ë¹¼ë¯¸' }
        ];

        function updateUI() {
            // Hide all slides
            for (let i = 1; i <= totalSlides; i++) {
                document.getElementById(`slide${i}`).classList.add('hidden');
            }
            
            // Show current slide with animation
            const currentSlideEl = document.getElementById(`slide${currentSlide}`);
            currentSlideEl.classList.remove('hidden');
            currentSlideEl.classList.add('slide-enter');
            
            setTimeout(() => {
                currentSlideEl.classList.remove('slide-enter');
            }, 500);
            
            // Update progress
            document.getElementById('progressBar').style.width = `${(currentSlide / totalSlides) * 100}%`;
            document.getElementById('currentStep').textContent = currentSlide;
            document.getElementById('totalSteps').textContent = totalSlides;
            
            // Update buttons
            document.getElementById('prevBtn').disabled = currentSlide === 1;
            const nextBtn = document.getElementById('nextBtn');
            if (currentSlide === totalSlides) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'block';
            }

            // Load avatar selection when on slide 8
            if (currentSlide === 8) {
                loadAvatarSelection();
            }
        }

        // í•™ë…„ ì„ íƒ í•¨ìˆ˜
        function selectGrade(grade) {
            selectedGrade = grade;
            localStorage.setItem('userGrade', grade.toString());

            // ëª¨ë“  í•™ë…„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            for (let i = 1; i <= 6; i++) {
                const btn = document.getElementById(`grade-${i}-btn`);
                if (btn) {
                    btn.className = 'grade-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105';
                }
            }

            // ì„ íƒëœ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
            const selectedBtn = document.getElementById(`grade-${grade}-btn`);
            if (selectedBtn) {
                selectedBtn.className = 'grade-btn p-4 border-4 border-blue-500 bg-blue-50 rounded-xl transition-all transform scale-105';
            }

            // ì„ íƒ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
            document.getElementById('grade-selection-message').classList.remove('hidden');

            console.log(`âœ… í•™ë…„ ì„ íƒ ì™„ë£Œ: ${grade}í•™ë…„`);
        }

        function nextSlide() {
            if (currentSlide < totalSlides) {
                currentSlide++;
                updateUI();
            }
        }

        function prevSlide() {
            if (currentSlide > 1) {
                currentSlide--;
                updateUI();
            }
        }

        // ì•„ë°”íƒ€ ì„ íƒ UI ë¡œë“œ (social-hub.htmlì—ì„œ ê°€ì ¸ì˜´)
        function loadAvatarSelection() {
            const avatarContainer = document.getElementById('avatar-selection');
            if (!avatarContainer) return;

            // ê¸°ë³¸ ì•„ë°”íƒ€ ì„¤ì • (í† ë¼)
            if (!tempSelectedAvatar) {
                tempSelectedAvatar = 'bunny';
            }

            const html = availableAvatars.map(avatar => {
                const isSelected = avatar.id === tempSelectedAvatar;
                return `
                    <div id="avatar-${avatar.id}" onclick="selectAvatarTemp('${avatar.id}')" style="
                        padding: 15px;
                        background: ${isSelected ? '#007bff' : 'white'};
                        border: 2px solid ${isSelected ? '#007bff' : '#dee2e6'};
                        border-radius: 10px;
                        text-align: center;
                        cursor: pointer;
                        transition: all 0.3s;
                        ${isSelected ? 'transform: scale(1.1);' : ''}
                    " onmouseover="this.style.borderColor='#007bff'" onmouseout="if('${avatar.id}' !== '${tempSelectedAvatar}') this.style.borderColor='#dee2e6'">
                        <div style="font-size: 2rem; margin-bottom: 5px;">${avatar.emoji}</div>
                        <div style="font-size: 0.75rem; color: ${isSelected ? 'white' : '#495057'}; font-weight: ${isSelected ? 'bold' : 'normal'};">${avatar.name}</div>
                    </div>
                `;
            }).join('');

            avatarContainer.innerHTML = html;
        }

        // ì•„ë°”íƒ€ ì„ì‹œ ì„ íƒ
        function selectAvatarTemp(avatarId) {
            tempSelectedAvatar = avatarId;

            // UI ì—…ë°ì´íŠ¸
            document.querySelectorAll('[id^="avatar-"]').forEach(el => {
                const id = el.id.replace('avatar-', '');
                const isSelected = id === avatarId;

                el.style.background = isSelected ? '#007bff' : 'white';
                el.style.borderColor = isSelected ? '#007bff' : '#dee2e6';
                el.style.transform = isSelected ? 'scale(1.1)' : 'scale(1)';

                const nameElement = el.querySelector('div:last-child');
                if (nameElement) {
                    nameElement.style.color = isSelected ? 'white' : '#495057';
                    nameElement.style.fontWeight = isSelected ? 'bold' : 'normal';
                }
            });
        }

        // ë³„ëª… ì„¤ì • í•¨ìˆ˜
        function setUserNickname() {
            const nicknameInput = document.getElementById('nicknameInput');
            const nickname = nicknameInput.value.trim();
            const errorDiv = document.getElementById('nicknameError');
            const successDiv = document.getElementById('nicknameSuccess');
            const setBtn = document.getElementById('setNicknameBtn');
            
            // ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ ì´ˆê¸°í™”
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
            
            // ì…ë ¥ ê²€ì¦
            if (!nickname) {
                showError('ë³„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            if (nickname.length < 2) {
                showError('ë³„ëª…ì€ 2ê¸€ì ì´ìƒì´ì–´ì•¼ í•´ìš”!');
                return;
            }
            
            if (nickname.length > 10) {
                showError('ë³„ëª…ì€ 10ê¸€ì ì´í•˜ì—¬ì•¼ í•´ìš”!');
                return;
            }
            
            // íŠ¹ìˆ˜ë¬¸ì ê²€ì‚¬ (í•œê¸€, ì˜ë¬¸, ìˆ«ì, ì¼ë¶€ íŠ¹ìˆ˜ë¬¸ìë§Œ í—ˆìš©)
            const allowedPattern = /^[ê°€-í£a-zA-Z0-9_\s]+$/;
            if (!allowedPattern.test(nickname)) {
                showError('í•œê¸€, ì˜ë¬¸, ìˆ«ì, _ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”!');
                return;
            }
            
            // ë³„ëª… ì €ì¥ (localStorage)
            const userSettings = {
                userName: nickname,
                setAt: Date.now()
            };
            localStorage.setItem('eduPetSettings', JSON.stringify(userSettings));

            // Firebaseì— ë‹‰ë„¤ì„ ë™ê¸°í™” (ë¹„ë™ê¸°)
            if (typeof eduPetAuth !== 'undefined' && eduPetAuth.currentUser) {
                eduPetAuth.setNickname(nickname).then(() => {
                    console.log('âœ… Firebaseì— ë‹‰ë„¤ì„ ë™ê¸°í™” ì™„ë£Œ:', nickname);
                }).catch(err => {
                    console.warn('âš ï¸ Firebase ë‹‰ë„¤ì„ ë™ê¸°í™” ì‹¤íŒ¨ (ë‚˜ì¤‘ì— ì¬ì‹œë„ë©ë‹ˆë‹¤):', err);
                });
            }

            // ì„±ê³µ ë©”ì‹œì§€
            showSuccess(`âœ¨ "${nickname}" ë³„ëª…ì´ ì„¤ì •ë˜ì—ˆì–´ìš”!`);
            
            // í™˜ì˜ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.textContent = `${nickname}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`;
            }
            
            // ë²„íŠ¼ ë³€ê²½
            setBtn.textContent = 'âœ… ì„¤ì • ì™„ë£Œ';
            setBtn.disabled = true;
            setBtn.classList.add('bg-green-500', 'hover:bg-green-500');
            setBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
            
            // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
            nextSlide();
            function showError(message) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
                nicknameInput.classList.add('border-red-300');
                nicknameInput.focus();
            }
            
            function showSuccess(message) {
                successDiv.textContent = message;
                successDiv.classList.remove('hidden');
                nicknameInput.classList.remove('border-red-300');
                nicknameInput.classList.add('border-green-300');
            }
        }
        
        // ë³„ëª… ì„¤ì • ê±´ë„ˆë›°ê¸°
        function skipNickname() {
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.textContent = 'ì´ì œ ì‹œì‘í•´ë³´ì„¸ìš”!';
            }
            nextSlide();
        }

        // ì—”í„° í‚¤ë¡œ ë³„ëª… ì„¤ì •
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && currentSlide === 7) {
                const nicknameInput = document.getElementById('nicknameInput');
                if (document.activeElement === nicknameInput) {
                    setUserNickname();
                }
            }
        });

        async function completeOnboarding() {
            // Validate grade selection
            if (!selectedGrade) {
                // í•™ë…„ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìœ¼ë©´ ê¸°ë³¸ê°’ 4í•™ë…„ ì„¤ì •
                selectedGrade = 4;
                localStorage.setItem('userGrade', '4');
                console.log('âš ï¸ í•™ë…„ ë¯¸ì„ íƒ - ê¸°ë³¸ê°’ 4í•™ë…„ ì„¤ì •');
            }

            // Validate avatar selection
            if (!tempSelectedAvatar) {
                alert('ëŒ€í‘œ ë™ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            // Get user nickname for personalized message
            let nickname = 'í•™ìŠµì';
            try {
                const userSettings = JSON.parse(localStorage.getItem('eduPetSettings') || '{}');
                if (userSettings.userName) {
                    nickname = userSettings.userName;
                }
            } catch (error) {
                console.log('ì‚¬ìš©ì ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            }

            try {
                // Update nickname and avatar in Firebase (ì„ íƒì )
                if (typeof eduPetAuth !== 'undefined' && eduPetAuth.currentUser) {
                    try {
                        await eduPetAuth.setNickname(nickname);
                        console.log('âœ… Firebaseì— ë‹‰ë„¤ì„ ë™ê¸°í™” ì™„ë£Œ');
                    } catch (nicknameError) {
                        // ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì´ê±°ë‚˜ ì´ë¯¸ ì„¤ì •ëœ ê²½ìš° ë¬´ì‹œ
                        console.warn('ë‹‰ë„¤ì„ ì„¤ì • ìŠ¤í‚µ:', nicknameError.message);
                    }

                    try {
                        await eduPetAuth.setAvatar(tempSelectedAvatar);
                        console.log('âœ… Firebaseì— ì•„ë°”íƒ€ ë™ê¸°í™” ì™„ë£Œ');
                    } catch (avatarError) {
                        console.warn('ì•„ë°”íƒ€ ì„¤ì • ì‹¤íŒ¨:', avatarError.message);
                    }
                } else {
                    console.log('âš ï¸ Firebase ì˜¤í”„ë¼ì¸ ëª¨ë“œ - ë¡œì»¬ ì €ì¥ì†Œë§Œ ì‚¬ìš©');
                }

                // Grant starter bonuses - 100ì› + í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ (plantSystem ì‚¬ìš©)
                // ì´ë¯¸ íŠœí† ë¦¬ì–¼ì„ ì™„ë£Œí•œ ê²½ìš° ë³´ë„ˆìŠ¤ ì§€ê¸‰ ì•ˆ í•¨
                const alreadyCompleted = localStorage.getItem('eduPetOnboardingCompleted') === 'true';

                if (typeof plantSystem !== 'undefined' && !alreadyCompleted) {
                    plantSystem.setMoney(100);
                    console.log('âœ… íŠœí† ë¦¬ì–¼ ì™„ë£Œ: 100ì› ì§€ê¸‰');

                    // âœ… ìˆ˜ì •: plantSystem.grantRewards() ì‚¬ìš© (ìë™ ì„±ì¥ ë¡œì§ í¬í•¨)
                    const plantSystemUser = plantSystem.getUserData();
                    if (!plantSystemUser.rewards) {
                        plantSystemUser.rewards = {
                            growthTickets: [],
                            normalGachaTickets: 0,
                            premiumGachaTickets: 0
                        };
                    }

                    // grantRewards() ì‚¬ìš©í•˜ì—¬ í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ ì§€ê¸‰
                    plantSystem.grantRewards(plantSystemUser, { premiumGacha: 1 });
                    plantSystem.saveUserData(plantSystemUser);
                    console.log('âœ… íŠœí† ë¦¬ì–¼ ì™„ë£Œ: í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ 1ì¥ ì§€ê¸‰');

                    // Firebaseì— ë³´ìƒ ë™ê¸°í™” (ì„ íƒì )
                    if (typeof plantSystemFirebase !== 'undefined') {
                        try {
                            await plantSystemFirebase.save();
                            console.log('âœ… Firebaseì— ë³´ìƒ ë™ê¸°í™” ì™„ë£Œ');
                        } catch (syncError) {
                            console.warn('âš ï¸ Firebase ë™ê¸°í™” ì‹¤íŒ¨ (ë‚˜ì¤‘ì— ì¬ì‹œë„ë©ë‹ˆë‹¤):', syncError.message);
                        }
                    }
                } else if (alreadyCompleted) {
                    console.log('âš ï¸ ì´ë¯¸ íŠœí† ë¦¬ì–¼ ì™„ë£Œë¨ - ë³´ìƒ ì§€ê¸‰ ìŠ¤í‚µ');
                } else {
                    console.error('âŒ plantSystemì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                    alert('ê²Œì„ ì‹œìŠ¤í…œ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // Initialize quiz progress
                const quizProgress = JSON.parse(localStorage.getItem('quizProgress') || '{}');
                if (!quizProgress.totalCorrect) quizProgress.totalCorrect = 0;
                if (!quizProgress.streakDays) quizProgress.streakDays = 0;
                localStorage.setItem('quizProgress', JSON.stringify(quizProgress));

                // Mark onboarding as completed
                localStorage.setItem('eduPetOnboardingCompleted', 'true');

                // Show completion message with delay to ensure data is saved
                setTimeout(() => {
                    alert(`ğŸ‰ ${nickname}ë‹˜, EduPet Collectionì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!\n\nì‹œì‘ ë³´ë„ˆìŠ¤ê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤:\nğŸ’° 100 ì½”ì¸\nğŸ« í”„ë¦¬ë¯¸ì—„ ë½‘ê¸°ê¶Œ 1ì¥\n\nì´ì œ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!\nì†Œì…œ ê¸°ëŠ¥ì€ ì†Œì…œ í—ˆë¸Œì—ì„œ ì‚¬ìš©í•˜ì„¸ìš”!`);

                    // Redirect to main page
                    window.location.href = 'index.html';
                }, 500);

            } catch (error) {
                console.error('íŠœí† ë¦¬ì–¼ ì™„ë£Œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('íŠœí† ë¦¬ì–¼ ì™„ë£Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // Check if user has already completed onboarding
        function checkOnboarding() {
            // Allow revisiting tutorial for review purposes
            // Don't redirect if user explicitly came here
            return;
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') prevSlide();
            if (e.key === 'ArrowRight') nextSlide();
            if (e.key === 'Escape') completeOnboarding();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            // Firebase ëª¨ë“ˆ ë¡œë“œ ì‹œë„ (ì„ íƒì )
            console.log('Waiting for Firebase modules to load in tutorial...');
            try {
                await new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 100; // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
                    const interval = setInterval(() => {
                        attempts++;
                        if (typeof eduPetAuth !== 'undefined' && typeof eduPetFirebaseIntegration !== 'undefined') {
                            console.log('âœ… Firebase modules loaded successfully in tutorial');
                            clearInterval(interval);
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            clearInterval(interval);
                            reject(new Error('Firebase ëª¨ë“ˆ ë¡œë“œ íƒ€ì„ì•„ì›ƒ in tutorial'));
                        }
                    }, 50);
                });

                // Firebase í†µí•© ê¸°ëŠ¥ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
                await eduPetFirebaseIntegration.initialize();
                console.log('âœ… Firebase Integration is ready in tutorial.');
            } catch (error) {
                // Firebase ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê²½ê³ ë§Œ í‘œì‹œí•˜ê³  ê³„ì† ì§„í–‰
                console.warn('âš ï¸ Firebase ë¡œë“œ ì‹¤íŒ¨ (ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ê³„ì† ì§„í–‰):', error.message);
            }

            checkOnboarding();
            updateUI();
        });
    </script>
</body>
</html>