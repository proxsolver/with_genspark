<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPet Collection 시작하기</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        .tutorial-slide {
            transition: all 0.5s ease;
            min-height: 500px;
        }
        
        .slide-enter {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateX(50px); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .floating-icon {
            animation: float 2s ease-in-out infinite alternate;
        }
        
        @keyframes float {
            from { transform: translateY(0px); }
            to { transform: translateY(-10px); }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 25px rgba(59, 130, 246, 0.6); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-green-50 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Progress Bar -->
        <div class="mb-6">
            <div class="bg-gray-200 rounded-full h-2 mb-2">
                <div id="progressBar" class="progress-bar bg-blue-500 h-2 rounded-full" style="width: 16.67%"></div>
            </div>
            <div class="text-center text-sm text-gray-600">
                <span id="currentStep">1</span> / 7
            </div>
        </div>

        <!-- Tutorial Slides -->
        <div id="tutorialContainer" class="bg-white rounded-xl shadow-lg p-6">
            <!-- Slide 1: Welcome -->
            <div id="slide1" class="tutorial-slide">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">🌱</div>
                    <h1 class="text-2xl font-bold text-gray-800 mb-4">EduPet Collection에<br>오신 것을 환영합니다!</h1>
                    <div class="text-gray-600 mb-6 space-y-2">
                        <p>학습하며 식물을 키우고</p>
                        <p>귀여운 동물들을 수집하는</p>
                        <p>교육 게임입니다</p>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4 mb-6">
                        <div class="text-sm text-blue-700">
                            <div class="flex items-center justify-center space-x-2 mb-2">
                                <span>📚</span>
                                <span>→</span>
                                <span>🌱</span>
                                <span>→</span>
                                <span>🦎</span>
                                <span>→</span>
                                <span>🛡️</span>
                            </div>
                            <div class="font-medium">학습 → 성장 → 수집 → 보호</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 2: Learning -->
            <div id="slide2" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">📚</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">1단계: 학습하기</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-yellow-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">🎯</span>
                                <span class="font-medium">과목 완료하기</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                10개 과목 중 하나를 선택해<br>
                                퀴즈를 완료하세요!
                            </div>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">🎁</span>
                                <span class="font-medium">보상 받기</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                • 3과목 완료: 성장권 1장<br>
                                • 5과목 완료: 일반 뽑기권 1장<br>
                                • 6과목 완료: 성장권 1장 추가<br>
                                • 9과목 완료: 프리미엄 뽑기권 1장!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 3: Farming -->
            <div id="slide3" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">🌱</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">2단계: 식물 키우기</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-green-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">🌰</span>
                                <span class="font-medium">씨앗 심고 물주기</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                화분에 씨앗을 심고<br>
                                20번의 물을 주세요!
                            </div>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">⏰</span>
                                <span class="font-medium">24시간 기다리기</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                물 20개 + 24시간 경과하면<br>
                                식물이 성장 준비 완료!
                            </div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">🎫</span>
                                <span class="font-medium">성장권 사용</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                학습으로 얻은 성장권으로<br>
                                식물을 즉시 성장시키세요!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 4: Collection -->
            <div id="slide4" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">🦎</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">3단계: 동물 수집</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-blue-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">🎫</span>
                                <span class="font-medium">일반 뽑기</span>
                            </div>
                            <div class="text-sm text-gray-700 mb-2">
                                5과목 완료 시 획득!
                            </div>
                            <div class="grid grid-cols-2 gap-1 text-xs">
                                <div>일반 60%</div>
                                <div>레어 30%</div>
                                <div>에픽 9%</div>
                                <div>전설 1%</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4 text-left border-2 border-purple-200">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">✨</span>
                                <span class="font-medium text-purple-800">프리미엄 뽑기</span>
                            </div>
                            <div class="text-sm text-purple-700 mb-2">
                                9과목 완료 시 획득!
                            </div>
                            <div class="grid grid-cols-2 gap-1 text-xs text-purple-700">
                                <div>에픽 90%</div>
                                <div>전설 10%</div>
                            </div>
                            <div class="text-xs text-center mt-2 font-bold text-purple-600">
                                🎁 에픽 이상 확정!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 5: Daily System -->
            <div id="slide5" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">📅</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">4단계: 매일 새로운 시작</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-green-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">🔄</span>
                                <span class="font-medium">일일 초기화</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                매일 새벽 4시에 과목 진행도가<br>
                                초기화되어 다시 도전할 수 있어요!
                            </div>
                        </div>
                        <div class="bg-yellow-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">⏰</span>
                                <span class="font-medium">성장권 유효기간</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                성장권은 24시간 후 만료되니<br>
                                빠르게 사용하세요!
                            </div>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-4 text-left">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl">🎯</span>
                                <span class="font-medium">꾸준한 학습</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                매일 조금씩 학습하면<br>
                                식물도 자라고 동물도 모을 수 있어요!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 6: Nickname Input -->
            <div id="slide6" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">👤</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">나만의 별명을 만들어보세요!</h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="text-sm text-gray-600 mb-4">
                            별명을 설정하면 친구들과 순위표에서<br>
                            더 재미있게 소통할 수 있어요!
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4 mb-4">
                            <div class="flex items-center justify-center space-x-2 mb-3">
                                <span class="text-2xl">🌐</span>
                                <span class="font-medium text-blue-800">소셜 기능 미리보기</span>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-xs text-blue-700">
                                <div>🏆 실시간 순위표</div>
                                <div>👥 친구 추가</div>
                                <div>🐾 동물 자랑하기</div>
                                <div>🎯 학습 그룹</div>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <input 
                                type="text" 
                                id="nicknameInput" 
                                placeholder="2-10자 사이로 입력하세요" 
                                maxlength="10"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-center text-lg"
                            >
                            <div class="text-xs text-gray-500 space-y-1">
                                <div>💡 나중에 소셜 허브에서 언제든 변경할 수 있어요!</div>
                                <div id="nicknameError" class="text-red-500 hidden"></div>
                                <div id="nicknameSuccess" class="text-green-600 hidden"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <button id="setNicknameBtn" onclick="setUserNickname()" class="w-full px-6 py-3 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition-colors">
                            ✨ 별명 설정하기
                        </button>
                        <button onclick="skipNickname()" class="w-full px-6 py-2 text-gray-500 hover:text-gray-700 transition-colors text-sm">
                            건너뛰기 (나중에 설정)
                        </button>
                    </div>
                </div>
            </div>

            <!-- Slide 7: Start -->
            <div id="slide7" class="tutorial-slide hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4 floating-icon">🎉</div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <span id="welcomeMessage">이제 시작해보세요!</span>
                    </h2>
                    <div class="text-gray-600 mb-6 space-y-3">
                        <div class="bg-green-50 rounded-lg p-4">
                            <div class="text-sm text-green-700 space-y-1">
                                <div class="font-medium mb-2">🎁 시작 보너스</div>
                                <div>💰 초기 자금: 100원</div>
                                <div>💧 물방울: 12개</div>
                                <div>🎫 프리미엄 뽑기권: 1장 (에픽 이상 확정!)</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">
                            언제든지 도움이 필요하면<br>
                            각 페이지의 안내를 확인하세요!
                        </div>
                    </div>
                    <button onclick="completeOnboarding()" class="w-full px-6 py-3 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 transition-colors pulse-glow">
                        🚀 EduPet 세계로 출발!
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-between mt-6">
            <button id="prevBtn" onclick="prevSlide()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                ← 이전
            </button>
            <button id="skipBtn" onclick="completeOnboarding()" class="px-4 py-2 text-gray-500 hover:text-gray-700 transition-colors">
                건너뛰기
            </button>
            <button id="nextBtn" onclick="nextSlide()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                다음 →
            </button>
        </div>
    </div>

    <script>
        let currentSlide = 1;
        const totalSlides = 7;

        function updateUI() {
            // Hide all slides
            for (let i = 1; i <= totalSlides; i++) {
                document.getElementById(`slide${i}`).classList.add('hidden');
            }
            
            // Show current slide with animation
            const currentSlideEl = document.getElementById(`slide${currentSlide}`);
            currentSlideEl.classList.remove('hidden');
            currentSlideEl.classList.add('slide-enter');
            
            setTimeout(() => {
                currentSlideEl.classList.remove('slide-enter');
            }, 500);
            
            // Update progress
            document.getElementById('progressBar').style.width = `${(currentSlide / totalSlides) * 100}%`;
            document.getElementById('currentStep').textContent = currentSlide;
            
            // Update buttons
            document.getElementById('prevBtn').disabled = currentSlide === 1;
            const nextBtn = document.getElementById('nextBtn');
            if (currentSlide === totalSlides) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'block';
            }
        }

        function nextSlide() {
            if (currentSlide < totalSlides) {
                currentSlide++;
                updateUI();
            }
        }

        function prevSlide() {
            if (currentSlide > 1) {
                currentSlide--;
                updateUI();
            }
        }

        // 별명 설정 함수
        function setUserNickname() {
            const nicknameInput = document.getElementById('nicknameInput');
            const nickname = nicknameInput.value.trim();
            const errorDiv = document.getElementById('nicknameError');
            const successDiv = document.getElementById('nicknameSuccess');
            const setBtn = document.getElementById('setNicknameBtn');
            
            // 에러/성공 메시지 초기화
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
            
            // 입력 검증
            if (!nickname) {
                showError('별명을 입력해주세요!');
                return;
            }
            
            if (nickname.length < 2) {
                showError('별명은 2글자 이상이어야 해요!');
                return;
            }
            
            if (nickname.length > 10) {
                showError('별명은 10글자 이하여야 해요!');
                return;
            }
            
            // 특수문자 검사 (한글, 영문, 숫자, 일부 특수문자만 허용)
            const allowedPattern = /^[가-힣a-zA-Z0-9_\s]+$/;
            if (!allowedPattern.test(nickname)) {
                showError('한글, 영문, 숫자, _만 사용할 수 있어요!');
                return;
            }
            
            // 별명 저장
            const userSettings = {
                userName: nickname,
                setAt: Date.now()
            };
            localStorage.setItem('eduPetSettings', JSON.stringify(userSettings));
            
            // 성공 메시지
            showSuccess(`✨ "${nickname}" 별명이 설정되었어요!`);
            
            // 환영 메시지 업데이트
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.textContent = `${nickname}님, 환영합니다!`;
            }
            
            // 버튼 변경
            setBtn.textContent = '✅ 설정 완료';
            setBtn.disabled = true;
            setBtn.classList.add('bg-green-500', 'hover:bg-green-500');
            setBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
            
            // 2초 후 자동으로 다음 단계로
            setTimeout(() => {
                nextSlide();
            }, 2000);
            
            function showError(message) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
                nicknameInput.classList.add('border-red-300');
                nicknameInput.focus();
            }
            
            function showSuccess(message) {
                successDiv.textContent = message;
                successDiv.classList.remove('hidden');
                nicknameInput.classList.remove('border-red-300');
                nicknameInput.classList.add('border-green-300');
            }
        }
        
        // 별명 설정 건너뛰기
        function skipNickname() {
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.textContent = '이제 시작해보세요!';
            }
            nextSlide();
        }
        
        // 엔터 키로 별명 설정
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && currentSlide === 6) {
                const nicknameInput = document.getElementById('nicknameInput');
                if (document.activeElement === nicknameInput) {
                    setUserNickname();
                }
            }
        });

        function completeOnboarding() {
            // Mark onboarding as completed
            localStorage.setItem('eduPetOnboardingCompleted', 'true');

            // Grant starter bonuses - 100원 + 프리미엄 뽑기권 (plantSystem 사용)
            if (typeof plantSystem !== 'undefined') {
                plantSystem.setMoney(100);
                console.log('✅ 튜토리얼 완료: 100원 지급');

                // Grant premium gacha ticket (Epic+ guaranteed)
                const plantSystemUser = plantSystem.getUserData();
                if (!plantSystemUser.rewards) {
                    plantSystemUser.rewards = {
                        growthTickets: [],
                        normalGachaTickets: 0,
                        premiumGachaTickets: 0
                    };
                }
                plantSystemUser.rewards.premiumGachaTickets += 1;
                plantSystem.saveUserData(plantSystemUser);
                console.log('✅ 튜토리얼 완료: 프리미엄 뽑기권 1장 지급');
            }

            // Initialize quiz progress
            const quizProgress = JSON.parse(localStorage.getItem('quizProgress') || '{}');
            if (!quizProgress.totalCorrect) quizProgress.totalCorrect = 0;
            if (!quizProgress.streakDays) quizProgress.streakDays = 0;
            localStorage.setItem('quizProgress', JSON.stringify(quizProgress));

            // Get user nickname for personalized message
            let nickname = '학습자';
            try {
                const userSettings = JSON.parse(localStorage.getItem('eduPetSettings') || '{}');
                if (userSettings.userName) {
                    nickname = userSettings.userName;
                }
            } catch (error) {
                console.log('사용자 설정 로드 실패:', error);
            }

            // Show completion message
            alert(`🎉 ${nickname}님, EduPet Collection에 오신 것을 환영합니다!\n\n시작 보너스가 지급되었습니다:\n💰 100원\n💧 물방울 12개\n🎫 프리미엄 뽑기권 1장 (에픽 이상 확정!)\n\n이제 첫 번째 퀴즈를 풀어보세요!`);

            // Redirect to main page
            window.location.href = 'index.html';
        }

        // Check if user has already completed onboarding
        function checkOnboarding() {
            // Allow revisiting tutorial for review purposes
            // Don't redirect if user explicitly came here
            return;
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') prevSlide();
            if (e.key === 'ArrowRight') nextSlide();
            if (e.key === 'Escape') completeOnboarding();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkOnboarding();
            updateUI();
        });
    </script>
</body>
</html>