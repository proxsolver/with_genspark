<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPet Collection - 학습으로 키우는 경제 생태계</title>
    <meta name="description" content="초등학생을 위한 통합 학습 게임 앱. 학습, 농장 경영, 동물 수집이 하나로!">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 한글 폰트 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- PWA 관련 메타태그 -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="EduPet Collection">

    <!-- 로거 시스템 (가장 먼저 로드) -->
    <script src="logger.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .font-game {
            font-family: 'Noto Sans KR', 'Comic Sans MS', cursive;
            font-weight: 600;
        }

        .gradient-bg {
            background: linear-gradient(135deg,
                rgba(76, 175, 80, 0.1) 0%,
                rgba(255, 152, 0, 0.1) 50%,
                rgba(33, 150, 243, 0.1) 100%
            );
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .progress-bar {
            transition: width 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes coinBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .animate-fade-in {
            animation: fadeIn 1s ease-out forwards;
        }

        .animate-slide-up {
            animation: slideUp 1s ease-out forwards;
        }

        .harvest-modal-show {
            animation: scaleIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .coin-bounce {
            animation: coinBounce 0.6s ease-in-out infinite;
        }

        /* 축하 모달 애니메이션 */
        .celebration-modal {
            animation: modalZoomIn 0.5s ease-out;
        }

        @keyframes modalZoomIn {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .glow-pulse {
            animation: glowPulse 2s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% {
                filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5));
                transform: scale(1);
            }
            50% {
                filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
                transform: scale(1.05);
            }
        }

        /* 컨페티 애니메이션 */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(720deg); opacity: 0; }
        }
    </style>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            500: '#4CAF50',
                            600: '#16a34a',
                        },
                        secondary: {
                            50: '#fff7ed',
                            500: '#FF9800',
                            600: '#ea580c',
                        },
                        accent: {
                            50: '#eff6ff',
                            500: '#2196F3',
                            600: '#2563eb',
                        },
                        danger: {
                            50: '#fef2f2',
                            500: '#F44336',
                            600: '#dc2626',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="gradient-bg min-h-screen">
    <!-- 메인 컨테이너 -->
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- 타이틀 섹션 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 opacity-0 animate-fade-in">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 font-game mb-2">
                        🌱 EduPet Collection
                    </h1>
                    <p class="text-sm text-gray-600 flex items-center flex-wrap gap-2">
                        <span>
                            <span id="userAvatarDisplay" style="font-size: 1.2rem;">🐰</span>
                            <span id="userNameDisplay">학습자</span>님, 환영합니다!
                        </span>
                        <button onclick="changeGrade()" id="gradeDisplay" class="px-3 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 text-xs rounded-full font-semibold transition-colors cursor-pointer" title="클릭하여 학년 변경">
                            🎓 4학년
                        </button>
                        <span id="offlineModeIndicator" class="hidden px-2 py-0.5 bg-gray-200 text-gray-600 text-xs rounded-full">📴 오프라인</span>
                        <a href="login.html" id="loginButton" class="hidden px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded-full transition-colors" onclick="return handleLoginClick()">🔐 로그인하고 동기화</a>
                    </p>
                </div>

                <div class="text-right">
                    <div class="flex items-center justify-end space-x-2 mb-2">
                        <span class="text-2xl">💰</span>
                        <span id="moneyDisplay" class="text-2xl font-bold text-primary-600">0 코인</span>
                    </div>
                    <div class="text-sm text-gray-600 mb-1">
                        🔥 <span id="streakDisplay">0일째</span> 플레이 중
                    </div>
                    <div class="text-sm text-gray-600">
                        🐾 <span id="animalCountDisplay">0마리</span>의 팻 보유
                    </div>
                </div>
            </div>
        </div>

        <!-- 오늘의 학습 (약점 보완) -->
        <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-xl p-6 mb-6 opacity-0" style="animation: slideUp 1s ease-out 0.2s forwards;">
            <div class="flex items-start space-x-4">
                <div class="text-6xl" id="highestAnimalDisplay">🐰</div>
                <div class="flex-1">
                    <div class="flex items-center space-x-2 mb-3">
                        <span class="text-xl">💡</span>
                        <h2 class="text-xl font-bold font-game">오늘의 학습</h2>
                        <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-semibold">약점 보완</span>
                    </div>

                    <!-- 말풍선 스타일의 문제 표시 -->
                    <div class="bg-white rounded-xl p-4 mb-3 shadow-md relative">
                        <div class="absolute -left-3 top-4">
                            <div class="w-0 h-0 border-t-8 border-b-8 border-r-8 border-transparent border-r-white"></div>
                        </div>

                        <div class="mb-3">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-lg" id="weaknessSubjectIcon">📚</span>
                                <span class="font-bold text-gray-800" id="weaknessSubjectName">약점 과목</span>
                                <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs">보통</span>
                            </div>
                            <p class="text-gray-700 mb-3" id="weaknessQuestion">
                                오늘의 문제가 여기에 표시됩니다
                            </p>
                        </div>

                        <!-- 정답 표시 -->
                        <div class="bg-green-50 border-2 border-green-200 rounded-lg p-3 mb-2">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-lg">✅</span>
                                <span class="font-bold text-green-900">정답</span>
                            </div>
                            <p class="text-sm text-green-800" id="weaknessAnswer">정답이 여기에 표시됩니다</p>
                        </div>

                        <!-- 해설 표시 -->
                        <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-3">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-lg">💡</span>
                                <span class="font-bold text-blue-900">해설</span>
                            </div>
                            <p class="text-sm text-gray-700" id="weaknessExplanation">해설이 여기에 표시됩니다</p>
                        </div>
                    </div>

                    <button onclick="loadNewWeaknessQuestion()" class="w-full px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition-colors">
                        다음 문제 보기
                    </button>
                </div>
            </div>
        </div>

        <!-- 일일 미션 진행 상황 -->
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl shadow-lg p-5 mb-6 text-gray-800 opacity-0" style="animation: slideUp 1s ease-out 0.3s forwards;">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center space-x-2">
                    <span class="text-2xl">🎯</span>
                    <h2 class="text-lg font-bold">오늘의 미션</h2>
                </div>
                <button onclick="window.location.href='daily-missions.html'" class="px-3 py-1 bg-blue-100 hover:bg-blue-200 rounded-lg text-sm font-semibold transition-all">
                    전체보기 →
                </button>
            </div>
            <div id="mission-widget" class="space-y-2">
                <!-- 미션 위젯 내용이 여기에 표시됩니다 -->
            </div>
        </div>

        <!-- 오늘 학습 미션 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 opacity-0" style="animation: slideUp 1s ease-out 0.4s forwards;">
            <div class="flex items-center space-x-2 mb-4">
                <span class="text-xl">📚</span>
                <h2 class="text-xl font-bold font-game">과목 선택</h2>
                <span id="dailyProgressDisplay" class="px-3 py-1 bg-secondary-100 text-secondary-800 rounded-full text-sm font-semibold">0/9 과목</span>
            </div>

            <!-- 진행률 바 -->
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-600">학습 진행률</span>
                    <span id="progressPercentDisplay" class="text-sm font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progressBarDisplay" class="bg-primary-500 h-3 rounded-full progress-bar" style="width: 0%;"></div>
                </div>
            </div>

            <!-- 필수 과목 -->
            <div class="mb-4">
                <h4 class="text-sm font-semibold text-gray-700 mb-3">필수 과목</h4>
                <div class="grid grid-cols-3 gap-3">
                    <button id="english-btn" onclick="startQuickQuiz('english')" class="border-2 border-gray-300 text-gray-700 p-4 rounded-xl h-20 flex flex-col items-center justify-center card-hover hover:border-primary-500 hover:bg-primary-50">
                        <div class="flex items-center space-x-1 mb-1">
                            <span>🇺🇸</span>
                            <span class="font-medium">영어</span>
                        </div>
                        <div id="english-status" class="text-xs opacity-80">필수</div>
                    </button>

                    <button id="weakness-btn" onclick="startWeaknessQuiz()" class="border-2 border-orange-300 text-gray-700 p-4 rounded-xl h-20 flex flex-col items-center justify-center card-hover hover:border-orange-500 hover:bg-orange-50">
                        <div class="flex items-center space-x-1 mb-1">
                            <span id="weaknessIcon">📊</span>
                            <span class="font-medium" id="weaknessLabel">약한과목</span>
                        </div>
                        <div id="weakness-status" class="text-xs opacity-80">필수</div>
                    </button>

                    <button id="all-subjects-btn" onclick="window.location.href='subject-select.html'" class="border-2 border-gray-300 text-gray-500 p-4 rounded-xl h-20 flex flex-col items-center justify-center card-hover hover:border-primary-500 hover:bg-primary-50">
                        <div class="flex items-center space-x-1 mb-1">
                            <span>📚</span>
                            <span class="font-medium">과목선택</span>
                        </div>
                        <div id="all-subjects-status" class="text-xs opacity-80">선택하기</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- 나의 농장 -->
        <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 mb-6 opacity-0" style="animation: slideUp 1s ease-out 0.6s forwards;">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-2">
                    <span class="text-xl">🌱</span>
                    <h2 class="text-xl font-bold font-game">나의 농장</h2>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="text-right">
                        <div class="text-sm text-gray-600">🎫 성장권</div>
                        <div class="font-bold text-green-600" id="farm-growth-tickets">0개</div>
                    </div>
                    <a href="admin.html" class="px-3 py-2 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg text-sm border border-red-200">
                        ⚙️
                    </a>
                </div>
            </div>

            <!-- 다음 보상 안내 -->
            <div class="bg-blue-50 rounded-lg p-3 mb-4 border border-blue-200">
                <div class="flex items-center space-x-2">
                    <span class="text-lg">🎯</span>
                    <div class="flex-1">
                        <p class="text-xs text-blue-700" id="farm-next-reward">3과목 달성 시: 성장권 1개</p>
                    </div>
                </div>
            </div>

            <!-- 화분 영역 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <!-- 화분 1 -->
                <div class="bg-white rounded-lg p-4 shadow-md border-2 border-green-200">
                    <div class="text-center mb-2">
                        <h3 class="text-sm font-bold text-gray-800">🪴 화분 #1</h3>
                    </div>

                    <div class="relative" id="home-pot1-container">
                        <div class="bg-amber-100 rounded-lg border-4 border-amber-300 h-32 flex flex-col items-center justify-end p-3 relative overflow-hidden"
                             id="home-pot1" style="cursor: pointer;">
                            <div id="home-plant1-display" class="absolute bottom-3 left-1/2 transform -translate-x-1/2"></div>
                            <div id="home-empty-pot1" class="text-center">
                                <div class="text-3xl mb-1">🕳️</div>
                                <div class="text-xs text-gray-500">씨앗 심기</div>
                            </div>
                        </div>

                        <div id="home-plant1-info" class="mt-2 text-center hidden">
                            <div class="text-xs text-gray-600 mb-1" id="home-plant1-status">성장 중</div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-600 mb-1">
                                    <span>💧 물</span>
                                    <span id="home-plant1-water">0/20</span>
                                </div>
                                <div class="bg-gray-200 rounded-full h-1.5">
                                    <div class="bg-blue-500 h-1.5 rounded-full transition-all" id="home-plant1-water-bar" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="text-xs text-gray-600" id="home-plant1-time">⏰ 24시간</div>
                        </div>

                        <div class="mt-2" id="home-pot1-actions">
                            <button onclick="homePlantSeed(1)" class="w-full px-3 py-2 bg-green-500 text-white rounded-lg text-xs hover:bg-green-600 transition-all">
                                🌰 씨앗 심기
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 화분 2 -->
                <div class="bg-white rounded-lg p-4 shadow-md border-2 border-green-200">
                    <div class="text-center mb-2">
                        <h3 class="text-sm font-bold text-gray-800">🪴 화분 #2</h3>
                    </div>

                    <div class="relative" id="home-pot2-container">
                        <div class="bg-amber-100 rounded-lg border-4 border-amber-300 h-32 flex flex-col items-center justify-end p-3 relative overflow-hidden"
                             id="home-pot2" style="cursor: pointer;">
                            <div id="home-plant2-display" class="absolute bottom-3 left-1/2 transform -translate-x-1/2"></div>
                            <div id="home-empty-pot2" class="text-center">
                                <div class="text-3xl mb-1">🕳️</div>
                                <div class="text-xs text-gray-500">씨앗 심기</div>
                            </div>
                        </div>

                        <div id="home-plant2-info" class="mt-2 text-center hidden">
                            <div class="text-xs text-gray-600 mb-1" id="home-plant2-status">성장 중</div>
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-600 mb-1">
                                    <span>💧 물</span>
                                    <span id="home-plant2-water">0/20</span>
                                </div>
                                <div class="bg-gray-200 rounded-full h-1.5">
                                    <div class="bg-blue-500 h-1.5 rounded-full transition-all" id="home-plant2-water-bar" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="text-xs text-gray-600" id="home-plant2-time">⏰ 24시간</div>
                        </div>

                        <div class="mt-2" id="home-pot2-actions">
                            <button onclick="homePlantSeed(2)" class="w-full px-3 py-2 bg-green-500 text-white rounded-lg text-xs hover:bg-green-600 transition-all">
                                🌰 씨앗 심기
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 물주기 안내 -->
            <div class="bg-blue-50 rounded-lg p-3 border border-blue-200">
                <div class="text-center">
                    <p class="text-xs text-blue-700 mb-1">
                        💧 식물을 클릭하면 약점 과목 문제로 물을 줄 수 있어요!
                    </p>
                    <div class="text-xs text-blue-600">
                        💡 물 20개 + 24시간 + 성장권 1개 = 성장!
                    </div>
                </div>
            </div>
        </div>


        <!-- 최근 학습 활동 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 opacity-0" style="animation: slideUp 1s ease-out 0.9s forwards;">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <span class="mr-2">📅</span>
                최근 학습 활동
            </h2>

            <!-- 오늘의 학습 현황 -->
            <div class="grid grid-cols-3 gap-3 mb-6">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-3 text-center">
                    <div class="text-xs text-gray-600 mb-1">오늘 푼 문제</div>
                    <div class="text-2xl font-bold text-blue-600" id="todayQuestions">0</div>
                    <div class="text-xs text-gray-500">문제</div>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-3 text-center">
                    <div class="text-xs text-gray-600 mb-1">정답률</div>
                    <div class="text-2xl font-bold text-purple-600" id="todayAccuracy">0</div>
                    <div class="text-xs text-gray-500">%</div>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-3 text-center">
                    <div class="text-xs text-gray-600 mb-1">학습 시간</div>
                    <div class="text-2xl font-bold text-green-600" id="todayMinutes">0</div>
                    <div class="text-xs text-gray-500">분</div>
                </div>
            </div>

            <!-- 주간 활동 그래프 -->
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm font-bold text-gray-700">최근 7일 활동</h3>
                <div class="text-sm">
                    <span class="text-orange-600 font-bold" id="streakDays">0</span>
                    <span class="text-gray-600">일 연속 🔥</span>
                </div>
            </div>
            <div class="grid grid-cols-7 gap-2 text-center">
                <div id="weeklyLabels" class="contents">
                    <!-- Day labels will be inserted here -->
                </div>

                <div id="weeklyActivity" class="contents">
                    <!-- Weekly activity cells will be inserted here -->
                </div>
            </div>
        </div>

        <!-- 동물 수집 -->
        <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-xl p-6 mb-6 opacity-0" style="animation: slideUp 1s ease-out 1s forwards;">
            <div class="flex items-start space-x-4">
                <div class="text-6xl" id="topAnimalDisplay">🦎</div>
                <div class="flex-1">
                    <div class="flex items-center space-x-2 mb-3">
                        <span class="text-xl">✨</span>
                        <h2 class="text-xl font-bold font-game">동물 수집</h2>
                    </div>

                    <div class="bg-white rounded-xl p-4 mb-3 shadow-md">
                        <p class="text-sm text-gray-700 mb-3" id="animalMessage">
                            "안녕! 나는 <span id="topAnimalName">도마뱀</span>이야! 현재 뽑기권이 <span id="ticketCount" class="font-bold text-purple-600">0장</span> 있어. 25문제를 풀면 새로운 친구를 만날 수 있어!"
                        </p>

                        <div class="grid grid-cols-2 gap-2 text-xs mb-3">
                            <div class="bg-gray-50 rounded p-2">
                                <div class="text-gray-600">일반 뽑기권</div>
                                <div class="font-bold" id="normalTickets">0장</div>
                            </div>
                            <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded p-2">
                                <div class="text-gray-600">프리미엄 뽑기권</div>
                                <div class="font-bold text-yellow-700" id="premiumTickets">0장</div>
                            </div>
                        </div>

                        <button onclick="window.location.href='animal-collection.html'" class="w-full px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition-colors">
                            동물 컬렉션 보기
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 그 외 메뉴 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 opacity-0" style="animation: slideUp 1s ease-out 1.2s forwards;">
            <h3 class="font-bold text-gray-800 mb-4 flex items-center space-x-2">
                <span>⚙️</span>
                <span>그 외 메뉴</span>
            </h3>

            <div class="grid grid-cols-2 gap-3">
                <button onclick="window.location.href='progress-dashboard.html'" class="border-2 border-gray-200 text-gray-700 p-3 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-left">
                    <div class="text-2xl mb-1">📊</div>
                    <div class="text-sm font-semibold">학습 현황</div>
                </button>

                <button onclick="window.location.href='social-hub.html'" class="border-2 border-gray-200 text-gray-700 p-3 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-left">
                    <div class="text-2xl mb-1">💬</div>
                    <div class="text-sm font-semibold">소통하기</div>
                </button>

                <button onclick="window.location.href='data-manager.html'" class="border-2 border-gray-200 text-gray-700 p-3 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-colors text-left">
                    <div class="text-2xl mb-1">💾</div>
                    <div class="text-sm font-semibold">데이터 관리</div>
                </button>

                <button onclick="window.location.href='analytics-console.html'" class="border-2 border-gray-200 text-gray-700 p-3 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-colors text-left">
                    <div class="text-2xl mb-1">📈</div>
                    <div class="text-sm font-semibold">학습 분석</div>
                </button>

                <button onclick="restartTutorial()" class="border-2 border-gray-200 text-gray-700 p-3 rounded-lg hover:border-cyan-500 hover:bg-cyan-50 transition-colors text-left">
                    <div class="text-2xl mb-1">📖</div>
                    <div class="text-sm font-semibold">튜토리얼 다시보기</div>
                </button>
            </div>

            <div class="mt-3 text-center space-y-2">
                <button class="text-sm text-gray-400 hover:text-gray-600 cursor-not-allowed" disabled>
                    💰 보상 요청 (향후 구현)
                </button>
                <div class="flex flex-col space-y-1">
                    <button onclick="window.location.href='debug-console.html'" class="text-xs text-blue-500 hover:text-blue-700">
                        🐛 디버그 콘솔
                    </button>
                    <button onclick="window.location.href='clear-offline-queue.html'" class="text-xs text-red-500 hover:text-red-700">
                        🔧 오프라인 큐 초기화
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 물주기 학습 모달 -->
    <div id="home-watering-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 max-w-lg w-full">
            <div class="text-center mb-4">
                <div class="text-4xl mb-2">🌱</div>
                <h3 class="text-lg font-bold">물주기 학습</h3>
            </div>

            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <div class="flex items-center mb-2">
                    <span class="text-2xl mr-2" id="home-question-subject-icon">📚</span>
                    <div class="font-bold text-blue-900" id="home-question-title">약점 과목 학습</div>
                </div>
                <div class="text-sm text-blue-800 mb-3" id="home-question-text">
                    문제가 여기에 표시됩니다
                </div>

                <div class="mb-3 p-3 bg-green-50 border-2 border-green-300 rounded-lg">
                    <div class="flex items-start space-x-2 mb-2">
                        <span class="text-lg">✅</span>
                        <div>
                            <div class="font-bold text-green-900 mb-1">정답</div>
                            <div class="text-sm text-green-800" id="home-correct-answer"></div>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2 mt-2 pt-2 border-t border-green-200">
                        <span class="text-lg">💡</span>
                        <div>
                            <div class="font-bold text-blue-900 mb-1">해설</div>
                            <div class="text-sm text-gray-700" id="home-explanation-text"></div>
                        </div>
                    </div>
                </div>

                <button id="home-water-confirm-btn" onclick="homeConfirmWater()" disabled
                        class="w-full px-4 py-3 bg-gray-400 text-white rounded-lg font-bold cursor-not-allowed transition-all">
                    <span id="home-water-btn-text">💧 문제를 읽어주세요 (<span id="home-countdown">3</span>초)</span>
                </button>
            </div>

            <div class="text-center">
                <button onclick="homeCloseWateringModal()" class="text-gray-500 text-sm hover:text-gray-700">
                    나중에 하기
                </button>
            </div>
        </div>
    </div>

    <!-- 식물 진화 축하 모달 -->
    <div id="home-celebration-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-yellow-50 to-green-50 rounded-2xl p-8 max-w-md w-full celebration-modal relative overflow-hidden">
            <!-- 배경 장식 -->
            <div id="home-confetti-container" class="absolute inset-0 pointer-events-none"></div>

            <div class="relative z-10">
                <!-- 축하 아이콘 -->
                <div class="text-center mb-4">
                    <div class="text-8xl mb-4 glow-pulse" id="home-celebration-emoji">🎉</div>
                    <div class="text-2xl font-bold text-gray-800 mb-2" id="home-celebration-title">축하합니다!</div>
                    <div class="text-lg text-gray-600 mb-4" id="home-celebration-message">식물이 성장했습니다!</div>
                </div>

                <!-- 변화 표시 -->
                <div class="bg-white rounded-xl p-4 mb-6 shadow-lg">
                    <div class="flex items-center justify-center space-x-4">
                        <div class="text-center">
                            <div class="text-4xl mb-2" id="home-celebration-before">🌰</div>
                            <div class="text-xs text-gray-500">이전</div>
                        </div>
                        <div class="text-3xl text-green-500">→</div>
                        <div class="text-center">
                            <div class="text-5xl mb-2 glow-pulse" id="home-celebration-after">🌱</div>
                            <div class="text-xs text-gray-500">현재</div>
                        </div>
                    </div>
                </div>

                <!-- 진행률 표시 -->
                <div class="bg-gradient-to-r from-green-100 to-blue-100 rounded-lg p-3 mb-4">
                    <div class="text-center">
                        <div class="text-sm font-semibold text-gray-700 mb-2" id="home-celebration-progress">진행률</div>
                        <div class="flex justify-center items-center space-x-2">
                            <div class="flex space-x-1" id="home-celebration-stages">
                                <!-- 동적 생성 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 다음 목표 -->
                <div class="bg-blue-50 rounded-lg p-3 mb-4 border-2 border-blue-200">
                    <div class="text-center text-sm">
                        <div class="font-semibold text-blue-800 mb-1">다음 목표</div>
                        <div class="text-blue-700" id="home-celebration-next-goal">계속 물주기!</div>
                    </div>
                </div>

                <!-- 닫기 버튼 -->
                <button onclick="homeCloseCelebrationModal()" class="w-full px-6 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl font-bold hover:from-green-600 hover:to-blue-600 transition-all shadow-lg">
                    확인
                </button>
            </div>
        </div>
    </div>

    <!-- 수확 보상 팝업 -->
    <div id="home-harvest-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full text-center transform transition-all scale-95" id="home-harvest-content">
            <div class="text-7xl mb-4 animate-bounce">🎉</div>
            <h2 class="text-3xl font-bold text-gray-900 mb-3">수확 완료!</h2>

            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl p-6 mb-4">
                <div class="text-6xl mb-3">💰</div>
                <div class="text-4xl font-bold text-orange-600" id="home-harvest-money">+100 코인</div>
            </div>

            <div class="text-gray-600 mb-6" id="home-harvest-message">
                식물을 성공적으로 수확했습니다!
            </div>

            <button onclick="closeHarvestModal()" class="w-full px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-bold hover:from-green-600 hover:to-green-700 transition-all shadow-lg">
                확인
            </button>
        </div>
    </div>

    <!-- 토스트 알림 -->
    <div id="home-toast" class="hidden fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50">
        <div id="home-toast-message"></div>
    </div>

    <!-- 학년 변경 모달 -->
    <div id="grade-change-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 max-w-lg w-full">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">🎓</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">학년 변경</h2>
                <p class="text-sm text-gray-600">학년에 맞는 난이도로 문제가 제공됩니다</p>
            </div>

            <div class="grid grid-cols-3 gap-3 mb-6">
                <button onclick="confirmGradeChange(1)" id="modal-grade-1" class="grade-modal-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                    <div class="text-4xl mb-2">🌰</div>
                    <div class="text-lg font-bold text-gray-800 mb-1">1학년</div>
                    <div class="text-xs text-gray-600">기초</div>
                </button>

                <button onclick="confirmGradeChange(2)" id="modal-grade-2" class="grade-modal-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                    <div class="text-4xl mb-2">🌱</div>
                    <div class="text-lg font-bold text-gray-800 mb-1">2학년</div>
                    <div class="text-xs text-gray-600">쉬움</div>
                </button>

                <button onclick="confirmGradeChange(3)" id="modal-grade-3" class="grade-modal-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                    <div class="text-4xl mb-2">🪴</div>
                    <div class="text-lg font-bold text-gray-800 mb-1">3학년</div>
                    <div class="text-xs text-gray-600">보통</div>
                </button>

                <button onclick="confirmGradeChange(4)" id="modal-grade-4" class="grade-modal-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                    <div class="text-4xl mb-2">🌳</div>
                    <div class="text-lg font-bold text-gray-800 mb-1">4학년</div>
                    <div class="text-xs text-gray-600">표준</div>
                </button>

                <button onclick="confirmGradeChange(5)" id="modal-grade-5" class="grade-modal-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                    <div class="text-4xl mb-2">🌲</div>
                    <div class="text-lg font-bold text-gray-800 mb-1">5학년</div>
                    <div class="text-xs text-gray-600">어려움</div>
                </button>

                <button onclick="confirmGradeChange(6)" id="modal-grade-6" class="grade-modal-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105">
                    <div class="text-4xl mb-2">🌺</div>
                    <div class="text-lg font-bold text-gray-800 mb-1">6학년</div>
                    <div class="text-xs text-gray-600">고급</div>
                </button>
            </div>

            <button onclick="closeGradeModal()" class="w-full px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition-colors">
                취소
            </button>
        </div>
    </div>

    <!-- 필수 스크립트 -->
    <script src="firebase-config.js"></script>
    <script src="firebase-auth.js"></script>
    <script src="firebase-integration.js"></script>
    <script src="plant-system.js"></script>
    <script src="daily-reset.js"></script>
    <script src="weakness-learning.js"></script>
    <script src="index-main.js"></script>
    <script src="index-missions.js"></script>
    <script src="index-farm.js"></script>

    <!-- 학년 관리 스크립트 -->
    <script>
        // 페이지 로드 시 학년 표시 업데이트
        document.addEventListener('DOMContentLoaded', function() {
            updateGradeDisplay();
        });

        // 학년 표시 업데이트
        function updateGradeDisplay() {
            const userGrade = localStorage.getItem('userGrade') || '4';
            const gradeDisplay = document.getElementById('gradeDisplay');
            if (gradeDisplay) {
                gradeDisplay.textContent = `🎓 ${userGrade}학년`;
            }
        }

        // 학년 변경 모달 열기
        function changeGrade() {
            const currentGrade = localStorage.getItem('userGrade') || '4';
            const modal = document.getElementById('grade-change-modal');

            // 모든 학년 버튼 스타일 초기화
            for (let i = 1; i <= 6; i++) {
                const btn = document.getElementById(`modal-grade-${i}`);
                if (btn) {
                    btn.className = 'grade-modal-btn p-4 border-4 border-gray-300 rounded-xl hover:border-blue-500 transition-all transform hover:scale-105';
                }
            }

            // 현재 학년 버튼 하이라이트
            const currentBtn = document.getElementById(`modal-grade-${currentGrade}`);
            if (currentBtn) {
                currentBtn.className = 'grade-modal-btn p-4 border-4 border-blue-500 bg-blue-50 rounded-xl transition-all transform scale-105';
            }

            modal.classList.remove('hidden');
        }

        // 학년 변경 확인
        function confirmGradeChange(grade) {
            const currentGrade = localStorage.getItem('userGrade') || '4';

            if (grade.toString() === currentGrade) {
                closeGradeModal();
                return;
            }

            if (confirm(`학년을 ${grade}학년으로 변경하시겠습니까?\n\n변경하면 ${grade}학년 수준의 문제가 제공됩니다.`)) {
                localStorage.setItem('userGrade', grade.toString());
                updateGradeDisplay();
                closeGradeModal();

                // 성공 토스트 표시
                showToast(`✅ 학년이 ${grade}학년으로 변경되었습니다!`);

                console.log(`✅ 학년 변경: ${grade}학년`);
            }
        }

        // 학년 변경 모달 닫기
        function closeGradeModal() {
            document.getElementById('grade-change-modal').classList.add('hidden');
        }

        // 토스트 메시지 표시 (간단 버전)
        function showToast(message) {
            const toast = document.getElementById('home-toast');
            const toastMessage = document.getElementById('home-toast-message');

            if (toast && toastMessage) {
                toastMessage.textContent = message;
                toast.classList.remove('hidden');

                setTimeout(() => {
                    toast.classList.add('hidden');
                }, 3000);
            }
        }
    </script>
</body>
</html>
