<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë¡±ì´ì˜ ì‘ì€ ì •ì› - EduPet Collection</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í•œê¸€ í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .font-game {
            font-family: 'Noto Sans KR', 'Comic Sans MS', cursive;
            font-weight: 600;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, 
                #e8f5e8 0%, 
                #f0f9ff 50%, 
                #fef3c7 100%
            );
        }
        
        .plant-pot {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .plant-pot:hover {
            transform: scale(1.05);
        }
        
        .plant-growing {
            animation: gentleGrow 3s ease-in-out infinite alternate;
        }
        
        @keyframes gentleGrow {
            from { transform: scale(1); }
            to { transform: scale(1.02); }
        }
        
        .plant-happy {
            animation: happyBounce 2s ease-in-out infinite;
        }
        
        @keyframes happyBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .water-drop {
            animation: waterFall 1s ease-out;
        }
        
        @keyframes waterFall {
            0% { 
                transform: translateY(-50px) scale(0); 
                opacity: 0; 
            }
            50% { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
            100% { 
                transform: translateY(20px) scale(0.5); 
                opacity: 0; 
            }
        }
        
        .love-heart {
            animation: loveFloat 2s ease-out;
        }
        
        @keyframes loveFloat {
            0% { 
                transform: translateY(0) scale(0); 
                opacity: 0; 
            }
            30% { 
                transform: translateY(-20px) scale(1); 
                opacity: 1; 
            }
            100% { 
                transform: translateY(-60px) scale(0.5); 
                opacity: 0; 
            }
        }
        
        .speech-bubble {
            animation: bubblePop 0.5s ease-out;
        }
        
        @keyframes bubblePop {
            0% { transform: scale(0) translateY(20px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        .modal-enter {
            animation: modalSlideIn 0.3s ease-out;
        }
        
        .protection-shield {
            animation: protectionFloat 3s ease-out;
        }
        
        @keyframes protectionFloat {
            0% { 
                transform: translate(-50%, 0) scale(0); 
                opacity: 0; 
            }
            20% { 
                transform: translate(-50%, -20px) scale(1.2); 
                opacity: 1; 
            }
            80% { 
                transform: translate(-50%, -30px) scale(1); 
                opacity: 1; 
            }
            100% { 
                transform: translate(-50%, -60px) scale(0.5); 
                opacity: 0; 
            }
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 500: '#4CAF50', 600: '#16a34a' },
                        secondary: { 500: '#FF9800', 600: '#ea580c' }
                    }
                }
            }
        }
    </script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- Firebase í†µí•© ìŠ¤í¬ë¦½íŠ¸ -->
    <script defer src="firebase-config.js"></script>
    <script defer src="firebase-auth.js"></script>
    <script defer src="firebase-integration.js"></script>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Loading Indicator -->
    <div id="loading-overlay" class="hidden fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="text-2xl animate-spin">ğŸŒ±</div>
            <div class="mt-2 font-bold text-gray-700">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>

        <!-- í—¤ë” -->
        <div class="flex items-center justify-between mb-6">
            <button onclick="window.location.href='index.html'" class="flex items-center space-x-2 p-3 bg-white rounded-xl shadow-md hover:shadow-lg transition-all">
                <span>â†</span>
                <span>í™ˆìœ¼ë¡œ</span>
            </button>
            
            <div class="text-center">
                <h1 class="text-2xl font-bold text-gray-900 font-game">ğŸŒ± ì´ˆë¡±ì´ì˜ ì‘ì€ ì •ì›</h1>
                <p class="text-sm text-gray-600">ì‚¬ë‘ìœ¼ë¡œ í‚¤ìš°ëŠ” ìš°ë¦¬ ì‹ë¬¼ì¹œêµ¬ë“¤</p>
            </div>
            
            <div class="text-right space-y-2">
                <div class="flex items-center justify-end space-x-2 text-green-600 font-bold">
                    <span>ğŸ’°</span>
                    <span id="money-count">500</span>
                    <span class="text-sm">ì›</span>
                </div>
                <div class="flex items-center justify-end space-x-2 text-blue-600 font-bold">
                    <span>ğŸ’§</span>
                    <span id="water-count">5</span>
                </div>
                <div class="text-xs text-gray-500">ëˆ / ë¬¼ë°©ìš¸</div>
            </div>
        </div>

        <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
        <div class="bg-white rounded-xl p-4 mb-6 shadow-md border-l-4 border-green-400">
            <div class="flex items-center space-x-3">
                <span class="text-2xl">ğŸ’š</span>
                <div>
                    <h3 class="font-bold text-gray-900">ì •ì› ê°€ê¾¸ê¸° ì•ˆë‚´</h3>
                    <p class="text-sm text-gray-600">
                        ìµœëŒ€ 2ê°œì˜ ì‹ë¬¼ì„ í‚¤ìš¸ ìˆ˜ ìˆì–´ìš”. ë¬¼ì„ ì£¼ë©´ì„œ í•™ìŠµí•˜ê³ , ì‚¬ë‘ìœ¼ë¡œ ëŒë´ì£¼ì„¸ìš”! ğŸŒ¿
                    </p>
                </div>
            </div>
        </div>

        <!-- ì‹ë¬¼ í™”ë¶„ êµ¬ì—­ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- í™”ë¶„ 1 -->
            <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-green-200">
                <div class="text-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">ğŸª´ í™”ë¶„ #1</h3>
                    <div class="text-xs text-gray-500" id="pot1-name">ë¹ˆ í™”ë¶„</div>
                </div>
                
                <div class="relative">
                    <!-- í™”ë¶„ ì˜ì—­ -->
                    <div class="plant-pot bg-amber-100 rounded-lg border-4 border-amber-300 h-48 flex flex-col items-center justify-end p-4 relative overflow-hidden" 
                         id="pot1" onclick="interactWithPlant(1)">
                        
                        <!-- ì‹ë¬¼ í‘œì‹œ ì˜ì—­ -->
                        <div id="plant1-display" class="absolute bottom-4 left-1/2 transform -translate-x-1/2">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                        </div>
                        
                        <!-- ë¹ˆ í™”ë¶„ í‘œì‹œ -->
                        <div id="empty-pot1" class="text-center">
                            <div class="text-4xl mb-2">ğŸ•³ï¸</div>
                            <div class="text-sm text-gray-500">ì”¨ì•—ì„ ì‹¬ì–´ë³´ì„¸ìš”</div>
                        </div>
                    </div>
                    
                    <!-- ìƒí˜¸ì‘ìš© ë²„íŠ¼ë“¤ -->
                    <div class="mt-4 flex justify-center space-x-2" id="pot1-actions">
                        <button onclick="plantSeed(1)" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-all">
                            ğŸŒ° ì”¨ì•— ì‹¬ê¸°
                        </button>
                    </div>
                </div>
                
                <!-- ì‹ë¬¼ ì •ë³´ -->
                <div id="plant1-info" class="mt-4 text-center hidden">
                    <div class="text-sm text-gray-600" id="plant1-stage">ë‹¨ê³„: ì”¨ì•—</div>
                    <div class="text-sm text-gray-600" id="plant1-grade">ë“±ê¸‰: âšª ì¼ë°˜ â€¢ ì¼ì¼ ìˆ˜ìµ: 0ì›</div>
                    <div class="text-sm text-gray-600" id="plant1-care">ëŒë´„ ì •ë„: 0%</div>
                    <div class="mt-2">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full transition-all duration-500" 
                                 id="plant1-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í™”ë¶„ 2 -->
            <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-green-200">
                <div class="text-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">ğŸª´ í™”ë¶„ #2</h3>
                    <div class="text-xs text-gray-500" id="pot2-name">ë¹ˆ í™”ë¶„</div>
                </div>
                
                <div class="relative">
                    <!-- í™”ë¶„ ì˜ì—­ -->
                    <div class="plant-pot bg-amber-100 rounded-lg border-4 border-amber-300 h-48 flex flex-col items-center justify-end p-4 relative overflow-hidden" 
                         id="pot2" onclick="interactWithPlant(2)">
                        
                        <!-- ì‹ë¬¼ í‘œì‹œ ì˜ì—­ -->
                        <div id="plant2-display" class="absolute bottom-4 left-1/2 transform -translate-x-1/2">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                        </div>
                        
                        <!-- ë¹ˆ í™”ë¶„ í‘œì‹œ -->
                        <div id="empty-pot2" class="text-center">
                            <div class="text-4xl mb-2">ğŸ•³ï¸</div>
                            <div class="text-sm text-gray-500">ì”¨ì•—ì„ ì‹¬ì–´ë³´ì„¸ìš”</div>
                        </div>
                    </div>
                    
                    <!-- ìƒí˜¸ì‘ìš© ë²„íŠ¼ë“¤ -->
                    <div class="mt-4 flex justify-center space-x-2" id="pot2-actions">
                        <button onclick="plantSeed(2)" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-all">
                            ğŸŒ° ì”¨ì•— ì‹¬ê¸°
                        </button>
                    </div>
                </div>
                
                <!-- ì‹ë¬¼ ì •ë³´ -->
                <div id="plant2-info" class="mt-4 text-center hidden">
                    <div class="text-sm text-gray-600" id="plant2-stage">ë‹¨ê³„: ì”¨ì•—</div>
                    <div class="text-sm text-gray-600" id="plant2-grade">ë“±ê¸‰: âšª ì¼ë°˜ â€¢ ì¼ì¼ ìˆ˜ìµ: 0ì›</div>
                    <div class="text-sm text-gray-600" id="plant2-care">ëŒë´„ ì •ë„: 0%</div>
                    <div class="mt-2">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full transition-all duration-500" 
                                 id="plant2-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¬¼ì£¼ê¸° ì•ˆë‚´ -->
        <div class="bg-blue-50 rounded-xl p-4 mb-6 border border-blue-200">
            <div class="text-center">
                <h3 class="font-bold text-blue-900 mb-2">ğŸ’§ ë¬¼ì£¼ê¸° ë°©ë²•</h3>
                <p class="text-sm text-blue-700 mb-3">
                    ì‹ë¬¼ì„ í´ë¦­í•˜ë©´ ë¬¼ì„ ì£¼ë©´ì„œ í•™ìŠµí•  ìˆ˜ ìˆì–´ìš”!<br>
                    ë¬¸ì œì˜ ì •ë‹µê³¼ í•´ì„¤ì„ ë³´ë©´ì„œ ì‹ë¬¼ê³¼ í•¨ê»˜ ë°°ì›Œë³´ì„¸ìš”.
                </p>
                <div class="text-xs text-blue-600">
                    ğŸ’¡ íŒ: ìì£¼ ë¬¼ì„ ì¤„ìˆ˜ë¡ ë” ì˜ˆìœ ì‹ë¬¼ë¡œ ìë¼ë‚©ë‹ˆë‹¤!
                </div>
            </div>
        </div>
    </div>

    <!-- ì”¨ì•— ì„ íƒ ëª¨ë‹¬ -->
    <div id="seed-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 max-w-lg w-full modal-enter">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold">ğŸŒ° ì”¨ì•— êµ¬ë§¤í•˜ê¸°</h3>
                <button onclick="closeSeedModal()" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            
            <div class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-center space-x-2 text-sm text-yellow-800">
                    <span>â„¹ï¸</span>
                    <div>
                        <div class="font-semibold">ë†ì¥ ê²½ì œ ì‹œìŠ¤í…œ</div>
                        <div>ë“±ê¸‰ë³„ ì„±ì¥ê¸°ê°„: ì¼ë°˜(3ì¼) â€¢ ê³ ê¸‰(7ì¼) â€¢ ì—í”½(14ì¼) â€¢ ì „ì„¤(28ì¼) â€¢ 1ì¼ ë¯¸ê´€ë¦¬ ì‹œ ë“±ê¸‰ í•˜ë½</div>
                    </div>
                </div>
            </div>
            
            <div class="space-y-3">
                <!-- ì¼ë°˜ ë“±ê¸‰ (ë¬´ë£Œ) -->
                <button onclick="selectSeed('common', 'mystery')" class="w-full p-4 text-left rounded-lg border-2 border-gray-300 hover:bg-gray-50 transition-all">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="text-3xl">âšª</span>
                            <div>
                                <div class="font-bold text-gray-800">ì¼ë°˜ ì”¨ì•—</div>
                                <div class="text-sm text-gray-600">3ì¼ ì„±ì¥ â€¢ ìˆ˜í™• 100ì› â€¢ ë“±ê¸‰í•˜ë½ ì—†ìŒ</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-green-600">ë¬´ë£Œ</div>
                        </div>
                    </div>
                </button>
                
                <!-- ê³ ê¸‰ ë“±ê¸‰ -->
                <button onclick="selectSeed('advanced', 'mystery')" class="w-full p-4 text-left rounded-lg border-2 border-blue-300 hover:bg-blue-50 transition-all">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="text-3xl">ğŸ”µ</span>
                            <div>
                                <div class="font-bold text-blue-800">ê³ ê¸‰ ì”¨ì•—</div>
                                <div class="text-sm text-blue-600">7ì¼ ì„±ì¥ â€¢ ìˆ˜í™• 1,000ì› â€¢ 1ì¼ ë¹ ì§€ë©´ ì¼ë°˜ìœ¼ë¡œ</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-blue-600">100ì›</div>
                        </div>
                    </div>
                </button>
                
                <!-- ì—í”½ ë“±ê¸‰ -->
                <button onclick="selectSeed('epic', 'mystery')" class="w-full p-4 text-left rounded-lg border-2 border-purple-300 hover:bg-purple-50 transition-all">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="text-3xl">ğŸŸ£</span>
                            <div>
                                <div class="font-bold text-purple-800">ì—í”½ ì”¨ì•—</div>
                                <div class="text-sm text-purple-600">14ì¼ ì„±ì¥ â€¢ ìˆ˜í™• 3,000ì› â€¢ 1ì¼ ë¹ ì§€ë©´ ê³ ê¸‰ìœ¼ë¡œ</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-purple-600">1,000ì›</div>
                        </div>
                    </div>
                </button>
                
                <!-- ì „ì„¤ ë“±ê¸‰ -->
                <button onclick="selectSeed('legendary', 'mystery')" class="w-full p-4 text-left rounded-lg border-2 border-yellow-300 hover:bg-yellow-50 transition-all">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="text-3xl">ğŸŸ¡</span>
                            <div>
                                <div class="font-bold text-yellow-800">ì „ì„¤ ì”¨ì•—</div>
                                <div class="text-sm text-yellow-600">28ì¼ ì„±ì¥ â€¢ ìˆ˜í™• 10,000ì› â€¢ 1ì¼ ë¹ ì§€ë©´ ì—í”½ìœ¼ë¡œ</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-yellow-600">3,000ì›</div>
                        </div>
                    </div>
                </button>
            </div>
            
            <div class="mt-4 text-center">
                <div class="text-sm text-gray-500">
                    ë³´ìœ  ê¸ˆì•¡: <span class="font-bold text-green-600" id="modal-money-display">500ì›</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¬¼ì£¼ê¸° í•™ìŠµ ëª¨ë‹¬ -->
    <div id="watering-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 max-w-lg w-full modal-enter">
            <div class="text-center mb-4">
                <div class="text-4xl mb-2" id="plant-character">ğŸŒ±</div>
                <h3 class="text-lg font-bold" id="plant-speech">ì•ˆë…•! ë‚˜ì—ê²Œ ë¬¼ì„ ì¤˜!</h3>
            </div>
            
            <!-- í•™ìŠµ ë‚´ìš© -->
            <div class="bg-blue-50 rounded-lg p-4 mb-4" id="learning-content">
                <div class="font-bold text-blue-900 mb-2" id="question-title">ì˜¤ëŠ˜ì˜ í•™ìŠµ</div>
                <div class="text-sm text-blue-800 mb-3" id="question-text">
                    ë¬¸ì œ: ë‹¤ìŒ ì¤‘ 'apple'ì˜ ëœ»ì€?
                </div>
                <div class="text-sm text-green-800 mb-2" id="answer-text">
                    <strong>ì •ë‹µ:</strong> ì‚¬ê³¼
                </div>
                <div class="text-sm text-gray-700" id="explanation-text">
                    <strong>í•´ì„¤:</strong> Appleì€ ì‚¬ê³¼ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì˜ì–´ì—ì„œ ê°€ì¥ ê¸°ë³¸ì ì¸ ê³¼ì¼ ë‹¨ì–´ ì¤‘ í•˜ë‚˜ì˜ˆìš”.
                </div>
            </div>
            
            <div class="text-center mb-4">
                <button onclick="giveWater()" class="px-8 py-3 bg-blue-500 text-white rounded-xl font-bold hover:bg-blue-600 transition-all">
                    ğŸ’§ ë¬¼ ì£¼ê¸°
                </button>
            </div>
            
            <div class="text-center">
                <button onclick="closeWateringModal()" class="text-gray-500 text-sm hover:text-gray-700">
                    ë‚˜ì¤‘ì— í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- ì‹ë¬¼ ëŒ€í™” íŒì—… -->
    <div id="plant-speech-popup" class="hidden fixed top-20 left-1/2 transform -translate-x-1/2 bg-white rounded-xl shadow-lg border-2 border-green-300 p-4 z-40">
        <div class="speech-bubble text-center">
            <div class="text-sm font-medium text-gray-800" id="popup-text">ì•ˆë…•í•˜ì„¸ìš”!</div>
            <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full">
                <div class="w-0 h-0 border-l-8 border-r-8 border-t-8 border-l-transparent border-r-transparent border-t-green-300"></div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            water: 5,
            money: 500, // ì´ˆê¸° ëˆ 500ì›
            plants: {
                1: null,
                2: null
            }
        };

        let currentPot = null;
        let selectedSeedType = null;

        // ë“±ê¸‰ë³„ ì”¨ì•— ë°ì´í„° - ìƒˆë¡œìš´ ê²½ì œ ì‹œìŠ¤í…œ
        const seedGrades = {
            common: {
                name: 'ì¼ë°˜',
                price: 0,
                color: 'gray',
                icon: 'âšª',
                growthDays: 3,
                harvestAmount: 100,
                canDowngrade: false,
                description: '3ì¼ ì„±ì¥ â€¢ ìˆ˜í™• 100ì›'
            },
            advanced: {
                name: 'ê³ ê¸‰',
                price: 100,
                color: 'blue', 
                icon: 'ğŸ”µ',
                growthDays: 7,
                harvestAmount: 1000,
                canDowngrade: true,
                downgradeTo: 'common',
                description: '7ì¼ ì„±ì¥ â€¢ ìˆ˜í™• 1,000ì›'
            },
            epic: {
                name: 'ì—í”½',
                price: 1000,
                color: 'purple',
                icon: 'ğŸŸ£',
                growthDays: 14,
                harvestAmount: 3000,
                canDowngrade: true,
                downgradeTo: 'advanced',
                description: '14ì¼ ì„±ì¥ â€¢ ìˆ˜í™• 3,000ì›'
            },
            legendary: {
                name: 'ì „ì„¤',
                price: 3000,
                color: 'yellow',
                icon: 'ğŸŸ¡',
                growthDays: 28,
                harvestAmount: 10000,
                canDowngrade: true,
                downgradeTo: 'epic',
                description: '28ì¼ ì„±ì¥ â€¢ ìˆ˜í™• 10,000ì›'
            }
        };

        // ì‹ë¬¼ íƒ€ì…ë³„ ë°ì´í„°  
        const plantTypes = {
            mystery: {
                name: 'ì‹ ë¹„í•œ ì‹ë¬¼',
                stages: [
                    { icon: 'ğŸŒ°', name: 'ì”¨ì•—', speech: 'ì•ˆë…•! ë‚˜ëŠ” ì‹ ë¹„í•œ ì”¨ì•—ì´ì•¼!' },
                    { icon: 'ğŸŒ±', name: 'ìƒˆì‹¹', speech: 'ë¬¼ì„ ì¤˜ì„œ ê³ ë§ˆì›Œ! ì‘¥ì‘¥ ìë¼ê³  ìˆì–´!' },
                    { icon: 'ğŸŒ¿', name: 'ì¤„ê¸°', speech: 'ì´ì œ ê³§ ë­”ê°€ íŠ¹ë³„í•œ ê²Œ ìƒê¸¸ ê²ƒ ê°™ì•„!' }
                ],
                possibleResults: ['ğŸŒ¸', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸª·']
            },
            flower: {
                name: 'ê½ƒì‹ë¬¼', 
                stages: [
                    { icon: 'ğŸŒ°', name: 'ê½ƒì”¨', speech: 'ì•ˆë…•! ë‚˜ëŠ” ì˜ˆìœ ê½ƒì´ ë  ì”¨ì•—ì´ì•¼!' },
                    { icon: 'ğŸŒ±', name: 'ê½ƒìƒˆì‹¹', speech: 'ë¬¼ì„ ë§ˆì‹œë‹ˆê¹Œ ê¸°ë¶„ì´ ì¢‹ì•„!' },
                    { icon: 'ğŸŒ¿', name: 'ê½ƒì¤„ê¸°', speech: 'ê³§ ì˜ˆìœ ê½ƒì´ í•„ ê±°ì•¼!' }
                ],
                possibleResults: ['ğŸŒ¸', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ·', 'ğŸŒ¹']
            },
            fruit: {
                name: 'ê³¼ì¼ë‚˜ë¬´',
                stages: [
                    { icon: 'ğŸŒ°', name: 'ê³¼ì¼ì”¨', speech: 'ì•ˆë…•! ë‚˜ëŠ” ë§›ìˆëŠ” ê³¼ì¼ì´ ë  ì”¨ì•—ì´ì•¼!' },
                    { icon: 'ğŸŒ±', name: 'ê³¼ì¼ìƒˆì‹¹', speech: 'ë¬¼ì„ ì£¼ë‹ˆê¹Œ í˜ì´ ë‚˜!' },
                    { icon: 'ğŸŒ¿', name: 'ê³¼ì¼ì¤„ê¸°', speech: 'ë§›ìˆëŠ” ê³¼ì¼ì„ ë§Œë“¤ì–´ì¤„ê²Œ!' }
                ],
                possibleResults: ['ğŸ', 'ğŸŠ', 'ğŸŒ', 'ğŸ“', 'ğŸ‘', 'ğŸ¥']
            }
        };

        // í•™ìŠµ ë¬¸ì œ ìƒ˜í”Œ (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì˜¬ ê²ƒ)
        const sampleQuestions = [
            {
                question: "ë‹¤ìŒ ì¤‘ 'apple'ì˜ ëœ»ì€?",
                answer: "ì‚¬ê³¼",
                explanation: "Appleì€ ì‚¬ê³¼ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì˜ì–´ì—ì„œ ê°€ì¥ ê¸°ë³¸ì ì¸ ê³¼ì¼ ë‹¨ì–´ ì¤‘ í•˜ë‚˜ì˜ˆìš”."
            },
            {
                question: "'cat'ì˜ ëœ»ì€?",
                answer: "ê³ ì–‘ì´", 
                explanation: "Catì€ ê³ ì–‘ì´ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·€ì—¬ìš´ ë™ë¬¼ì´ì£ !"
            },
            {
                question: "5 + 3 = ?",
                answer: "8",
                explanation: "5ì™€ 3ì„ ë”í•˜ë©´ 8ì…ë‹ˆë‹¤. ê°„ë‹¨í•œ ë§ì…ˆ ë¬¸ì œì˜ˆìš”."
            }
        ];

        // ì´ˆê¸°í™”
        async function initializeGarden() {
            await loadGameState();
            updateDisplay();
        }

        // ì”¨ì•— ì‹¬ê¸°
        function plantSeed(potNumber) {
            if (gameState.plants[potNumber]) {
                showPlantSpeech(`í™”ë¶„ ${potNumber}ì— ì´ë¯¸ ì‹ë¬¼ì´ ìˆì–´ìš”!`);
                return;
            }
            
            currentPot = potNumber;
            
            // ëª¨ë‹¬ì— í˜„ì¬ ëˆ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('modal-money-display').textContent = `${gameState.money}ì›`;
            document.getElementById('seed-modal').classList.remove('hidden');
        }

        function selectSeed(grade, type) {
            const seedInfo = seedGrades[grade];
            
            // ëˆì´ ë¶€ì¡±í•œì§€ í™•ì¸
            if (gameState.money < seedInfo.price) {
                alert(`ëˆì´ ë¶€ì¡±í•´ìš”! ${seedInfo.price}ì›ì´ í•„ìš”í•˜ì§€ë§Œ ${gameState.money}ì›ë§Œ ê°€ì§€ê³  ìˆì–´ìš”.`);
                return;
            }
            
            // ëˆ ì°¨ê°
            gameState.money -= seedInfo.price;
            
            selectedSeedType = type;
            
            // ìƒˆë¡œìš´ ì‹ë¬¼ ìƒì„± (ìƒˆë¡œìš´ ê²½ì œ ì‹œìŠ¤í…œ)
            gameState.plants[currentPot] = {
                type: type,
                grade: grade,
                stage: 0,
                care: 0,
                plantedAt: Date.now(),
                lastWatered: 0,
                lastStudied: Date.now(), // ë§ˆì§€ë§‰ í•™ìŠµ ì‹œê°„
                finalResult: null,
                growthDays: seedInfo.growthDays,
                harvestAmount: seedInfo.harvestAmount,
                isFullyGrown: false,
                isHarvested: false
            };
            
            closeSeedModal();
            updatePlantDisplay(currentPot);
            updateDisplay();
            
            const message = seedInfo.price > 0 
                ? `${seedInfo.name} ë“±ê¸‰ ì”¨ì•—ì„ ${seedInfo.price}ì›ì— êµ¬ë§¤í–ˆì–´ìš”! ${plantTypes[type].stages[0].speech}`
                : `${plantTypes[type].stages[0].speech}`;
            
            showPlantSpeech(message);
            
            saveGameState();
        }

        function closeSeedModal() {
            document.getElementById('seed-modal').classList.add('hidden');
            currentPot = null;
            selectedSeedType = null;
        }

        // ì‹ë¬¼ê³¼ ìƒí˜¸ì‘ìš©
        function interactWithPlant(potNumber) {
            const plant = gameState.plants[potNumber];
            
            if (!plant) {
                plantSeed(potNumber);
                return;
            }

            if (gameState.water <= 0) {
                showPlantSpeech('ë¬¼ì´ ë¶€ì¡±í•´ìš”! í•™ìŠµì„ ì™„ë£Œí•˜ë©´ ë¬¼ì„ ì–»ì„ ìˆ˜ ìˆì–´ìš”.');
                return;
            }

            // ë¬¼ì£¼ê¸° ëª¨ë‹¬ ì—´ê¸°
            openWateringModal(potNumber);
        }

        // ë¬¼ì£¼ê¸° ëª¨ë‹¬ ì—´ê¸°
        function openWateringModal(potNumber) {
            const plant = gameState.plants[potNumber];
            const plantInfo = plantTypes[plant.type];
            const currentStage = plantInfo.stages[plant.stage];
            
            // ëœë¤ í•™ìŠµ ë¬¸ì œ ì„ íƒ
            const question = sampleQuestions[Math.floor(Math.random() * sampleQuestions.length)];
            
            document.getElementById('plant-character').textContent = currentStage.icon;
            document.getElementById('plant-speech').textContent = currentStage.speech;
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('answer-text').innerHTML = `<strong>ì •ë‹µ:</strong> ${question.answer}`;
            document.getElementById('explanation-text').innerHTML = `<strong>í•´ì„¤:</strong> ${question.explanation}`;
            
            currentPot = potNumber;
            document.getElementById('watering-modal').classList.remove('hidden');
        }

        function closeWateringModal() {
            document.getElementById('watering-modal').classList.add('hidden');
            currentPot = null;
        }

        // ë¬¼ ì£¼ê¸°
        function giveWater() {
            if (gameState.water <= 0 || !currentPot) return;
            
            const plant = gameState.plants[currentPot];
            const potElement = document.getElementById(`pot${currentPot}`);
            
            // ë¬¼ ì†Œëª¨
            gameState.water--;
            
            // ì‹ë¬¼ ëŒë´„ ì¦ê°€
            plant.care += 20;
            plant.lastWatered = Date.now();
            
            // ë¬¼ë°©ìš¸ ì• ë‹ˆë©”ì´ì…˜
            showWaterAnimation(potElement);
            
            // í•˜íŠ¸ ì• ë‹ˆë©”ì´ì…˜
            setTimeout(() => {
                showLoveAnimation(potElement);
            }, 500);
            
            // ì„±ì¥ ì²´í¬
            checkPlantGrowth(currentPot);
            
            closeWateringModal();
            updateDisplay();
            saveGameState();
            
            showPlantSpeech('ê³ ë§ˆì›Œ! ë¬¼ì´ ì •ë§ ì‹œì›í•´!');
        }

        // ì‹ë¬¼ ì„±ì¥ ì²´í¬ - ìƒˆë¡œìš´ ë“±ê¸‰ë³„ ì„±ì¥ê¸°ê°„ ì‹œìŠ¤í…œ
        function checkPlantGrowth(potNumber) {
            const plant = gameState.plants[potNumber];
            if (!plant || plant.isHarvested) return;
            
            const plantInfo = plantTypes[plant.type];
            const gradeInfo = seedGrades[plant.grade];
            
            // ê²½ê³¼ ì¼ìˆ˜ ê³„ì‚° (í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ 30ë°° ê°€ì†)
            const daysPassed = (Date.now() - plant.plantedAt) / (1000 * 60 * 60 * 24 / 30);
            
            // ì„±ì¥ ë‹¨ê³„ ê²°ì • (ë“±ê¸‰ë³„ ì„±ì¥ê¸°ê°„ì— ë”°ë¼)
            const growthProgress = Math.min(daysPassed / gradeInfo.growthDays, 1);
            const targetStage = Math.floor(growthProgress * (plantInfo.stages.length - 1));
            
            if (targetStage > plant.stage && plant.care >= 20) { // ìµœì†Œ ëŒë´„ í•„ìš”
                plant.stage = targetStage;
                showPlantSpeech(`ì™€! í•œ ë‹¨ê³„ ë” ìëì–´ìš”! ì´ì œ ${plantInfo.stages[plant.stage].name}ì´ì—ìš”!`);
            }
            
            // ì™„ì „ ì„±ì¥ ì²´í¬
            if (daysPassed >= gradeInfo.growthDays && !plant.isFullyGrown) {
                plant.isFullyGrown = true;
                plant.stage = plantInfo.stages.length - 1;
                determineFinalResult(potNumber);
                
                // ìˆ˜í™• ê°€ëŠ¥ ì•Œë¦¼
                setTimeout(() => {
                    showPlantSpeech(`ğŸ‰ ${gradeInfo.growthDays}ì¼ê°„ì˜ ì„±ì¥ì´ ì™„ë£Œë˜ì—ˆì–´ìš”! ì´ì œ ìˆ˜í™•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸ’°${gradeInfo.harvestAmount}ì›ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”!`);
                }, 1000);
            }
            
            updatePlantDisplay(potNumber);
        }

        // ìµœì¢… ê²°ê³¼ ê²°ì •
        function determineFinalResult(potNumber) {
            const plant = gameState.plants[potNumber];
            const plantInfo = plantTypes[plant.type];
            
            // ëŒë´„ ì •ë„ì— ë”°ë¼ ë” ì¢‹ì€ ê²°ê³¼
            let resultIndex = Math.floor(Math.random() * plantInfo.possibleResults.length);
            
            if (plant.care >= 80) {
                // 80% ì´ìƒ ëŒë´„: ë” ì¢‹ì€ ê²°ê³¼ í™•ë¥  ì¦ê°€
                resultIndex = Math.min(resultIndex + 1, plantInfo.possibleResults.length - 1);
            }
            
            plant.finalResult = plantInfo.possibleResults[resultIndex];
            
            setTimeout(() => {
                showPlantSpeech(`ì§œì”! ë‚´ê°€ ë°”ë¡œ ${plant.finalResult}ì´ì•¼! ì •ì„±ê» í‚¤ì›Œì¤˜ì„œ ê³ ë§ˆì›Œ!`);
            }, 1000);
        }

        // ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            document.getElementById('water-count').textContent = gameState.water;
            document.getElementById('money-count').textContent = gameState.money;
            
            // ê° í™”ë¶„ ì—…ë°ì´íŠ¸
            [1, 2].forEach(potNumber => {
                updatePlantDisplay(potNumber);
            });
        }

        function updatePlantDisplay(potNumber) {
            const plant = gameState.plants[potNumber];
            const emptyElement = document.getElementById(`empty-pot${potNumber}`);
            const plantDisplay = document.getElementById(`plant${potNumber}-display`);
            const plantInfo = document.getElementById(`plant${potNumber}-info`);
            const potName = document.getElementById(`pot${potNumber}-name`);
            const actions = document.getElementById(`pot${potNumber}-actions`);
            
            if (!plant) {
                // ë¹ˆ í™”ë¶„
                emptyElement.classList.remove('hidden');
                plantDisplay.innerHTML = '';
                plantInfo.classList.add('hidden');
                potName.textContent = 'ë¹ˆ í™”ë¶„';
                actions.innerHTML = `
                    <button onclick="plantSeed(${potNumber})" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-all">
                        ğŸŒ° ì”¨ì•— ì‹¬ê¸°
                    </button>
                `;
            } else {
                // ì‹ë¬¼ì´ ìˆëŠ” í™”ë¶„
                emptyElement.classList.add('hidden');
                plantInfo.classList.remove('hidden');
                
                const plantTypeInfo = plantTypes[plant.type];
                const currentStage = plantTypeInfo.stages[plant.stage];
                const gradeInfo = seedGrades[plant.grade];
                
                potName.innerHTML = `${gradeInfo.icon} ${gradeInfo.name} ${plantTypeInfo.name}`;
                
                let displayIcon = currentStage.icon;
                if (plant.finalResult && plant.stage === plantTypeInfo.stages.length - 1) {
                    displayIcon = plant.finalResult;
                }
                
                plantDisplay.innerHTML = `
                    <div class="text-6xl plant-growing ${plant.care > 50 ? 'plant-happy' : ''}">${displayIcon}</div>
                `;
                
                document.getElementById(`plant${potNumber}-stage`).textContent = `ë‹¨ê³„: ${currentStage.name}`;
                document.getElementById(`plant${potNumber}-care`).textContent = `ëŒë´„ ì •ë„: ${Math.min(plant.care, 100)}%`;
                document.getElementById(`plant${potNumber}-progress`).style.width = `${Math.min(plant.care, 100)}%`;
                
                // ë“±ê¸‰ ë° ì„±ì¥ ì •ë³´ í‘œì‹œ
                const gradeDisplay = document.getElementById(`plant${potNumber}-grade`);
                if (gradeDisplay) {
                    const daysPassed = Math.floor((Date.now() - plant.plantedAt) / (1000 * 60 * 60 * 24 / 30)); // í…ŒìŠ¤íŠ¸ìš© 30ë°° ê°€ì†
                    const gradeInfo = seedGrades[plant.grade];
                    
                    let gradeText = '';
                    if (plant.isFullyGrown && !plant.isHarvested) {
                        gradeText = `${gradeInfo.icon} ${gradeInfo.name} â€¢ ğŸ‰ ìˆ˜í™• ê°€ëŠ¥! ${gradeInfo.harvestAmount}ì›`;
                    } else if (plant.isHarvested) {
                        gradeText = `${gradeInfo.icon} ${gradeInfo.name} â€¢ âœ… ìˆ˜í™• ì™„ë£Œ (${gradeInfo.harvestAmount}ì› íšë“)`;
                    } else {
                        gradeText = `${gradeInfo.icon} ${gradeInfo.name} â€¢ ì„±ì¥ ${daysPassed}/${gradeInfo.growthDays}ì¼`;
                    }
                    
                    // ë³´í˜¸ ìƒíƒœ í‘œì‹œ
                    if (isPlantProtected(potNumber)) {
                        const protectedDays = Math.ceil((plant.protectedUntil - Date.now()) / (1000 * 60 * 60 * 24));
                        gradeText += `<br><div class="text-sm text-purple-600 mt-1">ğŸ›¡ï¸ ${plant.protectedBy.emoji} ${plant.protectedBy.name}ì´ ë³´í˜¸ ì¤‘ (${protectedDays}ì¼ ë‚¨ìŒ)</div>`;
                    }
                    
                    gradeDisplay.innerHTML = gradeText;
                }
                
                if (plant.isFullyGrown && !plant.isHarvested) {
                    // ìˆ˜í™• ê°€ëŠ¥
                    actions.innerHTML = `
                        <button onclick="harvestPlant(${potNumber})" class="px-4 py-2 bg-yellow-500 text-white rounded-lg text-sm hover:bg-yellow-600 transition-all">
                            ğŸŒ¾ ìˆ˜í™•í•˜ê¸° (${seedGrades[plant.grade].harvestAmount}ì›)
                        </button>
                    `;
                } else if (plant.isHarvested) {
                    // ìˆ˜í™• ì™„ë£Œ
                    actions.innerHTML = `
                        <button onclick="removePlant(${potNumber})" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-all">
                            ğŸŒ± ìƒˆ ì”¨ì•— ì‹¬ê¸°
                        </button>
                    `;
                } else {
                    // ì„±ì¥ ì¤‘
                    let actionsHtml = `
                        <button onclick="interactWithPlant(${potNumber})" class="px-3 py-2 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition-all mb-2 w-full">
                            ğŸ’§ ë¬¼ì£¼ê¸°
                        </button>
                    `;
                    
                    // ë³´í˜¸ë˜ì§€ ì•Šì€ ì‹ë¬¼ì—ë§Œ ë³´í˜¸ ë²„íŠ¼ í‘œì‹œ
                    if (!isPlantProtected(potNumber)) {
                        actionsHtml += `
                            <button onclick="showProtectionDialog(${potNumber})" class="px-3 py-2 bg-purple-500 text-white rounded-lg text-sm hover:bg-purple-600 transition-all w-full">
                                ğŸ›¡ï¸ ë™ë¬¼ ë³´í˜¸
                            </button>
                        `;
                    } else {
                        actionsHtml += `
                            <div class="px-3 py-2 bg-purple-100 text-purple-600 rounded-lg text-sm text-center w-full">
                                ğŸ›¡ï¸ ë³´í˜¸ ì¤‘
                            </div>
                        `;
                    }
                    
                    actions.innerHTML = actionsHtml;
                }
            }
        }

        // ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜ë“¤
        function showWaterAnimation(potElement) {
            const waterDrop = document.createElement('div');
            waterDrop.innerHTML = 'ğŸ’§';
            waterDrop.className = 'absolute top-0 left-1/2 transform -translate-x-1/2 text-2xl water-drop pointer-events-none';
            potElement.appendChild(waterDrop);
            
            setTimeout(() => {
                potElement.removeChild(waterDrop);
            }, 1000);
        }

        function showLoveAnimation(potElement) {
            const heart = document.createElement('div');
            heart.innerHTML = 'ğŸ’š';
            heart.className = 'absolute bottom-8 left-1/2 transform -translate-x-1/2 text-xl love-heart pointer-events-none';
            potElement.appendChild(heart);
            
            setTimeout(() => {
                potElement.removeChild(heart);
            }, 2000);
        }

        // ë™ë¬¼ ë³´í˜¸ ì‹œìŠ¤í…œ
        function getProtectiveAnimals() {
            const animalCollection = JSON.parse(localStorage.getItem('animalCollection') || '{}');
            const collection = animalCollection.collection || {};
            
            const protectiveAnimals = [];
            for (const [animalId, animalData] of Object.entries(collection)) {
                if (animalData.tier === 'epic' || animalData.tier === 'legendary') {
                    protectiveAnimals.push({
                        ...animalData,
                        id: animalId
                    });
                }
            }
            return protectiveAnimals;
        }

        function activateProtection(potNumber, animalId) {
            const plant = gameState.plants[potNumber];
            if (!plant) return false;

            const animalCollection = JSON.parse(localStorage.getItem('animalCollection') || '{}');
            const animal = animalCollection.collection[animalId];
            
            if (!animal || (animal.tier !== 'epic' && animal.tier !== 'legendary') || animal.count <= 0) {
                alert('ì´ ë™ë¬¼ì€ ë³´í˜¸ ëŠ¥ë ¥ì´ ì—†ê±°ë‚˜ ë³´ìœ í•˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return false;
            }

            // ë™ë¬¼ í¬ìƒ (ìˆ˜ëŸ‰ ê°ì†Œ)
            animal.count--;
            if (animal.count <= 0) {
                delete animalCollection.collection[animalId];
                // ëª…ì˜ˆì˜ ì „ë‹¹ì— ì¶”ê°€
                if (!animalCollection.hallOfFame) animalCollection.hallOfFame = [];
                animalCollection.hallOfFame.push({
                    ...animal,
                    id: animalId,
                    sacrificedAt: Date.now(),
                    protectedPlant: plant.type,
                    potNumber: potNumber
                });
            }

            // ì‹ë¬¼ì— ë³´í˜¸ ìƒíƒœ ì¶”ê°€
            plant.protectedUntil = Date.now() + (7 * 24 * 60 * 60 * 1000); // 7ì¼ ë³´í˜¸
            plant.protectedBy = {
                id: animalId,
                name: animal.name,
                emoji: animal.emoji,
                tier: animal.tier
            };

            localStorage.setItem('animalCollection', JSON.stringify(animalCollection));
            saveGameState();

            showProtectionAnimation(potNumber, animal);
            alert(`${animal.emoji} ${animal.name}ì´(ê°€) ${plant.protectedBy ? plant.protectedBy.name : 'ì‹ë¬¼'}ì„ 7ì¼ê°„ ë³´í˜¸í•©ë‹ˆë‹¤!\nì´ ì‹ë¬¼ì€ ë“±ê¸‰ì´ í•˜ë½í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`);
            
            updatePlantDisplay(potNumber);
            return true;
        }

        function showProtectionAnimation(potNumber, animal) {
            const potElement = document.querySelector(`#pot${potNumber}-container`);
            if (!potElement) return;

            const shield = document.createElement('div');
            shield.innerHTML = `ğŸ›¡ï¸${animal.emoji}`;
            shield.className = 'absolute top-0 left-1/2 transform -translate-x-1/2 text-2xl protection-shield pointer-events-none';
            potElement.appendChild(shield);
            
            setTimeout(() => {
                if (potElement.contains(shield)) {
                    potElement.removeChild(shield);
                }
            }, 3000);
        }

        function isPlantProtected(potNumber) {
            const plant = gameState.plants[potNumber];
            return plant && plant.protectedUntil && Date.now() < plant.protectedUntil;
        }

        function showProtectionDialog(potNumber) {
            const protectiveAnimals = getProtectiveAnimals();
            if (protectiveAnimals.length === 0) {
                alert('ë³´í˜¸ ëŠ¥ë ¥ì„ ê°€ì§„ ë™ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.\nì—í”½ ë˜ëŠ” ì „ì„¤ ë“±ê¸‰ì˜ ë™ë¬¼ì„ ìˆ˜ì§‘í•˜ì„¸ìš”!');
                return;
            }

            const plant = gameState.plants[potNumber];
            const plantName = plant ? `${seedGrades[plant.grade].name} ${plantTypes[plant.type].name}` : 'ì‹ë¬¼';
            
            let dialogHtml = `
                <div id="protection-dialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-xl p-6 max-w-sm mx-4">
                        <h3 class="text-lg font-bold mb-4 text-center">ğŸ›¡ï¸ ì‹ë¬¼ ë³´í˜¸</h3>
                        <p class="text-sm text-gray-600 mb-4 text-center">${plantName}ì„(ë¥¼) ë³´í˜¸í•  ë™ë¬¼ì„ ì„ íƒí•˜ì„¸ìš”.<br><span class="text-red-500">ì„ íƒí•œ ë™ë¬¼ì€ í¬ìƒë©ë‹ˆë‹¤.</span></p>
                        <div class="space-y-2 max-h-60 overflow-y-auto">
            `;
            
            protectiveAnimals.forEach(animal => {
                const tierColor = animal.tier === 'legendary' ? 'bg-yellow-100 border-yellow-500' : 'bg-purple-100 border-purple-500';
                dialogHtml += `
                    <button onclick="confirmProtection('${potNumber}', '${animal.id}')" 
                            class="w-full p-3 ${tierColor} border-2 rounded-lg text-left hover:scale-105 transition-transform">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl">${animal.emoji}</span>
                                <div>
                                    <div class="font-bold">${animal.name}</div>
                                    <div class="text-xs text-gray-600">${animal.tier === 'legendary' ? 'ì „ì„¤' : 'ì—í”½'} â€¢ íŒŒì›Œ ${animal.power}</div>
                                </div>
                            </div>
                            <div class="text-sm font-bold">${animal.count}ë§ˆë¦¬</div>
                        </div>
                    </button>
                `;
            });
            
            dialogHtml += `
                        </div>
                        <button onclick="closeProtectionDialog()" 
                                class="w-full mt-4 p-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                            ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', dialogHtml);
        }

        function confirmProtection(potNumber, animalId) {
            const animalCollection = JSON.parse(localStorage.getItem('animalCollection') || '{}');
            const animal = animalCollection.collection[animalId];
            
            if (confirm(`ì •ë§ë¡œ ${animal.emoji} ${animal.name}ì„(ë¥¼) í¬ìƒì‹œì¼œ ì‹ë¬¼ì„ ë³´í˜¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ë™ë¬¼ì€ 7ì¼ê°„ ì‹ë¬¼ì„ ë³´í˜¸í•œ í›„ ëª…ì˜ˆì˜ ì „ë‹¹ì— ê¸°ë¡ë©ë‹ˆë‹¤.`)) {
                closeProtectionDialog();
                activateProtection(potNumber, animalId);
            }
        }

        function closeProtectionDialog() {
            const dialog = document.getElementById('protection-dialog');
            if (dialog) {
                dialog.remove();
            }
        }

        function showPlantSpeech(message) {
            const popup = document.getElementById('plant-speech-popup');
            document.getElementById('popup-text').textContent = message;
            popup.classList.remove('hidden');
            
            setTimeout(() => {
                popup.classList.add('hidden');
            }, 3000);
        }

        // ê²Œì„ ìƒíƒœ ì €ì¥/ë¡œë“œ
        async function saveGameState() {
            gameState.lastUpdated = Date.now();
            localStorage.setItem('simpleFarmState', JSON.stringify(gameState));
            
            if (typeof eduPetFirebaseIntegration !== 'undefined') {
                await eduPetFirebaseIntegration.saveFarmState(gameState);
            }
        }

        async function loadGameState() {
            const localState = JSON.parse(localStorage.getItem('simpleFarmState'));
            const serverState = await eduPetFirebaseIntegration.loadFarmState();

            if (serverState && (!localState || serverState.lastUpdated >= localState.lastUpdated)) {
                // ì„œë²„ ë°ì´í„°ê°€ ìµœì‹ ì´ê±°ë‚˜ ë¡œì»¬ ë°ì´í„°ê°€ ì—†ì„ ë•Œ
                console.log('ì„œë²„ ë°ì´í„°ë¡œ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.');
                gameState = { ...gameState, ...serverState };
            } else if (localState) {
                // ë¡œì»¬ ë°ì´í„°ê°€ ìµœì‹ ì¼ ë•Œ
                console.log('ë¡œì»¬ ë°ì´í„°ë¡œ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.');
                gameState = { ...gameState, ...localState };
            }
            
            // ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œì§ì€ ìœ ì§€
            [1, 2].forEach(potNumber => {
                const plant = gameState.plants[potNumber];
                if (plant) {
                    if (!plant.grade) plant.grade = 'common';
                    const gradeInfo = seedGrades[plant.grade];
                    if (!plant.growthDays) plant.growthDays = gradeInfo.growthDays;
                    if (!plant.harvestAmount) plant.harvestAmount = gradeInfo.harvestAmount;
                    if (plant.isFullyGrown === undefined) plant.isFullyGrown = false;
                    if (plant.isHarvested === undefined) plant.isHarvested = false;
                    if (!plant.lastStudied) plant.lastStudied = plant.plantedAt;
                    delete plant.dailyIncome;
                }
            });

            if (gameState.money === undefined) gameState.money = 500;
            delete gameState.monthlyEarnings;
            delete gameState.lastReset;

            // ìµœì¢… ë³‘í•©ëœ ìƒíƒœë¥¼ ë‹¤ì‹œ ì €ì¥í•˜ì—¬ ë™ê¸°í™”
            await saveGameState(); 
        }


        
        // ë“±ê¸‰ í•˜ë½ ì²´í¬ (ë§¤ì¼ 25ë¶„ í•™ìŠµ ë¯¸ì™„ë£Œ ì‹œ)
        function checkPlantDowngrade() {
            [1, 2].forEach(potNumber => {
                const plant = gameState.plants[potNumber];
                if (!plant || plant.isHarvested) return;
                
                // ë³´í˜¸ ì¤‘ì¸ ì‹ë¬¼ì€ ë“±ê¸‰ í•˜ë½ ì—†ìŒ
                if (isPlantProtected(potNumber)) {
                    return;
                }
                
                const lastStudied = plant.lastStudied || plant.plantedAt;
                const daysSinceStudy = (Date.now() - lastStudied) / (1000 * 60 * 60 * 24 / 30); // í…ŒìŠ¤íŠ¸ìš© 30ë°° ê°€ì†
                
                // 1ì¼ ì´ìƒ í•™ìŠµ ì•ˆí•¨ - ë“±ê¸‰ í•˜ë½
                if (daysSinceStudy >= 1) {
                    const currentGradeInfo = seedGrades[plant.grade];
                    
                    // ì¼ë°˜ ë“±ê¸‰ì´ ì•„ë‹ˆê³  í•˜ë½ ê°€ëŠ¥í•œ ê²½ìš°
                    if (currentGradeInfo.canDowngrade && currentGradeInfo.downgradeTo) {
                        const newGrade = currentGradeInfo.downgradeTo;
                        const newGradeInfo = seedGrades[newGrade];
                        
                        plant.grade = newGrade;
                        plant.growthDays = newGradeInfo.growthDays;
                        plant.harvestAmount = newGradeInfo.harvestAmount;
                        
                        // ì„±ì¥ê¸°ê°„ì´ ì¤„ì–´ë“¤ì—ˆìœ¼ë¯€ë¡œ ì„±ì¥ ìƒíƒœ ì¬ê³„ì‚°
                        const daysPassed = (Date.now() - plant.plantedAt) / (1000 * 60 * 60 * 24 / 30); // í…ŒìŠ¤íŠ¸ìš© 30ë°° ê°€ì†
                        if (daysPassed >= newGradeInfo.growthDays) {
                            plant.isFullyGrown = true;
                        }
                        
                        showPlantSpeech(`${potNumber}ë²ˆ í™”ë¶„ì˜ ì‹ë¬¼ì´ ê´€ë¦¬ ë¶€ì¡±ìœ¼ë¡œ ${newGradeInfo.name} ë“±ê¸‰ìœ¼ë¡œ í•˜ë½í–ˆì–´ìš”!`);
                        updatePlantDisplay(potNumber);
                        
                        // ë‹¤ì‹œ í•™ìŠµ ì‹œê°„ ì—…ë°ì´íŠ¸ (ì—°ì† í•˜ë½ ë°©ì§€)
                        plant.lastStudied = Date.now();
                    } else if (plant.grade === 'common') {
                        // ì¼ë°˜ ë“±ê¸‰ì€ ì„±ì¥ë§Œ ë©ˆì¶¤
                        showPlantSpeech(`${potNumber}ë²ˆ í™”ë¶„ì˜ ì¼ë°˜ ì‹ë¬¼ì´ ì„±ì¥ì„ ë©ˆì·„ì–´ìš”! í•™ìŠµì„ ì™„ë£Œí•´ì•¼ ë‹¤ì‹œ ìëë‹ˆë‹¤.`);
                        plant.lastStudied = Date.now(); // ì•Œë¦¼ í›„ ì‹œê°„ ì—…ë°ì´íŠ¸
                    }
                }
            });
        }
        
        // í•™ìŠµ ì™„ë£Œ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ (25ë¶„ í•™ìŠµ ì™„ë£Œ)
        function onStudyComplete() {
            // ëª¨ë“  ì‹ë¬¼ì˜ lastStudied ì—…ë°ì´íŠ¸
            [1, 2].forEach(potNumber => {
                const plant = gameState.plants[potNumber];
                if (plant) {
                    plant.lastStudied = Date.now();
                }
            });
            
            saveGameState();
        }
        
        // ìˆ˜í™• ê¸°ëŠ¥
        function harvestPlant(potNumber) {
            const plant = gameState.plants[potNumber];
            if (!plant || !plant.isFullyGrown || plant.isHarvested) return;
            
            const gradeInfo = seedGrades[plant.grade];
            
            // ëˆ íšë“
            gameState.money += gradeInfo.harvestAmount;
            plant.isHarvested = true;
            
            // ìˆ˜í™• ì• ë‹ˆë©”ì´ì…˜ ë° ë©”ì‹œì§€
            const potElement = document.getElementById(`pot${potNumber}`);
            showHarvestAnimation(potElement, gradeInfo.harvestAmount);
            
            showPlantSpeech(`ğŸ‰ ìˆ˜í™• ì™„ë£Œ! ${gradeInfo.harvestAmount}ì›ì„ íšë“í–ˆì–´ìš”! ì´ì œ ìƒˆë¡œìš´ ì”¨ì•—ì„ ì‹¬ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
            
            updateDisplay();
            saveGameState();
        }
        
        // ì‹ë¬¼ ì œê±° (ìƒˆ ì”¨ì•— ì‹¬ê¸° ìœ„í•´)
        function removePlant(potNumber) {
            gameState.plants[potNumber] = null;
            updateDisplay();
            saveGameState();
            showPlantSpeech('í™”ë¶„ì´ ë¹„ì›Œì¡Œì–´ìš”! ìƒˆë¡œìš´ ì”¨ì•—ì„ ì‹¬ì–´ë³´ì„¸ìš”.');
        }
        
        // ìˆ˜í™• ì• ë‹ˆë©”ì´ì…˜
        function showHarvestAnimation(potElement, amount) {
            const coin = document.createElement('div');
            coin.innerHTML = `ğŸ’°+${amount}ì›`;
            coin.className = 'absolute bottom-8 left-1/2 transform -translate-x-1/2 text-lg font-bold text-yellow-600 love-heart pointer-events-none';
            potElement.appendChild(coin);
            
            setTimeout(() => {
                if (potElement.contains(coin)) {
                    potElement.removeChild(coin);
                }
            }, 3000);
        }
        
        // ë¬¼ ì¶©ì „ (í•™ìŠµ ì™„ë£Œ ì‹œ í˜¸ì¶œë  í•¨ìˆ˜)
        function addWater(amount = 3) {
            gameState.water += amount;
            onStudyComplete(); // í•™ìŠµ ì™„ë£Œ ì²˜ë¦¬
            updateDisplay();
            saveGameState();
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.classList.remove('hidden');

            try {
                // eduPetAuthì™€ eduPetFirebaseIntegrationê°€ ì •ì˜ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
                await new Promise(resolve => {
                    const interval = setInterval(() => {
                        if (typeof eduPetAuth !== 'undefined' && typeof eduPetFirebaseIntegration !== 'undefined') {
                            clearInterval(interval);
                            resolve();
                        }
                    }, 50);
                });

                // ì¸ì¦ ìƒíƒœ ë¦¬ìŠ¤ë„ˆë¥¼ ë¨¼ì € ì„¤ì •í•©ë‹ˆë‹¤.
                eduPetAuth.addAuthStateListener(async (state, userData) => {
                    if (state === 'signed_in') {
                        console.log('Auth state is signed in. Initializing garden.');
                        await initializeGarden();
                        loadingOverlay.classList.add('hidden');
                    } else {
                        // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœ ì²˜ë¦¬
                        console.log('User is not signed in. Running in offline mode.');
                        await initializeGarden(); // ë¡œì»¬ ë°ì´í„°ë¡œë§Œ ì‹¤í–‰
                        loadingOverlay.classList.add('hidden');
                    }
                });

                // Firebase í†µí•© ê¸°ëŠ¥ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. (ì´ ê³¼ì •ì—ì„œ ìµëª… ë¡œê·¸ì¸ì´ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤)
                await eduPetFirebaseIntegration.initialize();
                console.log('Firebase Integration process started.');

            } catch (error) {
                console.error('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                // ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ê³„ì† ì§„í–‰
                await initializeGarden();
                loadingOverlay.classList.add('hidden');
            }

            // ì£¼ê¸°ì ì¸ ì‘ì—…ë“¤ì€ ì—¬ê¸°ì—ì„œ ê³„ì† ì‹¤í–‰í•©ë‹ˆë‹¤.
            // ì´ˆê¸° ë“±ê¸‰ í•˜ë½ ì²´í¬
            checkPlantDowngrade();

            // 10ì´ˆë§ˆë‹¤ ì‹ë¬¼ ìƒíƒœ ì²´í¬
            setInterval(() => {
                [1, 2].forEach(potNumber => {
                    if (gameState.plants[potNumber]) {
                        checkPlantGrowth(potNumber);
                    }
                });
            }, 10000);

            // 1ì‹œê°„ë§ˆë‹¤ ë“±ê¸‰ í•˜ë½ ì²´í¬
            setInterval(() => {
                checkPlantDowngrade();
            }, 60 * 60 * 1000);
        });

        // ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë“¤
        window.simpleFarm = {
            addWater: addWater,
            getGameState: () => gameState
        };
    </script>
</body>
</html>