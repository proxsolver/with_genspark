<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹ë¬¼ ì •ì› - EduPet Collection</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- í•œê¸€ í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f9ff 50%, #fef3c7 100%);
        }

        .plant-pot {
            transition: all 0.3s ease;
        }

        .plant-pot:hover {
            transform: scale(1.02);
        }

        .plant-growing {
            animation: gentleGrow 3s ease-in-out infinite alternate;
        }

        @keyframes gentleGrow {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        .water-drop {
            animation: waterFall 1s ease-out;
        }

        @keyframes waterFall {
            0% { transform: translateY(-50px) scale(0); opacity: 0; }
            50% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(20px) scale(0.5); opacity: 0; }
        }

        .love-heart {
            animation: loveFloat 2s ease-out forwards;
        }

        @keyframes loveFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }

        .plant-happy {
            animation: happyBounce 0.5s ease-in-out 3;
        }

        @keyframes happyBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .plant-mature {
            animation: sparkle 1.5s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { box-shadow: 0 0 0 rgba(34, 197, 94, 0); }
            50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.6); }
        }

        /* ì¶•í•˜ ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
        .celebration-modal {
            animation: modalZoomIn 0.5s ease-out;
        }

        @keyframes modalZoomIn {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ë°˜ì§ì´ ì…ì ì• ë‹ˆë©”ì´ì…˜ */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(720deg); opacity: 0; }
        }

        /* ë¹›ë‚˜ëŠ” íš¨ê³¼ */
        .glow-pulse {
            animation: glowPulse 1s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 1)); }
        }

        /* ìŠ¤íƒ€ í­ë°œ */
        .star-burst {
            animation: starBurst 1s ease-out forwards;
        }

        @keyframes starBurst {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(3) rotate(180deg); opacity: 0; }
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- í•„ìˆ˜ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="firebase-config.js"></script>
    <script src="firebase-auth.js"></script>
    <script src="firebase-integration.js"></script>
    <script src="plant-system.js"></script>
    <script src="daily-reset.js"></script>
    <script src="weakness-learning.js"></script>
</head>
<body class="gradient-bg min-h-screen p-4">
    <div class="container mx-auto max-w-6xl">
        <!-- í—¤ë” -->
        <div class="flex items-center justify-between mb-6 bg-white rounded-xl p-4 shadow-md">
            <button onclick="window.location.href='index.html'" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
                â† í™ˆìœ¼ë¡œ
            </button>

            <div class="text-center">
                <h1 class="text-2xl font-bold text-gray-900">ğŸŒ± ì‹ë¬¼ ì •ì›</h1>
                <p class="text-sm text-gray-600">í•™ìŠµìœ¼ë¡œ í‚¤ìš°ëŠ” ë‚˜ì˜ ì‹ë¬¼</p>
            </div>

            <div class="text-right flex items-center space-x-4">
                <div>
                    <div class="text-sm text-gray-600">ì¼ì¼ ì§„í–‰ë¥ </div>
                    <div class="font-bold text-blue-600" id="daily-progress">0/9 ê³¼ëª©</div>
                </div>
                <button onclick="showResetMenu()" class="px-3 py-2 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg text-sm border border-red-200">
                    âš™ï¸
                </button>
            </div>
        </div>

        <!-- ë³´ìƒ í˜„í™© -->
        <div class="bg-white rounded-xl p-4 shadow-md mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-sm text-gray-600">ğŸ« ì„±ì¥ê¶Œ</div>
                    <div class="text-2xl font-bold text-green-600" id="growth-tickets">0</div>
                </div>
                <button onclick="showTicketDetails()" class="text-blue-500 text-sm">ìƒì„¸</button>
            </div>
        </div>

        <!-- ë‹¤ìŒ ë³´ìƒ ì•ˆë‚´ -->
        <div class="bg-blue-50 rounded-xl p-4 mb-6 border border-blue-200">
            <div class="flex items-center space-x-3">
                <span class="text-2xl">ğŸ¯</span>
                <div>
                    <h3 class="font-bold text-blue-900">ë‹¤ìŒ ë³´ìƒ</h3>
                    <p class="text-sm text-blue-700" id="next-reward">3ê³¼ëª© ë‹¬ì„± ì‹œ: ì„±ì¥ê¶Œ 1ê°œ</p>
                </div>
            </div>
        </div>

        <!-- ì‹ë¬¼ í™”ë¶„ ì˜ì—­ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- í™”ë¶„ 1 -->
            <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-green-200">
                <div class="text-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">ğŸª´ í™”ë¶„ #1</h3>
                    <div class="text-xs text-gray-500" id="pot1-name">ë¹ˆ í™”ë¶„</div>
                </div>

                <div class="relative" id="pot1-container">
                    <!-- í™”ë¶„ ì˜ì—­ -->
                    <div class="plant-pot bg-amber-100 rounded-lg border-4 border-amber-300 h-48 flex flex-col items-center justify-end p-4 relative overflow-hidden"
                         id="pot1">

                        <!-- ì‹ë¬¼ í‘œì‹œ ì˜ì—­ -->
                        <div id="plant1-display" class="absolute bottom-4 left-1/2 transform -translate-x-1/2">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                        </div>

                        <!-- ë¹ˆ í™”ë¶„ í‘œì‹œ -->
                        <div id="empty-pot1" class="text-center">
                            <div class="text-4xl mb-2">ğŸ•³ï¸</div>
                            <div class="text-sm text-gray-500">ì”¨ì•—ì„ ì‹¬ì–´ë³´ì„¸ìš”</div>
                        </div>
                    </div>

                    <!-- ì‹ë¬¼ ì •ë³´ -->
                    <div id="plant1-info" class="mt-4 text-center hidden">
                        <div class="text-sm text-gray-600 mb-2" id="plant1-status">ìƒíƒœ: ì„±ì¥ ì¤‘</div>

                        <!-- ë¬¼ í”„ë¡œê·¸ë ˆìŠ¤ -->
                        <div class="mb-3">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>ğŸ’§ ë¬¼</span>
                                <span id="plant1-water">0/20</span>
                            </div>
                            <div class="bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-500"
                                     id="plant1-water-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- ì‹œê°„ ì •ë³´ -->
                        <div class="text-xs text-gray-600 mb-3" id="plant1-time">
                            â° ë‚¨ì€ ì‹œê°„: 24ì‹œê°„
                        </div>
                    </div>

                    <!-- ìƒí˜¸ì‘ìš© ë²„íŠ¼ë“¤ -->
                    <div class="mt-4 flex justify-center space-x-2" id="pot1-actions">
                        <button onclick="plantSeedToPot(1)" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-all">
                            ğŸŒ° ì”¨ì•— ì‹¬ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <!-- í™”ë¶„ 2 -->
            <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-green-200">
                <div class="text-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">ğŸª´ í™”ë¶„ #2</h3>
                    <div class="text-xs text-gray-500" id="pot2-name">ë¹ˆ í™”ë¶„</div>
                </div>

                <div class="relative" id="pot2-container">
                    <!-- í™”ë¶„ ì˜ì—­ -->
                    <div class="plant-pot bg-amber-100 rounded-lg border-4 border-amber-300 h-48 flex flex-col items-center justify-end p-4 relative overflow-hidden"
                         id="pot2">

                        <!-- ì‹ë¬¼ í‘œì‹œ ì˜ì—­ -->
                        <div id="plant2-display" class="absolute bottom-4 left-1/2 transform -translate-x-1/2">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                        </div>

                        <!-- ë¹ˆ í™”ë¶„ í‘œì‹œ -->
                        <div id="empty-pot2" class="text-center">
                            <div class="text-4xl mb-2">ğŸ•³ï¸</div>
                            <div class="text-sm text-gray-500">ì”¨ì•—ì„ ì‹¬ì–´ë³´ì„¸ìš”</div>
                        </div>
                    </div>

                    <!-- ì‹ë¬¼ ì •ë³´ -->
                    <div id="plant2-info" class="mt-4 text-center hidden">
                        <div class="text-sm text-gray-600 mb-2" id="plant2-status">ìƒíƒœ: ì„±ì¥ ì¤‘</div>

                        <!-- ë¬¼ í”„ë¡œê·¸ë ˆìŠ¤ -->
                        <div class="mb-3">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>ğŸ’§ ë¬¼</span>
                                <span id="plant2-water">0/20</span>
                            </div>
                            <div class="bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-500"
                                     id="plant2-water-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- ì‹œê°„ ì •ë³´ -->
                        <div class="text-xs text-gray-600 mb-3" id="plant2-time">
                            â° ë‚¨ì€ ì‹œê°„: 24ì‹œê°„
                        </div>
                    </div>

                    <!-- ìƒí˜¸ì‘ìš© ë²„íŠ¼ë“¤ -->
                    <div class="mt-4 flex justify-center space-x-2" id="pot2-actions">
                        <button onclick="plantSeedToPot(2)" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-all">
                            ğŸŒ° ì”¨ì•— ì‹¬ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¬¼ì£¼ê¸° ì•ˆë‚´ -->
        <div class="bg-blue-50 rounded-xl p-4 mb-6 border border-blue-200">
            <div class="text-center">
                <h3 class="font-bold text-blue-900 mb-2">ğŸŒ± ì‹ë¬¼ ì„±ì¥ ë‹¨ê³„</h3>
                <p class="text-sm text-blue-700 mb-3">
                    ì‹ë¬¼ì„ í´ë¦­í•˜ë©´ ì•½ì  ê³¼ëª© ë¬¸ì œì™€ ì •ë‹µ, í•´ì„¤ì´ í•¨ê»˜ í‘œì‹œë©ë‹ˆë‹¤!<br>
                    ë¬¸ì œë¥¼ ì½ê³  ì´í•´í•œ í›„ í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¬¼ì„ ì¤„ ìˆ˜ ìˆì–´ìš”.
                </p>
                <div class="flex justify-center items-center space-x-2 text-sm mb-2">
                    <span>ğŸŒ° ì”¨ì•—</span>
                    <span class="text-gray-400">â†’</span>
                    <span class="text-xs bg-white px-2 py-1 rounded">5íšŒ</span>
                    <span class="text-gray-400">â†’</span>
                    <span>ğŸŒ± ì¤„ê¸°</span>
                    <span class="text-gray-400">â†’</span>
                    <span class="text-xs bg-white px-2 py-1 rounded">10íšŒ</span>
                    <span class="text-gray-400">â†’</span>
                    <span>ğŸŒ³ ë‚˜ë¬´</span>
                    <span class="text-gray-400">â†’</span>
                    <span class="text-xs bg-white px-2 py-1 rounded">15íšŒ</span>
                    <span class="text-gray-400">â†’</span>
                    <span>ğŸŒº ì—´ë§¤/ê½ƒ</span>
                </div>
                <div class="text-xs text-blue-600">
                    ğŸ’¡ íŒ: í‹€ë ¤ë„ ê´œì°®ì•„ìš”! ì •ë‹µê³¼ í•´ì„¤ì„ ë³´ë©° í•™ìŠµí•˜ê³  ë¬¼ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ì•ˆë‚´ -->
        <div class="bg-white rounded-xl p-4 shadow-md">
            <h3 class="font-bold mb-2">ğŸ“˜ ì‚¬ìš© ì•ˆë‚´</h3>
            <ul class="text-sm text-gray-700 space-y-1">
                <li>â€¢ <strong>ë¬¼ì£¼ê¸°:</strong> ì•½ì  ê³¼ëª© ë¬¸ì œì˜ ì •ë‹µê³¼ í•´ì„¤ì„ ë³´ë©° í•™ìŠµí•©ë‹ˆë‹¤ (ë¬´ì œí•œ)</li>
                <li>â€¢ <strong>ì„±ì¥ ë‹¨ê³„:</strong> ğŸŒ°ì”¨ì•—(5íšŒ) â†’ ğŸŒ±ì¤„ê¸°(10íšŒ) â†’ ğŸŒ³ë‚˜ë¬´(15íšŒ) â†’ ğŸŒºì—´ë§¤/ê½ƒ</li>
                <li>â€¢ <strong>ì‹ë¬¼ ì¢…ë¥˜:</strong> ê° ë‹¨ê³„ë§ˆë‹¤ ëœë¤í•˜ê²Œ ë‹¤ë¥¸ ëª¨ì–‘ìœ¼ë¡œ ì„±ì¥í•©ë‹ˆë‹¤</li>
                <li>â€¢ <strong>ë³´ìƒ:</strong> 3ê³¼ëª©(ì„±ì¥ê¶Œ1), 5ê³¼ëª©(ì¼ë°˜ë½‘ê¸°), 6ê³¼ëª©(ì„±ì¥ê¶Œ1), 9ê³¼ëª©(í”„ë¦¬ë¯¸ì—„ë½‘ê¸°)</li>
            </ul>
        </div>
    </div>

    <!-- ë¬¼ì£¼ê¸° í•™ìŠµ ëª¨ë‹¬ -->
    <div id="watering-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 max-w-lg w-full modal-enter">
            <div class="text-center mb-4">
                <div class="text-4xl mb-2" id="plant-character">ğŸŒ±</div>
                <h3 class="text-lg font-bold" id="plant-speech">ì•ˆë…•! ë‚˜ì—ê²Œ ë¬¼ì„ ì¤˜!</h3>
            </div>

            <!-- í•™ìŠµ ë‚´ìš© -->
            <div class="bg-blue-50 rounded-lg p-4 mb-4" id="learning-content">
                <div class="flex items-center mb-2">
                    <span class="text-2xl mr-2" id="question-subject-icon">ğŸ“š</span>
                    <div class="font-bold text-blue-900" id="question-title">ì•½ì  ê³¼ëª© í•™ìŠµ</div>
                </div>
                <div class="text-sm text-blue-800 mb-3" id="question-text">
                    ë¬¸ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                </div>

                <!-- ì •ë‹µ ë° í•´ì„¤ (í•™ìŠµ ëª¨ë“œ) -->
                <div class="mb-3 p-3 bg-green-50 border-2 border-green-300 rounded-lg" id="answer-section">
                    <div class="flex items-start space-x-2 mb-2">
                        <span class="text-lg">âœ…</span>
                        <div>
                            <div class="font-bold text-green-900 mb-1">ì •ë‹µ</div>
                            <div class="text-sm text-green-800" id="correct-answer"></div>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2 mt-2 pt-2 border-t border-green-200">
                        <span class="text-lg">ğŸ’¡</span>
                        <div>
                            <div class="font-bold text-blue-900 mb-1">í•´ì„¤</div>
                            <div class="text-sm text-gray-700" id="explanation-text"></div>
                        </div>
                    </div>
                </div>

                <!-- í™•ì¸ ë²„íŠ¼ (5ì´ˆ í›„ í™œì„±í™”) -->
                <button id="water-confirm-btn" onclick="confirmLearningAndWater()" disabled
                        class="w-full px-4 py-3 bg-gray-400 text-white rounded-lg font-bold cursor-not-allowed transition-all">
                    <span id="water-btn-text">ğŸ’§ ë¬¸ì œë¥¼ ì½ì–´ì£¼ì„¸ìš” (<span id="countdown">5</span>ì´ˆ)</span>
                </button>
            </div>

            <div class="text-center">
                <button onclick="closeWateringModal()" class="text-gray-500 text-sm hover:text-gray-700">
                    ë‚˜ì¤‘ì— í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- ì‹ë¬¼ ëŒ€í™” íŒì—… -->
    <div id="plant-speech-popup" class="hidden fixed top-20 left-1/2 transform -translate-x-1/2 bg-white rounded-xl shadow-lg border-2 border-green-300 p-4 z-40">
        <div class="speech-bubble text-center">
            <div class="text-sm font-medium text-gray-800" id="popup-text">ì•ˆë…•í•˜ì„¸ìš”!</div>
            <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full">
                <div class="w-0 h-0 border-l-8 border-r-8 border-t-8 border-l-transparent border-r-transparent border-t-green-300"></div>
            </div>
        </div>
    </div>

    <!-- ì„±ì¥ê¶Œ ìƒì„¸ ëª¨ë‹¬ -->
    <div id="ticket-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold">ğŸ« ì„±ì¥ê¶Œ ëª©ë¡</h3>
                <button onclick="closeTicketModal()" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>

            <div id="ticket-list" class="space-y-2 max-h-96 overflow-y-auto">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
            </div>
        </div>
    </div>

    <!-- ì´ˆê¸°í™” ë©”ë‰´ ëª¨ë‹¬ -->
    <div id="reset-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-red-600">âš™ï¸ ê°œë°œì ë©”ë‰´</h3>
                <button onclick="closeResetMenu()" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>

            <div class="space-y-3">
                <button onclick="resetAllData()" class="w-full px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 text-left">
                    ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
                    <div class="text-xs text-red-100 mt-1">ì‚¬ìš©ì, ì‹ë¬¼, í•™ìŠµ ê¸°ë¡ ì „ì²´ ì‚­ì œ</div>
                </button>

                <button onclick="resetPlants()" class="w-full px-4 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 text-left">
                    ğŸŒ± ì‹ë¬¼ë§Œ ì´ˆê¸°í™”
                    <div class="text-xs text-orange-100 mt-1">ëª¨ë“  ì‹ë¬¼ ì œê±° (ë³´ìƒì€ ìœ ì§€)</div>
                </button>

                <button onclick="resetDaily()" class="w-full px-4 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 text-left">
                    ğŸ“… ì¼ì¼ ì§„í–‰ë¥  ì´ˆê¸°í™”
                    <div class="text-xs text-yellow-100 mt-1">ì˜¤ëŠ˜ ì™„ë£Œí•œ ê³¼ëª© ë¦¬ì…‹</div>
                </button>

                <button onclick="addTestTickets()" class="w-full px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 text-left">
                    ğŸ« í…ŒìŠ¤íŠ¸ ì„±ì¥ê¶Œ ì¶”ê°€
                    <div class="text-xs text-green-100 mt-1">ì„±ì¥ê¶Œ 5ê°œ ì¦‰ì‹œ ì§€ê¸‰</div>
                </button>

                <button onclick="skipPlantTime()" class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-left">
                    â° ì‹ë¬¼ ì‹œê°„ ê±´ë„ˆë›°ê¸°
                    <div class="text-xs text-blue-100 mt-1">24ì‹œê°„ ê²½ê³¼ë¡œ ì„¤ì •</div>
                </button>
            </div>

            <div class="mt-4 p-3 bg-gray-100 rounded-lg text-xs text-gray-600">
                âš ï¸ ì´ ë©”ë‰´ëŠ” ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©ì…ë‹ˆë‹¤. ì‹¤ì œ ë°ì´í„°ê°€ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <!-- ì•Œë¦¼ í† ìŠ¤íŠ¸ -->
    <div id="toast" class="hidden fixed top-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50">
        <div id="toast-message"></div>
    </div>

    <!-- ì¶•í•˜ ëª¨ë‹¬ -->
    <div id="celebration-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-yellow-50 to-green-50 rounded-2xl p-8 max-w-md w-full celebration-modal relative overflow-hidden">
            <!-- ë°°ê²½ ì¥ì‹ -->
            <div id="confetti-container" class="absolute inset-0 pointer-events-none"></div>

            <div class="relative z-10">
                <!-- ì¶•í•˜ ì•„ì´ì½˜ -->
                <div class="text-center mb-4">
                    <div class="text-8xl mb-4 glow-pulse" id="celebration-emoji">ğŸ‰</div>
                    <div class="text-2xl font-bold text-gray-800 mb-2" id="celebration-title">ì¶•í•˜í•©ë‹ˆë‹¤!</div>
                    <div class="text-lg text-gray-600 mb-4" id="celebration-message">ì‹ë¬¼ì´ ì„±ì¥í–ˆìŠµë‹ˆë‹¤!</div>
                </div>

                <!-- ë³€í™” í‘œì‹œ -->
                <div class="bg-white rounded-xl p-4 mb-6 shadow-lg">
                    <div class="flex items-center justify-center space-x-4">
                        <div class="text-center">
                            <div class="text-4xl mb-2" id="celebration-before">ğŸŒ°</div>
                            <div class="text-xs text-gray-500">ì´ì „</div>
                        </div>
                        <div class="text-3xl text-green-500">â†’</div>
                        <div class="text-center">
                            <div class="text-5xl mb-2 glow-pulse" id="celebration-after">ğŸŒ±</div>
                            <div class="text-xs text-gray-500">í˜„ì¬</div>
                        </div>
                    </div>
                </div>

                <!-- ì§„í–‰ë¥  í‘œì‹œ -->
                <div class="bg-gradient-to-r from-green-100 to-blue-100 rounded-lg p-3 mb-4">
                    <div class="text-center">
                        <div class="text-sm font-semibold text-gray-700 mb-2" id="celebration-progress">ì§„í–‰ë¥ </div>
                        <div class="flex justify-center items-center space-x-2">
                            <div class="flex space-x-1" id="celebration-stages">
                                <!-- ë™ì  ìƒì„± -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë‹¤ìŒ ëª©í‘œ -->
                <div class="bg-blue-50 rounded-lg p-3 mb-4 border-2 border-blue-200">
                    <div class="text-center text-sm">
                        <span class="font-semibold text-blue-900">ë‹¤ìŒ ëª©í‘œ:</span>
                        <span class="text-blue-700" id="celebration-next-goal">ë¬¼ 10ê°œ ë” ì£¼ê¸°</span>
                    </div>
                </div>

                <!-- í™•ì¸ ë²„íŠ¼ -->
                <button onclick="closeCelebrationModal()" class="w-full px-6 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl font-bold hover:from-green-600 hover:to-blue-600 transition-all shadow-lg">
                    ê³„ì†í•˜ê¸° ğŸš€
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentPlantId = null;

        // ì´ˆê¸°í™”
        function init() {
            console.log('Initializing plant system...');

            // ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í™•ì¸
            if (typeof plantSystem === 'undefined') {
                console.error('plantSystem is not loaded');
                setTimeout(init, 100);
                return;
            }

            console.log('plantSystem loaded');

            try {
                // ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ìë™ ìƒì„±)
                currentUser = plantSystem.getUserData();
                console.log('Current user loaded:', currentUser);

                if (!currentUser || !currentUser.userId) {
                    console.error('Failed to load user data');
                    showToast('âŒ ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                    return;
                }

                // ì¼ì¼ ë¦¬ì…‹ ì²´í¬
                plantSystem.dailyReset(currentUser);
                console.log('Daily reset checked');

                // ì‚¬ìš©ì ë°ì´í„° ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸° (ë¦¬ì…‹ í›„ ë³€ê²½ì‚¬í•­ ë°˜ì˜)
                currentUser = plantSystem.getUserData();

                // UI ì—…ë°ì´íŠ¸
                updateDashboard();
                renderPlants();

                // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
                setInterval(updateDashboard, 30000); // 30ì´ˆë§ˆë‹¤

                console.log('Initialization complete');
                showToast('âœ… ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                showToast('âŒ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            try {
                if (!currentUser) {
                    console.warn('currentUser is not set yet');
                    return;
                }

                const dashboard = plantSystem.getDashboardState(currentUser.userId);

                // ì¼ì¼ ì§„í–‰ë¥ 
                document.getElementById('daily-progress').textContent = dashboard.learning.progress;

                // í‹°ì¼“ ì •ë³´
                document.getElementById('growth-tickets').textContent = dashboard.tickets.growthTickets;

                // ë‹¤ìŒ ë³´ìƒ
                document.getElementById('next-reward').textContent = dashboard.learning.nextReward.message;

                renderPlants();
            } catch (error) {
                console.error('Dashboard update error:', error);
            }
        }

        // ì‹ë¬¼ ë Œë”ë§ (í™”ë¶„ë³„ë¡œ)
        function renderPlants() {
            try {
                if (!currentUser) {
                    console.warn('currentUser is not set for renderPlants');
                    return;
                }

                const plants = plantSystem.getUserPlants(currentUser.userId);
                console.log('Rendering plants:', plants);

                // ê° í™”ë¶„ ì—…ë°ì´íŠ¸
                [1, 2].forEach(potNum => {
                    renderPot(potNum, plants);
                });

            } catch (error) {
                console.error('Render plants error:', error);
            }
        }

        // ê°œë³„ í™”ë¶„ ë Œë”ë§
        function renderPot(potNum, allPlants) {
            // potNumì— í•´ë‹¹í•˜ëŠ” ì‹ë¬¼ ì°¾ê¸° (ê°„ë‹¨í•˜ê²Œ ì¸ë±ìŠ¤ë¡œ)
            const plantData = allPlants[potNum - 1] || null;

            // getDashboardStateì—ì„œ ê°€ì ¸ì˜¨ ì‹ë¬¼ ë°ì´í„° (timeRemaining í¬í•¨)
            const dashboard = plantSystem.getDashboardState(currentUser.userId);
            const plant = dashboard.plants[potNum - 1] || null;

            const emptyElement = document.getElementById(`empty-pot${potNum}`);
            const plantDisplay = document.getElementById(`plant${potNum}-display`);
            const plantInfo = document.getElementById(`plant${potNum}-info`);
            const potName = document.getElementById(`pot${potNum}-name`);
            const actions = document.getElementById(`pot${potNum}-actions`);
            const potElement = document.getElementById(`pot${potNum}`);

            if (!plant) {
                // ë¹ˆ í™”ë¶„
                emptyElement.classList.remove('hidden');
                plantDisplay.innerHTML = '';
                plantInfo.classList.add('hidden');
                potName.textContent = 'ë¹ˆ í™”ë¶„';
                potElement.onclick = null;
                actions.innerHTML = `
                    <button onclick="plantSeedToPot(${potNum})" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-all">
                        ğŸŒ° ì”¨ì•— ì‹¬ê¸°
                    </button>
                `;
            } else {
                // ì‹ë¬¼ì´ ìˆëŠ” í™”ë¶„
                emptyElement.classList.add('hidden');
                plantInfo.classList.remove('hidden');

                // ì‹ë¬¼ í‘œì‹œ (ìŠ¤í…Œì´ì§€ë³„ í¬ê¸° ì¡°ì ˆ)
                const plantEmoji = plant.type || 'ğŸŒ±';
                const stage = plant.stage || 0;
                const sizeClass = ['text-4xl', 'text-5xl', 'text-6xl', 'text-7xl'][stage];

                plantDisplay.innerHTML = `
                    <div class="${sizeClass} plant-growing ${plant.waterCount > 5 ? 'plant-happy' : ''}">${plantEmoji}</div>
                `;

                // í™”ë¶„ í´ë¦­ ê°€ëŠ¥
                if (plant.status === 'PLANTED') {
                    potElement.onclick = () => waterPlantInPot(potNum, plant.id);
                    potElement.style.cursor = 'pointer';
                } else {
                    potElement.onclick = null;
                    potElement.style.cursor = 'default';
                }

                potName.textContent = 'ì„±ì¥ ì¤‘ì¸ ì‹ë¬¼';

                // ìƒíƒœ ì •ë³´ (ìŠ¤í…Œì´ì§€ í¬í•¨)
                const stageNames = ['ğŸŒ° ì”¨ì•—', 'ğŸŒ± ì¤„ê¸°', 'ğŸŒ³ ë‚˜ë¬´', 'ğŸŒº ì™„ì„±'];
                const stageName = stageNames[plant.stage || 0] || 'ğŸŒ± ì„±ì¥ ì¤‘';

                const statusText = plant.status === 'GROWN'
                    ? 'ğŸŒº ì„±ì¥ ì™„ë£Œ - ìˆ˜í™• ê°€ëŠ¥!'
                    : `${stageName} ë‹¨ê³„`;

                document.getElementById(`plant${potNum}-status`).textContent = statusText;

                // ë¬¼ ì •ë³´ - ëª¨ë“  ë‹¨ê³„ì—ì„œ 5ë²ˆì”©
                const maxWater = 5;
                const waterPercent = (plant.waterCount / maxWater) * 100;
                document.getElementById(`plant${potNum}-water`).textContent = `${plant.waterCount}/${maxWater}`;
                document.getElementById(`plant${potNum}-water-bar`).style.width = waterPercent + '%';

                // ì‹œê°„ ì •ë³´
                document.getElementById(`plant${potNum}-time`).textContent = `â° ${plant.timeRemaining}`;

                // ë²„íŠ¼ (ìŠ¤í…Œì´ì§€ ê¸°ë°˜)
                const maxWaterForStage = 5;

                if (plant.status === 'GROWN') {
                    // ì™„ì „íˆ ì„±ì¥ ì™„ë£Œ - ìˆ˜í™• ê°€ëŠ¥
                    actions.innerHTML = `
                        <button onclick="harvestPlant('${plant.id}')" class="w-full px-4 py-2 bg-yellow-500 text-white rounded-lg font-bold hover:bg-yellow-600 transition-all">
                            ğŸŒº ìˆ˜í™•í•˜ê¸°
                        </button>
                    `;
                } else {
                    // ì„±ì¥ ì¤‘ - ë¬¼ì£¼ê¸° ê°€ëŠ¥
                    const nextStage = ['ğŸŒ± ì¤„ê¸°', 'ğŸŒ³ ë‚˜ë¬´', 'ğŸŒº ì—´ë§¤/ê½ƒ', 'ì™„ì„±'][plant.stage || 0];
                    actions.innerHTML = `
                        <button onclick="waterPlantInPot(${potNum}, '${plant.id}')" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition-all">
                            ğŸ’§ ë¬¼ì£¼ê¸° (${plant.waterCount}/${maxWaterForStage})
                        </button>
                        <div class="text-xs text-gray-500 mt-2">ë‹¤ìŒ: ${nextStage}</div>
                    `;
                }
            }
        }

        // ê¸°ì¡´ renderPlants ë¡œì§ ì œê±°
        function OLD_renderPlants() {
            try {
                if (!currentUser) {
                    console.warn('currentUser is not set for renderPlants');
                    return;
                }

                const plants = plantSystem.getUserPlants(currentUser.userId);
                const container = document.getElementById('OLD-plants-container');

            container.innerHTML = plants.map(plant => {
                const statusColor = {
                    'PLANTED': 'blue',
                    'READY': 'green',
                    'GROWN': 'yellow'
                }[plant.status];

                const statusText = {
                    'PLANTED': 'ì„±ì¥ ì¤‘',
                    'READY': 'ì„±ì¥ ì¤€ë¹„ ì™„ë£Œ',
                    'GROWN': 'ì„±ì¥ ì™„ë£Œ'
                }[plant.status];

                return `
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <div class="text-center mb-4">
                            <div class="text-6xl mb-2 plant-growing">${plant.type}</div>
                            <div class="text-sm font-semibold text-${statusColor}-600">${statusText}</div>
                        </div>

                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">ë¬¼</span>
                                <span class="font-bold">${plant.waterCount}/20</span>
                            </div>
                            <div class="bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all" style="width: ${plant.waterCount/20*100}%"></div>
                            </div>

                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">ì‹œê°„</span>
                                <span class="font-bold">${plant.timeRemaining}</span>
                            </div>
                        </div>

                        ${plant.status === 'READY' ? `
                            <button onclick="growPlant('${plant.id}')" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600">
                                ğŸŒ± ì„±ì¥ì‹œí‚¤ê¸°
                            </button>
                        ` : plant.status === 'PLANTED' ? `
                            <button onclick="waterPlant('${plant.id}')" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600">
                                ğŸ’§ ë¬¼ì£¼ê¸° (${plant.waterCount}/20)
                            </button>
                        ` : `
                            <div class="text-center text-sm text-gray-500">
                                ìˆ˜í™•í•˜ì—¬ ë³´ìƒì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                            </div>
                        `}
                    </div>
                `;
            }).join('');
            } catch (error) {
                console.error('Render plants error:', error);
            }
        }

        // í™”ë¶„ì— ì”¨ì•— ì‹¬ê¸°
        function plantSeedToPot(potNum) {
            try {
                if (!currentUser) {
                    showToast('âŒ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤');
                    return;
                }

                // ì´ë¯¸ ì‹ë¬¼ì´ ìˆëŠ”ì§€ í™•ì¸
                const plants = plantSystem.getUserPlants(currentUser.userId);
                const existingPlant = plants[potNum - 1];

                if (existingPlant) {
                    showToast('âŒ ì´ë¯¸ ì‹ë¬¼ì´ ì‹¬ì–´ì ¸ ìˆìŠµë‹ˆë‹¤');
                    return;
                }

                const plant = plantSystem.plantSeed(currentUser.userId);
                console.log('New plant created:', plant);

                showPlantSpeech('ì•ˆë…•! ë‚˜ë¥¼ ì˜ ë¶€íƒí•´!');
                showToast('ğŸŒ° ì”¨ì•—ì„ ì‹¬ì—ˆìŠµë‹ˆë‹¤!');
                updateDashboard();
            } catch (error) {
                console.error('ì”¨ì•— ì‹¬ê¸° ì˜¤ë¥˜:', error);
                showToast('âŒ ì”¨ì•— ì‹¬ê¸° ì‹¤íŒ¨: ' + error.message);
            }
        }

        // í™”ë¶„ì— ë¬¼ì£¼ê¸°
        async function waterPlantInPot(potNum, plantId) {
            try {
                if (!currentUser) {
                    showToast('âŒ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤');
                    return;
                }

                currentPlantId = plantId;

                // ì•½ì  ê³¼ëª© ë¬¸ì œ ìƒì„± (ì‹¤ì œ ë¬¸ì œ ì€í–‰ì—ì„œ ë¡œë“œ)
                const questionData = await weaknessLearning.generateWaterQuestion(currentUser, plantId);

                if (!questionData.success) {
                    showToast('âŒ ' + questionData.message);
                    return;
                }

                // í˜„ì¬ ë¬¸ì œì˜ ê³¼ëª© ì •ë³´ ì €ì¥
                window.currentQuestionSubject = questionData.subjectName;
                window.currentQuestionData = questionData;

                // ëª¨ë‹¬ì— ë¬¸ì œ í‘œì‹œ
                const subjectIcons = {
                    'math': 'ğŸ”¢',
                    'korean': 'ğŸ“š',
                    'english': 'ğŸ”¤',
                    'science': 'ğŸ”¬',
                    'social': 'ğŸŒ',
                    'history': 'ğŸ“œ',
                    'art': 'ğŸ¨',
                    'music': 'ğŸµ',
                    'pe': 'âš½'
                };

                document.getElementById('question-subject-icon').textContent = subjectIcons[questionData.subjectId] || 'ğŸ“š';
                document.getElementById('question-title').textContent = questionData.subjectName + ' í•™ìŠµ';
                document.getElementById('question-text').textContent = questionData.question.q;

                // ì •ë‹µ ë° í•´ì„¤ í‘œì‹œ (í•™ìŠµ ëª¨ë“œ)
                const correctAnswer = questionData.question.a[questionData.question.correct];
                document.getElementById('correct-answer').textContent = `${questionData.question.correct + 1}. ${correctAnswer}`;

                // í•´ì„¤ì´ ìˆìœ¼ë©´ í‘œì‹œ, ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€
                const explanation = questionData.question.explanation || 'ì´ ë¬¸ì œë¥¼ ì˜ ê¸°ì–µí•˜ê³  ì´í•´í•´ë³´ì„¸ìš”!';
                document.getElementById('explanation-text').textContent = explanation;

                // ë²„íŠ¼ ì´ˆê¸°í™” (ë¹„í™œì„±í™” ìƒíƒœë¡œ)
                const waterBtn = document.getElementById('water-confirm-btn');
                const waterBtnText = document.getElementById('water-btn-text');
                if (waterBtn) {
                    waterBtn.disabled = true;
                    waterBtn.className = 'w-full px-4 py-3 bg-gray-400 text-white rounded-lg font-bold cursor-not-allowed transition-all';
                }
                if (waterBtnText) {
                    waterBtnText.innerHTML = 'ğŸ’§ ë¬¸ì œë¥¼ ì½ì–´ì£¼ì„¸ìš” (<span id="countdown">5</span>ì´ˆ)';
                }

                // ëª¨ë‹¬ í‘œì‹œ (ë¨¼ì €!)
                document.getElementById('watering-modal').classList.remove('hidden');

                // 5ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘ (ëª¨ë‹¬ í‘œì‹œ í›„)
                setTimeout(() => {
                    startWaterButtonCountdown();
                }, 100);

            } catch (error) {
                console.error('ë¬¼ì£¼ê¸° ì˜¤ë¥˜:', error);
                showToast('âŒ ë¬¼ì£¼ê¸° ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ë¬¼ì£¼ê¸° ë²„íŠ¼ 5ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´
        let countdownInterval = null;
        function startWaterButtonCountdown() {
            const btn = document.getElementById('water-confirm-btn');
            const countdownSpan = document.getElementById('countdown');
            const btnText = document.getElementById('water-btn-text');

            // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨
            if (!btn || !countdownSpan || !btnText) {
                console.warn('ì¹´ìš´íŠ¸ë‹¤ìš´ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            let timeLeft = 5;

            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ì´ˆê¸°í™”
            btn.disabled = true;
            btn.className = 'w-full px-4 py-3 bg-gray-400 text-white rounded-lg font-bold cursor-not-allowed transition-all';
            countdownSpan.textContent = timeLeft;

            // ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆë‹¤ë©´ ì •ë¦¬
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }

            // 1ì´ˆë§ˆë‹¤ ì¹´ìš´íŠ¸ë‹¤ìš´
            countdownInterval = setInterval(() => {
                timeLeft--;

                // ìš”ì†Œ ì¬í™•ì¸ (ëª¨ë‹¬ì´ ë‹«í˜”ì„ ìˆ˜ ìˆìŒ)
                if (!countdownSpan) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                    return;
                }

                countdownSpan.textContent = timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;

                    // ë²„íŠ¼ í™œì„±í™”
                    if (btn) {
                        btn.disabled = false;
                        btn.className = 'w-full px-4 py-3 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition-all';
                    }
                    if (btnText) {
                        btnText.innerHTML = 'ğŸ’§ ì´í•´í–ˆì–´ìš”! ë¬¼ì£¼ê¸°';
                    }
                }
            }, 1000);
        }

        // í•™ìŠµ í™•ì¸ í›„ ë¬¼ì£¼ê¸° (í•™ìŠµ ëª¨ë“œ)
        function confirmLearningAndWater() {
            const result = plantSystem.waterPlant(currentPlantId);
            if (result.success) {
                showWaterAnimation();
                showLoveAnimation();

                // ìŠ¤í…Œì´ì§€ ë³€ê²½ ì²´í¬
                const plant = plantSystem.getPlant(currentPlantId);
                const maxWater = 5;

                if (result.stageChanged) {
                    // ì¶•í•˜ ëª¨ë‹¬ í‘œì‹œ
                    closeWateringModal();
                    showCelebrationModal(plant);
                } else {
                    showPlantSpeech(`ê³ ë§ˆì›Œ! ì´ì œ ${result.waterCount}/${maxWater} ë¬¼ì„ ë°›ì•˜ì–´!`);
                    showToast(`âœ… í•™ìŠµ ì™„ë£Œ! ë¬¼ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤ (${result.waterCount}/${maxWater})`);
                    closeWateringModal();
                }

                updateDashboard();

                // í•™ìŠµ ì§„í–‰ë„ ì—…ë°ì´íŠ¸ (í•™ìŠµ ëª¨ë“œëŠ” í•­ìƒ trueë¡œ ì²˜ë¦¬)
                if (window.currentQuestionSubject) {
                    weaknessLearning.updateLearningProgress(currentUser, window.currentQuestionSubject, true);
                }

                // Firebase ë™ê¸°í™”
                if (window.plantSystemFirebase && typeof plantSystemFirebase.savePlantSystemState === 'function') {
                    plantSystemFirebase.savePlantSystemState();
                }
            } else {
                showToast('âŒ ' + result.message);
            }
        }

        // ì¶•í•˜ ëª¨ë‹¬ í‘œì‹œ
        function showCelebrationModal(plant) {
            const stageNames = ['ğŸŒ° ì”¨ì•—', 'ğŸŒ± ì¤„ê¸°', 'ğŸŒ³ ë‚˜ë¬´', 'ğŸŒº ì—´ë§¤/ê½ƒ'];
            const stageEmojis = ['ğŸŒ°', 'ğŸŒ±', 'ğŸŒ³', 'ğŸŒº'];
            const currentStage = plant.stage || 0;
            const prevStage = Math.max(0, currentStage - 1);

            // ëª¨ë‹¬ ë‚´ìš© ì„¤ì •
            document.getElementById('celebration-emoji').textContent = plant.plantType;
            document.getElementById('celebration-title').textContent = currentStage === 3 ? 'ğŸ‰ ì„±ì¥ ì™„ë£Œ!' : 'ğŸŒ± í•œ ë‹¨ê³„ ì„±ì¥!';
            document.getElementById('celebration-message').textContent =
                currentStage === 3
                    ? `${stageNames[currentStage]} ë‹¨ê³„ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤!`
                    : `${stageNames[prevStage]}ì—ì„œ ${stageNames[currentStage]}(ìœ¼)ë¡œ ìëì–´ìš”!`;

            // ì´ì „/í˜„ì¬ ëª¨ìŠµ
            document.getElementById('celebration-before').textContent = stageEmojis[prevStage];
            document.getElementById('celebration-after').textContent = plant.plantType;

            // ì§„í–‰ë¥  í‘œì‹œ
            const stagesHtml = stageEmojis.map((emoji, idx) => {
                const isCompleted = idx < currentStage;
                const isCurrent = idx === currentStage;
                return `
                    <div class="flex flex-col items-center">
                        <div class="text-2xl ${isCurrent ? 'glow-pulse' : ''} ${isCompleted ? 'opacity-50' : ''}">${emoji}</div>
                        ${isCurrent ? '<div class="text-xs text-green-600 font-bold">í˜„ì¬</div>' : ''}
                        ${isCompleted ? '<div class="text-xs text-gray-400">ì™„ë£Œ</div>' : ''}
                    </div>
                `;
            }).join('');
            document.getElementById('celebration-stages').innerHTML = stagesHtml;

            // ë‹¤ìŒ ëª©í‘œ
            if (currentStage < 3) {
                const nextWater = [5, 10, 15][currentStage];
                document.getElementById('celebration-next-goal').textContent =
                    `${stageNames[currentStage + 1]} ë‹¨ê³„ê¹Œì§€ ë¬¼ ${nextWater}ê°œ ë” ì£¼ê¸°`;
            } else {
                document.getElementById('celebration-next-goal').textContent = 'ìˆ˜í™• ê°€ëŠ¥! ğŸ‰';
            }

            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('celebration-modal').classList.remove('hidden');

            // ì»¨í˜í‹° ìƒì„±
            createConfetti();

            // í”Œë ˆì´í’€í•œ ì‚¬ìš´ë“œ íš¨ê³¼ (ì„ íƒì )
            playSuccessSound();
        }

        function closeCelebrationModal() {
            document.getElementById('celebration-modal').classList.add('hidden');
            document.getElementById('confetti-container').innerHTML = '';
        }

        // ì»¨í˜í‹° ì• ë‹ˆë©”ì´ì…˜ ìƒì„±
        function createConfetti() {
            const container = document.getElementById('confetti-container');
            container.innerHTML = ''; // ì´ˆê¸°í™”

            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F'];
            const emojis = ['â­', 'âœ¨', 'ğŸ’«', 'ğŸŒŸ', 'ğŸ’–', 'ğŸŠ', 'ğŸ‰'];

            // 50ê°œì˜ ì»¨í˜í‹° ìƒì„±
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';

                // ëœë¤í•˜ê²Œ ìƒ‰ìƒ ë˜ëŠ” ì´ëª¨ì§€
                if (Math.random() > 0.5) {
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                } else {
                    confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    confetti.style.fontSize = '20px';
                }

                // ëœë¤ ìœ„ì¹˜
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-20px';

                // ëœë¤ ì• ë‹ˆë©”ì´ì…˜ ì§€ì—°
                confetti.style.animationDelay = Math.random() * 1 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';

                container.appendChild(confetti);

                // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ì œê±°
                setTimeout(() => confetti.remove(), 5000);
            }
        }

        // ì„±ê³µ ì‚¬ìš´ë“œ (Web Audio API ì‚¬ìš© - ê°„ë‹¨í•œ ë¹„í”„ìŒ)
        function playSuccessSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();

                // ê²½ì¾Œí•œ 3ìŒê³„
                const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
                let startTime = audioContext.currentTime;

                notes.forEach((freq, idx) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.3, startTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.2);

                    oscillator.start(startTime);
                    oscillator.stop(startTime + 0.2);

                    startTime += 0.15;
                });
            } catch (e) {
                console.log('ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨ (ì„ íƒ ê¸°ëŠ¥)');
            }
        }

        function closeWateringModal() {
            // ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ ì •ë¦¬
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }

            document.getElementById('watering-modal').classList.add('hidden');
            currentPlantId = null;
        }

        // ì‹ë¬¼ ì„±ì¥ì‹œí‚¤ê¸°
        function growPlantInPot(plantId) {
            try {
                if (!currentUser) {
                    showToast('âŒ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤');
                    return;
                }

                // ì„±ì¥ ì „ ì‹ë¬¼ ìƒíƒœ ì €ì¥
                const plantBefore = plantSystem.getPlant(plantId);
                const stageBefore = plantBefore ? plantBefore.stage : 0;

                const result = plantSystem.growPlant(currentUser, plantId);

                if (result.success) {
                    // ì„±ì¥ í›„ ì‹ë¬¼ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
                    const plantAfter = plantSystem.getPlant(plantId);
                    const stageAfter = plantAfter ? plantAfter.stage : 0;

                    // ìŠ¤í…Œì´ì§€ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë©´ ì¶•í•˜ ëª¨ë‹¬ í‘œì‹œ
                    if (stageAfter > stageBefore) {
                        showPlantSpeech('ì™€! í•œ ë‹¨ê³„ ì„±ì¥í–ˆì–´ìš”! ğŸ‰');
                        showCelebrationModal(plantAfter);
                    } else {
                        showPlantSpeech('ì™€! ì™„ì „íˆ ìëì–´ìš”! ìˆ˜ê³ í•˜ì…¨ì–´ìš” ğŸ‰');
                        showToast('ğŸ‰ ' + result.message);
                    }

                    // Firebase ë™ê¸°í™”
                    if (window.plantSystemFirebase) {
                        plantSystemFirebase.syncPlantGrowth({plantId});
                    }

                    updateDashboard();
                } else {
                    showToast('âŒ ' + result.message);
                }
            } catch (error) {
                console.error('ì„±ì¥ ì˜¤ë¥˜:', error);
                showToast('âŒ ì„±ì¥ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ì‹ë¬¼ ìˆ˜í™•
        function harvestPlant(plantId) {
            try {
                if (!currentUser) {
                    showToast('âŒ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤');
                    return;
                }

                const result = plantSystem.harvestPlant(plantId);

                if (result.success) {
                    showPlantSpeech('ê°ì‚¬í–ˆì–´ìš”! ë˜ ë§Œë‚˜ìš”!');
                    showToast('ğŸŒº ' + result.message);

                    // Firebase ë™ê¸°í™”
                    if (window.plantSystemFirebase) {
                        plantSystemFirebase.savePlantSystemState();
                    }

                    updateDashboard();
                } else {
                    showToast('âŒ ' + result.message);
                }
            } catch (error) {
                console.error('ìˆ˜í™• ì˜¤ë¥˜:', error);
                showToast('âŒ ìˆ˜í™• ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜ë“¤
        function showWaterAnimation() {
            // í˜„ì¬ í™œì„±í™”ëœ í™”ë¶„ ì°¾ê¸°
            const plants = plantSystem.getUserPlants(currentUser.userId);
            const activePlantIndex = plants.findIndex(p => p && p.plantId === currentPlantId);

            if (activePlantIndex === -1) return;

            const potNum = activePlantIndex + 1;
            const potElement = document.getElementById(`pot${potNum}`);

            // ë¬¼ë°©ìš¸ ìƒì„±
            const droplet = document.createElement('div');
            droplet.textContent = 'ğŸ’§';
            droplet.className = 'water-drop absolute text-4xl';
            droplet.style.left = '50%';
            droplet.style.top = '10px';
            droplet.style.transform = 'translateX(-50%)';

            potElement.appendChild(droplet);

            // ì• ë‹ˆë©”ì´ì…˜ í›„ ì œê±°
            setTimeout(() => {
                droplet.remove();
            }, 1000);
        }

        function showLoveAnimation() {
            // í˜„ì¬ í™œì„±í™”ëœ í™”ë¶„ ì°¾ê¸°
            const plants = plantSystem.getUserPlants(currentUser.userId);
            const activePlantIndex = plants.findIndex(p => p && p.plantId === currentPlantId);

            if (activePlantIndex === -1) return;

            const potNum = activePlantIndex + 1;
            const potElement = document.getElementById(`pot${potNum}`);

            // í•˜íŠ¸ ìƒì„±
            const heart = document.createElement('div');
            heart.textContent = 'ğŸ’š';
            heart.className = 'love-heart absolute text-3xl';
            heart.style.left = '50%';
            heart.style.bottom = '50%';
            heart.style.transform = 'translateX(-50%)';

            potElement.appendChild(heart);

            // ì• ë‹ˆë©”ì´ì…˜ í›„ ì œê±°
            setTimeout(() => {
                heart.remove();
            }, 2000);
        }

        function showPlantSpeech(message) {
            const popup = document.getElementById('plant-speech-popup');
            const text = document.getElementById('popup-text');

            text.textContent = message;
            popup.classList.remove('hidden');

            setTimeout(() => {
                popup.classList.add('hidden');
            }, 3000);
        }

        // ì„±ì¥ê¶Œ ìƒì„¸
        function showTicketDetails() {
            const user = plantSystem.getUserData();
            const currentTime = plantSystem.getCurrentTimestamp();
            const validTickets = user.rewards.growthTickets.filter(t => t.expiresAt > currentTime);

            const listHtml = validTickets.length === 0 ?
                '<div class="text-center text-gray-500 py-4">ë³´ìœ í•œ ì„±ì¥ê¶Œì´ ì—†ìŠµë‹ˆë‹¤</div>' :
                validTickets.map(ticket => {
                    const remaining = ticket.expiresAt - currentTime;
                    const hours = Math.floor(remaining / (60 * 60 * 1000));
                    const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));

                    return `
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="text-sm font-semibold">ì„±ì¥ê¶Œ #${ticket.ticketId.slice(0, 8)}</div>
                                <div class="text-sm text-red-600">${hours}ì‹œê°„ ${minutes}ë¶„ ë‚¨ìŒ</div>
                            </div>
                        </div>
                    `;
                }).join('');

            document.getElementById('ticket-list').innerHTML = listHtml;
            document.getElementById('ticket-modal').classList.remove('hidden');
        }

        function closeTicketModal() {
            document.getElementById('ticket-modal').classList.add('hidden');
        }

        // ===== ê°œë°œì ë©”ë‰´ =====

        function showResetMenu() {
            document.getElementById('reset-modal').classList.remove('hidden');
        }

        function closeResetMenu() {
            document.getElementById('reset-modal').classList.add('hidden');
        }

        function resetAllData() {
            if (!confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            localStorage.removeItem('plantSystemUser');
            localStorage.removeItem('plantSystemPlants');
            showToast('âœ… ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
            closeResetMenu();

            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }

        function resetPlants() {
            if (!confirm('ëª¨ë“  ì‹ë¬¼ì„ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            localStorage.removeItem('plantSystemPlants');
            showToast('âœ… ì‹ë¬¼ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
            closeResetMenu();
            updateDashboard();
        }

        function resetDaily() {
            if (!confirm('ì¼ì¼ ì§„í–‰ë¥ ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            const user = plantSystem.getUserData();
            user.daily.completedSubjects = 0;
            user.daily.completedSubjectIds = [];
            user.daily.lastResetDate = plantSystem.getCurrentDate();
            plantSystem.saveUserData(user);

            showToast('âœ… ì¼ì¼ ì§„í–‰ë¥ ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
            closeResetMenu();
            updateDashboard();
        }

        function addTestTickets() {
            const user = plantSystem.getUserData();
            const currentTime = plantSystem.getCurrentTimestamp();
            const expiresAt = currentTime + (24 * 60 * 60 * 1000);

            for (let i = 0; i < 5; i++) {
                user.rewards.growthTickets.push({
                    ticketId: plantSystem.generateUUID(),
                    earnedAt: currentTime,
                    expiresAt: expiresAt
                });
            }

            plantSystem.saveUserData(user);
            showToast('âœ… ì„±ì¥ê¶Œ 5ê°œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
            closeResetMenu();
            updateDashboard();
        }

        function skipPlantTime() {
            const plants = plantSystem.getAllPlants();
            let updated = 0;

            Object.values(plants).forEach(plant => {
                if (plant.status === 'PLANTED') {
                    // 24ì‹œê°„ ì „ìœ¼ë¡œ ì‹¬ì€ ì‹œê°„ ë³€ê²½
                    plant.plantedAt = plantSystem.getCurrentTimestamp() - (25 * 60 * 60 * 1000);
                    plantSystem.savePlant(plant);

                    // ìƒíƒœ ì¬í™•ì¸
                    plantSystem.checkReadyStatus(plant);
                    plantSystem.savePlant(plant);
                    updated++;
                }
            });

            showToast(`âœ… ${updated}ê°œ ì‹ë¬¼ì˜ ì‹œê°„ì„ ê±´ë„ˆë›°ì—ˆìŠµë‹ˆë‹¤`);
            closeResetMenu();
            updateDashboard();
        }

        // í† ìŠ¤íŠ¸ ì•Œë¦¼
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('hidden');

            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('dailyReset', () => {
            showToast('ğŸŒ… ì¼ì¼ ì´ˆê¸°í™” ì™„ë£Œ');
            updateDashboard();
        });

        window.addEventListener('plantsStatusUpdated', (e) => {
            if (e.detail.updatedCount > 0) {
                showToast(`ğŸŒ± ${e.detail.updatedCount}ê°œ ì‹ë¬¼ì´ ì„±ì¥ ì¤€ë¹„ ì™„ë£Œ!`);
                updateDashboard();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
