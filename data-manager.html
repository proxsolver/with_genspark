<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„° ê´€ë¦¬ - EduPet Collection</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        .data-section {
            transition: all 0.3s ease;
        }
        
        .success-animation {
            animation: success-pulse 1s ease-out;
        }
        
        @keyframes success-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); background-color: #dcfce7; }
            100% { transform: scale(1); }
        }
        
        .export-area {
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-6">
            <button onclick="goHome()" class="absolute left-4 top-6 text-2xl hover:scale-110 transition-transform">
                ğŸ 
            </button>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h1>
            <div class="text-sm text-gray-600">
                ì§„í–‰ ìƒí™©ì„ ë°±ì—…í•˜ê³  ë³µì›í•˜ì„¸ìš”
            </div>
        </div>

        <!-- Current Data Status -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                ğŸ“Š í˜„ì¬ ë°ì´í„° ìƒíƒœ
            </h2>
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span>í•™ìŠµ ì§„í–‰ë¥ :</span>
                    <span id="learningData" class="font-medium">-</span>
                </div>
                <div class="flex justify-between">
                    <span>ë†ì¥ ìƒíƒœ:</span>
                    <span id="farmData" class="font-medium">-</span>
                </div>
                <div class="flex justify-between">
                    <span>ë™ë¬¼ ì»¬ë ‰ì…˜:</span>
                    <span id="collectionData" class="font-medium">-</span>
                </div>
                <div class="flex justify-between">
                    <span>ì—…ì  ë‹¬ì„±:</span>
                    <span id="achievementData" class="font-medium">-</span>
                </div>
                <div class="flex justify-between border-t pt-2 mt-2">
                    <span>ë§ˆì§€ë§‰ ë°±ì—…:</span>
                    <span id="lastBackup" class="font-medium text-blue-600">-</span>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 data-section">
            <h2 class="text-lg font-bold text-gray-800 mb-4">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h2>
            <div class="text-sm text-gray-600 mb-4">
                í˜„ì¬ ì§„í–‰ ìƒí™©ì„ ì•ˆì „í•˜ê²Œ ë°±ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
            
            <button onclick="exportData()" class="w-full mb-4 px-4 py-3 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors">
                ğŸ“¦ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
            </button>
            
            <textarea id="exportArea" 
                      class="export-area w-full h-32 p-3 border rounded-lg text-xs bg-gray-50 resize-none"
                      placeholder="ë‚´ë³´ë‚¸ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."
                      readonly></textarea>
            
            <div class="flex space-x-2 mt-2">
                <button onclick="copyExportData()" 
                        class="flex-1 px-3 py-2 bg-green-500 text-white rounded text-sm hover:bg-green-600 transition-colors"
                        id="copyBtn" disabled>
                    ğŸ“‹ ë³µì‚¬í•˜ê¸°
                </button>
                <button onclick="saveAsFile()" 
                        class="flex-1 px-3 py-2 bg-purple-500 text-white rounded text-sm hover:bg-purple-600 transition-colors"
                        id="saveBtn" disabled>
                    ğŸ’¾ íŒŒì¼ ì €ì¥
                </button>
            </div>
        </div>

        <!-- Import Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 data-section">
            <h2 class="text-lg font-bold text-gray-800 mb-4">ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</h2>
            <div class="text-sm text-gray-600 mb-4">
                ë°±ì—…í•œ ë°ì´í„°ë¥¼ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. âš ï¸ í˜„ì¬ ë°ì´í„°ê°€ ë®ì–´ì¨ì§‘ë‹ˆë‹¤!
            </div>
            
            <textarea id="importArea" 
                      class="export-area w-full h-32 p-3 border rounded-lg text-xs"
                      placeholder="ë°±ì—…í•œ ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
            
            <div class="flex space-x-2 mt-4">
                <button onclick="validateImportData()" 
                        class="flex-1 px-3 py-2 bg-yellow-500 text-white rounded text-sm hover:bg-yellow-600 transition-colors">
                    ğŸ” ë°ì´í„° ê²€ì¦
                </button>
                <button onclick="importData()" 
                        class="flex-1 px-3 py-2 bg-red-500 text-white rounded text-sm hover:bg-red-600 transition-colors">
                    âš¡ ë°ì´í„° ë³µì›
                </button>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-lg font-bold text-gray-800 mb-4">âš¡ ë¹ ë¥¸ ì‘ì—…</h2>
            
            <div class="grid grid-cols-2 gap-3">
                <button onclick="autoBackup()" 
                        class="px-3 py-3 bg-indigo-500 text-white rounded-lg text-sm hover:bg-indigo-600 transition-colors">
                    ğŸ”„ ìë™ ë°±ì—…
                </button>
                <button onclick="resetAllData()" 
                        class="px-3 py-3 bg-gray-500 text-white rounded-lg text-sm hover:bg-gray-600 transition-colors">
                    ğŸ—‘ï¸ ì´ˆê¸°í™”
                </button>
            </div>
            
            <div class="mt-4 text-xs text-gray-500 bg-gray-50 rounded p-3">
                ğŸ’¡ íŒ: ì •ê¸°ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°±ì—…í•˜ì—¬ ì§„í–‰ ìƒí™©ì„ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ì„¸ìš”!
            </div>
        </div>
    </div>

    <script>
        let exportedData = null;

        function loadCurrentDataStatus() {
            // Load and display current data status
            const learningProgress = JSON.parse(localStorage.getItem('learningProgress') || '{}');
            const quizProgress = JSON.parse(localStorage.getItem('quizProgress') || '{}');
            const farmState = JSON.parse(localStorage.getItem('simpleFarmState') || '{}');
            const animalCollection = JSON.parse(localStorage.getItem('animalCollection') || '{}');
            const achievements = JSON.parse(localStorage.getItem('achievements') || '{}');
            
            // Update display
            document.getElementById('learningData').textContent = 
                `${quizProgress.totalCorrect || 0}ë¬¸ì œ ì •ë‹µ / ${quizProgress.sessionCount || 0}ì„¸ì…˜`;
            
            document.getElementById('farmData').textContent = 
                `ğŸ’°${farmState.money || 0}ì› / ğŸ’§${farmState.water || 0}ê°œ`;
            
            const collectionCount = Object.keys(animalCollection.collection || {}).length;
            document.getElementById('collectionData').textContent = 
                `${collectionCount}ì¢… ìˆ˜ì§‘`;
            
            const achievementCount = Object.values(achievements).filter(a => a.completed).length;
            document.getElementById('achievementData').textContent = 
                `${achievementCount}ê°œ ë‹¬ì„±`;
            
            // Check last backup
            const lastBackup = localStorage.getItem('lastBackupTime');
            document.getElementById('lastBackup').textContent = 
                lastBackup ? new Date(parseInt(lastBackup)).toLocaleString() : 'ì—†ìŒ';
        }

        function exportData() {
            const gameData = {
                version: "1.0.0",
                timestamp: Date.now(),
                data: {
                    learningProgress: JSON.parse(localStorage.getItem('learningProgress') || '{}'),
                    quizProgress: JSON.parse(localStorage.getItem('quizProgress') || '{}'),
                    simpleFarmState: JSON.parse(localStorage.getItem('simpleFarmState') || '{}'),
                    animalCollection: JSON.parse(localStorage.getItem('animalCollection') || '{}'),
                    achievements: JSON.parse(localStorage.getItem('achievements') || '{}'),
                    eduPetOnboardingCompleted: localStorage.getItem('eduPetOnboardingCompleted')
                }
            };
            
            exportedData = JSON.stringify(gameData, null, 2);
            document.getElementById('exportArea').value = exportedData;
            
            // Enable action buttons
            document.getElementById('copyBtn').disabled = false;
            document.getElementById('saveBtn').disabled = false;
            
            // Show success animation
            const exportSection = document.querySelector('.data-section');
            exportSection.classList.add('success-animation');
            setTimeout(() => exportSection.classList.remove('success-animation'), 1000);
            
            alert('âœ… ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!\n\nì•„ë˜ í…ìŠ¤íŠ¸ ì˜ì—­ì˜ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ê±°ë‚˜ íŒŒì¼ë¡œ ì €ì¥í•˜ì„¸ìš”.');
        }

        function copyExportData() {
            const exportArea = document.getElementById('exportArea');
            exportArea.select();
            exportArea.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                alert('ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì•ˆì „í•œ ê³³ì— ë³´ê´€í•˜ì„¸ìš”.');
            } catch (err) {
                alert('âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ì„œ ë³µì‚¬í•˜ì„¸ìš”.');
            }
        }

        function saveAsFile() {
            if (!exportedData) return;
            
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            const filename = `EduPet_Backup_${timestamp}.json`;
            
            const blob = new Blob([exportedData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert(`ğŸ’¾ íŒŒì¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\níŒŒì¼ëª…: ${filename}`);
        }

        function validateImportData() {
            const importArea = document.getElementById('importArea');
            const data = importArea.value.trim();
            
            if (!data) {
                alert('âŒ ê°€ì ¸ì˜¬ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            try {
                const gameData = JSON.parse(data);
                
                // Validate structure
                if (!gameData.version || !gameData.timestamp || !gameData.data) {
                    throw new Error('Invalid data format');
                }
                
                const backupDate = new Date(gameData.timestamp).toLocaleString();
                const dataKeys = Object.keys(gameData.data);
                
                alert(`âœ… ìœ íš¨í•œ ë°±ì—… ë°ì´í„°ì…ë‹ˆë‹¤!\n\në°±ì—… ì‹œê°„: ${backupDate}\ní¬í•¨ëœ ë°ì´í„°: ${dataKeys.length}ê°œ í•­ëª©\n\në³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
                
            } catch (error) {
                alert('âŒ ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.\n\nì˜¬ë°”ë¥¸ ë°±ì—… ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            }
        }

        function importData() {
            const importArea = document.getElementById('importArea');
            const data = importArea.value.trim();
            
            if (!data) {
                alert('âŒ ê°€ì ¸ì˜¬ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            if (!confirm('âš ï¸ í˜„ì¬ ëª¨ë“  ì§„í–‰ ìƒí™©ì´ ë®ì–´ì¨ì§‘ë‹ˆë‹¤!\n\nì •ë§ë¡œ ë°ì´í„°ë¥¼ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const gameData = JSON.parse(data);
                
                // Restore all data
                Object.entries(gameData.data).forEach(([key, value]) => {
                    if (value !== null && value !== undefined) {
                        if (typeof value === 'object') {
                            localStorage.setItem(key, JSON.stringify(value));
                        } else {
                            localStorage.setItem(key, value);
                        }
                    }
                });
                
                // Update backup time
                localStorage.setItem('lastBackupTime', Date.now().toString());
                
                // Refresh display
                loadCurrentDataStatus();
                
                alert('âœ… ë°ì´í„° ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”.');
                
                // Clear import area
                importArea.value = '';
                
            } catch (error) {
                alert('âŒ ë°ì´í„° ë³µì›ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì˜¬ë°”ë¥¸ ë°±ì—… ë°ì´í„°ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
            }
        }

        function autoBackup() {
            exportData();
            
            // Set automatic backup timestamp
            localStorage.setItem('lastBackupTime', Date.now().toString());
            loadCurrentDataStatus();
            
            // Auto-save to a predictable format for regular backups
            const timestamp = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
            localStorage.setItem(`autoBackup_${timestamp}`, exportedData);
            
            alert('ğŸ”„ ìë™ ë°±ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\në¸Œë¼ìš°ì € ë¡œì»¬ ì €ì¥ì†Œì— ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function resetAllData() {
            if (!confirm('âš ï¸ ëª¨ë“  ì§„í–‰ ìƒí™©ì´ ì‚­ì œë©ë‹ˆë‹¤!\n\nì •ë§ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            if (!confirm('ğŸš¨ ë§ˆì§€ë§‰ í™•ì¸!\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            // Clear all EduPet related data
            const keysToRemove = [
                'learningProgress', 'quizProgress', 'simpleFarmState',
                'animalCollection', 'achievements', 'eduPetOnboardingCompleted',
                'lastBackupTime'
            ];
            
            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
            });
            
            // Also clear auto-backups
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('autoBackup_')) {
                    localStorage.removeItem(key);
                }
            });
            
            alert('ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\n\ní™ˆí˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ ìƒˆë¡œ ì‹œì‘í•˜ì„¸ìš”.');
            
            // Refresh display
            loadCurrentDataStatus();
            
            // Redirect to tutorial
            setTimeout(() => {
                window.location.href = 'tutorial.html';
            }, 2000);
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentDataStatus();
        });
    </script>
</body>
</html>