<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©€í‹° ê³¼ëª© í•™ìŠµ - EduPet Collection</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í•œê¸€ í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .font-game {
            font-family: 'Noto Sans KR', 'Comic Sans MS', cursive;
            font-weight: 600;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, 
                rgba(76, 175, 80, 0.1) 0%, 
                rgba(255, 152, 0, 0.1) 50%, 
                rgba(33, 150, 243, 0.1) 100%
            );
        }
        
        .option-btn {
            transition: all 0.2s ease;
        }
        
        .option-btn:hover {
            transform: scale(1.02);
        }
        
        .option-btn.correct {
            background-color: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .option-btn.incorrect {
            background-color: #ef4444;
            border-color: #ef4444;
            color: white;
        }
        
        .option-btn.neutral {
            background-color: #e5e7eb;
            border-color: #e5e7eb;
            color: #6b7280;
        }
        
        .confetti-animation {
            animation: confetti 1s ease-out;
        }
        
        @keyframes confetti {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .progress-fill {
            transition: width 0.5s ease-out;
        }
        
        .subject-transition {
            animation: subjectChange 0.8s ease-in-out;
        }
        
        @keyframes subjectChange {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .subject-complete {
            animation: subjectComplete 1.5s ease-out;
        }
        
        @keyframes subjectComplete {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .time-warning {
            animation: timeWarning 1s infinite;
        }
        
        @keyframes timeWarning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 500: '#4CAF50', 600: '#16a34a' },
                        secondary: { 500: '#FF9800', 600: '#ea580c' }
                    }
                }
            }
        }
    </script>
</head>
<body class="gradient-bg min-h-screen">
    <!-- í€´ì¦ˆ ì»¨í…Œì´ë„ˆ -->
    <div class="container mx-auto px-4 py-6 max-w-2xl">
        <!-- í—¤ë” -->
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-3">
                <button onclick="confirmExit()" class="p-2 rounded-lg hover:bg-white hover:shadow-md transition-all">
                    â† ë‚˜ê°€ê¸°
                </button>
                <div class="flex items-center space-x-2">
                    <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium" id="current-subject">
                        ğŸ‡ºğŸ‡¸ ì˜ì–´
                    </span>
                    <span class="text-sm text-gray-600 font-medium" id="question-counter">1 / 4</span>
                </div>
            </div>
            
            <div class="text-right">
                <div class="text-xs text-gray-500 mb-1">ë‚¨ì€ ì‹œê°„</div>
                <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium" id="timer">
                    â° 24:30
                </span>
            </div>
        </div>

        <!-- ê³¼ëª©ë³„ ì§„í–‰ë¥  -->
        <div class="bg-white rounded-xl p-4 mb-6 shadow-md">
            <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-medium text-gray-700">ì „ì²´ ì§„í–‰ë¥ </span>
                <span class="text-sm font-bold text-primary-600" id="overall-progress">1 / 12 ë¬¸ì œ</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                <div class="bg-primary-500 h-2 rounded-full progress-fill" id="overall-progress-bar" style="width: 8.33%;"></div>
            </div>
            
            <!-- ê³¼ëª©ë³„ ìƒíƒœ -->
            <div class="grid grid-cols-3 gap-3 text-center" id="subjects-status">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- í€´ì¦ˆ ì¹´ë“œ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 slide-in" id="quiz-card">
            <!-- ë¬¸ì œ -->
            <div class="mb-6">
                <div class="flex items-start justify-between">
                    <h2 class="text-xl font-bold text-gray-900 mb-4 flex-1" id="question-text">
                        ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </h2>
                    
                    <!-- TTS ë²„íŠ¼ -->
                    <button id="tts-btn" onclick="playTTS()" class="ml-4 px-3 py-1 border-2 border-primary-500 text-primary-500 rounded-lg text-sm hover:bg-primary-500 hover:text-white transition-all hidden">
                        ğŸ”Š ë°œìŒ
                    </button>
                </div>
            </div>

            <!-- ë³´ê¸° -->
            <div class="space-y-3 mb-6" id="options-container">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <!-- í•´ì„¤ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
            <div id="explanation" class="hidden mb-6">
                <div class="p-4 rounded-xl border-2 bg-green-50 border-green-200">
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl" id="result-icon">ğŸ‰</span>
                        <div>
                            <h4 class="font-bold text-gray-900 mb-2" id="result-text">ì •ë‹µì…ë‹ˆë‹¤!</h4>
                            <p class="text-gray-700 leading-relaxed" id="explanation-text">
                                í•´ì„¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë‹¤ìŒ/ì™„ë£Œ ë²„íŠ¼ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
            <div id="next-section" class="hidden text-center">
                <button onclick="nextQuestion()" class="px-8 py-3 bg-primary-500 text-white rounded-xl text-lg font-bold hover:bg-primary-600 transition-all" id="next-btn">
                    ë‹¤ìŒ ë¬¸ì œ â¡ï¸
                </button>
            </div>
        </div>

        <!-- ê³¼ëª©ë³„ í†µê³„ -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-6">
            <div class="flex items-center justify-between mb-3">
                <span class="font-medium text-gray-700" id="current-subject-stats">ì˜ì–´ í•™ìŠµ í˜„í™©</span>
                <span class="text-sm text-blue-600" id="subject-time">10ë¶„ ëª©í‘œ</span>
            </div>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div>
                    <div class="text-2xl font-bold text-green-600" id="subject-correct">0</div>
                    <div class="text-sm text-gray-600">ì •ë‹µ</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-red-600" id="subject-incorrect">0</div>
                    <div class="text-sm text-gray-600">ì˜¤ë‹µ</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-blue-600" id="subject-accuracy">0%</div>
                    <div class="text-sm text-gray-600">ì •ë‹µë¥ </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê³¼ëª© ì™„ë£Œ ëª¨ë‹¬ -->
    <div id="subject-complete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full subject-complete">
            <div class="text-center mb-4">
                <span class="text-6xl block mb-3" id="completed-subject-icon">ğŸ‡ºğŸ‡¸</span>
                <h3 class="text-xl font-bold text-gray-900 mb-2" id="completed-subject-name">ì˜ì–´ ì™„ë£Œ!</h3>
                <p class="text-gray-600" id="completed-subject-stats">4ë¬¸ì œ ì¤‘ 3ë¬¸ì œ ì •ë‹µ (75%)</p>
            </div>
            
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                <div class="flex items-center space-x-2 mb-2">
                    <span class="text-green-600">ğŸŒ±</span>
                    <span class="font-medium text-green-800">ì‹ë¬¼ì´ ìëì–´ìš”!</span>
                </div>
                <p class="text-sm text-green-700">ê¾¸ì¤€í•œ í•™ìŠµìœ¼ë¡œ ë†ì¥ì´ ë”ìš± ê±´ê°•í•´ì§€ê³  ìˆìŠµë‹ˆë‹¤!</p>
            </div>
            
            <button onclick="continueToNextSubject()" class="w-full py-3 bg-primary-500 text-white rounded-lg font-bold hover:bg-primary-600 transition-all">
                ë‹¤ìŒ ê³¼ëª©ìœ¼ë¡œ ê³„ì†í•˜ê¸°
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let selectedSubjects = [];
        let currentSubjectIndex = 0;
        let currentQuestionIndex = 0;
        let questions = {};
        let subjectStats = {};
        let isAnswered = false;
        let shuffledOptions = [];
        let totalTimeRemaining = 25 * 60; // 25ë¶„
        let subjectTimeTargets = { english: 10 * 60, math: 7.5 * 60, science: 7.5 * 60 }; // ì´ˆ ë‹¨ìœ„

        // ê³¼ëª© ì •ë³´
        const subjects = {
            english: { name: 'ì˜ì–´', icon: 'ğŸ‡ºğŸ‡¸', color: 'orange' },
            math: { name: 'ìˆ˜í•™', icon: 'ğŸ”¢', color: 'blue' },
            science: { name: 'ê³¼í•™', icon: 'ğŸ”¬', color: 'green' },
            general: { name: 'ìƒì‹', icon: 'ğŸ§ ', color: 'purple' },
            idiom: { name: 'ì‚¬ìì„±ì–´', icon: 'ğŸ“œ', color: 'yellow' },
            person: { name: 'ì¸ë¬¼', icon: 'ğŸ‘¤', color: 'indigo' },
            korean: { name: 'êµ­ì–´', icon: 'ğŸ“š', color: 'red' },
            social: { name: 'ì‚¬íšŒ', icon: 'ğŸ›ï¸', color: 'gray' },
            economy: { name: 'ê²½ì œ', icon: 'ğŸ’°', color: 'yellow' },
            etc: { name: 'ê¸°íƒ€', icon: 'ğŸ²', color: 'pink' }
        };

        // ì´ˆê¸°í™”
        async function initializeQuiz() {
            // localStorageì—ì„œ ì„ íƒëœ ê³¼ëª© ê°€ì ¸ì˜¤ê¸°
            const stored = localStorage.getItem('selectedSubjects');
            if (!stored) {
                alert('ì„ íƒëœ ê³¼ëª©ì´ ì—†ìŠµë‹ˆë‹¤. ê³¼ëª© ì„ íƒ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = 'subject-select.html';
                return;
            }

            selectedSubjects = JSON.parse(stored);
            currentSubjectIndex = parseInt(localStorage.getItem('currentSubjectIndex') || '0');

            // ê° ê³¼ëª©ë³„ í†µê³„ ì´ˆê¸°í™”
            selectedSubjects.forEach(subject => {
                subjectStats[subject] = {
                    correct: 0,
                    incorrect: 0,
                    total: 0,
                    completed: false
                };
            });

            // ë¬¸ì œ ë°ì´í„° ë¡œë“œ
            await loadQuestions();
            
            // UI ì´ˆê¸°í™”
            updateSubjectsStatus();
            startTimer();
            loadCurrentQuestion();
        }

        // ë¬¸ì œ ë°ì´í„° ë¡œë“œ
        async function loadQuestions() {
            try {
                const response = await fetch('src/data/questions/all-questions.json');
                const allQuestions = await response.json();
                
                // ê³¼ëª©ë³„ë¡œ ë¬¸ì œ ë¶„ë¥˜
                selectedSubjects.forEach(subject => {
                    questions[subject] = allQuestions
                        .filter(q => q.subject === subject)
                        .slice(0, 4); // ê³¼ëª©ë‹¹ 4ë¬¸ì œ
                });
            } catch (error) {
                console.error('ë¬¸ì œ ë¡œë“œ ì‹¤íŒ¨:', error);
                // í´ë°±ìœ¼ë¡œ ê°„ë‹¨í•œ ë¬¸ì œ ì‚¬ìš©
                loadFallbackQuestions();
            }
        }

        // í´ë°± ë¬¸ì œ (fetch ì‹¤íŒ¨ ì‹œ)
        function loadFallbackQuestions() {
            const fallbackQuestions = {
                english: [
                    {
                        id: "eng_001",
                        subject: "english",
                        question: "ë‹¤ìŒ ì¤‘ 'apple'ì˜ ëœ»ì€?",
                        options: ["ì‚¬ê³¼", "ë°”ë‚˜ë‚˜", "ì˜¤ë Œì§€", "í¬ë„"],
                        correctIndex: 0,
                        explanation: "Appleì€ ì‚¬ê³¼ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.",
                        audioText: "apple"
                    }
                ],
                math: [
                    {
                        id: "math_001",
                        subject: "math",
                        question: "25 + 37 = ?",
                        options: ["52", "62", "72", "82"],
                        correctIndex: 1,
                        explanation: "25 + 37 = 62ì…ë‹ˆë‹¤."
                    }
                ]
            };

            selectedSubjects.forEach(subject => {
                questions[subject] = fallbackQuestions[subject] || [
                    {
                        id: `${subject}_001`,
                        subject: subject,
                        question: `${subjects[subject].name} ìƒ˜í”Œ ë¬¸ì œì…ë‹ˆë‹¤.`,
                        options: ["ì •ë‹µ", "ì˜¤ë‹µ1", "ì˜¤ë‹µ2", "ì˜¤ë‹µ3"],
                        correctIndex: 0,
                        explanation: `${subjects[subject].name} ìƒ˜í”Œ í•´ì„¤ì…ë‹ˆë‹¤.`
                    }
                ];
            });
        }

        // íƒ€ì´ë¨¸ ì‹œì‘
        function startTimer() {
            setInterval(() => {
                if (totalTimeRemaining > 0) {
                    totalTimeRemaining--;
                    updateTimerDisplay();
                } else {
                    completeAllSubjects();
                }
            }, 1000);
        }

        // íƒ€ì´ë¨¸ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateTimerDisplay() {
            const minutes = Math.floor(totalTimeRemaining / 60);
            const seconds = totalTimeRemaining % 60;
            const timerElement = document.getElementById('timer');
            
            timerElement.textContent = `â° ${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // ì‹œê°„ ê²½ê³ 
            if (totalTimeRemaining < 60) {
                timerElement.className = 'px-2 py-1 bg-red-500 text-white rounded-full text-sm font-medium time-warning';
            } else if (totalTimeRemaining < 300) {
                timerElement.className = 'px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-medium';
            }
        }

        // ê³¼ëª© ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSubjectsStatus() {
            const container = document.getElementById('subjects-status');
            
            container.innerHTML = selectedSubjects.map((subject, index) => {
                const subjectInfo = subjects[subject];
                const stats = subjectStats[subject];
                const isCurrentSubject = index === currentSubjectIndex;
                const isCompleted = stats.completed;
                
                let statusClass = 'text-gray-400';
                let statusIcon = 'â³';
                
                if (isCompleted) {
                    statusClass = 'text-green-600';
                    statusIcon = 'âœ…';
                } else if (isCurrentSubject) {
                    statusClass = 'text-blue-600';
                    statusIcon = 'ğŸ”„';
                }
                
                return `
                    <div class="p-2 rounded-lg ${isCurrentSubject ? 'bg-blue-50 border border-blue-200' : ''}">
                        <div class="text-2xl mb-1">${subjectInfo.icon}</div>
                        <div class="text-xs font-medium text-gray-700">${subjectInfo.name}</div>
                        <div class="text-xs ${statusClass}">${statusIcon} ${stats.total}/4</div>
                    </div>
                `;
            }).join('');
        }

        // í˜„ì¬ ë¬¸ì œ ë¡œë“œ
        function loadCurrentQuestion() {
            if (currentSubjectIndex >= selectedSubjects.length) {
                completeAllSubjects();
                return;
            }

            const currentSubject = selectedSubjects[currentSubjectIndex];
            const subjectQuestions = questions[currentSubject];
            
            if (currentQuestionIndex >= subjectQuestions.length) {
                completeCurrentSubject();
                return;
            }

            const question = subjectQuestions[currentQuestionIndex];
            shuffledOptions = shuffleOptions(question);
            isAnswered = false;

            // UI ì—…ë°ì´íŠ¸
            updateCurrentSubjectDisplay(currentSubject);
            updateQuestionDisplay(question);
            updateProgressDisplay();
        }

        // í˜„ì¬ ê³¼ëª© í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateCurrentSubjectDisplay(subject) {
            const subjectInfo = subjects[subject];
            document.getElementById('current-subject').textContent = `${subjectInfo.icon} ${subjectInfo.name}`;
            document.getElementById('current-subject-stats').textContent = `${subjectInfo.name} í•™ìŠµ í˜„í™©`;
            
            const stats = subjectStats[subject];
            document.getElementById('subject-correct').textContent = stats.correct;
            document.getElementById('subject-incorrect').textContent = stats.incorrect;
            
            const accuracy = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
            document.getElementById('subject-accuracy').textContent = accuracy + '%';
        }

        // ë¬¸ì œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateQuestionDisplay(question) {
            document.getElementById('question-text').textContent = question.question;
            
            // ë³´ê¸° ìƒì„±
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = shuffledOptions.map((option, index) => `
                <button class="option-btn w-full p-4 text-left rounded-xl border-2 border-gray-300 hover:border-primary-500 hover:bg-primary-50 font-medium transition-all" onclick="selectOption(${index})">
                    <span class="inline-block w-8 h-8 rounded-full bg-gray-100 text-center leading-8 mr-3 text-sm font-bold">
                        ${String.fromCharCode(65 + index)}
                    </span>
                    ${option.text}
                </button>
            `).join('');

            // TTS ë²„íŠ¼
            const ttsBtn = document.getElementById('tts-btn');
            if (question.audioText) {
                ttsBtn.classList.remove('hidden');
            } else {
                ttsBtn.classList.add('hidden');
            }

            // í•´ì„¤ê³¼ ë‹¤ìŒ ë²„íŠ¼ ìˆ¨ê¹€
            document.getElementById('explanation').classList.add('hidden');
            document.getElementById('next-section').classList.add('hidden');
        }

        // ì§„í–‰ë¥  í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateProgressDisplay() {
            const totalQuestions = selectedSubjects.reduce((sum, subject) => sum + questions[subject].length, 0);
            const completedQuestions = selectedSubjects.reduce((sum, subject) => sum + subjectStats[subject].total, 0);
            
            document.getElementById('question-counter').textContent = `${completedQuestions + 1} / ${totalQuestions}`;
            document.getElementById('overall-progress').textContent = `${completedQuestions + 1} / ${totalQuestions} ë¬¸ì œ`;
            
            const progress = ((completedQuestions + 1) / totalQuestions) * 100;
            document.getElementById('overall-progress-bar').style.width = progress + '%';
        }

        // ë³´ê¸° ì…”í”Œ
        function shuffleOptions(question) {
            const options = question.options.map((text, index) => ({ text, originalIndex: index }));
            const shuffled = [...options];
            
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            return shuffled;
        }

        // ì˜µì…˜ ì„ íƒ
        function selectOption(shuffledIndex) {
            if (isAnswered) return;

            const currentSubject = selectedSubjects[currentSubjectIndex];
            const question = questions[currentSubject][currentQuestionIndex];
            const selectedOriginalIndex = shuffledOptions[shuffledIndex].originalIndex;
            const isCorrect = selectedOriginalIndex === question.correctIndex;
            
            isAnswered = true;

            // í†µê³„ ì—…ë°ì´íŠ¸
            subjectStats[currentSubject].total++;
            if (isCorrect) {
                subjectStats[currentSubject].correct++;
            } else {
                subjectStats[currentSubject].incorrect++;
            }

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateOptionButtons(shuffledIndex, question.correctIndex);
            
            // í•´ì„¤ í‘œì‹œ
            setTimeout(() => {
                showExplanation(isCorrect, question.explanation);
                updateCurrentSubjectDisplay(currentSubject);
                updateSubjectsStatus();
            }, 1000);
        }

        // ì˜µì…˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateOptionButtons(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.option-btn');
            
            options.forEach((btn, index) => {
                const originalIndex = shuffledOptions[index].originalIndex;
                
                if (originalIndex === correctIndex) {
                    btn.classList.add('correct');
                    btn.innerHTML += ' <span class="ml-2 text-xl">âœ…</span>';
                } else if (index === selectedIndex) {
                    btn.classList.add('incorrect');
                    btn.innerHTML += ' <span class="ml-2 text-xl">âŒ</span>';
                } else {
                    btn.classList.add('neutral');
                }
                
                btn.onclick = null;
            });

            if (selectedIndex !== -1 && shuffledOptions[selectedIndex].originalIndex === correctIndex) {
                options[selectedIndex].classList.add('confetti-animation');
            }
        }

        // í•´ì„¤ í‘œì‹œ
        function showExplanation(isCorrect, explanation) {
            const explanationDiv = document.getElementById('explanation');
            const resultIcon = document.getElementById('result-icon');
            const resultText = document.getElementById('result-text');
            const explanationText = document.getElementById('explanation-text');

            if (isCorrect) {
                resultIcon.textContent = 'ğŸ‰';
                resultText.textContent = 'ì •ë‹µì…ë‹ˆë‹¤!';
                explanationDiv.className = 'mb-6 p-4 rounded-xl border-2 bg-green-50 border-green-200';
            } else {
                resultIcon.textContent = 'ğŸ’¡';
                resultText.textContent = 'ì•„ì‰½ë„¤ìš”! ì •ë‹µì„ í™•ì¸í•´ë³´ì„¸ìš”.';
                explanationDiv.className = 'mb-6 p-4 rounded-xl border-2 bg-blue-50 border-blue-200';
            }

            explanationText.textContent = explanation;
            explanationDiv.classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('next-section').classList.remove('hidden');
            }, 500);
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            currentQuestionIndex++;
            loadCurrentQuestion();
        }

        // í˜„ì¬ ê³¼ëª© ì™„ë£Œ
        function completeCurrentSubject() {
            const currentSubject = selectedSubjects[currentSubjectIndex];
            subjectStats[currentSubject].completed = true;
            
            showSubjectCompleteModal(currentSubject);
        }

        // ê³¼ëª© ì™„ë£Œ ëª¨ë‹¬ í‘œì‹œ
        function showSubjectCompleteModal(subject) {
            const subjectInfo = subjects[subject];
            const stats = subjectStats[subject];
            
            document.getElementById('completed-subject-icon').textContent = subjectInfo.icon;
            document.getElementById('completed-subject-name').textContent = `${subjectInfo.name} ì™„ë£Œ!`;
            
            const accuracy = Math.round((stats.correct / stats.total) * 100);
            document.getElementById('completed-subject-stats').textContent = 
                `${stats.total}ë¬¸ì œ ì¤‘ ${stats.correct}ë¬¸ì œ ì •ë‹µ (${accuracy}%)`;
            
            document.getElementById('subject-complete-modal').classList.remove('hidden');
        }

        // ë‹¤ìŒ ê³¼ëª© ê³„ì†
        function continueToNextSubject() {
            document.getElementById('subject-complete-modal').classList.add('hidden');
            
            currentSubjectIndex++;
            currentQuestionIndex = 0;
            
            if (currentSubjectIndex >= selectedSubjects.length) {
                completeAllSubjects();
            } else {
                loadCurrentQuestion();
            }
        }

        // ì „ì²´ ì™„ë£Œ
        function completeAllSubjects() {
            // ê²°ê³¼ ì €ì¥
            localStorage.setItem('quizResults', JSON.stringify({
                subjects: selectedSubjects,
                stats: subjectStats,
                completedAt: new Date().toISOString()
            }));
            
            alert('ëª¨ë“  ê³¼ëª© ì™„ë£Œ! ì‹ë¬¼ì´ ìëì–´ìš”! ğŸŒ±');
            window.location.href = 'index.html';
        }

        // TTS ì¬ìƒ
        function playTTS() {
            const currentSubject = selectedSubjects[currentSubjectIndex];
            const question = questions[currentSubject][currentQuestionIndex];
            
            if (question.audioText && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(question.audioText);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // ë‚˜ê°€ê¸° í™•ì¸
        function confirmExit() {
            if (confirm('í•™ìŠµì„ ì¤‘ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ ìƒí™©ì´ ì €ì¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                window.location.href = 'subject-select.html';
            }
        }

        // ì´ˆê¸°í™” ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', initializeQuiz);

        // ë’¤ë¡œê°€ê¸° ë°©ì§€
        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = '';
        });
    </script>
</body>
</html>