<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë””ë²„ê·¸ ì½˜ì†” - EduPet Collection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Courier New', monospace;
        }
        .log-entry {
            padding: 8px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 12px;
        }
        .log-error { background: #fee; color: #c00; }
        .log-warn { background: #fffbeb; color: #f59e0b; }
        .log-info { background: #eff6ff; color: #2563eb; }
        .log-success { background: #f0fdf4; color: #16a34a; }
        .log-default { background: white; color: #374151; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <!-- í—¤ë” -->
            <div class="bg-gray-800 text-white p-4 flex items-center justify-between">
                <div>
                    <h1 class="text-xl font-bold">ğŸ› ë””ë²„ê·¸ ì½˜ì†”</h1>
                    <p class="text-sm text-gray-300">ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§</p>
                </div>
                <div class="flex space-x-2">
                    <button onclick="copyAllLogs()" class="px-4 py-2 bg-green-500 hover:bg-green-600 rounded text-sm">
                        ğŸ“‹ ì „ì²´ ë³µì‚¬
                    </button>
                    <button onclick="copyVisibleLogs()" class="px-4 py-2 bg-teal-500 hover:bg-teal-600 rounded text-sm">
                        ğŸ“‹ ë³´ì´ëŠ” ê²ƒë§Œ ë³µì‚¬
                    </button>
                    <button onclick="clearLogs()" class="px-4 py-2 bg-red-500 hover:bg-red-600 rounded text-sm">
                        ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°
                    </button>
                    <button onclick="toggleAutoScroll()" id="autoscroll-btn" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded text-sm">
                        â¬‡ï¸ ìë™ ìŠ¤í¬ë¡¤: ON
                    </button>
                    <button onclick="window.location.href='index.html'" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded text-sm">
                        ğŸ  í™ˆìœ¼ë¡œ
                    </button>
                </div>
            </div>

            <!-- í•„í„° -->
            <div class="bg-gray-100 p-3 border-b border-gray-300 flex items-center space-x-3">
                <span class="text-sm font-medium">í•„í„°:</span>
                <label class="inline-flex items-center">
                    <input type="checkbox" id="filter-error" checked onchange="applyFilters()" class="mr-1">
                    <span class="text-sm">âŒ Error</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="checkbox" id="filter-warn" checked onchange="applyFilters()" class="mr-1">
                    <span class="text-sm">âš ï¸ Warn</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="checkbox" id="filter-info" checked onchange="applyFilters()" class="mr-1">
                    <span class="text-sm">â„¹ï¸ Info</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="checkbox" id="filter-log" checked onchange="applyFilters()" class="mr-1">
                    <span class="text-sm">ğŸ“ Log</span>
                </label>
                <input type="text" id="search-input" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..."
                    class="ml-auto px-3 py-1 border border-gray-300 rounded text-sm"
                    oninput="applyFilters()">
            </div>

            <!-- ë¡œê·¸ ì˜ì—­ -->
            <div id="log-container" class="h-[600px] overflow-y-auto bg-white">
                <div class="p-4 text-gray-400 text-center">
                    ë¡œê·¸ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...
                </div>
            </div>

            <!-- í•˜ë‹¨ ìƒíƒœë°” -->
            <div class="bg-gray-800 text-white p-2 text-xs flex items-center justify-between">
                <span id="log-count">ì´ ë¡œê·¸: 0ê°œ</span>
                <span id="timestamp">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</span>
            </div>
        </div>
    </div>

    <script>
        let logs = [];
        let autoScroll = true;
        const logContainer = document.getElementById('log-container');

        // ì›ë˜ console í•¨ìˆ˜ë“¤ ë°±ì—…
        const originalConsole = {
            log: console.log.bind(console),
            error: console.error.bind(console),
            warn: console.warn.bind(console),
            info: console.info.bind(console)
        };

        // console í•¨ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ
        function interceptConsole() {
            // localStorageì— console interceptor í™œì„±í™” í”Œë˜ê·¸ ì„¤ì •
            sessionStorage.setItem('debugConsoleActive', 'true');

            console.log = function(...args) {
                addLog('log', args);
                originalConsole.log(...args);
            };

            console.error = function(...args) {
                addLog('error', args);
                originalConsole.error(...args);
            };

            console.warn = function(...args) {
                addLog('warn', args);
                originalConsole.warn(...args);
            };

            console.info = function(...args) {
                addLog('info', args);
                originalConsole.info(...args);
            };

            // ìœˆë„ìš° ì—ëŸ¬ë„ ìº¡ì²˜
            window.addEventListener('error', function(event) {
                addLog('error', [event.message, event.filename, event.lineno]);
            });

            // Promise rejectionë„ ìº¡ì²˜
            window.addEventListener('unhandledrejection', function(event) {
                addLog('error', ['Unhandled Promise Rejection:', event.reason]);
            });
        }

        // ë¡œê·¸ ì¶”ê°€
        function addLog(type, args) {
            const timestamp = new Date().toLocaleTimeString('ko-KR', { hour12: false });
            const message = args.map(arg => {
                if (typeof arg === 'object') {
                    try {
                        return JSON.stringify(arg, null, 2);
                    } catch (e) {
                        return String(arg);
                    }
                }
                return String(arg);
            }).join(' ');

            const logEntry = {
                type,
                timestamp,
                message,
                id: Date.now() + Math.random()
            };

            logs.push(logEntry);

            // ìµœëŒ€ 1000ê°œê¹Œì§€ë§Œ ìœ ì§€
            if (logs.length > 1000) {
                logs.shift();
            }

            renderLog(logEntry);
            updateStats();

            if (autoScroll) {
                scrollToBottom();
            }
        }

        // ë¡œê·¸ ë Œë”ë§
        function renderLog(log) {
            const div = document.createElement('div');
            div.className = `log-entry log-${log.type}`;
            div.dataset.type = log.type;
            div.dataset.id = log.id;
            div.dataset.rawMessage = log.message; // ì›ë³¸ ë©”ì‹œì§€ ì €ì¥
            div.dataset.timestamp = log.timestamp;
            div.dataset.page = log.page || '';

            const icon = {
                error: 'âŒ',
                warn: 'âš ï¸',
                info: 'â„¹ï¸',
                log: 'ğŸ“'
            }[log.type] || 'ğŸ“';

            const displayTime = log.timestamp ? new Date(log.timestamp).toLocaleTimeString('ko-KR', { hour12: false }) : '';
            const pageName = log.page ? `[${log.page}]` : '';

            div.innerHTML = `
                <span class="font-bold">[${displayTime}]</span>
                ${pageName ? `<span class="text-xs text-gray-500">${pageName}</span>` : ''}
                <span>${icon}</span>
                <span class="ml-2" style="white-space: pre-wrap; word-break: break-all;">${escapeHtml(log.message)}</span>
            `;

            if (logContainer.firstChild && logContainer.firstChild.classList.contains('text-gray-400')) {
                logContainer.innerHTML = '';
            }

            logContainer.appendChild(div);
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLogs() {
            if (!confirm('ëª¨ë“  ë¡œê·¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            // ë©”ëª¨ë¦¬ì˜ ë¡œê·¸ ì§€ìš°ê¸°
            logs = [];

            // localStorageì˜ ë¡œê·¸ ì§€ìš°ê¸°
            localStorage.removeItem('eduPetDebugLogs');

            // í™”ë©´ ì´ˆê¸°í™”
            logContainer.innerHTML = '<div class="p-4 text-gray-400 text-center">ë¡œê·¸ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>';

            // í†µê³„ ì—…ë°ì´íŠ¸
            updateStats();

            // ì•Œë¦¼ í‘œì‹œ
            showCopyNotification('âœ… ëª¨ë“  ë¡œê·¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // ìë™ ìŠ¤í¬ë¡¤ í† ê¸€
        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const btn = document.getElementById('autoscroll-btn');
            btn.textContent = autoScroll ? 'â¬‡ï¸ ìë™ ìŠ¤í¬ë¡¤: ON' : 'â¬‡ï¸ ìë™ ìŠ¤í¬ë¡¤: OFF';
            btn.className = autoScroll ?
                'px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded text-sm' :
                'px-4 py-2 bg-gray-500 hover:bg-gray-600 rounded text-sm';
        }

        // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
        function scrollToBottom() {
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            const showError = document.getElementById('filter-error').checked;
            const showWarn = document.getElementById('filter-warn').checked;
            const showInfo = document.getElementById('filter-info').checked;
            const showLog = document.getElementById('filter-log').checked;
            const searchText = document.getElementById('search-input').value.toLowerCase();

            const entries = logContainer.querySelectorAll('.log-entry');
            entries.forEach(entry => {
                const type = entry.dataset.type;
                const text = entry.textContent.toLowerCase();

                const typeMatch = (
                    (type === 'error' && showError) ||
                    (type === 'warn' && showWarn) ||
                    (type === 'info' && showInfo) ||
                    (type === 'log' && showLog)
                );

                const searchMatch = searchText === '' || text.includes(searchText);

                entry.style.display = (typeMatch && searchMatch) ? 'block' : 'none';
            });
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('log-count').textContent = `ì´ ë¡œê·¸: ${logs.length}ê°œ`;
            document.getElementById('timestamp').textContent =
                `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString('ko-KR', { hour12: false })}`;
        }

        // ì „ì²´ ë¡œê·¸ ë³µì‚¬
        function copyAllLogs() {
            if (logs.length === 0) {
                alert('ë³µì‚¬í•  ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const text = logs.map(log => {
                const time = log.timestamp ? new Date(log.timestamp).toLocaleString('ko-KR') : '';
                const page = log.page ? `[${log.page}]` : '';
                const type = log.type.toUpperCase();
                return `[${time}] ${page} [${type}] ${log.message}`;
            }).join('\n');

            copyToClipboard(text, 'ì „ì²´ ë¡œê·¸');
        }

        // ë³´ì´ëŠ” ë¡œê·¸ë§Œ ë³µì‚¬
        function copyVisibleLogs() {
            const visibleEntries = Array.from(logContainer.querySelectorAll('.log-entry'))
                .filter(entry => entry.style.display !== 'none');

            if (visibleEntries.length === 0) {
                alert('ë³µì‚¬í•  ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const text = visibleEntries.map(entry => {
                const timestamp = entry.dataset.timestamp ? new Date(entry.dataset.timestamp).toLocaleString('ko-KR') : '';
                const page = entry.dataset.page ? `[${entry.dataset.page}]` : '';
                const type = entry.dataset.type.toUpperCase();
                const message = entry.dataset.rawMessage || entry.textContent;
                return `[${timestamp}] ${page} [${type}] ${message}`;
            }).join('\n');

            copyToClipboard(text, `ë³´ì´ëŠ” ë¡œê·¸ (${visibleEntries.length}ê°œ)`);
        }

        // í´ë¦½ë³´ë“œì— ë³µì‚¬
        function copyToClipboard(text, description) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showCopyNotification(`âœ… ${description}ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    })
                    .catch(err => {
                        console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                        fallbackCopy(text, description);
                    });
            } else {
                fallbackCopy(text, description);
            }
        }

        // í´ë°± ë³µì‚¬ ë°©ë²• (êµ¬í˜• ë¸Œë¼ìš°ì € ì§€ì›)
        function fallbackCopy(text, description) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.top = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();

            try {
                document.execCommand('copy');
                showCopyNotification(`âœ… ${description}ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            } catch (err) {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }

            document.body.removeChild(textarea);
        }

        // ë³µì‚¬ ì•Œë¦¼ í‘œì‹œ
        function showCopyNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in';
            notification.style.animation = 'fadeIn 0.3s ease-in-out';
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease-in-out';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // localStorageì—ì„œ ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadLogsFromStorage() {
            try {
                const stored = localStorage.getItem('eduPetDebugLogs');
                if (stored) {
                    const storedLogs = JSON.parse(stored);
                    logs = storedLogs;

                    // ëª¨ë“  ë¡œê·¸ ë Œë”ë§
                    logContainer.innerHTML = '';
                    storedLogs.forEach(log => {
                        renderLog(log);
                    });

                    updateStats();
                    if (autoScroll) {
                        scrollToBottom();
                    }
                }
            } catch (e) {
                console.error('ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }

        // ì£¼ê¸°ì ìœ¼ë¡œ ìƒˆ ë¡œê·¸ í™•ì¸
        function refreshLogs() {
            loadLogsFromStorage();
        }

        // ì´ˆê¸°í™”
        interceptConsole();
        loadLogsFromStorage();
        updateStats();

        // 2ì´ˆë§ˆë‹¤ ë¡œê·¸ ê°±ì‹ 
        setInterval(refreshLogs, 2000);

        // í…ŒìŠ¤íŠ¸ ë¡œê·¸
        setTimeout(() => {
            console.log('ë””ë²„ê·¸ ì½˜ì†”ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
            console.info('ëª¨ë“  console.log, console.error, console.warn, console.infoê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤');
            console.warn('ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ë°œìƒí•œ ë¡œê·¸ë„ 2ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤');
        }, 100);
    </script>
</body>
</html>
