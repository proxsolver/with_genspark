<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>식물 성장 단계 테스트</title>
    <script src="plant-system.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-result {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .plant-display {
            font-size: 48px;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>🌱 식물 성장 단계 테스트</h1>
    <button onclick="runTest()">테스트 시작</button>
    <button onclick="clearData()">데이터 초기화</button>
    <div id="results"></div>

    <script>
        function log(message, isSuccess = true) {
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.textContent = message;
            document.getElementById('results').appendChild(div);
        }

        function displayPlant(emoji, stage, water) {
            const div = document.createElement('div');
            div.className = 'plant-display';
            div.innerHTML = `
                <div>${emoji}</div>
                <div style="font-size: 16px;">Stage ${stage} | Water: ${water}</div>
            `;
            document.getElementById('results').appendChild(div);
        }

        function clearData() {
            localStorage.removeItem('plantSystemUser');
            localStorage.removeItem('plantSystemPlants');
            document.getElementById('results').innerHTML = '';
            log('✅ 데이터 초기화 완료');
        }

        function runTest() {
            document.getElementById('results').innerHTML = '';
            log('🧪 테스트 시작...');

            try {
                // 1. 사용자 생성
                const user = plantSystem.getUserData();
                log(`✅ 사용자 생성: ${user.userId}`);

                // 2. 씨앗 심기
                const plant = plantSystem.plantSeed(user.userId);
                log(`✅ 씨앗 심기 완료: ${plant.plantType} (Stage ${plant.stage})`);
                displayPlant(plant.plantType, plant.stage, plant.waterCount);

                // 3. Stage 0 → 1 (5회 물주기)
                log('💧 Stage 0 → 1: 5회 물주기 시작...');
                for (let i = 1; i <= 5; i++) {
                    const result = plantSystem.waterPlant(plant.plantId);
                    if (!result.success) {
                        log(`❌ 물주기 ${i}회 실패: ${result.message}`, false);
                        return;
                    }
                    log(`  ${i}회: 물 ${result.waterCount}, Stage ${result.stage}`);
                }

                let updatedPlant = plantSystem.getPlant(plant.plantId);
                log(`✅ Stage 1 도달: ${updatedPlant.plantType}`);
                displayPlant(updatedPlant.plantType, updatedPlant.stage, updatedPlant.waterCount);

                // 4. Stage 1 → 2 (10회 물주기)
                log('💧 Stage 1 → 2: 10회 물주기 시작...');
                for (let i = 1; i <= 10; i++) {
                    const result = plantSystem.waterPlant(plant.plantId);
                    if (!result.success) {
                        log(`❌ 물주기 ${i}회 실패: ${result.message}`, false);
                        return;
                    }
                    log(`  ${i}회: 물 ${result.waterCount}, Stage ${result.stage}`);
                }

                updatedPlant = plantSystem.getPlant(plant.plantId);
                log(`✅ Stage 2 도달: ${updatedPlant.plantType}`);
                displayPlant(updatedPlant.plantType, updatedPlant.stage, updatedPlant.waterCount);

                // 5. Stage 2 → 3 (15회 물주기)
                log('💧 Stage 2 → 3: 15회 물주기 시작...');
                for (let i = 1; i <= 15; i++) {
                    const result = plantSystem.waterPlant(plant.plantId);
                    if (!result.success) {
                        log(`❌ 물주기 ${i}회 실패: ${result.message}`, false);
                        return;
                    }
                    log(`  ${i}회: 물 ${result.waterCount}, Stage ${result.stage}, Status: ${result.status}`);
                }

                updatedPlant = plantSystem.getPlant(plant.plantId);
                log(`✅ Stage 3 도달 (완성): ${updatedPlant.plantType}, Status: ${updatedPlant.status}`);
                displayPlant(updatedPlant.plantType, updatedPlant.stage, updatedPlant.waterCount);

                // 6. 추가 물주기 시도 (실패해야 함)
                log('💧 완성된 식물에 물주기 시도...');
                const finalResult = plantSystem.waterPlant(plant.plantId);
                if (!finalResult.success) {
                    log(`✅ 예상대로 실패: ${finalResult.message}`);
                } else {
                    log('❌ 완성된 식물에 물을 줄 수 있으면 안됨!', false);
                }

                log('🎉 모든 테스트 통과!');

            } catch (error) {
                log(`❌ 오류 발생: ${error.message}`, false);
                console.error(error);
            }
        }
    </script>
</body>
</html>
