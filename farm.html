<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë†ì¥ ê´€ë¦¬ - EduPet Collection</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í•œê¸€ í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .font-game {
            font-family: 'Noto Sans KR', 'Comic Sans MS', cursive;
            font-weight: 600;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, 
                rgba(76, 175, 80, 0.1) 0%, 
                rgba(255, 152, 0, 0.1) 50%, 
                rgba(33, 150, 243, 0.1) 100%
            );
        }
        
        .plant-slot {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .plant-slot:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .plant-growing {
            animation: grow 2s ease-in-out infinite alternate;
        }
        
        @keyframes grow {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        .plant-mature {
            animation: sparkle 1.5s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
        }
        
        .coin-animation {
            animation: coinFlip 0.6s ease-out;
        }
        
        @keyframes coinFlip {
            0% { transform: scale(1) rotateY(0deg); }
            50% { transform: scale(1.5) rotateY(180deg); }
            100% { transform: scale(1) rotateY(360deg); }
        }
        
        .threat-pulse {
            animation: threatPulse 1s ease-in-out infinite;
        }
        
        @keyframes threatPulse {
            0%, 100% { background-color: rgba(239, 68, 68, 0.1); }
            50% { background-color: rgba(239, 68, 68, 0.3); }
        }
    </style>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 500: '#4CAF50', 600: '#16a34a' },
                        secondary: { 500: '#FF9800', 600: '#ea580c' }
                    }
                }
            }
        }
    </script>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- í—¤ë” -->
        <div class="flex items-center justify-between mb-6">
            <button onclick="window.location.href='index.html'" class="flex items-center space-x-2 p-3 bg-white rounded-xl shadow-md hover:shadow-lg transition-all">
                <span>â†</span>
                <span>í™ˆìœ¼ë¡œ</span>
            </button>
            
            <div class="text-center">
                <h1 class="text-2xl font-bold text-gray-900 font-game">ğŸŒ± ì´ˆë¡±ì´ì˜ ë†ì¥</h1>
                <p class="text-sm text-gray-600">í•™ìŠµìœ¼ë¡œ í‚¤ìš°ëŠ” ìŠ¤ë§ˆíŠ¸ ë†ì¥</p>
            </div>
            
            <div class="text-right">
                <div class="flex items-center space-x-2 text-yellow-600 font-bold">
                    <span>ğŸ’°</span>
                    <span id="coin-count">1,250</span>
                </div>
                <div class="text-xs text-gray-500">EduCoin</div>
            </div>
        </div>

        <!-- ë†ì¥ ìƒíƒœ ìš”ì•½ -->
        <div class="bg-white rounded-xl p-4 mb-6 shadow-md">
            <div class="grid grid-cols-3 gap-4 text-center">
                <div class="p-3 bg-green-50 rounded-lg">
                    <div class="text-2xl font-bold text-green-600" id="total-plants">8</div>
                    <div class="text-xs text-green-700">ì´ ì‹ë¬¼</div>
                </div>
                <div class="p-3 bg-blue-50 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600" id="mature-plants">3</div>
                    <div class="text-xs text-blue-700">ìˆ˜í™• ê°€ëŠ¥</div>
                </div>
                <div class="p-3 bg-red-50 rounded-lg">
                    <div class="text-2xl font-bold text-red-600" id="threatened-plants">2</div>
                    <div class="text-xs text-red-700">ìœ„í—˜ ìƒíƒœ</div>
                </div>
            </div>
        </div>

        <!-- ìœ„í—˜ ì•Œë¦¼ -->
        <div id="threat-alert" class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6 threat-pulse">
            <div class="flex items-center space-x-3">
                <span class="text-2xl">âš ï¸</span>
                <div>
                    <h3 class="font-bold text-red-900">ë†ì¥ì— í•´ì¶©ì´ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤!</h3>
                    <p class="text-sm text-red-700">ë™ë¬¼ë“¤ì„ ë³´ë‚´ì„œ ì‹ë¬¼ì„ ë³´í˜¸í•˜ì„¸ìš”. ë°©ì¹˜í•˜ë©´ ìˆ˜í™•ëŸ‰ì´ ê°ì†Œí•©ë‹ˆë‹¤.</p>
                </div>
                <button onclick="openAnimalDefense()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all">
                    ë™ë¬¼ ë³´ë‚´ê¸°
                </button>
            </div>
        </div>

        <!-- ë†ì¥ ê·¸ë¦¬ë“œ -->
        <div class="bg-white rounded-xl p-6 mb-6 shadow-md">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-gray-900">ğŸ¡ ë†ì¥ í˜„í™©</h2>
                <button onclick="openPlantShop()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all">
                    ì”¨ì•— êµ¬ë§¤
                </button>
            </div>
            
            <div class="grid grid-cols-4 md:grid-cols-6 gap-3" id="farm-grid">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ë™ë¬¼ ì»¬ë ‰ì…˜ -->
        <div class="bg-white rounded-xl p-6 mb-6 shadow-md">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-gray-900">ğŸ¦ ë™ë¬¼ ì»¬ë ‰ì…˜</h2>
                <button onclick="openAnimalGacha()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all">
                    ë™ë¬¼ ë½‘ê¸°
                </button>
            </div>
            
            <div class="grid grid-cols-5 md:grid-cols-8 gap-3" id="animal-collection">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- í•˜ë£¨ ìˆ˜í™• ìš”ì•½ -->
        <div class="bg-white rounded-xl p-6 shadow-md">
            <h2 class="text-lg font-bold text-gray-900 mb-4">ğŸ“Š ì˜¤ëŠ˜ì˜ ìˆ˜í™•</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-yellow-50 rounded-lg">
                    <div class="text-3xl mb-2">ğŸ</div>
                    <div class="font-bold text-yellow-800">150 ì½”ì¸</div>
                    <div class="text-xs text-yellow-600">ì‚¬ê³¼ 3ê°œ</div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded-lg">
                    <div class="text-3xl mb-2">ğŸ¥•</div>
                    <div class="font-bold text-orange-800">80 ì½”ì¸</div>
                    <div class="text-xs text-orange-600">ë‹¹ê·¼ 2ê°œ</div>
                </div>
                <div class="text-center p-4 bg-red-50 rounded-lg">
                    <div class="text-3xl mb-2">ğŸ…</div>
                    <div class="font-bold text-red-800">200 ì½”ì¸</div>
                    <div class="text-xs text-red-600">í† ë§ˆí†  4ê°œ</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <div class="text-3xl mb-2">ğŸ’°</div>
                    <div class="font-bold text-green-800">430 ì½”ì¸</div>
                    <div class="text-xs text-green-600">ì´ ìˆ˜ìµ</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì”¨ì•— êµ¬ë§¤ ëª¨ë‹¬ -->
    <div id="plant-shop-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full max-h-96 overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold">ğŸŒ± ì”¨ì•— ìƒì </h3>
                <button onclick="closePlantShop()" class="text-gray-400 hover:text-gray-600">âœ•</button>
            </div>
            <div class="space-y-3" id="plant-shop-items">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ë™ë¬¼ ê°€ì±  ëª¨ë‹¬ -->
    <div id="animal-gacha-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold">ğŸ² ë™ë¬¼ ë½‘ê¸°</h3>
                <button onclick="closeAnimalGacha()" class="text-gray-400 hover:text-gray-600">âœ•</button>
            </div>
            <div class="text-center mb-4">
                <div class="text-6xl mb-4" id="gacha-result">ğŸ</div>
                <p class="text-gray-600 mb-4">100 EduCoinìœ¼ë¡œ ëœë¤ ë™ë¬¼ì„ íšë“í•˜ì„¸ìš”!</p>
                <button onclick="drawAnimal()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all font-bold">
                    ë™ë¬¼ ë½‘ê¸° (100 ì½”ì¸)
                </button>
            </div>
            <div class="text-xs text-gray-500 space-y-1">
                <div>â€¢ ì¼ë°˜ (60%): ë³‘ì•„ë¦¬, í† ë¼, í–„ìŠ¤í„°</div>
                <div>â€¢ ë ˆì–´ (30%): ê³ ì–‘ì´, ê°•ì•„ì§€, ì•µë¬´ìƒˆ</div>
                <div>â€¢ ì—í”½ (9%): íŒ¬ë”, ì—¬ìš°, ë¶€ì—‰ì´</div>
                <div>â€¢ ë ˆì „ë“œ (1%): ìœ ë‹ˆì½˜, ìš©, ë¶ˆì‚¬ì¡°</div>
            </div>
        </div>
    </div>

    <!-- ë™ë¬¼ ë°©ì–´ ëª¨ë‹¬ -->
    <div id="animal-defense-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold">ğŸ›¡ï¸ ì‹ë¬¼ ë³´í˜¸</h3>
                <button onclick="closeAnimalDefense()" class="text-gray-400 hover:text-gray-600">âœ•</button>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-4">ë™ë¬¼ì„ ë³´ë‚´ì„œ í•´ì¶©ì„ ë¬¼ë¦¬ì¹˜ì„¸ìš”. ë³´ë‚¸ ë™ë¬¼ì€ ì‚¬ë¼ì§€ì§€ë§Œ ì‹ë¬¼ì„ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <div class="grid grid-cols-3 gap-3" id="available-animals">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            <div class="text-xs text-gray-500">
                ğŸ’¡ íŒ: ê°•í•œ ë™ë¬¼ì¼ìˆ˜ë¡ ë” ë§ì€ ì‹ë¬¼ì„ ë³´í˜¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ê²Œì„ ìƒíƒœ ê´€ë¦¬
        let gameState = {
            coins: 1250,
            plants: [],
            animals: [],
            farmSlots: 24, // 4x6 ê·¸ë¦¬ë“œ
            threats: []
        };

        // ì‹ë¬¼ ë°ì´í„°
        const plantData = {
            tomato: { name: 'í† ë§ˆí† ', icon: 'ğŸ…', price: 50, growTime: 180, value: 80, rarity: 'common' },
            carrot: { name: 'ë‹¹ê·¼', icon: 'ğŸ¥•', price: 30, growTime: 120, value: 50, rarity: 'common' },
            apple: { name: 'ì‚¬ê³¼', icon: 'ğŸ', price: 100, growTime: 300, value: 150, rarity: 'rare' },
            corn: { name: 'ì˜¥ìˆ˜ìˆ˜', icon: 'ğŸŒ½', price: 70, growTime: 240, value: 100, rarity: 'common' },
            strawberry: { name: 'ë”¸ê¸°', icon: 'ğŸ“', price: 80, growTime: 200, value: 120, rarity: 'rare' },
            kiwi: { name: 'í‚¤ìœ„', icon: 'ğŸ¥', price: 200, growTime: 600, value: 350, rarity: 'epic' }
        };

        // ë™ë¬¼ ë°ì´í„°
        const animalData = {
            // ì¼ë°˜ (60%)
            chick: { name: 'ë³‘ì•„ë¦¬', icon: 'ğŸ¤', rarity: 'common', power: 1 },
            rabbit: { name: 'í† ë¼', icon: 'ğŸ°', rarity: 'common', power: 1 },
            hamster: { name: 'í–„ìŠ¤í„°', icon: 'ğŸ¹', rarity: 'common', power: 1 },
            
            // ë ˆì–´ (30%)
            cat: { name: 'ê³ ì–‘ì´', icon: 'ğŸ±', rarity: 'rare', power: 2 },
            dog: { name: 'ê°•ì•„ì§€', icon: 'ğŸ¶', rarity: 'rare', power: 2 },
            parrot: { name: 'ì•µë¬´ìƒˆ', icon: 'ğŸ¦œ', rarity: 'rare', power: 2 },
            
            // ì—í”½ (9%)
            panda: { name: 'íŒ¬ë”', icon: 'ğŸ¼', rarity: 'epic', power: 4 },
            fox: { name: 'ì—¬ìš°', icon: 'ğŸ¦Š', rarity: 'epic', power: 4 },
            owl: { name: 'ë¶€ì—‰ì´', icon: 'ğŸ¦‰', rarity: 'epic', power: 4 },
            
            // ë ˆì „ë“œ (1%)
            unicorn: { name: 'ìœ ë‹ˆì½˜', icon: 'ğŸ¦„', rarity: 'legendary', power: 10 },
            dragon: { name: 'ìš©', icon: 'ğŸ‰', rarity: 'legendary', power: 10 },
            phoenix: { name: 'ë¶ˆì‚¬ì¡°', icon: 'ğŸ”¥', rarity: 'legendary', power: 10 }
        };

        // ì´ˆê¸°í™”
        function initializeFarm() {
            // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
            gameState.plants = [
                { id: 1, type: 'tomato', slot: 0, plantedAt: Date.now() - 120000, threatened: false },
                { id: 2, type: 'carrot', slot: 2, plantedAt: Date.now() - 80000, threatened: true },
                { id: 3, type: 'apple', slot: 5, plantedAt: Date.now() - 200000, threatened: false },
                { id: 4, type: 'corn', slot: 8, plantedAt: Date.now() - 160000, threatened: true },
                { id: 5, type: 'strawberry', slot: 12, plantedAt: Date.now() - 150000, threatened: false },
                { id: 6, type: 'kiwi', slot: 15, plantedAt: Date.now() - 400000, threatened: false },
                { id: 7, type: 'tomato', slot: 18, plantedAt: Date.now() - 190000, threatened: false },
                { id: 8, type: 'carrot', slot: 21, plantedAt: Date.now() - 130000, threatened: false }
            ];

            gameState.animals = [
                { id: 1, type: 'chick', acquired: true },
                { id: 2, type: 'rabbit', acquired: true },
                { id: 3, type: 'cat', acquired: true },
                { id: 4, type: 'dog', acquired: true },
                { id: 5, type: 'panda', acquired: true },
                { id: 6, type: 'hamster', acquired: true },
                { id: 7, type: 'parrot', acquired: true }
            ];

            renderFarm();
            renderAnimals();
            updateStats();
            loadGameState();
        }

        // ë†ì¥ ë Œë”ë§
        function renderFarm() {
            const farmGrid = document.getElementById('farm-grid');
            farmGrid.innerHTML = '';

            for (let i = 0; i < gameState.farmSlots; i++) {
                const plant = gameState.plants.find(p => p.slot === i);
                const slot = document.createElement('div');
                
                if (plant) {
                    const plantInfo = plantData[plant.type];
                    const growthTime = Date.now() - plant.plantedAt;
                    const progress = Math.min(growthTime / (plantInfo.growTime * 1000), 1);
                    const isMatured = progress >= 1;
                    
                    slot.className = `plant-slot aspect-square bg-green-100 rounded-lg border-2 border-green-200 flex flex-col items-center justify-center p-2 ${
                        plant.threatened ? 'border-red-400 bg-red-50' : ''
                    } ${
                        isMatured ? 'plant-mature' : (progress > 0.3 ? 'plant-growing' : '')
                    }`;
                    
                    slot.innerHTML = `
                        <div class="text-2xl mb-1">${plantInfo.icon}</div>
                        <div class="text-xs font-medium text-center">${plantInfo.name}</div>
                        ${plant.threatened ? '<div class="text-xs text-red-600">âš ï¸ ìœ„í—˜</div>' : ''}
                        <div class="w-full bg-gray-200 rounded-full h-1 mt-1">
                            <div class="bg-green-500 h-1 rounded-full transition-all" style="width: ${progress * 100}%"></div>
                        </div>
                        ${isMatured ? '<div class="text-xs text-green-600 mt-1">ìˆ˜í™•ê°€ëŠ¥</div>' : ''}
                    `;
                    
                    if (isMatured) {
                        slot.onclick = () => harvestPlant(plant.id);
                    }
                } else {
                    slot.className = 'plant-slot aspect-square bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center';
                    slot.innerHTML = '<span class="text-gray-400 text-2xl">+</span>';
                    slot.onclick = () => openPlantShop();
                }
                
                farmGrid.appendChild(slot);
            }
        }

        // ë™ë¬¼ ì»¬ë ‰ì…˜ ë Œë”ë§
        function renderAnimals() {
            const animalCollection = document.getElementById('animal-collection');
            animalCollection.innerHTML = '';

            Object.keys(animalData).forEach(type => {
                const animal = animalData[type];
                const owned = gameState.animals.filter(a => a.type === type && a.acquired);
                const slot = document.createElement('div');
                
                slot.className = `aspect-square rounded-lg border-2 flex flex-col items-center justify-center p-2 cursor-pointer transition-all ${
                    owned.length > 0 ? `rarity-${animal.rarity}` : 'bg-gray-100 border-gray-300'
                }`;
                
                slot.innerHTML = `
                    <div class="text-2xl">${owned.length > 0 ? animal.icon : 'â“'}</div>
                    <div class="text-xs font-medium text-center mt-1">${owned.length > 0 ? animal.name : '???'}</div>
                    ${owned.length > 1 ? `<div class="text-xs font-bold text-blue-600">Ã—${owned.length}</div>` : ''}
                `;
                
                animalCollection.appendChild(slot);
            });
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const totalPlants = gameState.plants.length;
            const maturePlants = gameState.plants.filter(p => {
                const plantInfo = plantData[p.type];
                const growthTime = Date.now() - p.plantedAt;
                return growthTime >= plantInfo.growTime * 1000;
            }).length;
            const threatenedPlants = gameState.plants.filter(p => p.threatened).length;

            document.getElementById('total-plants').textContent = totalPlants;
            document.getElementById('mature-plants').textContent = maturePlants;
            document.getElementById('threatened-plants').textContent = threatenedPlants;
            document.getElementById('coin-count').textContent = gameState.coins.toLocaleString();

            // ìœ„í—˜ ì•Œë¦¼ í‘œì‹œ/ìˆ¨ê¹€
            document.getElementById('threat-alert').style.display = threatenedPlants > 0 ? 'block' : 'none';
        }

        // ì‹ë¬¼ ìˆ˜í™•
        function harvestPlant(plantId) {
            const plant = gameState.plants.find(p => p.id === plantId);
            if (!plant) return;

            const plantInfo = plantData[plant.type];
            const coins = Math.floor(plantInfo.value * (plant.threatened ? 0.5 : 1)); // ìœ„í—˜ìƒíƒœë©´ 50% ê°ì†Œ
            
            gameState.coins += coins;
            gameState.plants = gameState.plants.filter(p => p.id !== plantId);
            
            // ì½”ì¸ ì• ë‹ˆë©”ì´ì…˜
            const coinElement = document.getElementById('coin-count');
            coinElement.classList.add('coin-animation');
            setTimeout(() => coinElement.classList.remove('coin-animation'), 600);

            renderFarm();
            updateStats();
            saveGameState();
            
            // ì„±ê³µ ë©”ì‹œì§€
            alert(`${plantInfo.name}ì„ ìˆ˜í™•í–ˆìŠµë‹ˆë‹¤! +${coins} EduCoin`);
        }

        // ì”¨ì•— ìƒì  ì—´ê¸°
        function openPlantShop() {
            const modal = document.getElementById('plant-shop-modal');
            const itemsContainer = document.getElementById('plant-shop-items');
            
            itemsContainer.innerHTML = '';
            
            Object.keys(plantData).forEach(type => {
                const plant = plantData[type];
                const item = document.createElement('div');
                
                item.className = `flex items-center justify-between p-3 border rounded-lg cursor-pointer hover:bg-gray-50 ${
                    gameState.coins >= plant.price ? 'border-green-300' : 'border-gray-300 opacity-50'
                }`;
                
                item.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl">${plant.icon}</span>
                        <div>
                            <div class="font-medium">${plant.name}</div>
                            <div class="text-xs text-gray-500">${Math.floor(plant.growTime / 60)}ë¶„ ì„±ì¥</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-yellow-600">${plant.price} ì½”ì¸</div>
                        <div class="text-xs text-gray-500">${plant.value} ì½”ì¸ ìˆ˜ìµ</div>
                    </div>
                `;
                
                if (gameState.coins >= plant.price) {
                    item.onclick = () => buyPlant(type);
                }
                
                itemsContainer.appendChild(item);
            });
            
            modal.classList.remove('hidden');
        }

        function closePlantShop() {
            document.getElementById('plant-shop-modal').classList.add('hidden');
        }

        // ì‹ë¬¼ êµ¬ë§¤
        function buyPlant(type) {
            const plant = plantData[type];
            if (gameState.coins < plant.price) return;

            // ë¹ˆ ìŠ¬ë¡¯ ì°¾ê¸°
            const emptySlot = Array.from({length: gameState.farmSlots}, (_, i) => i)
                .find(slot => !gameState.plants.some(p => p.slot === slot));
            
            if (emptySlot === undefined) {
                alert('ë†ì¥ì— ë¹ˆ ìë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }

            gameState.coins -= plant.price;
            gameState.plants.push({
                id: Date.now(),
                type: type,
                slot: emptySlot,
                plantedAt: Date.now(),
                threatened: false
            });

            closePlantShop();
            renderFarm();
            updateStats();
            saveGameState();
        }

        // ë™ë¬¼ ê°€ì±  ì—´ê¸°
        function openAnimalGacha() {
            document.getElementById('animal-gacha-modal').classList.remove('hidden');
            document.getElementById('gacha-result').textContent = 'ğŸ';
        }

        function closeAnimalGacha() {
            document.getElementById('animal-gacha-modal').classList.add('hidden');
        }

        // ë™ë¬¼ ë½‘ê¸°
        function drawAnimal() {
            if (gameState.coins < 100) {
                alert('ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
                return;
            }

            gameState.coins -= 100;

            // í™•ë¥  ê³„ì‚°
            const rand = Math.random();
            let animalType;
            
            if (rand < 0.6) { // 60% ì¼ë°˜
                const commons = ['chick', 'rabbit', 'hamster'];
                animalType = commons[Math.floor(Math.random() * commons.length)];
            } else if (rand < 0.9) { // 30% ë ˆì–´
                const rares = ['cat', 'dog', 'parrot'];
                animalType = rares[Math.floor(Math.random() * rares.length)];
            } else if (rand < 0.99) { // 9% ì—í”½
                const epics = ['panda', 'fox', 'owl'];
                animalType = epics[Math.floor(Math.random() * epics.length)];
            } else { // 1% ë ˆì „ë“œ
                const legendaries = ['unicorn', 'dragon', 'phoenix'];
                animalType = legendaries[Math.floor(Math.random() * legendaries.length)];
            }

            const animal = animalData[animalType];
            gameState.animals.push({
                id: Date.now(),
                type: animalType,
                acquired: true
            });

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('gacha-result').textContent = animal.icon;
            
            setTimeout(() => {
                alert(`${animal.name}ì„ íšë“í–ˆìŠµë‹ˆë‹¤! (${animal.rarity})`);
                renderAnimals();
                updateStats();
                saveGameState();
            }, 500);
        }

        // ë™ë¬¼ ë°©ì–´ ì‹œìŠ¤í…œ ì—´ê¸°
        function openAnimalDefense() {
            const modal = document.getElementById('animal-defense-modal');
            const availableAnimals = document.getElementById('available-animals');
            
            availableAnimals.innerHTML = '';
            
            // ë³´ìœ í•œ ë™ë¬¼ë“¤ í‘œì‹œ
            const uniqueAnimals = [...new Set(gameState.animals.filter(a => a.acquired).map(a => a.type))];
            
            uniqueAnimals.forEach(type => {
                const animal = animalData[type];
                const count = gameState.animals.filter(a => a.type === type && a.acquired).length;
                const item = document.createElement('div');
                
                item.className = `text-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 ${
                    count > 0 ? `rarity-${animal.rarity}` : 'border-gray-300 opacity-50'
                }`;
                
                item.innerHTML = `
                    <div class="text-2xl mb-1">${animal.icon}</div>
                    <div class="text-xs font-medium">${animal.name}</div>
                    <div class="text-xs text-gray-500">Ã—${count}</div>
                    <div class="text-xs font-bold text-blue-600">ë°©ì–´ë ¥ ${animal.power}</div>
                `;
                
                if (count > 0) {
                    item.onclick = () => useAnimalForDefense(type);
                }
                
                availableAnimals.appendChild(item);
            });
            
            modal.classList.remove('hidden');
        }

        function closeAnimalDefense() {
            document.getElementById('animal-defense-modal').classList.add('hidden');
        }

        // ë™ë¬¼ë¡œ ë°©ì–´í•˜ê¸°
        function useAnimalForDefense(animalType) {
            const animal = animalData[animalType];
            const ownedAnimal = gameState.animals.find(a => a.type === animalType && a.acquired);
            
            if (!ownedAnimal) return;

            // ë™ë¬¼ ì œê±° (í¬ìƒ)
            const animalIndex = gameState.animals.findIndex(a => a.type === animalType && a.acquired);
            gameState.animals.splice(animalIndex, 1);

            // ìœ„í—˜ ìƒíƒœì¸ ì‹ë¬¼ë“¤ì„ ë°©ì–´ë ¥ë§Œí¼ ì¹˜ë£Œ
            const threatenedPlants = gameState.plants.filter(p => p.threatened);
            const plantsToSave = threatenedPlants.slice(0, animal.power);
            
            plantsToSave.forEach(plant => {
                plant.threatened = false;
            });

            closeAnimalDefense();
            renderFarm();
            renderAnimals();
            updateStats();
            saveGameState();

            alert(`${animal.name}ì´ ${plantsToSave.length}ê°œì˜ ì‹ë¬¼ì„ êµ¬í–ˆìŠµë‹ˆë‹¤! ë™ë¬¼ì€ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤.`);
        }

        // ê²Œì„ ìƒíƒœ ì €ì¥/ë¡œë“œ
        function saveGameState() {
            localStorage.setItem('eduPetFarmState', JSON.stringify(gameState));
        }

        function loadGameState() {
            const saved = localStorage.getItem('eduPetFarmState');
            if (saved) {
                const savedState = JSON.parse(saved);
                gameState = { ...gameState, ...savedState };
                updateStats();
            }
        }

        // ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ìœ„í˜‘ ì‹œë®¬ë ˆì´ì…˜
        function simulateThreats() {
            // 5% í™•ë¥ ë¡œ ëœë¤ ì‹ë¬¼ì— ìœ„í˜‘ ë°œìƒ
            if (Math.random() < 0.05 && gameState.plants.length > 0) {
                const healthyPlants = gameState.plants.filter(p => !p.threatened);
                if (healthyPlants.length > 0) {
                    const randomPlant = healthyPlants[Math.floor(Math.random() * healthyPlants.length)];
                    randomPlant.threatened = true;
                    renderFarm();
                    updateStats();
                    saveGameState();
                }
            }
        }

        // ì´ˆê¸°í™” ë° ì •ê¸° ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            initializeFarm();
            
            // 30ì´ˆë§ˆë‹¤ ìœ„í˜‘ ì‹œë®¬ë ˆì´ì…˜ ë° í™”ë©´ ì—…ë°ì´íŠ¸
            setInterval(() => {
                simulateThreats();
                renderFarm(); // ì„±ì¥ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            }, 30000);
            
            // 5ì´ˆë§ˆë‹¤ í™”ë©´ ì—…ë°ì´íŠ¸ (ì„±ì¥ ì§„í–‰ë¥ )
            setInterval(() => {
                renderFarm();
            }, 5000);
        });
    </script>
</body>
</html>