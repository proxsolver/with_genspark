<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì ì‘í˜• í•™ìŠµ - EduPet Collection</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í•œê¸€ í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .font-game {
            font-family: 'Noto Sans KR', 'Comic Sans MS', cursive;
            font-weight: 600;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, 
                rgba(76, 175, 80, 0.1) 0%, 
                rgba(255, 152, 0, 0.1) 50%, 
                rgba(33, 150, 243, 0.1) 100%
            );
        }
        
        .option-btn {
            transition: all 0.2s ease;
        }
        
        .option-btn:hover {
            transform: scale(1.02);
        }
        
        .option-btn.correct {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .option-btn.incorrect {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-color: #ef4444;
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .option-btn.neutral {
            background-color: #e5e7eb;
            border-color: #e5e7eb;
            color: #6b7280;
        }
        
        .correct-animation {
            animation: gentleBounce 0.6s ease-out;
        }
        
        @keyframes gentleBounce {
            0% { transform: scale(1); }
            30% { transform: scale(1.08); }
            60% { transform: scale(0.98); }
            100% { transform: scale(1.02); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-fill {
            transition: width 0.8s ease-out;
        }
        
        .difficulty-badge {
            position: relative;
        }
        
        .difficulty-badge.easy {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        
        .difficulty-badge.medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .difficulty-badge.hard {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .achievement-popup {
            animation: achievementSlide 2s ease-out;
        }
        
        @keyframes achievementSlide {
            0% { transform: translateY(-100px); opacity: 0; }
            20% { transform: translateY(0); opacity: 1; }
            80% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
    </style>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 500: '#4CAF50', 600: '#16a34a' },
                        secondary: { 500: '#FF9800', 600: '#ea580c' }
                    }
                }
            }
        }
    </script>
</head>
<body class="gradient-bg min-h-screen">
    <!-- ì„±ì·¨ ì•Œë¦¼ -->
    <div id="achievement-popup" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 hidden">
        <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-6 py-3 rounded-full shadow-lg achievement-popup">
            <div class="flex items-center space-x-2">
                <span class="text-lg">ğŸ†</span>
                <span class="font-bold" id="achievement-text">ë‚œì´ë„ ìƒìŠ¹!</span>
            </div>
        </div>
    </div>

    <!-- í€´ì¦ˆ ì»¨í…Œì´ë„ˆ -->
    <div class="container mx-auto px-4 py-6 max-w-2xl">
        <!-- í—¤ë” -->
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-3">
                <button onclick="confirmExit()" class="p-2 rounded-lg hover:bg-white hover:shadow-md transition-all">
                    â† ë‚˜ê°€ê¸°
                </button>
                <div class="flex items-center space-x-2">
                    <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium" id="current-subject">
                        ğŸ‡ºğŸ‡¸ ì˜ì–´
                    </span>
                    <span class="px-2 py-1 rounded-full text-xs font-medium difficulty-badge" id="difficulty-badge">
                        ì‰¬ì›€
                    </span>
                </div>
            </div>
            
            <div class="text-right">
                <div class="flex items-center justify-end space-x-2 mb-2">
                    <button onclick="toggleVibration()" id="vibration-toggle" 
                            class="p-2 rounded-lg transition-all text-sm" 
                            title="ì§„ë™ ì„¤ì •">
                        ğŸ“³
                    </button>
                </div>
                <div class="text-xs text-gray-500 mb-1">ëª©í‘œ ì‹œê°„</div>
                <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium" id="target-time">
                    10ë¶„
                </span>
            </div>
        </div>

        <!-- ì§„í–‰ë¥  ë° í†µê³„ -->
        <div class="bg-white rounded-xl p-4 mb-6 shadow-md">
            <!-- ì „ì²´ ì§„í–‰ë¥  -->
            <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-medium text-gray-700">í•™ìŠµ ì§„í–‰ë¥ </span>
                <span class="text-sm font-bold text-primary-600" id="overall-progress">1 / 30 ë¬¸ì œ</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                <div class="bg-primary-500 h-3 rounded-full progress-fill" id="overall-progress-bar" style="width: 3.33%;"></div>
            </div>
            
            <!-- ë‚œì´ë„ë³„ í˜„í™© -->
            <div class="grid grid-cols-3 gap-3 text-center">
                <div class="p-3 bg-green-50 rounded-lg border border-green-200" id="easy-status">
                    <div class="text-lg font-bold text-green-600">0/30</div>
                    <div class="text-xs text-green-700">ì‰¬ì›€ (20ì´ˆ/ë¬¸ì œ)</div>
                </div>
                <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-200" id="medium-status">
                    <div class="text-lg font-bold text-yellow-600">0/20</div>
                    <div class="text-xs text-yellow-700">ë³´í†µ (22.5ì´ˆ/ë¬¸ì œ)</div>
                </div>
                <div class="p-3 bg-red-50 rounded-lg border border-red-200" id="hard-status">
                    <div class="text-lg font-bold text-red-600">0/10</div>
                    <div class="text-xs text-red-700">ì–´ë ¤ì›€ (45ì´ˆ/ë¬¸ì œ)</div>
                </div>
            </div>
        </div>

        <!-- í€´ì¦ˆ ì¹´ë“œ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 slide-in" id="quiz-card">
            <!-- ë¬¸ì œ -->
            <div class="mb-6">
                <div class="flex items-start justify-between">
                    <h2 class="text-xl font-bold text-gray-900 mb-4 flex-1" id="question-text">
                        ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </h2>
                    
                    <!-- TTS ë²„íŠ¼ -->
                    <button id="tts-btn" onclick="playTTS()" class="ml-4 px-3 py-1 border-2 border-primary-500 text-primary-500 rounded-lg text-sm hover:bg-primary-500 hover:text-white transition-all hidden">
                        ğŸ”Š ë°œìŒ
                    </button>
                </div>
            </div>

            <!-- ë³´ê¸° -->
            <div class="space-y-3 mb-6" id="options-container">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <!-- í•´ì„¤ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
            <div id="explanation" class="hidden mb-6">
                <div class="p-4 rounded-xl border-2 bg-green-50 border-green-200">
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl" id="result-icon">ğŸ‰</span>
                        <div>
                            <h4 class="font-bold text-gray-900 mb-2" id="result-text">ì •ë‹µì…ë‹ˆë‹¤!</h4>
                            <p class="text-gray-700 leading-relaxed" id="explanation-text">
                                í•´ì„¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë‹¤ìŒ/ì™„ë£Œ ë²„íŠ¼ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
            <div id="next-section" class="hidden text-center">
                <button onclick="nextQuestion()" class="px-8 py-3 bg-primary-500 text-white rounded-xl text-lg font-bold hover:bg-primary-600 transition-all" id="next-btn">
                    ë‹¤ìŒ ë¬¸ì œ â¡ï¸
                </button>
            </div>
        </div>

        <!-- í•™ìŠµ í†µê³„ -->
        <div class="bg-white rounded-xl shadow-lg p-4">
            <div class="flex items-center justify-between mb-3">
                <span class="font-medium text-gray-700">í˜„ì¬ ì„¸ì…˜ í†µê³„</span>
                <span class="text-sm text-blue-600" id="session-accuracy">ì •ë‹µë¥  0%</span>
            </div>
            <div class="grid grid-cols-4 gap-4 text-center">
                <div>
                    <div class="text-xl font-bold text-green-600" id="total-correct">0</div>
                    <div class="text-xs text-gray-600">ì •ë‹µ</div>
                </div>
                <div>
                    <div class="text-xl font-bold text-red-600" id="total-incorrect">0</div>
                    <div class="text-xs text-gray-600">ì˜¤ë‹µ</div>
                </div>
                <div>
                    <div class="text-xl font-bold text-purple-600" id="difficulty-level">1</div>
                    <div class="text-xs text-gray-600">í˜„ì¬ ë ˆë²¨</div>
                </div>
                <div>
                    <div class="text-xl font-bold text-orange-600" id="time-elapsed">0:00</div>
                    <div class="text-xs text-gray-600">ì†Œìš” ì‹œê°„</div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let selectedSubjects = [];
        let currentSubjectIndex = 0;
        let questions = {};
        let currentDifficulty = 1; // 1: ì‰¬ì›€, 2: ë³´í†µ, 3: ì–´ë ¤ì›€
        let questionCounts = { easy: 0, medium: 0, hard: 0 };
        let targetCounts = { easy: 30, medium: 20, hard: 10 };
        let currentQuestionPool = [];
        let currentQuestionIndex = 0;
        let isAnswered = false;
        let shuffledOptions = [];
        let sessionStats = { correct: 0, incorrect: 0, startTime: Date.now() };
        let recentAnswers = []; // ìµœê·¼ 5ë¬¸ì œ ì •ë‹µ ì—¬ë¶€
        let vibrationEnabled = true; // ì§„ë™ ê¸°ëŠ¥ í™œì„±í™” ì—¬ë¶€

        // ì •ë‹µ ì‚¬ìš´ë“œ ë° ì§„ë™ íš¨ê³¼ í•¨ìˆ˜
        function playCorrectSound() {
            // ì§„ë™ íš¨ê³¼ (ëª¨ë°”ì¼)
            if (vibrationEnabled && navigator.vibrate) {
                // ì •ë‹µ: ê²½ì¾Œí•œ íŒ¨í„´ - ì§§ê²Œ 2ë²ˆ (ì„±ì·¨ê°)
                navigator.vibrate([100, 50, 100]); // ì§„ë™ 100ms â†’ ë©ˆì¶¤ 50ms â†’ ì§„ë™ 100ms
            }
            
            try {
                // Web Audio APIë¥¼ ì‚¬ìš©í•˜ì—¬ ê²½ì¾Œí•œ íš¨ê³¼ìŒ ìƒì„±
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // ì²« ë²ˆì§¸ ìŒ (ë†’ì€ ìŒ)
                const oscillator1 = audioContext.createOscillator();
                const gainNode1 = audioContext.createGain();
                
                oscillator1.connect(gainNode1);
                gainNode1.connect(audioContext.destination);
                
                oscillator1.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator1.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                
                gainNode1.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode1.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                gainNode1.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                
                oscillator1.start(audioContext.currentTime);
                oscillator1.stop(audioContext.currentTime + 0.3);
                
                // ë‘ ë²ˆì§¸ ìŒ (í™”ìŒ)
                const oscillator2 = audioContext.createOscillator();
                const gainNode2 = audioContext.createGain();
                
                oscillator2.connect(gainNode2);
                gainNode2.connect(audioContext.destination);
                
                oscillator2.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator2.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                
                gainNode2.gain.setValueAtTime(0, audioContext.currentTime + 0.1);
                gainNode2.gain.linearRampToValueAtTime(0.25, audioContext.currentTime + 0.11);
                gainNode2.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.4);
                
                oscillator2.start(audioContext.currentTime + 0.1);
                oscillator2.stop(audioContext.currentTime + 0.4);
                
            } catch (error) {
                // Web Audio APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë¬´ì‹œ
                console.log('Audio not supported:', error);
            }
        }

        // ì˜¤ë‹µ ì‚¬ìš´ë“œ ë° ì§„ë™ íš¨ê³¼ í•¨ìˆ˜ (ë ë  ê²½ê³ ìŒ)
        function playIncorrectSound() {
            // ì§„ë™ íš¨ê³¼ (ëª¨ë°”ì¼)
            if (vibrationEnabled && navigator.vibrate) {
                // ì˜¤ë‹µ: ê¸¸ê²Œ í•œ ë²ˆ (ì•Œë¦¼, í•˜ì§€ë§Œ ë„ˆë¬´ ê°•í•˜ì§€ ì•Šê²Œ)
                navigator.vibrate(200); // ì§„ë™ 200ms
            }
            
            try {
                // Web Audio APIë¥¼ ì‚¬ìš©í•˜ì—¬ ê²½ê³ ìŒ ìƒì„±
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // ì²« ë²ˆì§¸ "ë " ì†Œë¦¬ (ë‚®ì€ ê²½ê³ ìŒ)
                const oscillator1 = audioContext.createOscillator();
                const gainNode1 = audioContext.createGain();
                
                oscillator1.connect(gainNode1);
                gainNode1.connect(audioContext.destination);
                
                oscillator1.frequency.setValueAtTime(220, audioContext.currentTime); // A3 (ë‚®ì€ í†¤)
                oscillator1.type = 'square'; // ê²½ê³ ìŒ ëŠë‚Œì˜ ì‚¬ê°íŒŒ
                
                gainNode1.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode1.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                gainNode1.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.15);
                
                oscillator1.start(audioContext.currentTime);
                oscillator1.stop(audioContext.currentTime + 0.15);
                
                // ë‘ ë²ˆì§¸ "ë " ì†Œë¦¬ (ì•½ê°„ì˜ ê°„ê²© í›„)
                const oscillator2 = audioContext.createOscillator();
                const gainNode2 = audioContext.createGain();
                
                oscillator2.connect(gainNode2);
                gainNode2.connect(audioContext.destination);
                
                oscillator2.frequency.setValueAtTime(220, audioContext.currentTime + 0.2); // ê°™ì€ í†¤ ë°˜ë³µ
                oscillator2.type = 'square';
                
                gainNode2.gain.setValueAtTime(0, audioContext.currentTime + 0.2);
                gainNode2.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.21);
                gainNode2.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.35);
                
                oscillator2.start(audioContext.currentTime + 0.2);
                oscillator2.stop(audioContext.currentTime + 0.35);
                
            } catch (error) {
                // Web Audio APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë¬´ì‹œ
                console.log('Audio not supported:', error);
            }
        }

        // ê³¼ëª© ì •ë³´
        const subjects = {
            english: { name: 'ì˜ì–´', icon: 'ğŸ‡ºğŸ‡¸', targetTime: 10 }
        };

        // ë‚œì´ë„ë³„ ì„¤ì •
        const difficultyConfig = {
            1: { name: 'ì‰¬ì›€', class: 'easy', targetCount: 30, timePerQuestion: 20 },
            2: { name: 'ë³´í†µ', class: 'medium', targetCount: 20, timePerQuestion: 22.5 },
            3: { name: 'ì–´ë ¤ì›€', class: 'hard', targetCount: 10, timePerQuestion: 45 }
        };

        // ì´ˆê¸°í™”
        async function initializeQuiz() {
            // localStorageì—ì„œ ì„ íƒëœ ê³¼ëª© ê°€ì ¸ì˜¤ê¸°
            const stored = localStorage.getItem('selectedSubjects');
            if (!stored) {
                selectedSubjects = ['english']; // ê¸°ë³¸ê°’
            } else {
                selectedSubjects = JSON.parse(stored);
            }

            currentSubjectIndex = parseInt(localStorage.getItem('currentSubjectIndex') || '0');

            // ë¬¸ì œ ë°ì´í„° ë¡œë“œ
            await loadQuestions();
            
            // ì§„ë™ ì„¤ì • ë¡œë“œ
            const savedVibration = localStorage.getItem('quizVibrationEnabled');
            if (savedVibration !== null) {
                vibrationEnabled = JSON.parse(savedVibration);
            }
            
            // UI ì´ˆê¸°í™”
            updateUI();
            updateVibrationButton(); // ì§„ë™ ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            generateQuestionPool();
            loadCurrentQuestion();
            startTimer();
        }

        // ë¬¸ì œ ë°ì´í„° ë¡œë“œ
        async function loadQuestions() {
            try {
                const response = await fetch('src/data/questions/expanded-questions.json');
                const allQuestions = await response.json();
                
                // ê³¼ëª©ë³„ë¡œ ë‚œì´ë„ë³„ ë¶„ë¥˜
                const currentSubject = selectedSubjects[currentSubjectIndex];
                questions = {
                    easy: allQuestions.filter(q => q.subject === currentSubject && q.difficulty === 1),
                    medium: allQuestions.filter(q => q.subject === currentSubject && q.difficulty === 2),
                    hard: allQuestions.filter(q => q.subject === currentSubject && q.difficulty === 3)
                };

                console.log('ë¬¸ì œ ë¡œë“œ ì™„ë£Œ:', {
                    easy: questions.easy.length,
                    medium: questions.medium.length, 
                    hard: questions.hard.length
                });
            } catch (error) {
                console.error('ë¬¸ì œ ë¡œë“œ ì‹¤íŒ¨:', error);
                // í´ë°±ìœ¼ë¡œ ê¸°ë³¸ ë¬¸ì œ ì‚¬ìš©
                loadFallbackQuestions();
            }
        }

        // í´ë°± ë¬¸ì œ
        function loadFallbackQuestions() {
            questions = {
                easy: Array(30).fill().map((_, i) => ({
                    id: `eng_easy_${i+1}`,
                    subject: 'english',
                    question: `ì‰¬ìš´ ì˜ì–´ ë¬¸ì œ ${i+1}ë²ˆì…ë‹ˆë‹¤.`,
                    options: ['ì •ë‹µ', 'ì˜¤ë‹µ1', 'ì˜¤ë‹µ2', 'ì˜¤ë‹µ3'],
                    correctIndex: 0,
                    explanation: `ë¬¸ì œ ${i+1}ë²ˆì˜ í•´ì„¤ì…ë‹ˆë‹¤.`,
                    difficulty: 1,
                    audioText: 'sample'
                })),
                medium: Array(20).fill().map((_, i) => ({
                    id: `eng_medium_${i+1}`,
                    subject: 'english', 
                    question: `ë³´í†µ ì˜ì–´ ë¬¸ì œ ${i+1}ë²ˆì…ë‹ˆë‹¤.`,
                    options: ['ì •ë‹µ', 'ì˜¤ë‹µ1', 'ì˜¤ë‹µ2', 'ì˜¤ë‹µ3'],
                    correctIndex: 0,
                    explanation: `ë¬¸ì œ ${i+1}ë²ˆì˜ í•´ì„¤ì…ë‹ˆë‹¤.`,
                    difficulty: 2
                })),
                hard: Array(10).fill().map((_, i) => ({
                    id: `eng_hard_${i+1}`,
                    subject: 'english',
                    question: `ì–´ë ¤ìš´ ì˜ì–´ ë¬¸ì œ ${i+1}ë²ˆì…ë‹ˆë‹¤.`,
                    options: ['ì •ë‹µ', 'ì˜¤ë‹µ1', 'ì˜¤ë‹µ2', 'ì˜¤ë‹µ3'],
                    correctIndex: 0,
                    explanation: `ë¬¸ì œ ${i+1}ë²ˆì˜ í•´ì„¤ì…ë‹ˆë‹¤.`,
                    difficulty: 3
                }))
            };
        }

        // ë¬¸ì œ í’€ ìƒì„±
        function generateQuestionPool() {
            const config = difficultyConfig[currentDifficulty];
            const difficultyKey = config.class;
            
            currentQuestionPool = [...questions[difficultyKey]];
            // ë¬¸ì œ ìˆœì„œ ì…”í”Œ
            for (let i = currentQuestionPool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentQuestionPool[i], currentQuestionPool[j]] = [currentQuestionPool[j], currentQuestionPool[i]];
            }
            
            currentQuestionIndex = 0;
        }

        // í˜„ì¬ ë¬¸ì œ ë¡œë“œ
        function loadCurrentQuestion() {
            if (isSessionComplete()) {
                completeSession();
                return;
            }

            // ë‚œì´ë„ë³„ ë¬¸ì œ ê°œìˆ˜ ì²´í¬
            const config = difficultyConfig[currentDifficulty];
            const difficultyKey = config.class;
            const currentCount = questionCounts[difficultyKey];
            const targetCount = config.targetCount;

            if (currentCount >= targetCount) {
                // í˜„ì¬ ë‚œì´ë„ ì™„ë£Œ, ë‹¤ìŒ ë‚œì´ë„ë¡œ
                upgradeDifficulty();
                return;
            }

            if (currentQuestionIndex >= currentQuestionPool.length) {
                // ë¬¸ì œ í’€ ì¬ìƒì„±
                generateQuestionPool();
            }

            const question = currentQuestionPool[currentQuestionIndex];
            shuffledOptions = shuffleOptions(question);
            isAnswered = false;

            // UI ì—…ë°ì´íŠ¸
            updateQuestionDisplay(question);
            updateProgressDisplay();
        }

        // ë¬¸ì œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateQuestionDisplay(question) {
            document.getElementById('question-text').textContent = question.question;
            
            // ë³´ê¸° ìƒì„±
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = shuffledOptions.map((option, index) => `
                <button class="option-btn w-full p-4 text-left rounded-xl border-2 border-gray-300 hover:border-primary-500 hover:bg-primary-50 font-medium transition-all" onclick="selectOption(${index})">
                    <span class="inline-block w-8 h-8 rounded-full bg-gray-100 text-center leading-8 mr-3 text-sm font-bold">
                        ${String.fromCharCode(65 + index)}
                    </span>
                    ${option.text}
                </button>
            `).join('');

            // TTS ë²„íŠ¼
            const ttsBtn = document.getElementById('tts-btn');
            if (question.audioText) {
                ttsBtn.classList.remove('hidden');
            } else {
                ttsBtn.classList.add('hidden');
            }

            // í•´ì„¤ê³¼ ë‹¤ìŒ ë²„íŠ¼ ìˆ¨ê¹€
            document.getElementById('explanation').classList.add('hidden');
            document.getElementById('next-section').classList.add('hidden');
        }

        // ì§„í–‰ë¥  í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateProgressDisplay() {
            const totalCompleted = questionCounts.easy + questionCounts.medium + questionCounts.hard;
            const totalTarget = targetCounts.easy + targetCounts.medium + targetCounts.hard;
            
            document.getElementById('overall-progress').textContent = `${totalCompleted} / ${totalTarget} ë¬¸ì œ`;
            
            const progress = (totalCompleted / totalTarget) * 100;
            document.getElementById('overall-progress-bar').style.width = progress + '%';

            // ë‚œì´ë„ë³„ í˜„í™© ì—…ë°ì´íŠ¸
            document.getElementById('easy-status').innerHTML = `
                <div class="text-lg font-bold text-green-600">${questionCounts.easy}/30</div>
                <div class="text-xs text-green-700">ì‰¬ì›€ (20ì´ˆ/ë¬¸ì œ)</div>
            `;
            document.getElementById('medium-status').innerHTML = `
                <div class="text-lg font-bold text-yellow-600">${questionCounts.medium}/20</div>
                <div class="text-xs text-yellow-700">ë³´í†µ (22.5ì´ˆ/ë¬¸ì œ)</div>
            `;
            document.getElementById('hard-status').innerHTML = `
                <div class="text-lg font-bold text-red-600">${questionCounts.hard}/10</div>
                <div class="text-xs text-red-700">ì–´ë ¤ì›€ (45ì´ˆ/ë¬¸ì œ)</div>
            `;
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            const currentSubject = selectedSubjects[currentSubjectIndex];
            const subjectInfo = subjects[currentSubject];
            
            document.getElementById('current-subject').textContent = `${subjectInfo.icon} ${subjectInfo.name}`;
            document.getElementById('target-time').textContent = `${subjectInfo.targetTime}ë¶„`;
            
            const config = difficultyConfig[currentDifficulty];
            const difficultyBadge = document.getElementById('difficulty-badge');
            difficultyBadge.textContent = config.name;
            difficultyBadge.className = `px-2 py-1 rounded-full text-xs font-medium difficulty-badge ${config.class}`;

            // ì„¸ì…˜ í†µê³„ ì—…ë°ì´íŠ¸
            const totalAnswered = sessionStats.correct + sessionStats.incorrect;
            const accuracy = totalAnswered > 0 ? Math.round((sessionStats.correct / totalAnswered) * 100) : 0;
            
            document.getElementById('total-correct').textContent = sessionStats.correct;
            document.getElementById('total-incorrect').textContent = sessionStats.incorrect;
            document.getElementById('difficulty-level').textContent = currentDifficulty;
            document.getElementById('session-accuracy').textContent = `ì •ë‹µë¥  ${accuracy}%`;
        }

        // ë³´ê¸° ì…”í”Œ
        function shuffleOptions(question) {
            const options = question.options.map((text, index) => ({ text, originalIndex: index }));
            const shuffled = [...options];
            
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            return shuffled;
        }

        // ì˜µì…˜ ì„ íƒ
        function selectOption(shuffledIndex) {
            if (isAnswered) return;

            const question = currentQuestionPool[currentQuestionIndex];
            const selectedOriginalIndex = shuffledOptions[shuffledIndex].originalIndex;
            const isCorrect = selectedOriginalIndex === question.correctIndex;
            
            isAnswered = true;

            // í†µê³„ ì—…ë°ì´íŠ¸
            if (isCorrect) {
                sessionStats.correct++;
                recentAnswers.push(true);
            } else {
                sessionStats.incorrect++;
                recentAnswers.push(false);
            }

            // ìµœê·¼ 5ë¬¸ì œë§Œ ìœ ì§€
            if (recentAnswers.length > 5) {
                recentAnswers.shift();
            }

            // ë‚œì´ë„ë³„ ì¹´ìš´íŠ¸ ì¦ê°€
            const config = difficultyConfig[currentDifficulty];
            const difficultyKey = config.class;
            questionCounts[difficultyKey]++;

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateOptionButtons(shuffledIndex, question.correctIndex);
            
            // í•´ì„¤ í‘œì‹œ
            setTimeout(() => {
                showExplanation(isCorrect, question.explanation);
                updateUI();
                updateProgressDisplay();
                checkDifficultyAdjustment();
            }, 1000);
        }

        // ì˜µì…˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateOptionButtons(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.option-btn');
            
            options.forEach((btn, index) => {
                const originalIndex = shuffledOptions[index].originalIndex;
                
                if (originalIndex === correctIndex) {
                    btn.classList.add('correct');
                    btn.innerHTML += ' <span class="ml-2 text-xl">âœ…</span>';
                } else if (index === selectedIndex) {
                    btn.classList.add('incorrect');
                    btn.innerHTML += ' <span class="ml-2 text-xl">âŒ</span>';
                } else {
                    btn.classList.add('neutral');
                }
                
                btn.onclick = null;
            });

            if (selectedIndex !== -1 && shuffledOptions[selectedIndex].originalIndex === correctIndex) {
                options[selectedIndex].classList.add('correct-animation');
                
                // ì •ë‹µ ì‚¬ìš´ë“œ íš¨ê³¼ (Web Audio API ì‚¬ìš©)
                playCorrectSound();
            } else if (selectedIndex !== -1) {
                // ì˜¤ë‹µ ì‚¬ìš´ë“œ íš¨ê³¼ (ë ë  ê²½ê³ ìŒ)
                playIncorrectSound();
            }
        }

        // í•´ì„¤ í‘œì‹œ
        function showExplanation(isCorrect, explanation) {
            const explanationDiv = document.getElementById('explanation');
            const resultIcon = document.getElementById('result-icon');
            const resultText = document.getElementById('result-text');
            const explanationText = document.getElementById('explanation-text');

            if (isCorrect) {
                resultIcon.textContent = 'ğŸ‰';
                resultText.textContent = 'ì •ë‹µì…ë‹ˆë‹¤!';
                explanationDiv.className = 'mb-6 p-4 rounded-xl border-2 bg-green-50 border-green-200';
            } else {
                resultIcon.textContent = 'ğŸ’¡';
                resultText.textContent = 'ì•„ì‰½ë„¤ìš”! ì •ë‹µì„ í™•ì¸í•´ë³´ì„¸ìš”.';
                explanationDiv.className = 'mb-6 p-4 rounded-xl border-2 bg-blue-50 border-blue-200';
            }

            explanationText.textContent = explanation;
            explanationDiv.classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('next-section').classList.remove('hidden');
            }, 500);
        }

        // ë‚œì´ë„ ì¡°ì • í™•ì¸
        function checkDifficultyAdjustment() {
            if (recentAnswers.length < 5) return;

            const recentCorrectCount = recentAnswers.filter(answer => answer).length;
            const accuracy = recentCorrectCount / recentAnswers.length;

            // ì •ë‹µë¥  80% ì´ìƒì´ë©´ ë‚œì´ë„ ìƒìŠ¹
            if (accuracy >= 0.8 && currentDifficulty < 3) {
                const config = difficultyConfig[currentDifficulty];
                const difficultyKey = config.class;
                const currentCount = questionCounts[difficultyKey];
                const minRequired = Math.floor(config.targetCount * 0.3); // ìµœì†Œ 30% ì§„í–‰

                if (currentCount >= minRequired) {
                    upgradeDifficulty();
                    showAchievement('ğŸš€ ë‚œì´ë„ ìƒìŠ¹!');
                }
            }
            // ì •ë‹µë¥  40% ì´í•˜ë©´ ë‚œì´ë„ í•˜ë½ (2ë‹¨ê³„ ì´ìƒì—ì„œë§Œ)
            else if (accuracy <= 0.4 && currentDifficulty > 1) {
                downgradeDifficulty();
                showAchievement('ğŸ“– ë‚œì´ë„ ì¡°ì •ë¨');
            }
        }

        // ë‚œì´ë„ ìƒìŠ¹
        function upgradeDifficulty() {
            if (currentDifficulty < 3) {
                currentDifficulty++;
                generateQuestionPool();
                recentAnswers = [];
            }
        }

        // ë‚œì´ë„ í•˜ë½
        function downgradeDifficulty() {
            if (currentDifficulty > 1) {
                currentDifficulty--;
                generateQuestionPool();
                recentAnswers = [];
            }
        }

        // ì„±ì·¨ ì•Œë¦¼ í‘œì‹œ
        function showAchievement(message) {
            const popup = document.getElementById('achievement-popup');
            document.getElementById('achievement-text').textContent = message;
            popup.classList.remove('hidden');
            
            setTimeout(() => {
                popup.classList.add('hidden');
            }, 2000);
        }

        // ì„¸ì…˜ ì™„ë£Œ í™•ì¸
        function isSessionComplete() {
            return questionCounts.easy >= targetCounts.easy && 
                   questionCounts.medium >= targetCounts.medium && 
                   questionCounts.hard >= targetCounts.hard;
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            currentQuestionIndex++;
            loadCurrentQuestion();
        }

        // ì„¸ì…˜ ì™„ë£Œ
        function completeSession() {
            const totalAnswered = sessionStats.correct + sessionStats.incorrect;
            const accuracy = Math.round((sessionStats.correct / totalAnswered) * 100);
            const timeSpent = Math.round((Date.now() - sessionStats.startTime) / 1000 / 60 * 10) / 10;
            
            // í•™ìŠµ ì§„í–‰ë¥  ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
            updateLearningProgress(selectedSubjects[currentSubjectIndex], sessionStats.correct, totalAnswered);
            
            // ì™„ë²½í•œ í€´ì¦ˆ ì„¸ì…˜ ì²´í¬ (ì—…ì ìš©)
            if (accuracy >= 100 && totalAnswered >= 5) {
                const existingProgress = JSON.parse(localStorage.getItem('quizProgress') || '{}');
                existingProgress.perfectSessions = (existingProgress.perfectSessions || 0) + 1;
                localStorage.setItem('quizProgress', JSON.stringify(existingProgress));
            }
            
            // ì •ë‹µë¥ ì— ë”°ë¥¸ ë³´ìƒ ê³„ì‚°
            let coinReward = Math.floor(sessionStats.correct * 10); // ê¸°ë³¸: ì •ë‹µ 1ê°œë‹¹ 10ì½”ì¸
            let bonusCoins = 0;
            
            if (accuracy >= 90) {
                bonusCoins = 200; // 90% ì´ìƒ: ë³´ë„ˆìŠ¤ 200ì½”ì¸
            } else if (accuracy >= 80) {
                bonusCoins = 150; // 80% ì´ìƒ: ë³´ë„ˆìŠ¤ 150ì½”ì¸
            } else if (accuracy >= 70) {
                bonusCoins = 100; // 70% ì´ìƒ: ë³´ë„ˆìŠ¤ 100ì½”ì¸
            } else if (accuracy >= 60) {
                bonusCoins = 50; // 60% ì´ìƒ: ë³´ë„ˆìŠ¤ 50ì½”ì¸
            }
            
            const totalReward = coinReward + bonusCoins;
            
            // ë†ì¥ ì‹œìŠ¤í…œì— ë³´ìƒ ì¶”ê°€
            const farmState = JSON.parse(localStorage.getItem('eduPetFarmState') || '{"coins": 0}');
            farmState.coins = (farmState.coins || 0) + totalReward;
            localStorage.setItem('eduPetFarmState', JSON.stringify(farmState));
            
            alert(`ğŸ‰ í•™ìŠµ ì™„ë£Œ!\n\nì´ ${totalAnswered}ë¬¸ì œ í’€ì´\nì •ë‹µë¥ : ${accuracy}%\nì†Œìš”ì‹œê°„: ${timeSpent}ë¶„\n\nğŸ’° íšë“ ë³´ìƒ:\nê¸°ë³¸ ì½”ì¸: ${coinReward}\në³´ë„ˆìŠ¤: ${bonusCoins}\nì´ ${totalReward} EduCoin!\n\nì‹ë¬¼ì´ ìëì–´ìš”! ğŸŒ±`);
            
            // í•™ìŠµ ê²°ê³¼ ì €ì¥
            localStorage.setItem('adaptiveQuizResults', JSON.stringify({
                subject: selectedSubjects[currentSubjectIndex],
                stats: sessionStats,
                questionCounts,
                completedAt: new Date().toISOString(),
                reward: {
                    coins: coinReward,
                    bonus: bonusCoins,
                    total: totalReward
                }
            }));
            
            // ë†ì¥ì— ë¬¼ë°©ìš¸ ì¶”ê°€ ë° ì‹ë¬¼ ì„±ì¥ ê°€ì† (ì‹¬í”Œ ë†ì¥ ì‹œìŠ¤í…œ)
            const simpleFarmState = JSON.parse(localStorage.getItem('simpleFarmState') || '{"water": 0, "plants": [null, null]}');
            const waterReward = Math.floor(sessionStats.correct / 10) + 3; // ê¸°ë³¸ 3ê°œ + ì •ë‹µ 10ê°œë‹¹ 1ê°œ ì¶”ê°€
            simpleFarmState.water = (simpleFarmState.water || 0) + waterReward;
            
            // í•™ìŠµ ì™„ë£Œ ì‹œ ì‹ë¬¼ ì„±ì¥ ì´‰ì§„ (ê° ì‹ë¬¼ì˜ ëŒë´„ ì •ë„ ì¦ê°€)
            const growthBonus = Math.min(sessionStats.correct * 2, 20); // ì •ë‹µ 1ê°œë‹¹ 2% ì„±ì¥, ìµœëŒ€ 20%
            if (simpleFarmState.plants) {
                [1, 2].forEach(potIndex => {
                    const plant = simpleFarmState.plants[potIndex - 1];
                    if (plant && !plant.isHarvested) {
                        plant.care = Math.min((plant.care || 0) + growthBonus, 100);
                        plant.lastStudied = Date.now(); // í•™ìŠµ ì‹œê°„ ì—…ë°ì´íŠ¸ë¡œ ë“±ê¸‰ í•˜ë½ ë°©ì§€
                        
                        // ì„±ì¥ ìƒíƒœ ì¬ê³„ì‚°
                        const daysPassed = Math.floor((Date.now() - plant.plantedAt) / (1000 * 60 * 60 * 24 / 30)); // 30ë°° ê°€ì†
                        const gradeInfo = {
                            common: { growthDays: 3 },
                            advanced: { growthDays: 7 },
                            epic: { growthDays: 14 },
                            legendary: { growthDays: 28 }
                        }[plant.grade] || { growthDays: 3 };
                        
                        if (daysPassed >= gradeInfo.growthDays && plant.care >= 80) {
                            plant.isFullyGrown = true;
                        }
                    }
                });
            }
            
            localStorage.setItem('simpleFarmState', JSON.stringify(simpleFarmState));
            
            // ë†ì¥ìœ¼ë¡œ ì´ë™í•˜ì—¬ ë³´ìƒ í™•ì¸
            setTimeout(() => {
                if (confirm(`ğŸ‰ ë¬¼ë°©ìš¸ ${waterReward}ê°œ íšë“!\\nì‹ë¬¼ì¹œêµ¬ë“¤ì—ê²Œ ë¬¼ì„ ì£¼ëŸ¬ ê°€ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    window.location.href = 'simple-farm.html';
                } else {
                    window.location.href = 'index.html';
                }
            }, 1000);
        }

        // ì§„ë™ ì„¤ì • í† ê¸€
        function toggleVibration() {
            vibrationEnabled = !vibrationEnabled;
            updateVibrationButton();
            
            // ì„¤ì •ì„ localStorageì— ì €ì¥
            localStorage.setItem('quizVibrationEnabled', vibrationEnabled);
            
            // í…ŒìŠ¤íŠ¸ ì§„ë™ (ì„¤ì • í”¼ë“œë°±)
            if (vibrationEnabled && navigator.vibrate) {
                navigator.vibrate(50); // ì§§ì€ í™•ì¸ ì§„ë™
            }
        }

        // í•™ìŠµ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLearningProgress(subject, correctAnswers, totalQuestions) {
            // ê¸°ì¡´ ì§„í–‰ë¥  ë°ì´í„° ë¡œë“œ
            let progressData = JSON.parse(localStorage.getItem('learningProgress') || '{}');
            
            // ê¸°ë³¸ êµ¬ì¡° ì´ˆê¸°í™”
            if (!progressData.subjectStats) progressData.subjectStats = {};
            if (!progressData.dailyActivity) progressData.dailyActivity = {};
            if (!progressData.unlockedAchievements) progressData.unlockedAchievements = [];
            
            // ê³¼ëª©ë³„ í†µê³„ ì´ˆê¸°í™”
            if (!progressData.subjectStats[subject]) {
                progressData.subjectStats[subject] = {
                    questions: 0,
                    correct: 0,
                    lastStudied: null,
                    level: 1,
                    experience: 0
                };
            }
            
            // ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸
            progressData.totalQuestions = (progressData.totalQuestions || 0) + totalQuestions;
            progressData.correctAnswers = (progressData.correctAnswers || 0) + correctAnswers;
            
            // ê³¼ëª©ë³„ í†µê³„ ì—…ë°ì´íŠ¸
            const subjectStats = progressData.subjectStats[subject];
            subjectStats.questions += totalQuestions;
            subjectStats.correct += correctAnswers;
            subjectStats.experience += correctAnswers * 10; // ì •ë‹µ 1ê°œë‹¹ 10 ê²½í—˜ì¹˜
            subjectStats.lastStudied = Date.now();
            
            // ì¼ì¼ í™œë™ ì—…ë°ì´íŠ¸
            const today = new Date().toDateString();
            progressData.dailyActivity[today] = (progressData.dailyActivity[today] || 0) + totalQuestions;
            
            // ì—°ì† í•™ìŠµì¼ ì—…ë°ì´íŠ¸
            if (!progressData.lastStudyDate || new Date(progressData.lastStudyDate).toDateString() !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (progressData.lastStudyDate && new Date(progressData.lastStudyDate).toDateString() === yesterday.toDateString()) {
                    // ì–´ì œ ê³µë¶€í–ˆìœ¼ë©´ ì—°ì†ì¼ ì¦ê°€
                    progressData.streakDays = (progressData.streakDays || 0) + 1;
                } else {
                    // ì—°ì†ì¼ ë¦¬ì…‹
                    progressData.streakDays = 1;
                }
                
                progressData.lastStudyDate = Date.now();
            }
            
            // í€´ì¦ˆ ì§„í–‰ë¥  ë³„ë„ ì €ì¥ (ê¸°ì¡´ ì‹œìŠ¤í…œ í˜¸í™˜)
            const existingQuizProgress = JSON.parse(localStorage.getItem('quizProgress') || '{}');
            const quizProgress = {
                totalCorrect: progressData.correctAnswers,
                totalAnswered: progressData.totalQuestions,
                sessionCount: (existingQuizProgress.sessionCount || 0) + 1,
                perfectSessions: existingQuizProgress.perfectSessions || 0,
                lastUpdated: Date.now()
            };
            localStorage.setItem('quizProgress', JSON.stringify(quizProgress));
            
            // ìƒˆë¡œìš´ ì„±ì·¨ í™•ì¸ ë° ì•Œë¦¼
            checkNewAchievements(progressData);
            
            // ì—…ë°ì´íŠ¸ëœ ì§„í–‰ë¥  ì €ì¥
            localStorage.setItem('learningProgress', JSON.stringify(progressData));
            
            console.log('í•™ìŠµ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ ì™„ë£Œ:', {
                subject,
                correctAnswers,
                totalQuestions,
                streakDays: progressData.streakDays,
                totalExp: subjectStats.experience
            });
        }
        
        // ìƒˆë¡œìš´ ì„±ì·¨ í™•ì¸
        function checkNewAchievements(progressData) {
            const achievements = [
                { id: 'first_correct', name: 'ì²« ë°œê±¸ìŒ', requirement: 1, type: 'correct_answers', emoji: 'ğŸ‘¶' },
                { id: 'streak_3', name: 'ê¾¸ì¤€í•¨ì˜ ì‹œì‘', requirement: 3, type: 'streak_days', emoji: 'ğŸŒ±' },
                { id: 'streak_7', name: 'ì¼ì£¼ì¼ ì±Œë¦°ì €', requirement: 7, type: 'streak_days', emoji: 'ğŸ”¥' },
                { id: 'correct_25', name: 'ì‹¤ë ¥ì', requirement: 25, type: 'correct_answers', emoji: 'â­' },
                { id: 'correct_100', name: 'ë°±ì  ë§Œì ', requirement: 100, type: 'correct_answers', emoji: 'ğŸŒŸ' }
            ];
            
            achievements.forEach(achievement => {
                if (progressData.unlockedAchievements.includes(achievement.id)) return;
                
                let isUnlocked = false;
                switch (achievement.type) {
                    case 'correct_answers':
                        isUnlocked = progressData.correctAnswers >= achievement.requirement;
                        break;
                    case 'streak_days':
                        isUnlocked = progressData.streakDays >= achievement.requirement;
                        break;
                    case 'accuracy':
                        const accuracy = progressData.totalQuestions > 0 
                            ? (progressData.correctAnswers / progressData.totalQuestions) * 100 
                            : 0;
                        isUnlocked = accuracy >= achievement.requirement;
                        break;
                }
                
                if (isUnlocked) {
                    progressData.unlockedAchievements.push(achievement.id);
                    
                    // ì„±ì·¨ ì•Œë¦¼ í‘œì‹œ
                    setTimeout(() => {
                        showAchievementUnlock(achievement);
                    }, 2000); // í€´ì¦ˆ ì™„ë£Œ ë©”ì‹œì§€ í›„ì— í‘œì‹œ
                }
            });
        }
        
        // ì„±ì·¨ í•´ì œ ì•Œë¦¼ í‘œì‹œ
        function showAchievementUnlock(achievement) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-yellow-400 text-yellow-900 px-6 py-4 rounded-xl shadow-lg z-50 achievement-unlock';
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="text-3xl">${achievement.emoji}</span>
                    <div>
                        <div class="font-bold">ğŸ† ìƒˆë¡œìš´ ì„±ì·¨!</div>
                        <div class="text-sm">${achievement.name}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // 3ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
            
            // ì„±ì·¨ ì‚¬ìš´ë“œ ì¬ìƒ
            playCorrectSound();
        }

        // ì§„ë™ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸
        function updateVibrationButton() {
            const button = document.getElementById('vibration-toggle');
            
            // ì§„ë™ API ì§€ì› ì—¬ë¶€ í™•ì¸
            if (!navigator.vibrate) {
                button.textContent = 'ğŸ“µ';
                button.className = 'p-2 rounded-lg transition-all text-sm bg-gray-100 text-gray-400 cursor-not-allowed';
                button.title = 'ì´ ê¸°ê¸°ëŠ” ì§„ë™ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
                button.disabled = true;
                return;
            }
            
            button.disabled = false;
            if (vibrationEnabled) {
                button.textContent = 'ğŸ“³';
                button.className = 'p-2 rounded-lg transition-all text-sm bg-blue-100 text-blue-700 hover:bg-blue-200';
                button.title = 'ì§„ë™ ì¼œì§ (í´ë¦­í•˜ì—¬ ë„ê¸°)';
            } else {
                button.textContent = 'ğŸ”‡';
                button.className = 'p-2 rounded-lg transition-all text-sm bg-gray-100 text-gray-500 hover:bg-gray-200';
                button.title = 'ì§„ë™ êº¼ì§ (í´ë¦­í•˜ì—¬ ì¼œê¸°)';
            }
        }

        // íƒ€ì´ë¨¸
        function startTimer() {
            setInterval(() => {
                const elapsed = Math.floor((Date.now() - sessionStats.startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('time-elapsed').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // TTS ì¬ìƒ
        function playTTS() {
            const question = currentQuestionPool[currentQuestionIndex];
            
            if (question.audioText && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(question.audioText);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // ë‚˜ê°€ê¸° í™•ì¸
        function confirmExit() {
            if (confirm('í•™ìŠµì„ ì¤‘ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ ìƒí™©ì´ ì €ì¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                window.location.href = 'index.html';
            }
        }

        // ì´ˆê¸°í™” ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', initializeQuiz);
    </script>
</body>
</html>